(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const of=!1;var oc=Array.isArray,zm=Array.prototype.indexOf,ac=Array.from,af=Object.defineProperty,Er=Object.getOwnPropertyDescriptor,cf=Object.getOwnPropertyDescriptors,Hm=Object.prototype,Wm=Array.prototype,cc=Object.getPrototypeOf,_l=Object.isExtensible;const Tr=()=>{};function Gm(n){return n()}function Aa(n){for(var e=0;e<n.length;e++)n[e]()}function uf(){var n,e,t=new Promise((r,s)=>{n=r,e=s});return{promise:t,resolve:n,reject:e}}const Fe=2,uc=4,oo=8,Qt=16,Xt=32,tr=64,ao=128,dt=512,Pe=1024,Ke=2048,Mt=4096,Ze=8192,hn=16384,lc=32768,Dr=65536,yl=1<<17,lf=1<<18,Wr=1<<19,hf=1<<20,Vs=32768,ba=1<<21,hc=1<<22,fn=1<<23,Ir=Symbol("$state"),Km=Symbol("legacy props"),Qm=Symbol(""),yr=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function fc(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Xm(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Jm(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ym(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Zm(n){throw new Error("https://svelte.dev/e/effect_orphan")}function eg(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function tg(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function ng(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function rg(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function sg(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function ig(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const og=1,ag=2,cg=16,ug=1,lg=2,hg=4,fg=8,dg=16,pg=1,mg=2,Ve=Symbol(),gg="http://www.w3.org/1999/xhtml";function _g(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let yg=!1;function ff(n){return n===this.v}function df(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function pf(n){return!df(n,this.v)}let Gr=!1,vg=!1;function Eg(){Gr=!0}let ie=null;function Vr(n){ie=n}function Or(n){return mf().get(n)}function Sa(n,e){return mf().set(n,e),e}function et(n,e=!1,t){ie={p:ie,i:!1,c:null,e:null,s:n,x:null,l:Gr&&!e?{s:null,u:null,$:[]}:null}}function tt(n){var e=ie,t=e.e;if(t!==null){e.e=null;for(var r of t)kf(r)}return e.i=!0,ie=e.p,{}}function zs(){return!Gr||ie!==null&&ie.l===null}function mf(n){return ie===null&&fc(),ie.c??=new Map(Tg(ie)||void 0)}function Tg(n){let e=n.p;for(;e!==null;){const t=e.c;if(t!==null)return t;e=e.p}return null}let xn=[];function gf(){var n=xn;xn=[],Aa(n)}function co(n){if(xn.length===0&&!bs){var e=xn;queueMicrotask(()=>{e===xn&&gf()})}xn.push(n)}function Ig(){for(;xn.length>0;)gf()}function _f(n){var e=ee;if(e===null)return Z.f|=fn,n;if((e.f&lc)===0){if((e.f&ao)===0)throw n;e.b.error(n)}else Mr(n,e)}function Mr(n,e){for(;e!==null;){if((e.f&ao)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n}const mi=new Set;let ae=null,wi=null,Je=null,vt=[],uo=null,Ra=!1,bs=!1;class Et{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#n=0;#r=0;#c=null;#o=[];#a=[];skipped_effects=new Set;is_fork=!1;process(e){vt=[],wi=null,this.apply();var t={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const r of e)this.#s(r,t);this.is_fork||this.#u(),this.#r>0||this.is_fork?(this.#i(t.effects),this.#i(t.render_effects),this.#i(t.block_effects)):(wi=this,ae=null,vl(t.render_effects),vl(t.effects),wi=null,this.#c?.resolve()),Je=null}#s(e,t){e.f^=Pe;for(var r=e.first;r!==null;){var s=r.f,i=(s&(Xt|tr))!==0,a=i&&(s&Pe)!==0,c=a||(s&Ze)!==0||this.skipped_effects.has(r);if((r.f&ao)!==0&&r.b?.is_pending()&&(t={parent:t,effect:r,effects:[],render_effects:[],block_effects:[]}),!c&&r.fn!==null){i?r.f^=Pe:(s&uc)!==0?t.effects.push(r):Kr(r)&&((r.f&Qt)!==0&&t.block_effects.push(r),Lr(r));var l=r.first;if(l!==null){r=l;continue}}var h=r.parent;for(r=r.next;r===null&&h!==null;)h===t.effect&&(this.#i(t.effects),this.#i(t.render_effects),this.#i(t.block_effects),t=t.parent),r=h.next,h=h.parent}}#i(e){for(const t of e)((t.f&Ke)!==0?this.#o:this.#a).push(t),Ce(t,Pe)}capture(e,t){this.previous.has(e)||this.previous.set(e,t),(e.f&fn)===0&&(this.current.set(e,e.v),Je?.set(e,e.v))}activate(){ae=this,this.apply()}deactivate(){ae=null,Je=null}flush(){if(this.activate(),vt.length>0){if(yf(),ae!==null&&ae!==this)return}else this.#n===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#u(){if(this.#r===0){for(const e of this.#e)e();this.#e.clear()}this.#n===0&&this.#l()}#l(){if(mi.size>1){this.previous.clear();var e=Je,t=!0,r={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const s of mi){if(s===this){t=!1;continue}const i=[];for(const[c,l]of this.current){if(s.current.has(c))if(t&&l!==s.current.get(c))s.current.set(c,l);else continue;i.push(c)}if(i.length===0)continue;const a=[...s.current.keys()].filter(c=>!this.current.has(c));if(a.length>0){const c=new Set,l=new Map;for(const h of i)vf(h,a,c,l);if(vt.length>0){ae=s,s.apply();for(const h of vt)s.#s(h,r);vt=[],s.deactivate()}}}ae=null,Je=e}this.committed=!0,mi.delete(this)}increment(e){this.#n+=1,e&&(this.#r+=1)}decrement(e){this.#n-=1,e&&(this.#r-=1),this.revive()}revive(){for(const e of this.#o)Ce(e,Ke),Wn(e);for(const e of this.#a)Ce(e,Mt),Wn(e);this.#o=[],this.#a=[],this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#c??=uf()).promise}static ensure(){if(ae===null){const e=ae=new Et;mi.add(ae),bs||Et.enqueue(()=>{ae===e&&e.flush()})}return ae}static enqueue(e){co(e)}apply(){}}function wg(n){var e=bs;bs=!0;try{for(var t;;){if(Ig(),vt.length===0&&(ae?.flush(),vt.length===0))return uo=null,t;yf()}}finally{bs=e}}function yf(){var n=$n;Ra=!0;try{var e=0;for(Tl(!0);vt.length>0;){var t=Et.ensure();if(e++>1e3){var r,s;Ag()}t.process(vt),dn.clear()}}finally{Ra=!1,Tl(n),uo=null}}function Ag(){try{eg()}catch(n){Mr(n,uo)}}let Bt=null;function vl(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var r=n[t++];if((r.f&(hn|Ze))===0&&Kr(r)&&(Bt=new Set,Lr(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?Vf(r):r.fn=null),Bt?.size>0)){dn.clear();for(const s of Bt){if((s.f&(hn|Ze))!==0)continue;const i=[s];let a=s.parent;for(;a!==null;)Bt.has(a)&&(Bt.delete(a),i.push(a)),a=a.parent;for(let c=i.length-1;c>=0;c--){const l=i[c];(l.f&(hn|Ze))===0&&Lr(l)}}Bt.clear()}}Bt=null}}function vf(n,e,t,r){if(!t.has(n)&&(t.add(n),n.reactions!==null))for(const s of n.reactions){const i=s.f;(i&Fe)!==0?vf(s,e,t,r):(i&(hc|Qt))!==0&&(i&Ke)===0&&Ef(s,e,r)&&(Ce(s,Ke),Wn(s))}}function Ef(n,e,t){const r=t.get(n);if(r!==void 0)return r;if(n.deps!==null)for(const s of n.deps){if(e.includes(s))return!0;if((s.f&Fe)!==0&&Ef(s,e,t))return t.set(s,!0),!0}return t.set(n,!1),!1}function Wn(n){for(var e=uo=n;e.parent!==null;){e=e.parent;var t=e.f;if(Ra&&e===ee&&(t&Qt)!==0&&(t&lf)===0)return;if((t&(tr|Xt))!==0){if((t&Pe)===0)return;e.f^=Pe}}vt.push(e)}function bg(n){let e=0,t=Gn(0),r;return()=>{po()&&(M(t),mo(()=>(e===0&&(r=Me(()=>n(()=>Ss(t)))),e+=1,()=>{co(()=>{e-=1,e===0&&(r?.(),r=void 0,Ss(t))})})))}}var Sg=Dr|Wr|ao;function Rg(n,e,t){new Pg(n,e,t)}class Pg{parent;#e=!1;#t;#n=null;#r;#c;#o;#a=null;#s=null;#i=null;#u=null;#l=null;#d=0;#h=0;#p=!1;#f=null;#v=bg(()=>(this.#f=Gn(this.#d),()=>{this.#f=null}));constructor(e,t,r){this.#t=e,this.#r=t,this.#c=r,this.parent=ee.b,this.#e=!!this.#r.pending,this.#o=mc(()=>{ee.b=this;{var s=this.#_();try{this.#a=ct(()=>r(s))}catch(i){this.error(i)}this.#h>0?this.#g():this.#e=!1}return()=>{this.#l?.remove()}},Sg)}#E(){try{this.#a=ct(()=>this.#c(this.#t))}catch(e){this.error(e)}this.#e=!1}#T(){const e=this.#r.pending;e&&(this.#s=ct(()=>e(this.#t)),Et.enqueue(()=>{var t=this.#_();this.#a=this.#m(()=>(Et.ensure(),ct(()=>this.#c(t)))),this.#h>0?this.#g():(wr(this.#s,()=>{this.#s=null}),this.#e=!1)}))}#_(){var e=this.#t;return this.#e&&(this.#l=Kn(),this.#t.before(this.#l),e=this.#l),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#r.pending}#m(e){var t=ee,r=Z,s=ie;kt(this.#o),We(this.#o),Vr(this.#o.ctx);try{return e()}catch(i){return _f(i),null}finally{kt(t),We(r),Vr(s)}}#g(){const e=this.#r.pending;this.#a!==null&&(this.#u=document.createDocumentFragment(),this.#u.append(this.#l),Lf(this.#a,this.#u)),this.#s===null&&(this.#s=ct(()=>e(this.#t)))}#y(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#y(e);return}this.#h+=e,this.#h===0&&(this.#e=!1,this.#s&&wr(this.#s,()=>{this.#s=null}),this.#u&&(this.#t.before(this.#u),this.#u=null))}update_pending_count(e){this.#y(e),this.#d+=e,this.#f&&Os(this.#f,this.#d)}get_effect_pending(){return this.#v(),M(this.#f)}error(e){var t=this.#r.onerror;let r=this.#r.failed;if(this.#p||!t&&!r)throw e;this.#a&&(qe(this.#a),this.#a=null),this.#s&&(qe(this.#s),this.#s=null),this.#i&&(qe(this.#i),this.#i=null);var s=!1,i=!1;const a=()=>{if(s){_g();return}s=!0,i&&ig(),Et.ensure(),this.#d=0,this.#i!==null&&wr(this.#i,()=>{this.#i=null}),this.#e=this.has_pending_snippet(),this.#a=this.#m(()=>(this.#p=!1,ct(()=>this.#c(this.#t)))),this.#h>0?this.#g():this.#e=!1};var c=Z;try{We(null),i=!0,t?.(e,a),i=!1}catch(l){Mr(l,this.#o&&this.#o.parent)}finally{We(c)}r&&co(()=>{this.#i=this.#m(()=>{Et.ensure(),this.#p=!0;try{return ct(()=>{r(this.#t,()=>e,()=>a)})}catch(l){return Mr(l,this.#o.parent),null}finally{this.#p=!1}})})}}function Cg(n,e,t,r){const s=zs()?lo:ho;if(t.length===0&&n.length===0){r(e.map(s));return}var i=ae,a=ee,c=kg();function l(){Promise.all(t.map(h=>Ng(h))).then(h=>{c();try{r([...e.map(s),...h])}catch(d){(a.f&hn)===0&&Mr(d,a)}i?.deactivate(),Oi()}).catch(h=>{Mr(h,a)})}n.length>0?Promise.all(n).then(()=>{c();try{return l()}finally{i?.deactivate(),Oi()}}):l()}function kg(){var n=ee,e=Z,t=ie,r=ae;return function(i=!0){kt(n),We(e),Vr(t),i&&r?.activate()}}function Oi(){kt(null),We(null),Vr(null)}function lo(n){var e=Fe|Ke,t=Z!==null&&(Z.f&Fe)!==0?Z:null;return ee!==null&&(ee.f|=Wr),{ctx:ie,deps:null,effects:null,equals:ff,f:e,fn:n,reactions:null,rv:0,v:Ve,wv:0,parent:t??ee,ac:null}}function Ng(n,e){let t=ee;t===null&&Xm();var r=t.b,s=void 0,i=Gn(Ve),a=!Z,c=new Map;return $g(()=>{var l=uf();s=l.promise;try{Promise.resolve(n()).then(l.resolve,l.reject).then(()=>{h===ae&&h.committed&&h.deactivate(),Oi()})}catch(m){l.reject(m),Oi()}var h=ae;if(a){var d=!r.is_pending();r.update_pending_count(1),h.increment(d),c.get(h)?.reject(yr),c.delete(h),c.set(h,l)}const g=(m,E=void 0)=>{if(h.activate(),E)E!==yr&&(i.f|=fn,Os(i,E));else{(i.f&fn)!==0&&(i.f^=fn),Os(i,m);for(const[S,C]of c){if(c.delete(S),S===h)break;C.reject(yr)}}a&&(r.update_pending_count(-1),h.decrement(d))};l.promise.then(g,m=>g(null,m||"unknown"))}),pc(()=>{for(const l of c.values())l.reject(yr)}),new Promise(l=>{function h(d){function g(){d===s?l(i):h(s)}d.then(g,g)}h(s)})}function ho(n){const e=lo(n);return e.equals=pf,e}function Tf(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)qe(e[t])}}function Dg(n){for(var e=n.parent;e!==null;){if((e.f&Fe)===0)return e;e=e.parent}return null}function dc(n){var e,t=ee;kt(Dg(n));try{n.f&=~Vs,Tf(n),e=Bf(n)}finally{kt(t)}return e}function If(n){var e=dc(n);if(n.equals(e)||(n.v=e,n.wv=Ff()),!rr)if(Je!==null)po()&&Je.set(n,n.v);else{var t=(n.f&dt)===0?Mt:Pe;Ce(n,t)}}let Pa=new Set;const dn=new Map;let wf=!1;function Gn(n,e){var t={f:0,v:n,reactions:null,equals:ff,rv:0,wv:0};return t}function sn(n,e){const t=Gn(n);return zg(t),t}function pe(n,e=!1,t=!0){const r=Gn(n);return e||(r.equals=pf),Gr&&t&&ie!==null&&ie.l!==null&&(ie.l.s??=[]).push(r),r}function z(n,e,t=!1){Z!==null&&(!Tt||(Z.f&yl)!==0)&&zs()&&(Z.f&(Fe|Qt|hc|yl))!==0&&!zt?.includes(n)&&sg();let r=t?vr(e):e;return Os(n,r)}function Os(n,e){if(!n.equals(e)){var t=n.v;rr?dn.set(n,e):dn.set(n,t),n.v=e;var r=Et.ensure();r.capture(n,t),(n.f&Fe)!==0&&((n.f&Ke)!==0&&dc(n),Ce(n,(n.f&dt)!==0?Pe:Mt)),n.wv=Ff(),Af(n,Ke),zs()&&ee!==null&&(ee.f&Pe)!==0&&(ee.f&(Xt|tr))===0&&(st===null?Hg([n]):st.push(n)),!r.is_fork&&Pa.size>0&&!wf&&Vg()}return e}function Vg(){wf=!1;const n=Array.from(Pa);for(const e of n)(e.f&Pe)!==0&&Ce(e,Mt),Kr(e)&&Lr(e);Pa.clear()}function Ss(n){z(n,n.v+1)}function Af(n,e){var t=n.reactions;if(t!==null)for(var r=zs(),s=t.length,i=0;i<s;i++){var a=t[i],c=a.f;if(!(!r&&a===ee)){var l=(c&Ke)===0;if(l&&Ce(a,e),(c&Fe)!==0){var h=a;Je?.delete(h),(c&Vs)===0&&(c&dt&&(a.f|=Vs),Af(h,Mt))}else l&&((c&Qt)!==0&&Bt!==null&&Bt.add(a),Wn(a))}}}function vr(n){if(typeof n!="object"||n===null||Ir in n)return n;const e=cc(n);if(e!==Hm&&e!==Wm)return n;var t=new Map,r=oc(n),s=sn(0),i=jn,a=c=>{if(jn===i)return c();var l=Z,h=jn;We(null),wl(i);var d=c();return We(l),wl(h),d};return r&&t.set("length",sn(n.length)),new Proxy(n,{defineProperty(c,l,h){(!("value"in h)||h.configurable===!1||h.enumerable===!1||h.writable===!1)&&ng();var d=t.get(l);return d===void 0?d=a(()=>{var g=sn(h.value);return t.set(l,g),g}):z(d,h.value,!0),!0},deleteProperty(c,l){var h=t.get(l);if(h===void 0){if(l in c){const d=a(()=>sn(Ve));t.set(l,d),Ss(s)}}else z(h,Ve),Ss(s);return!0},get(c,l,h){if(l===Ir)return n;var d=t.get(l),g=l in c;if(d===void 0&&(!g||Er(c,l)?.writable)&&(d=a(()=>{var E=vr(g?c[l]:Ve),S=sn(E);return S}),t.set(l,d)),d!==void 0){var m=M(d);return m===Ve?void 0:m}return Reflect.get(c,l,h)},getOwnPropertyDescriptor(c,l){var h=Reflect.getOwnPropertyDescriptor(c,l);if(h&&"value"in h){var d=t.get(l);d&&(h.value=M(d))}else if(h===void 0){var g=t.get(l),m=g?.v;if(g!==void 0&&m!==Ve)return{enumerable:!0,configurable:!0,value:m,writable:!0}}return h},has(c,l){if(l===Ir)return!0;var h=t.get(l),d=h!==void 0&&h.v!==Ve||Reflect.has(c,l);if(h!==void 0||ee!==null&&(!d||Er(c,l)?.writable)){h===void 0&&(h=a(()=>{var m=d?vr(c[l]):Ve,E=sn(m);return E}),t.set(l,h));var g=M(h);if(g===Ve)return!1}return d},set(c,l,h,d){var g=t.get(l),m=l in c;if(r&&l==="length")for(var E=h;E<g.v;E+=1){var S=t.get(E+"");S!==void 0?z(S,Ve):E in c&&(S=a(()=>sn(Ve)),t.set(E+"",S))}if(g===void 0)(!m||Er(c,l)?.writable)&&(g=a(()=>sn(void 0)),z(g,vr(h)),t.set(l,g));else{m=g.v!==Ve;var C=a(()=>vr(h));z(g,C)}var P=Reflect.getOwnPropertyDescriptor(c,l);if(P?.set&&P.set.call(d,h),!m){if(r&&typeof l=="string"){var x=t.get("length"),V=Number(l);Number.isInteger(V)&&V>=x.v&&z(x,V+1)}Ss(s)}return!0},ownKeys(c){M(s);var l=Reflect.ownKeys(c).filter(g=>{var m=t.get(g);return m===void 0||m.v!==Ve});for(var[h,d]of t)d.v!==Ve&&!(h in c)&&l.push(h);return l},setPrototypeOf(){rg()}})}var Ca,bf,Sf,Rf;function Og(){if(Ca===void 0){Ca=window,bf=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;Sf=Er(e,"firstChild").get,Rf=Er(e,"nextSibling").get,_l(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),_l(t)&&(t.__t=void 0)}}function Kn(n=""){return document.createTextNode(n)}function Mi(n){return Sf.call(n)}function Hs(n){return Rf.call(n)}function ne(n,e){return Mi(n)}function Bn(n,e=!1){{var t=Mi(n);return t instanceof Comment&&t.data===""?Hs(t):t}}function le(n,e=1,t=!1){let r=n;for(;e--;)r=Hs(r);return r}function Mg(n){n.textContent=""}function Pf(){return!1}let El=!1;function Lg(){El||(El=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const e of n.target.elements)e.__on_r?.()})},{capture:!0}))}function fo(n){var e=Z,t=ee;We(null),kt(null);try{return n()}finally{We(e),kt(t)}}function xg(n,e,t,r=t){n.addEventListener(e,()=>fo(t));const s=n.__on_r;s?n.__on_r=()=>{s(),r(!0)}:n.__on_r=()=>r(!0),Lg()}function Cf(n){ee===null&&(Z===null&&Zm(),Ym()),rr&&Jm()}function Fg(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function Jt(n,e,t,r=!0){var s=ee;s!==null&&(s.f&Ze)!==0&&(n|=Ze);var i={ctx:ie,deps:null,nodes_start:null,nodes_end:null,f:n|Ke|dt,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{Lr(i),i.f|=lc}catch(l){throw qe(i),l}else e!==null&&Wn(i);if(r){var a=i;if(t&&a.deps===null&&a.teardown===null&&a.nodes_start===null&&a.first===a.last&&(a.f&Wr)===0&&(a=a.first,(n&Qt)!==0&&(n&Dr)!==0&&a!==null&&(a.f|=Dr)),a!==null&&(a.parent=s,s!==null&&Fg(a,s),Z!==null&&(Z.f&Fe)!==0&&(n&tr)===0)){var c=Z;(c.effects??=[]).push(a)}}return i}function po(){return Z!==null&&!Tt}function pc(n){const e=Jt(oo,null,!1);return Ce(e,Pe),e.teardown=n,e}function ka(n){Cf();var e=ee.f,t=!Z&&(e&Xt)!==0&&(e&lc)===0;if(t){var r=ie;(r.e??=[]).push(n)}else return kf(n)}function kf(n){return Jt(uc|hf,n,!1)}function Ug(n){return Cf(),Jt(oo|hf,n,!0)}function Bg(n){Et.ensure();const e=Jt(tr|Wr,n,!0);return(t={})=>new Promise(r=>{t.outro?wr(e,()=>{qe(e),r(void 0)}):(qe(e),r(void 0))})}function vn(n,e){var t=ie,r={effect:null,ran:!1,deps:n};t.l.$.push(r),r.effect=mo(()=>{n(),!r.ran&&(r.ran=!0,Me(e))})}function nr(){var n=ie;mo(()=>{for(var e of n.l.$){e.deps();var t=e.effect;(t.f&Pe)!==0&&Ce(t,Mt),Kr(t)&&Lr(t),e.ran=!1}})}function $g(n){return Jt(hc|Wr,n,!0)}function mo(n,e=0){return Jt(oo|e,n,!0)}function Ct(n,e=[],t=[],r=[],s=!1){Cg(r,e,t,i=>{Jt(s?uc:oo,()=>n(...i.map(M)),!0)})}function mc(n,e=0){var t=Jt(Qt|e,n,!0);return t}function ct(n,e=!0){return Jt(Xt|Wr,n,!0,e)}function Nf(n){var e=n.teardown;if(e!==null){const t=rr,r=Z;Il(!0),We(null);try{e.call(null)}finally{Il(t),We(r)}}}function Df(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const s=t.ac;s!==null&&fo(()=>{s.abort(yr)});var r=t.next;(t.f&tr)!==0?t.parent=null:qe(t,e),t=r}}function jg(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Xt)===0&&qe(e),e=t}}function qe(n,e=!0){var t=!1;(e||(n.f&lf)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(qg(n.nodes_start,n.nodes_end),t=!0),Df(n,e&&!t),Li(n,0),Ce(n,hn);var r=n.transitions;if(r!==null)for(const i of r)i.stop();Nf(n);var s=n.parent;s!==null&&s.first!==null&&Vf(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function qg(n,e){for(;n!==null;){var t=n===e?null:Hs(n);n.remove(),n=t}}function Vf(n){var e=n.parent,t=n.prev,r=n.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===n&&(e.first=r),e.last===n&&(e.last=t))}function wr(n,e,t=!0){var r=[];gc(n,r,!0),Of(r,()=>{t&&qe(n),e&&e()})}function Of(n,e){var t=n.length;if(t>0){var r=()=>--t||e();for(var s of n)s.out(r)}else e()}function gc(n,e,t){if((n.f&Ze)===0){if(n.f^=Ze,n.transitions!==null)for(const a of n.transitions)(a.is_global||t)&&e.push(a);for(var r=n.first;r!==null;){var s=r.next,i=(r.f&Dr)!==0||(r.f&Xt)!==0&&(n.f&Qt)!==0;gc(r,e,i?t:!1),r=s}}}function _c(n){Mf(n,!0)}function Mf(n,e){if((n.f&Ze)!==0){n.f^=Ze,(n.f&Pe)===0&&(Ce(n,Ke),Wn(n));for(var t=n.first;t!==null;){var r=t.next,s=(t.f&Dr)!==0||(t.f&Xt)!==0;Mf(t,s?e:!1),t=r}if(n.transitions!==null)for(const i of n.transitions)(i.is_global||e)&&i.in()}}function Lf(n,e){for(var t=n.nodes_start,r=n.nodes_end;t!==null;){var s=t===r?null:Hs(t);e.append(t),t=s}}let $n=!1;function Tl(n){$n=n}let rr=!1;function Il(n){rr=n}let Z=null,Tt=!1;function We(n){Z=n}let ee=null;function kt(n){ee=n}let zt=null;function zg(n){Z!==null&&(zt===null?zt=[n]:zt.push(n))}let je=null,Xe=0,st=null;function Hg(n){st=n}let xf=1,Ms=0,jn=Ms;function wl(n){jn=n}function Ff(){return++xf}function Kr(n){var e=n.f;if((e&Ke)!==0)return!0;if(e&Fe&&(n.f&=~Vs),(e&Mt)!==0){var t=n.deps;if(t!==null)for(var r=t.length,s=0;s<r;s++){var i=t[s];if(Kr(i)&&If(i),i.wv>n.wv)return!0}(e&dt)!==0&&Je===null&&Ce(n,Pe)}return!1}function Uf(n,e,t=!0){var r=n.reactions;if(r!==null&&!zt?.includes(n))for(var s=0;s<r.length;s++){var i=r[s];(i.f&Fe)!==0?Uf(i,e,!1):e===i&&(t?Ce(i,Ke):(i.f&Pe)!==0&&Ce(i,Mt),Wn(i))}}function Bf(n){var e=je,t=Xe,r=st,s=Z,i=zt,a=ie,c=Tt,l=jn,h=n.f;je=null,Xe=0,st=null,Z=(h&(Xt|tr))===0?n:null,zt=null,Vr(n.ctx),Tt=!1,jn=++Ms,n.ac!==null&&(fo(()=>{n.ac.abort(yr)}),n.ac=null);try{n.f|=ba;var d=n.fn,g=d(),m=n.deps;if(je!==null){var E;if(Li(n,Xe),m!==null&&Xe>0)for(m.length=Xe+je.length,E=0;E<je.length;E++)m[Xe+E]=je[E];else n.deps=m=je;if($n&&po()&&(n.f&dt)!==0)for(E=Xe;E<m.length;E++)(m[E].reactions??=[]).push(n)}else m!==null&&Xe<m.length&&(Li(n,Xe),m.length=Xe);if(zs()&&st!==null&&!Tt&&m!==null&&(n.f&(Fe|Mt|Ke))===0)for(E=0;E<st.length;E++)Uf(st[E],n);return s!==null&&s!==n&&(Ms++,st!==null&&(r===null?r=st:r.push(...st))),(n.f&fn)!==0&&(n.f^=fn),g}catch(S){return _f(S)}finally{n.f^=ba,je=e,Xe=t,st=r,Z=s,zt=i,Vr(a),Tt=c,jn=l}}function Wg(n,e){let t=e.reactions;if(t!==null){var r=zm.call(t,n);if(r!==-1){var s=t.length-1;s===0?t=e.reactions=null:(t[r]=t[s],t.pop())}}t===null&&(e.f&Fe)!==0&&(je===null||!je.includes(e))&&(Ce(e,Mt),(e.f&dt)!==0&&(e.f^=dt,e.f&=~Vs),Tf(e),Li(e,0))}function Li(n,e){var t=n.deps;if(t!==null)for(var r=e;r<t.length;r++)Wg(n,t[r])}function Lr(n){var e=n.f;if((e&hn)===0){Ce(n,Pe);var t=ee,r=$n;ee=n,$n=!0;try{(e&Qt)!==0?jg(n):Df(n),Nf(n);var s=Bf(n);n.teardown=typeof s=="function"?s:null,n.wv=xf;var i;of&&vg&&(n.f&Ke)!==0&&n.deps}finally{$n=r,ee=t}}}async function Gg(){await Promise.resolve(),wg()}function M(n){var e=n.f,t=(e&Fe)!==0;if(Z!==null&&!Tt){var r=ee!==null&&(ee.f&hn)!==0;if(!r&&!zt?.includes(n)){var s=Z.deps;if((Z.f&ba)!==0)n.rv<Ms&&(n.rv=Ms,je===null&&s!==null&&s[Xe]===n?Xe++:je===null?je=[n]:je.includes(n)||je.push(n));else{(Z.deps??=[]).push(n);var i=n.reactions;i===null?n.reactions=[Z]:i.includes(Z)||i.push(Z)}}}if(rr){if(dn.has(n))return dn.get(n);if(t){var a=n,c=a.v;return((a.f&Pe)===0&&a.reactions!==null||jf(a))&&(c=dc(a)),dn.set(a,c),c}}else if(t){if(a=n,Je?.has(a))return Je.get(a);Kr(a)&&If(a),$n&&po()&&(a.f&dt)===0&&$f(a)}else if(Je?.has(n))return Je.get(n);if((n.f&fn)!==0)throw n.v;return n.v}function $f(n){if(n.deps!==null){n.f^=dt;for(const e of n.deps)(e.reactions??=[]).push(n),(e.f&Fe)!==0&&(e.f&dt)===0&&$f(e)}}function jf(n){if(n.v===Ve)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(dn.has(e)||(e.f&Fe)!==0&&jf(e))return!0;return!1}function Me(n){var e=Tt;try{return Tt=!0,n()}finally{Tt=e}}const Kg=-7169;function Ce(n,e){n.f=n.f&Kg|e}function yc(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(Ir in n)Na(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&Ir in t&&Na(t)}}}function Na(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let r in n)try{Na(n[r],e)}catch{}const t=cc(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const r=cf(t);for(let s in r){const i=r[s].get;if(i)try{i.call(n)}catch{}}}}}const Qg=["touchstart","touchmove"];function Xg(n){return Qg.includes(n)}const Jg=new Set,Al=new Set;function Yg(n,e,t,r={}){function s(i){if(r.capture||Es.call(e,i),!i.cancelBubble)return fo(()=>t?.call(this,i))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?co(()=>{e.addEventListener(n,s,r)}):e.addEventListener(n,s,r),s}function Nt(n,e,t,r,s){var i={capture:r,passive:s},a=Yg(n,e,t,i);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&pc(()=>{e.removeEventListener(n,a,i)})}let bl=null;function Es(n){var e=this,t=e.ownerDocument,r=n.type,s=n.composedPath?.()||[],i=s[0]||n.target;bl=n;var a=0,c=bl===n&&n.__root;if(c){var l=s.indexOf(c);if(l!==-1&&(e===document||e===window)){n.__root=e;return}var h=s.indexOf(e);if(h===-1)return;l<=h&&(a=l)}if(i=s[a]||n.target,i!==e){af(n,"currentTarget",{configurable:!0,get(){return i||t}});var d=Z,g=ee;We(null),kt(null);try{for(var m,E=[];i!==null;){var S=i.assignedSlot||i.parentNode||i.host||null;try{var C=i["__"+r];C!=null&&(!i.disabled||n.target===i)&&C.call(i,n)}catch(P){m?E.push(P):m=P}if(n.cancelBubble||S===e||S===null)break;i=S}if(m){for(let P of E)queueMicrotask(()=>{throw P});throw m}}finally{n.__root=e,delete n.currentTarget,We(d),kt(g)}}}function Zg(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function Da(n,e){var t=ee;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function he(n,e){var t=(e&pg)!==0,r=(e&mg)!==0,s,i=!n.startsWith("<!>");return()=>{s===void 0&&(s=Zg(i?n:"<!>"+n),t||(s=Mi(s)));var a=r||bf?document.importNode(s,!0):s.cloneNode(!0);if(t){var c=Mi(a),l=a.lastChild;Da(c,l)}else Da(a,a);return a}}function vc(){var n=document.createDocumentFragment(),e=document.createComment(""),t=Kn();return n.append(e,t),Da(e,t),n}function se(n,e){n!==null&&n.before(e)}function go(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function e_(n,e){return t_(n,e)}const fr=new Map;function t_(n,{target:e,anchor:t,props:r={},events:s,context:i,intro:a=!0}){Og();var c=new Set,l=g=>{for(var m=0;m<g.length;m++){var E=g[m];if(!c.has(E)){c.add(E);var S=Xg(E);e.addEventListener(E,Es,{passive:S});var C=fr.get(E);C===void 0?(document.addEventListener(E,Es,{passive:S}),fr.set(E,1)):fr.set(E,C+1)}}};l(ac(Jg)),Al.add(l);var h=void 0,d=Bg(()=>{var g=t??e.appendChild(Kn());return Rg(g,{pending:()=>{}},m=>{if(i){et({});var E=ie;E.c=i}s&&(r.$$events=s),h=n(m,r)||{},i&&tt()}),()=>{for(var m of c){e.removeEventListener(m,Es);var E=fr.get(m);--E===0?(document.removeEventListener(m,Es),fr.delete(m)):fr.set(m,E)}Al.delete(l),g!==t&&g.parentNode?.removeChild(g)}});return n_.set(h,d),h}let n_=new WeakMap;class r_{anchor;#e=new Map;#t=new Map;#n=new Map;#r=!0;constructor(e,t=!0){this.anchor=e,this.#r=t}#c=()=>{var e=ae;if(this.#e.has(e)){var t=this.#e.get(e),r=this.#t.get(t);if(r)_c(r);else{var s=this.#n.get(t);s&&(this.#t.set(t,s.effect),this.#n.delete(t),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),r=s.effect)}for(const[i,a]of this.#e){if(this.#e.delete(i),i===e)break;const c=this.#n.get(a);c&&(qe(c.effect),this.#n.delete(a))}for(const[i,a]of this.#t){if(i===t)continue;const c=()=>{if(Array.from(this.#e.values()).includes(i)){var h=document.createDocumentFragment();Lf(a,h),h.append(Kn()),this.#n.set(i,{effect:a,fragment:h})}else qe(a);this.#t.delete(i)};this.#r||!r?wr(a,c,!1):c()}}};#o=e=>{this.#e.delete(e);const t=Array.from(this.#e.values());for(const[r,s]of this.#n)t.includes(r)||(qe(s.effect),this.#n.delete(r))};ensure(e,t){var r=ae,s=Pf();if(t&&!this.#t.has(e)&&!this.#n.has(e))if(s){var i=document.createDocumentFragment(),a=Kn();i.append(a),this.#n.set(e,{effect:ct(()=>t(a)),fragment:i})}else this.#t.set(e,ct(()=>t(this.anchor)));if(this.#e.set(r,e),s){for(const[c,l]of this.#t)c===e?r.skipped_effects.delete(l):r.skipped_effects.add(l);for(const[c,l]of this.#n)c===e?r.skipped_effects.delete(l.effect):r.skipped_effects.add(l.effect);r.oncommit(this.#c),r.ondiscard(this.#o)}else this.#c()}}function lt(n,e,t=!1){var r=new r_(n),s=t?Dr:0;function i(a,c){r.ensure(a,c)}mc(()=>{var a=!1;e((c,l=!0)=>{a=!0,i(l,c)}),a||i(!1,null)},s)}function qf(n,e){return e}function s_(n,e,t){for(var r=n.items,s=[],i=e.length,a=0;a<i;a++)gc(e[a].e,s,!0);var c=i>0&&s.length===0&&t!==null;if(c){var l=t.parentNode;Mg(l),l.append(t),r.clear(),_t(n,e[0].prev,e[i-1].next)}Of(s,()=>{for(var h=0;h<i;h++){var d=e[h];c||(r.delete(d.k),_t(n,d.prev,d.next)),qe(d.e,!c)}})}function zf(n,e,t,r,s,i=null){var a=n,c={flags:e,items:new Map,first:null};{var l=n;a=l.appendChild(Kn())}var h=null,d=!1,g=new Map,m=ho(()=>{var P=t();return oc(P)?P:P==null?[]:ac(P)}),E,S;function C(){i_(S,E,c,g,a,s,e,r,t),i!==null&&(E.length===0?h?_c(h):h=ct(()=>i(a)):h!==null&&wr(h,()=>{h=null}))}mc(()=>{S??=ee,E=M(m);var P=E.length;if(!(d&&P===0)){d=P===0;var x,V,k,F;if(Pf()){var G=new Set,J=ae;for(V=0;V<P;V+=1){k=E[V],F=r(k,V);var I=c.items.get(F)??g.get(F);I?Hf(I,k,V):(x=Wf(null,c,null,null,k,F,V,s,e,t,!0),g.set(F,x)),G.add(F)}for(const[_,y]of c.items)G.has(_)||J.skipped_effects.add(y.e);J.oncommit(C)}else C();M(m)}})}function i_(n,e,t,r,s,i,a,c,l){var h=e.length,d=t.items,g=t.first,m=g,E,S=null,C=[],P=[],x,V,k,F;for(F=0;F<h;F+=1){if(x=e[F],V=c(x,F),k=d.get(V),k===void 0){var G=r.get(V);if(G!==void 0){r.delete(V),d.set(V,G);var J=S?S.next:m;_t(t,S,G),_t(t,G,J),ua(G,J,s),S=G}else{var I=m?m.e.nodes_start:s;S=Wf(I,t,S,S===null?t.first:S.next,x,V,F,i,a,l)}d.set(V,S),C=[],P=[],m=S.next;continue}if(Hf(k,x,F),(k.e.f&Ze)!==0&&_c(k.e),k!==m){if(E!==void 0&&E.has(k)){if(C.length<P.length){var _=P[0],y;S=_.prev;var w=C[0],T=C[C.length-1];for(y=0;y<C.length;y+=1)ua(C[y],_,s);for(y=0;y<P.length;y+=1)E.delete(P[y]);_t(t,w.prev,T.next),_t(t,S,w),_t(t,T,_),m=_,S=T,F-=1,C=[],P=[]}else E.delete(k),ua(k,m,s),_t(t,k.prev,k.next),_t(t,k,S===null?t.first:S.next),_t(t,S,k),S=k;continue}for(C=[],P=[];m!==null&&m.k!==V;)(m.e.f&Ze)===0&&(E??=new Set).add(m),P.push(m),m=m.next;if(m===null)continue;k=m}C.push(k),S=k,m=k.next}if(m!==null||E!==void 0){for(var A=E===void 0?[]:ac(E);m!==null;)(m.e.f&Ze)===0&&A.push(m),m=m.next;var v=A.length;if(v>0){var ge=h===0?s:null;s_(t,A,ge)}}n.first=t.first&&t.first.e,n.last=S&&S.e;for(var nt of r.values())qe(nt.e);r.clear()}function Hf(n,e,t,r){Os(n.v,e),n.i=t}function Wf(n,e,t,r,s,i,a,c,l,h,d){var g=(l&og)!==0,m=(l&cg)===0,E=g?m?pe(s,!1,!1):Gn(s):s,S=(l&ag)===0?a:Gn(a),C={i:S,v:E,k:i,a:null,e:null,prev:t,next:r};try{if(n===null){var P=document.createDocumentFragment();P.append(n=Kn())}return C.e=ct(()=>c(n,E,S,h),yg),C.e.prev=t&&t.e,C.e.next=r&&r.e,t===null?d||(e.first=C):(t.next=C,t.e.next=C.e),r!==null&&(r.prev=C,r.e.prev=C.e),C}finally{}}function ua(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,i=n.e.nodes_start;i!==null&&i!==r;){var a=Hs(i);s.before(i),i=a}}function _t(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Ec(n,e,t,r,s){var i=e.$$slots?.[t],a=!1;i===!0&&(i=e.children,a=!0),i===void 0||i(n,a?()=>r:r)}const Sl=[...` 	
\r\fÂ \v\uFEFF`];function o_(n,e,t){var r=n==null?"":""+n;if(t){for(var s in t)if(t[s])r=r?r+" "+s:s;else if(r.length)for(var i=s.length,a=0;(a=r.indexOf(s,a))>=0;){var c=a+i;(a===0||Sl.includes(r[a-1]))&&(c===r.length||Sl.includes(r[c]))?r=(a===0?"":r.substring(0,a))+r.substring(c+1):a=c}}return r===""?null:r}function a_(n,e){return n==null?null:String(n)}function Qn(n,e,t,r,s,i){var a=n.__className;if(a!==t||a===void 0){var c=o_(t,r,i);c==null?n.removeAttribute("class"):n.className=c,n.__className=t}else if(i&&s!==i)for(var l in i){var h=!!i[l];(s==null||h!==!!s[l])&&n.classList.toggle(l,h)}return i}function c_(n,e,t,r){var s=n.__style;if(s!==e){var i=a_(e);i==null?n.removeAttribute("style"):n.style.cssText=i,n.__style=e}return r}const u_=Symbol("is custom element"),l_=Symbol("is html");function Ar(n,e,t,r){var s=h_(n);s[e]!==(s[e]=t)&&(e==="loading"&&(n[Qm]=t),t==null?n.removeAttribute(e):typeof t!="string"&&f_(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function h_(n){return n.__attributes??={[u_]:n.nodeName.includes("-"),[l_]:n.namespaceURI===gg}}var Rl=new Map;function f_(n){var e=n.getAttribute("is")||n.nodeName,t=Rl.get(e);if(t)return t;Rl.set(e,t=[]);for(var r,s=n,i=Element.prototype;i!==s;){r=cf(s);for(var a in r)r[a].set&&t.push(a);s=cc(s)}return t}function br(n,e,t=e){var r=new WeakSet;xg(n,"input",async s=>{var i=s?n.defaultValue:n.value;if(i=la(n)?ha(i):i,t(i),ae!==null&&r.add(ae),await Gg(),i!==(i=e())){var a=n.selectionStart,c=n.selectionEnd,l=n.value.length;if(n.value=i??"",c!==null){var h=n.value.length;a===c&&c===l&&h>l?(n.selectionStart=h,n.selectionEnd=h):(n.selectionStart=a,n.selectionEnd=Math.min(c,h))}}}),Me(e)==null&&n.value&&(t(la(n)?ha(n.value):n.value),ae!==null&&r.add(ae)),mo(()=>{var s=e();if(n===document.activeElement){var i=wi??ae;if(r.has(i))return}la(n)&&s===ha(n.value)||n.type==="date"&&!s&&!n.value||s!==n.value&&(n.value=s??"")})}function la(n){var e=n.type;return e==="number"||e==="range"}function ha(n){return n===""?null:+n}function d_(n){return function(...e){var t=e[0];return t.preventDefault(),n?.apply(this,e)}}function at(n=!1){const e=ie,t=e.l.u;if(!t)return;let r=()=>yc(e.s);if(n){let s=0,i={};const a=lo(()=>{let c=!1;const l=e.s;for(const h in l)l[h]!==i[h]&&(i[h]=l[h],c=!0);return c&&s++,s});r=()=>M(a)}t.b.length&&Ug(()=>{Pl(e,r),Aa(t.b)}),ka(()=>{const s=Me(()=>t.m.map(Gm));return()=>{for(const i of s)typeof i=="function"&&i()}}),t.a.length&&ka(()=>{Pl(e,r),Aa(t.a)})}function Pl(n,e){if(n.l.s)for(const t of n.l.s)M(t);e()}function Gf(n,e,t){if(n==null)return e(void 0),Tr;const r=Me(()=>n.subscribe(e,t));return r.unsubscribe?()=>r.unsubscribe():r}const dr=[];function _o(n,e=Tr){let t=null;const r=new Set;function s(c){if(df(n,c)&&(n=c,t)){const l=!dr.length;for(const h of r)h[1](),dr.push(h,n);if(l){for(let h=0;h<dr.length;h+=2)dr[h][0](dr[h+1]);dr.length=0}}}function i(c){s(c(n))}function a(c,l=Tr){const h=[c,l];return r.add(h),r.size===1&&(t=e(s,i)||Tr),c(n),()=>{r.delete(h),r.size===0&&t&&(t(),t=null)}}return{set:s,update:i,subscribe:a}}function p_(n){let e;return Gf(n,t=>e=t)(),e}let gi=!1,Va=Symbol();function It(n,e,t){const r=t[e]??={store:null,source:pe(void 0),unsubscribe:Tr};if(r.store!==n&&!(Va in t))if(r.unsubscribe(),r.store=n??null,n==null)r.source.v=void 0,r.unsubscribe=Tr;else{var s=!0;r.unsubscribe=Gf(n,i=>{s?r.source.v=i:z(r.source,i)}),s=!1}return n&&Va in t?p_(n):M(r.source)}function Qr(){const n={};function e(){pc(()=>{for(var t in n)n[t].unsubscribe();af(n,Va,{enumerable:!1,value:!0})})}return[n,e]}function m_(n){var e=gi;try{return gi=!1,[n(),gi]}finally{gi=e}}function Le(n,e,t,r){var s=!Gr||(t&lg)!==0,i=(t&fg)!==0,a=(t&dg)!==0,c=r,l=!0,h=()=>(l&&(l=!1,c=a?Me(r):r),c),d;if(i){var g=Ir in n||Km in n;d=Er(n,e)?.set??(g&&e in n?k=>n[e]=k:void 0)}var m,E=!1;i?[m,E]=m_(()=>n[e]):m=n[e],m===void 0&&r!==void 0&&(m=h(),d&&(s&&tg(),d(m)));var S;if(s?S=()=>{var k=n[e];return k===void 0?h():(l=!0,k)}:S=()=>{var k=n[e];return k!==void 0&&(c=void 0),k===void 0?c:k},s&&(t&hg)===0)return S;if(d){var C=n.$$legacy;return(function(k,F){return arguments.length>0?((!s||!F||C||E)&&d(F?S():k),k):S()})}var P=!1,x=((t&ug)!==0?lo:ho)(()=>(P=!1,S()));i&&M(x);var V=ee;return(function(k,F){if(arguments.length>0){const G=F?M(x):s&&i?vr(k):k;return z(x,G),P=!0,c!==void 0&&(c=G),k}return rr&&P||(V.f&hn)!==0?x.v:M(x)})}function g_(n){ie===null&&fc(),Gr&&ie.l!==null?y_(ie).m.push(n):ka(()=>{const e=Me(n);if(typeof e=="function")return e})}function __(n,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:r})}function Ws(){const n=ie;return n===null&&fc(),(e,t,r)=>{const s=n.s.$$events?.[e];if(s){const i=oc(s)?s.slice():[s],a=__(e,t,r);for(const c of i)c.call(n.x,a);return!a.defaultPrevented}return!0}}function y_(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}const v_="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(v_);Eg();const E_=()=>{};var Cl={};const Kf=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},T_=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],a=n[t++],c=n[t++],l=((s&7)<<18|(i&63)<<12|(a&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},Qf={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],a=s+1<n.length,c=a?n[s+1]:0,l=s+2<n.length,h=l?n[s+2]:0,d=i>>2,g=(i&3)<<4|c>>4;let m=(c&15)<<2|h>>6,E=h&63;l||(E=64,a||(m=64)),r.push(t[d],t[g],t[m],t[E])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Kf(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):T_(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],c=s<n.length?t[n.charAt(s)]:0;++s;const h=s<n.length?t[n.charAt(s)]:64;++s;const g=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||c==null||h==null||g==null)throw new I_;const m=i<<2|c>>4;if(r.push(m),h!==64){const E=c<<4&240|h>>2;if(r.push(E),g!==64){const S=h<<6&192|g;r.push(S)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class I_ extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const w_=function(n){const e=Kf(n);return Qf.encodeByteArray(e,!0)},xi=function(n){return w_(n).replace(/\./g,"")},Xf=function(n){try{return Qf.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function A_(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const b_=()=>A_().__FIREBASE_DEFAULTS__,S_=()=>{if(typeof process>"u"||typeof Cl>"u")return;const n=Cl.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},R_=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Xf(n[1]);return e&&JSON.parse(e)},yo=()=>{try{return E_()||b_()||S_()||R_()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Jf=n=>yo()?.emulatorHosts?.[n],Yf=n=>{const e=Jf(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Zf=()=>yo()?.config,ed=n=>yo()?.[`_${n}`];class P_{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function Rn(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Tc(n){return(await fetch(n,{credentials:"include"})).ok}function C_(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[xi(JSON.stringify(t)),xi(JSON.stringify(a)),""].join(".")}const Rs={};function k_(){const n={prod:[],emulator:[]};for(const e of Object.keys(Rs))Rs[e]?n.emulator.push(e):n.prod.push(e);return n}function N_(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let kl=!1;function Ic(n,e){if(typeof window>"u"||typeof document>"u"||!Rn(window.location.host)||Rs[n]===e||Rs[n]||kl)return;Rs[n]=e;function t(m){return`__firebase__banner__${m}`}const r="__firebase__banner",i=k_().prod.length>0;function a(){const m=document.getElementById(r);m&&m.remove()}function c(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function l(m,E){m.setAttribute("width","24"),m.setAttribute("id",E),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function h(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{kl=!0,a()},m}function d(m,E){m.setAttribute("id",E),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function g(){const m=N_(r),E=t("text"),S=document.getElementById(E)||document.createElement("span"),C=t("learnmore"),P=document.getElementById(C)||document.createElement("a"),x=t("preprendIcon"),V=document.getElementById(x)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const k=m.element;c(k),d(P,C);const F=h();l(V,x),k.append(V,S,P,F),document.body.appendChild(k)}i?(S.innerText="Preview backend disconnected.",V.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(V.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,S.innerText="Preview backend running in this workspace."),S.setAttribute("id",E)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function Ue(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function D_(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ue())}function V_(){const n=yo()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function O_(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function M_(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function L_(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function x_(){const n=Ue();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function F_(){return!V_()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function U_(){try{return typeof indexedDB=="object"}catch{return!1}}function B_(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const $_="FirebaseError";class Lt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=$_,Object.setPrototypeOf(this,Lt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Gs.prototype.create)}}class Gs{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?j_(i,r):"Error",c=`${this.serviceName}: ${a} (${s}).`;return new Lt(s,c,r)}}function j_(n,e){return n.replace(q_,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const q_=/\{\$([^}]+)}/g;function z_(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Xn(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],a=e[s];if(Nl(i)&&Nl(a)){if(!Xn(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Nl(n){return n!==null&&typeof n=="object"}function Ks(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function H_(n,e){const t=new W_(n,e);return t.subscribe.bind(t)}class W_{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");G_(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=fa),s.error===void 0&&(s.error=fa),s.complete===void 0&&(s.complete=fa);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function G_(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function fa(){}function ve(n){return n&&n._delegate?n._delegate:n}class En{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Ln="[DEFAULT]";class K_{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new P_;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(X_(e))try{this.getOrInitializeService({instanceIdentifier:Ln})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Ln){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ln){return this.instances.has(e)}getOptions(e=Ln){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);r===c&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Q_(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ln){return this.component?this.component.multipleInstances?e:Ln:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Q_(n){return n===Ln?void 0:n}function X_(n){return n.instantiationMode==="EAGER"}class J_{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new K_(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var K;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(K||(K={}));const Y_={debug:K.DEBUG,verbose:K.VERBOSE,info:K.INFO,warn:K.WARN,error:K.ERROR,silent:K.SILENT},Z_=K.INFO,ey={[K.DEBUG]:"log",[K.VERBOSE]:"log",[K.INFO]:"info",[K.WARN]:"warn",[K.ERROR]:"error"},ty=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=ey[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class wc{constructor(e){this.name=e,this._logLevel=Z_,this._logHandler=ty,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in K))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Y_[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,K.DEBUG,...e),this._logHandler(this,K.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,K.VERBOSE,...e),this._logHandler(this,K.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,K.INFO,...e),this._logHandler(this,K.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,K.WARN,...e),this._logHandler(this,K.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,K.ERROR,...e),this._logHandler(this,K.ERROR,...e)}}const ny=(n,e)=>e.some(t=>n instanceof t);let Dl,Vl;function ry(){return Dl||(Dl=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function sy(){return Vl||(Vl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const td=new WeakMap,Oa=new WeakMap,nd=new WeakMap,da=new WeakMap,Ac=new WeakMap;function iy(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(pn(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&td.set(t,n)}).catch(()=>{}),Ac.set(e,n),e}function oy(n){if(Oa.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});Oa.set(n,e)}let Ma={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Oa.get(n);if(e==="objectStoreNames")return n.objectStoreNames||nd.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return pn(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function ay(n){Ma=n(Ma)}function cy(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(pa(this),e,...t);return nd.set(r,e.sort?e.sort():[e]),pn(r)}:sy().includes(n)?function(...e){return n.apply(pa(this),e),pn(td.get(this))}:function(...e){return pn(n.apply(pa(this),e))}}function uy(n){return typeof n=="function"?cy(n):(n instanceof IDBTransaction&&oy(n),ny(n,ry())?new Proxy(n,Ma):n)}function pn(n){if(n instanceof IDBRequest)return iy(n);if(da.has(n))return da.get(n);const e=uy(n);return e!==n&&(da.set(n,e),Ac.set(e,n)),e}const pa=n=>Ac.get(n);function ly(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(n,e),c=pn(a);return r&&a.addEventListener("upgradeneeded",l=>{r(pn(a.result),l.oldVersion,l.newVersion,pn(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),c.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",h=>s(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}const hy=["get","getKey","getAll","getAllKeys","count"],fy=["put","add","delete","clear"],ma=new Map;function Ol(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ma.get(e))return ma.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=fy.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||hy.includes(t)))return;const i=async function(a,...c){const l=this.transaction(a,s?"readwrite":"readonly");let h=l.store;return r&&(h=h.index(c.shift())),(await Promise.all([h[t](...c),s&&l.done]))[0]};return ma.set(e,i),i}ay(n=>({...n,get:(e,t,r)=>Ol(e,t)||n.get(e,t,r),has:(e,t)=>!!Ol(e,t)||n.has(e,t)}));class dy{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(py(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function py(n){return n.getComponent()?.type==="VERSION"}const La="@firebase/app",Ml="0.14.5";const Ht=new wc("@firebase/app"),my="@firebase/app-compat",gy="@firebase/analytics-compat",_y="@firebase/analytics",yy="@firebase/app-check-compat",vy="@firebase/app-check",Ey="@firebase/auth",Ty="@firebase/auth-compat",Iy="@firebase/database",wy="@firebase/data-connect",Ay="@firebase/database-compat",by="@firebase/functions",Sy="@firebase/functions-compat",Ry="@firebase/installations",Py="@firebase/installations-compat",Cy="@firebase/messaging",ky="@firebase/messaging-compat",Ny="@firebase/performance",Dy="@firebase/performance-compat",Vy="@firebase/remote-config",Oy="@firebase/remote-config-compat",My="@firebase/storage",Ly="@firebase/storage-compat",xy="@firebase/firestore",Fy="@firebase/ai",Uy="@firebase/firestore-compat",By="firebase",$y="12.5.0";const xa="[DEFAULT]",jy={[La]:"fire-core",[my]:"fire-core-compat",[_y]:"fire-analytics",[gy]:"fire-analytics-compat",[vy]:"fire-app-check",[yy]:"fire-app-check-compat",[Ey]:"fire-auth",[Ty]:"fire-auth-compat",[Iy]:"fire-rtdb",[wy]:"fire-data-connect",[Ay]:"fire-rtdb-compat",[by]:"fire-fn",[Sy]:"fire-fn-compat",[Ry]:"fire-iid",[Py]:"fire-iid-compat",[Cy]:"fire-fcm",[ky]:"fire-fcm-compat",[Ny]:"fire-perf",[Dy]:"fire-perf-compat",[Vy]:"fire-rc",[Oy]:"fire-rc-compat",[My]:"fire-gcs",[Ly]:"fire-gcs-compat",[xy]:"fire-fst",[Uy]:"fire-fst-compat",[Fy]:"fire-vertex","fire-js":"fire-js",[By]:"fire-js-all"};const Fi=new Map,qy=new Map,Fa=new Map;function Ll(n,e){try{n.container.addComponent(e)}catch(t){Ht.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Jn(n){const e=n.name;if(Fa.has(e))return Ht.debug(`There were multiple attempts to register component ${e}.`),!1;Fa.set(e,n);for(const t of Fi.values())Ll(t,n);for(const t of qy.values())Ll(t,n);return!0}function vo(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function it(n){return n==null?!1:n.settings!==void 0}const zy={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},mn=new Gs("app","Firebase",zy);class Hy{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new En("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw mn.create("app-deleted",{appName:this._name})}}const Xr=$y;function rd(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:xa,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw mn.create("bad-app-name",{appName:String(s)});if(t||(t=Zf()),!t)throw mn.create("no-options");const i=Fi.get(s);if(i){if(Xn(t,i.options)&&Xn(r,i.config))return i;throw mn.create("duplicate-app",{appName:s})}const a=new J_(s);for(const l of Fa.values())a.addComponent(l);const c=new Hy(t,r,a);return Fi.set(s,c),c}function bc(n=xa){const e=Fi.get(n);if(!e&&n===xa&&Zf())return rd();if(!e)throw mn.create("no-app",{appName:n});return e}function wt(n,e,t){let r=jy[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ht.warn(a.join(" "));return}Jn(new En(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const Wy="firebase-heartbeat-database",Gy=1,Ls="firebase-heartbeat-store";let ga=null;function sd(){return ga||(ga=ly(Wy,Gy,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ls)}catch(t){console.warn(t)}}}}).catch(n=>{throw mn.create("idb-open",{originalErrorMessage:n.message})})),ga}async function Ky(n){try{const t=(await sd()).transaction(Ls),r=await t.objectStore(Ls).get(id(n));return await t.done,r}catch(e){if(e instanceof Lt)Ht.warn(e.message);else{const t=mn.create("idb-get",{originalErrorMessage:e?.message});Ht.warn(t.message)}}}async function xl(n,e){try{const r=(await sd()).transaction(Ls,"readwrite");await r.objectStore(Ls).put(e,id(n)),await r.done}catch(t){if(t instanceof Lt)Ht.warn(t.message);else{const r=mn.create("idb-set",{originalErrorMessage:t?.message});Ht.warn(r.message)}}}function id(n){return`${n.name}!${n.options.appId}`}const Qy=1024,Xy=30;class Jy{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Zy(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Fl();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>Xy){const s=ev(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ht.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Fl(),{heartbeatsToSend:t,unsentEntries:r}=Yy(this._heartbeatsCache.heartbeats),s=xi(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return Ht.warn(e),""}}}function Fl(){return new Date().toISOString().substring(0,10)}function Yy(n,e=Qy){const t=[];let r=n.slice();for(const s of n){const i=t.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),Ul(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Ul(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Zy{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return U_()?B_().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Ky(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return xl(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return xl(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Ul(n){return xi(JSON.stringify({version:2,heartbeats:n})).length}function ev(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function tv(n){Jn(new En("platform-logger",e=>new dy(e),"PRIVATE")),Jn(new En("heartbeat",e=>new Jy(e),"PRIVATE")),wt(La,Ml,n),wt(La,Ml,"esm2020"),wt("fire-js","")}tv("");var nv="firebase",rv="12.5.0";wt(nv,rv,"app");var Bl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var gn,od;(function(){var n;function e(I,_){function y(){}y.prototype=_.prototype,I.F=_.prototype,I.prototype=new y,I.prototype.constructor=I,I.D=function(w,T,A){for(var v=Array(arguments.length-2),ge=2;ge<arguments.length;ge++)v[ge-2]=arguments[ge];return _.prototype[T].apply(w,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,_,y){y||(y=0);const w=Array(16);if(typeof _=="string")for(var T=0;T<16;++T)w[T]=_.charCodeAt(y++)|_.charCodeAt(y++)<<8|_.charCodeAt(y++)<<16|_.charCodeAt(y++)<<24;else for(T=0;T<16;++T)w[T]=_[y++]|_[y++]<<8|_[y++]<<16|_[y++]<<24;_=I.g[0],y=I.g[1],T=I.g[2];let A=I.g[3],v;v=_+(A^y&(T^A))+w[0]+3614090360&4294967295,_=y+(v<<7&4294967295|v>>>25),v=A+(T^_&(y^T))+w[1]+3905402710&4294967295,A=_+(v<<12&4294967295|v>>>20),v=T+(y^A&(_^y))+w[2]+606105819&4294967295,T=A+(v<<17&4294967295|v>>>15),v=y+(_^T&(A^_))+w[3]+3250441966&4294967295,y=T+(v<<22&4294967295|v>>>10),v=_+(A^y&(T^A))+w[4]+4118548399&4294967295,_=y+(v<<7&4294967295|v>>>25),v=A+(T^_&(y^T))+w[5]+1200080426&4294967295,A=_+(v<<12&4294967295|v>>>20),v=T+(y^A&(_^y))+w[6]+2821735955&4294967295,T=A+(v<<17&4294967295|v>>>15),v=y+(_^T&(A^_))+w[7]+4249261313&4294967295,y=T+(v<<22&4294967295|v>>>10),v=_+(A^y&(T^A))+w[8]+1770035416&4294967295,_=y+(v<<7&4294967295|v>>>25),v=A+(T^_&(y^T))+w[9]+2336552879&4294967295,A=_+(v<<12&4294967295|v>>>20),v=T+(y^A&(_^y))+w[10]+4294925233&4294967295,T=A+(v<<17&4294967295|v>>>15),v=y+(_^T&(A^_))+w[11]+2304563134&4294967295,y=T+(v<<22&4294967295|v>>>10),v=_+(A^y&(T^A))+w[12]+1804603682&4294967295,_=y+(v<<7&4294967295|v>>>25),v=A+(T^_&(y^T))+w[13]+4254626195&4294967295,A=_+(v<<12&4294967295|v>>>20),v=T+(y^A&(_^y))+w[14]+2792965006&4294967295,T=A+(v<<17&4294967295|v>>>15),v=y+(_^T&(A^_))+w[15]+1236535329&4294967295,y=T+(v<<22&4294967295|v>>>10),v=_+(T^A&(y^T))+w[1]+4129170786&4294967295,_=y+(v<<5&4294967295|v>>>27),v=A+(y^T&(_^y))+w[6]+3225465664&4294967295,A=_+(v<<9&4294967295|v>>>23),v=T+(_^y&(A^_))+w[11]+643717713&4294967295,T=A+(v<<14&4294967295|v>>>18),v=y+(A^_&(T^A))+w[0]+3921069994&4294967295,y=T+(v<<20&4294967295|v>>>12),v=_+(T^A&(y^T))+w[5]+3593408605&4294967295,_=y+(v<<5&4294967295|v>>>27),v=A+(y^T&(_^y))+w[10]+38016083&4294967295,A=_+(v<<9&4294967295|v>>>23),v=T+(_^y&(A^_))+w[15]+3634488961&4294967295,T=A+(v<<14&4294967295|v>>>18),v=y+(A^_&(T^A))+w[4]+3889429448&4294967295,y=T+(v<<20&4294967295|v>>>12),v=_+(T^A&(y^T))+w[9]+568446438&4294967295,_=y+(v<<5&4294967295|v>>>27),v=A+(y^T&(_^y))+w[14]+3275163606&4294967295,A=_+(v<<9&4294967295|v>>>23),v=T+(_^y&(A^_))+w[3]+4107603335&4294967295,T=A+(v<<14&4294967295|v>>>18),v=y+(A^_&(T^A))+w[8]+1163531501&4294967295,y=T+(v<<20&4294967295|v>>>12),v=_+(T^A&(y^T))+w[13]+2850285829&4294967295,_=y+(v<<5&4294967295|v>>>27),v=A+(y^T&(_^y))+w[2]+4243563512&4294967295,A=_+(v<<9&4294967295|v>>>23),v=T+(_^y&(A^_))+w[7]+1735328473&4294967295,T=A+(v<<14&4294967295|v>>>18),v=y+(A^_&(T^A))+w[12]+2368359562&4294967295,y=T+(v<<20&4294967295|v>>>12),v=_+(y^T^A)+w[5]+4294588738&4294967295,_=y+(v<<4&4294967295|v>>>28),v=A+(_^y^T)+w[8]+2272392833&4294967295,A=_+(v<<11&4294967295|v>>>21),v=T+(A^_^y)+w[11]+1839030562&4294967295,T=A+(v<<16&4294967295|v>>>16),v=y+(T^A^_)+w[14]+4259657740&4294967295,y=T+(v<<23&4294967295|v>>>9),v=_+(y^T^A)+w[1]+2763975236&4294967295,_=y+(v<<4&4294967295|v>>>28),v=A+(_^y^T)+w[4]+1272893353&4294967295,A=_+(v<<11&4294967295|v>>>21),v=T+(A^_^y)+w[7]+4139469664&4294967295,T=A+(v<<16&4294967295|v>>>16),v=y+(T^A^_)+w[10]+3200236656&4294967295,y=T+(v<<23&4294967295|v>>>9),v=_+(y^T^A)+w[13]+681279174&4294967295,_=y+(v<<4&4294967295|v>>>28),v=A+(_^y^T)+w[0]+3936430074&4294967295,A=_+(v<<11&4294967295|v>>>21),v=T+(A^_^y)+w[3]+3572445317&4294967295,T=A+(v<<16&4294967295|v>>>16),v=y+(T^A^_)+w[6]+76029189&4294967295,y=T+(v<<23&4294967295|v>>>9),v=_+(y^T^A)+w[9]+3654602809&4294967295,_=y+(v<<4&4294967295|v>>>28),v=A+(_^y^T)+w[12]+3873151461&4294967295,A=_+(v<<11&4294967295|v>>>21),v=T+(A^_^y)+w[15]+530742520&4294967295,T=A+(v<<16&4294967295|v>>>16),v=y+(T^A^_)+w[2]+3299628645&4294967295,y=T+(v<<23&4294967295|v>>>9),v=_+(T^(y|~A))+w[0]+4096336452&4294967295,_=y+(v<<6&4294967295|v>>>26),v=A+(y^(_|~T))+w[7]+1126891415&4294967295,A=_+(v<<10&4294967295|v>>>22),v=T+(_^(A|~y))+w[14]+2878612391&4294967295,T=A+(v<<15&4294967295|v>>>17),v=y+(A^(T|~_))+w[5]+4237533241&4294967295,y=T+(v<<21&4294967295|v>>>11),v=_+(T^(y|~A))+w[12]+1700485571&4294967295,_=y+(v<<6&4294967295|v>>>26),v=A+(y^(_|~T))+w[3]+2399980690&4294967295,A=_+(v<<10&4294967295|v>>>22),v=T+(_^(A|~y))+w[10]+4293915773&4294967295,T=A+(v<<15&4294967295|v>>>17),v=y+(A^(T|~_))+w[1]+2240044497&4294967295,y=T+(v<<21&4294967295|v>>>11),v=_+(T^(y|~A))+w[8]+1873313359&4294967295,_=y+(v<<6&4294967295|v>>>26),v=A+(y^(_|~T))+w[15]+4264355552&4294967295,A=_+(v<<10&4294967295|v>>>22),v=T+(_^(A|~y))+w[6]+2734768916&4294967295,T=A+(v<<15&4294967295|v>>>17),v=y+(A^(T|~_))+w[13]+1309151649&4294967295,y=T+(v<<21&4294967295|v>>>11),v=_+(T^(y|~A))+w[4]+4149444226&4294967295,_=y+(v<<6&4294967295|v>>>26),v=A+(y^(_|~T))+w[11]+3174756917&4294967295,A=_+(v<<10&4294967295|v>>>22),v=T+(_^(A|~y))+w[2]+718787259&4294967295,T=A+(v<<15&4294967295|v>>>17),v=y+(A^(T|~_))+w[9]+3951481745&4294967295,I.g[0]=I.g[0]+_&4294967295,I.g[1]=I.g[1]+(T+(v<<21&4294967295|v>>>11))&4294967295,I.g[2]=I.g[2]+T&4294967295,I.g[3]=I.g[3]+A&4294967295}r.prototype.v=function(I,_){_===void 0&&(_=I.length);const y=_-this.blockSize,w=this.C;let T=this.h,A=0;for(;A<_;){if(T==0)for(;A<=y;)s(this,I,A),A+=this.blockSize;if(typeof I=="string"){for(;A<_;)if(w[T++]=I.charCodeAt(A++),T==this.blockSize){s(this,w),T=0;break}}else for(;A<_;)if(w[T++]=I[A++],T==this.blockSize){s(this,w),T=0;break}}this.h=T,this.o+=_},r.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var _=1;_<I.length-8;++_)I[_]=0;_=this.o*8;for(var y=I.length-8;y<I.length;++y)I[y]=_&255,_/=256;for(this.v(I),I=Array(16),_=0,y=0;y<4;++y)for(let w=0;w<32;w+=8)I[_++]=this.g[y]>>>w&255;return I};function i(I,_){var y=c;return Object.prototype.hasOwnProperty.call(y,I)?y[I]:y[I]=_(I)}function a(I,_){this.h=_;const y=[];let w=!0;for(let T=I.length-1;T>=0;T--){const A=I[T]|0;w&&A==_||(y[T]=A,w=!1)}this.g=y}var c={};function l(I){return-128<=I&&I<128?i(I,function(_){return new a([_|0],_<0?-1:0)}):new a([I|0],I<0?-1:0)}function h(I){if(isNaN(I)||!isFinite(I))return g;if(I<0)return P(h(-I));const _=[];let y=1;for(let w=0;I>=y;w++)_[w]=I/y|0,y*=4294967296;return new a(_,0)}function d(I,_){if(I.length==0)throw Error("number format error: empty string");if(_=_||10,_<2||36<_)throw Error("radix out of range: "+_);if(I.charAt(0)=="-")return P(d(I.substring(1),_));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');const y=h(Math.pow(_,8));let w=g;for(let A=0;A<I.length;A+=8){var T=Math.min(8,I.length-A);const v=parseInt(I.substring(A,A+T),_);T<8?(T=h(Math.pow(_,T)),w=w.j(T).add(h(v))):(w=w.j(y),w=w.add(h(v)))}return w}var g=l(0),m=l(1),E=l(16777216);n=a.prototype,n.m=function(){if(C(this))return-P(this).m();let I=0,_=1;for(let y=0;y<this.g.length;y++){const w=this.i(y);I+=(w>=0?w:4294967296+w)*_,_*=4294967296}return I},n.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(S(this))return"0";if(C(this))return"-"+P(this).toString(I);const _=h(Math.pow(I,6));var y=this;let w="";for(;;){const T=F(y,_).g;y=x(y,T.j(_));let A=((y.g.length>0?y.g[0]:y.h)>>>0).toString(I);if(y=T,S(y))return A+w;for(;A.length<6;)A="0"+A;w=A+w}},n.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function S(I){if(I.h!=0)return!1;for(let _=0;_<I.g.length;_++)if(I.g[_]!=0)return!1;return!0}function C(I){return I.h==-1}n.l=function(I){return I=x(this,I),C(I)?-1:S(I)?0:1};function P(I){const _=I.g.length,y=[];for(let w=0;w<_;w++)y[w]=~I.g[w];return new a(y,~I.h).add(m)}n.abs=function(){return C(this)?P(this):this},n.add=function(I){const _=Math.max(this.g.length,I.g.length),y=[];let w=0;for(let T=0;T<=_;T++){let A=w+(this.i(T)&65535)+(I.i(T)&65535),v=(A>>>16)+(this.i(T)>>>16)+(I.i(T)>>>16);w=v>>>16,A&=65535,v&=65535,y[T]=v<<16|A}return new a(y,y[y.length-1]&-2147483648?-1:0)};function x(I,_){return I.add(P(_))}n.j=function(I){if(S(this)||S(I))return g;if(C(this))return C(I)?P(this).j(P(I)):P(P(this).j(I));if(C(I))return P(this.j(P(I)));if(this.l(E)<0&&I.l(E)<0)return h(this.m()*I.m());const _=this.g.length+I.g.length,y=[];for(var w=0;w<2*_;w++)y[w]=0;for(w=0;w<this.g.length;w++)for(let T=0;T<I.g.length;T++){const A=this.i(w)>>>16,v=this.i(w)&65535,ge=I.i(T)>>>16,nt=I.i(T)&65535;y[2*w+2*T]+=v*nt,V(y,2*w+2*T),y[2*w+2*T+1]+=A*nt,V(y,2*w+2*T+1),y[2*w+2*T+1]+=v*ge,V(y,2*w+2*T+1),y[2*w+2*T+2]+=A*ge,V(y,2*w+2*T+2)}for(I=0;I<_;I++)y[I]=y[2*I+1]<<16|y[2*I];for(I=_;I<2*_;I++)y[I]=0;return new a(y,0)};function V(I,_){for(;(I[_]&65535)!=I[_];)I[_+1]+=I[_]>>>16,I[_]&=65535,_++}function k(I,_){this.g=I,this.h=_}function F(I,_){if(S(_))throw Error("division by zero");if(S(I))return new k(g,g);if(C(I))return _=F(P(I),_),new k(P(_.g),P(_.h));if(C(_))return _=F(I,P(_)),new k(P(_.g),_.h);if(I.g.length>30){if(C(I)||C(_))throw Error("slowDivide_ only works with positive integers.");for(var y=m,w=_;w.l(I)<=0;)y=G(y),w=G(w);var T=J(y,1),A=J(w,1);for(w=J(w,2),y=J(y,2);!S(w);){var v=A.add(w);v.l(I)<=0&&(T=T.add(y),A=v),w=J(w,1),y=J(y,1)}return _=x(I,T.j(_)),new k(T,_)}for(T=g;I.l(_)>=0;){for(y=Math.max(1,Math.floor(I.m()/_.m())),w=Math.ceil(Math.log(y)/Math.LN2),w=w<=48?1:Math.pow(2,w-48),A=h(y),v=A.j(_);C(v)||v.l(I)>0;)y-=w,A=h(y),v=A.j(_);S(A)&&(A=m),T=T.add(A),I=x(I,v)}return new k(T,I)}n.B=function(I){return F(this,I).h},n.and=function(I){const _=Math.max(this.g.length,I.g.length),y=[];for(let w=0;w<_;w++)y[w]=this.i(w)&I.i(w);return new a(y,this.h&I.h)},n.or=function(I){const _=Math.max(this.g.length,I.g.length),y=[];for(let w=0;w<_;w++)y[w]=this.i(w)|I.i(w);return new a(y,this.h|I.h)},n.xor=function(I){const _=Math.max(this.g.length,I.g.length),y=[];for(let w=0;w<_;w++)y[w]=this.i(w)^I.i(w);return new a(y,this.h^I.h)};function G(I){const _=I.g.length+1,y=[];for(let w=0;w<_;w++)y[w]=I.i(w)<<1|I.i(w-1)>>>31;return new a(y,I.h)}function J(I,_){const y=_>>5;_%=32;const w=I.g.length-y,T=[];for(let A=0;A<w;A++)T[A]=_>0?I.i(A+y)>>>_|I.i(A+y+1)<<32-_:I.i(A+y);return new a(T,I.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,od=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=d,gn=a}).apply(typeof Bl<"u"?Bl:typeof self<"u"?self:typeof window<"u"?window:{});var _i=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ad,Ts,cd,Ai,Ua,ud,ld,hd;(function(){var n,e=Object.defineProperty;function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof _i=="object"&&_i];for(var u=0;u<o.length;++u){var f=o[u];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var r=t(this);function s(o,u){if(u)e:{var f=r;o=o.split(".");for(var p=0;p<o.length-1;p++){var b=o[p];if(!(b in f))break e;f=f[b]}o=o[o.length-1],p=f[o],u=u(p),u!=p&&u!=null&&e(f,o,{configurable:!0,writable:!0,value:u})}}s("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(o){return o||function(u){var f=[],p;for(p in u)Object.prototype.hasOwnProperty.call(u,p)&&f.push([p,u[p]]);return f}});var i=i||{},a=this||self;function c(o){var u=typeof o;return u=="object"&&o!=null||u=="function"}function l(o,u,f){return o.call.apply(o.bind,arguments)}function h(o,u,f){return h=l,h.apply(null,arguments)}function d(o,u){var f=Array.prototype.slice.call(arguments,1);return function(){var p=f.slice();return p.push.apply(p,arguments),o.apply(this,p)}}function g(o,u){function f(){}f.prototype=u.prototype,o.Z=u.prototype,o.prototype=new f,o.prototype.constructor=o,o.Ob=function(p,b,R){for(var O=Array(arguments.length-2),W=2;W<arguments.length;W++)O[W-2]=arguments[W];return u.prototype[b].apply(p,O)}}var m=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function E(o){const u=o.length;if(u>0){const f=Array(u);for(let p=0;p<u;p++)f[p]=o[p];return f}return[]}function S(o,u){for(let p=1;p<arguments.length;p++){const b=arguments[p];var f=typeof b;if(f=f!="object"?f:b?Array.isArray(b)?"array":f:"null",f=="array"||f=="object"&&typeof b.length=="number"){f=o.length||0;const R=b.length||0;o.length=f+R;for(let O=0;O<R;O++)o[f+O]=b[O]}else o.push(b)}}class C{constructor(u,f){this.i=u,this.j=f,this.h=0,this.g=null}get(){let u;return this.h>0?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function P(o){a.setTimeout(()=>{throw o},0)}function x(){var o=I;let u=null;return o.g&&(u=o.g,o.g=o.g.next,o.g||(o.h=null),u.next=null),u}class V{constructor(){this.h=this.g=null}add(u,f){const p=k.get();p.set(u,f),this.h?this.h.next=p:this.g=p,this.h=p}}var k=new C(()=>new F,o=>o.reset());class F{constructor(){this.next=this.g=this.h=null}set(u,f){this.h=u,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let G,J=!1,I=new V,_=()=>{const o=Promise.resolve(void 0);G=()=>{o.then(y)}};function y(){for(var o;o=x();){try{o.h.call(o.g)}catch(f){P(f)}var u=k;u.j(o),u.h<100&&(u.h++,o.next=u.g,u.g=o)}J=!1}function w(){this.u=this.u,this.C=this.C}w.prototype.u=!1,w.prototype.dispose=function(){this.u||(this.u=!0,this.N())},w.prototype[Symbol.dispose]=function(){this.dispose()},w.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function T(o,u){this.type=o,this.g=this.target=u,this.defaultPrevented=!1}T.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,u=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const f=()=>{};a.addEventListener("test",f,u),a.removeEventListener("test",f,u)}catch{}return o})();function v(o){return/^[\s\xa0]*$/.test(o)}function ge(o,u){T.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,u)}g(ge,T),ge.prototype.init=function(o,u){const f=this.type=o.type,p=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=u,u=o.relatedTarget,u||(f=="mouseover"?u=o.fromElement:f=="mouseout"&&(u=o.toElement)),this.relatedTarget=u,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&ge.Z.h.call(this)},ge.prototype.h=function(){ge.Z.h.call(this);const o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var nt="closure_listenable_"+(Math.random()*1e6|0),or=0;function ar(o,u,f,p,b){this.listener=o,this.proxy=null,this.src=u,this.type=f,this.capture=!!p,this.ha=b,this.key=++or,this.da=this.fa=!1}function pt(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function xt(o,u,f){for(const p in o)u.call(f,o[p],p,o)}function rt(o,u){for(const f in o)u.call(void 0,o[f],f,o)}function Ft(o){const u={};for(const f in o)u[f]=o[f];return u}const ns="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function cr(o,u){let f,p;for(let b=1;b<arguments.length;b++){p=arguments[b];for(f in p)o[f]=p[f];for(let R=0;R<ns.length;R++)f=ns[R],Object.prototype.hasOwnProperty.call(p,f)&&(o[f]=p[f])}}function Ut(o){this.src=o,this.g={},this.h=0}Ut.prototype.add=function(o,u,f,p,b){const R=o.toString();o=this.g[R],o||(o=this.g[R]=[],this.h++);const O=kn(o,u,p,b);return O>-1?(u=o[O],f||(u.fa=!1)):(u=new ar(u,this.src,R,!!p,b),u.fa=f,o.push(u)),u};function rs(o,u){const f=u.type;if(f in o.g){var p=o.g[f],b=Array.prototype.indexOf.call(p,u,void 0),R;(R=b>=0)&&Array.prototype.splice.call(p,b,1),R&&(pt(u),o.g[f].length==0&&(delete o.g[f],o.h--))}}function kn(o,u,f,p){for(let b=0;b<o.length;++b){const R=o[b];if(!R.da&&R.listener==u&&R.capture==!!f&&R.ha==p)return b}return-1}var $o="closure_lm_"+(Math.random()*1e6|0),jo={};function vu(o,u,f,p,b){if(Array.isArray(u)){for(let R=0;R<u.length;R++)vu(o,u[R],f,p,b);return null}return f=Iu(f),o&&o[nt]?o.J(u,f,c(p)?!!p.capture:!1,b):mm(o,u,f,!1,p,b)}function mm(o,u,f,p,b,R){if(!u)throw Error("Invalid event type");const O=c(b)?!!b.capture:!!b;let W=zo(o);if(W||(o[$o]=W=new Ut(o)),f=W.add(u,f,p,O,R),f.proxy)return f;if(p=gm(),f.proxy=p,p.src=o,p.listener=f,o.addEventListener)A||(b=O),b===void 0&&(b=!1),o.addEventListener(u.toString(),p,b);else if(o.attachEvent)o.attachEvent(Tu(u.toString()),p);else if(o.addListener&&o.removeListener)o.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return f}function gm(){function o(f){return u.call(o.src,o.listener,f)}const u=_m;return o}function Eu(o,u,f,p,b){if(Array.isArray(u))for(var R=0;R<u.length;R++)Eu(o,u[R],f,p,b);else p=c(p)?!!p.capture:!!p,f=Iu(f),o&&o[nt]?(o=o.i,R=String(u).toString(),R in o.g&&(u=o.g[R],f=kn(u,f,p,b),f>-1&&(pt(u[f]),Array.prototype.splice.call(u,f,1),u.length==0&&(delete o.g[R],o.h--)))):o&&(o=zo(o))&&(u=o.g[u.toString()],o=-1,u&&(o=kn(u,f,p,b)),(f=o>-1?u[o]:null)&&qo(f))}function qo(o){if(typeof o!="number"&&o&&!o.da){var u=o.src;if(u&&u[nt])rs(u.i,o);else{var f=o.type,p=o.proxy;u.removeEventListener?u.removeEventListener(f,p,o.capture):u.detachEvent?u.detachEvent(Tu(f),p):u.addListener&&u.removeListener&&u.removeListener(p),(f=zo(u))?(rs(f,o),f.h==0&&(f.src=null,u[$o]=null)):pt(o)}}}function Tu(o){return o in jo?jo[o]:jo[o]="on"+o}function _m(o,u){if(o.da)o=!0;else{u=new ge(u,this);const f=o.listener,p=o.ha||o.src;o.fa&&qo(o),o=f.call(p,u)}return o}function zo(o){return o=o[$o],o instanceof Ut?o:null}var Ho="__closure_events_fn_"+(Math.random()*1e9>>>0);function Iu(o){return typeof o=="function"?o:(o[Ho]||(o[Ho]=function(u){return o.handleEvent(u)}),o[Ho])}function Ne(){w.call(this),this.i=new Ut(this),this.M=this,this.G=null}g(Ne,w),Ne.prototype[nt]=!0,Ne.prototype.removeEventListener=function(o,u,f,p){Eu(this,o,u,f,p)};function Be(o,u){var f,p=o.G;if(p)for(f=[];p;p=p.G)f.push(p);if(o=o.M,p=u.type||u,typeof u=="string")u=new T(u,o);else if(u instanceof T)u.target=u.target||o;else{var b=u;u=new T(p,o),cr(u,b)}b=!0;let R,O;if(f)for(O=f.length-1;O>=0;O--)R=u.g=f[O],b=ri(R,p,!0,u)&&b;if(R=u.g=o,b=ri(R,p,!0,u)&&b,b=ri(R,p,!1,u)&&b,f)for(O=0;O<f.length;O++)R=u.g=f[O],b=ri(R,p,!1,u)&&b}Ne.prototype.N=function(){if(Ne.Z.N.call(this),this.i){var o=this.i;for(const u in o.g){const f=o.g[u];for(let p=0;p<f.length;p++)pt(f[p]);delete o.g[u],o.h--}}this.G=null},Ne.prototype.J=function(o,u,f,p){return this.i.add(String(o),u,!1,f,p)},Ne.prototype.K=function(o,u,f,p){return this.i.add(String(o),u,!0,f,p)};function ri(o,u,f,p){if(u=o.i.g[String(u)],!u)return!0;u=u.concat();let b=!0;for(let R=0;R<u.length;++R){const O=u[R];if(O&&!O.da&&O.capture==f){const W=O.listener,Ee=O.ha||O.src;O.fa&&rs(o.i,O),b=W.call(Ee,p)!==!1&&b}}return b&&!p.defaultPrevented}function ym(o,u){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=h(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(u)>2147483647?-1:a.setTimeout(o,u||0)}function wu(o){o.g=ym(()=>{o.g=null,o.i&&(o.i=!1,wu(o))},o.l);const u=o.h;o.h=null,o.m.apply(null,u)}class vm extends w{constructor(u,f){super(),this.m=u,this.l=f,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:wu(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ss(o){w.call(this),this.h=o,this.g={}}g(ss,w);var Au=[];function bu(o){xt(o.g,function(u,f){this.g.hasOwnProperty(f)&&qo(u)},o),o.g={}}ss.prototype.N=function(){ss.Z.N.call(this),bu(this)},ss.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Wo=a.JSON.stringify,Em=a.JSON.parse,Tm=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function Su(){}function Ru(){}var is={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Go(){T.call(this,"d")}g(Go,T);function Ko(){T.call(this,"c")}g(Ko,T);var Nn={},Pu=null;function si(){return Pu=Pu||new Ne}Nn.Ia="serverreachability";function Cu(o){T.call(this,Nn.Ia,o)}g(Cu,T);function os(o){const u=si();Be(u,new Cu(u))}Nn.STAT_EVENT="statevent";function ku(o,u){T.call(this,Nn.STAT_EVENT,o),this.stat=u}g(ku,T);function $e(o){const u=si();Be(u,new ku(u,o))}Nn.Ja="timingevent";function Nu(o,u){T.call(this,Nn.Ja,o),this.size=u}g(Nu,T);function as(o,u){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},u)}function cs(){this.g=!0}cs.prototype.ua=function(){this.g=!1};function Im(o,u,f,p,b,R){o.info(function(){if(o.g)if(R){var O="",W=R.split("&");for(let re=0;re<W.length;re++){var Ee=W[re].split("=");if(Ee.length>1){const Ae=Ee[0];Ee=Ee[1];const gt=Ae.split("_");O=gt.length>=2&&gt[1]=="type"?O+(Ae+"="+Ee+"&"):O+(Ae+"=redacted&")}}}else O=null;else O=R;return"XMLHTTP REQ ("+p+") [attempt "+b+"]: "+u+`
`+f+`
`+O})}function wm(o,u,f,p,b,R,O){o.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+b+"]: "+u+`
`+f+`
`+R+" "+O})}function ur(o,u,f,p){o.info(function(){return"XMLHTTP TEXT ("+u+"): "+bm(o,f)+(p?" "+p:"")})}function Am(o,u){o.info(function(){return"TIMEOUT: "+u})}cs.prototype.info=function(){};function bm(o,u){if(!o.g)return u;if(!u)return null;try{const R=JSON.parse(u);if(R){for(o=0;o<R.length;o++)if(Array.isArray(R[o])){var f=R[o];if(!(f.length<2)){var p=f[1];if(Array.isArray(p)&&!(p.length<1)){var b=p[0];if(b!="noop"&&b!="stop"&&b!="close")for(let O=1;O<p.length;O++)p[O]=""}}}}return Wo(R)}catch{return u}}var ii={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Du={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Vu;function Qo(){}g(Qo,Su),Qo.prototype.g=function(){return new XMLHttpRequest},Vu=new Qo;function us(o){return encodeURIComponent(String(o))}function Sm(o){var u=1;o=o.split(":");const f=[];for(;u>0&&o.length;)f.push(o.shift()),u--;return o.length&&f.push(o.join(":")),f}function Yt(o,u,f,p){this.j=o,this.i=u,this.l=f,this.S=p||1,this.V=new ss(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ou}function Ou(){this.i=null,this.g="",this.h=!1}var Mu={},Xo={};function Jo(o,u,f){o.M=1,o.A=ai(mt(u)),o.u=f,o.R=!0,Lu(o,null)}function Lu(o,u){o.F=Date.now(),oi(o),o.B=mt(o.A);var f=o.B,p=o.S;Array.isArray(p)||(p=[String(p)]),Qu(f.i,"t",p),o.C=0,f=o.j.L,o.h=new Ou,o.g=dl(o.j,f?u:null,!o.u),o.P>0&&(o.O=new vm(h(o.Y,o,o.g),o.P)),u=o.V,f=o.g,p=o.ba;var b="readystatechange";Array.isArray(b)||(b&&(Au[0]=b.toString()),b=Au);for(let R=0;R<b.length;R++){const O=vu(f,b[R],p||u.handleEvent,!1,u.h||u);if(!O)break;u.g[O.key]=O}u=o.J?Ft(o.J):{},o.u?(o.v||(o.v="POST"),u["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,u)):(o.v="GET",o.g.ea(o.B,o.v,null,u)),os(),Im(o.i,o.v,o.B,o.l,o.S,o.u)}Yt.prototype.ba=function(o){o=o.target;const u=this.O;u&&tn(o)==3?u.j():this.Y(o)},Yt.prototype.Y=function(o){try{if(o==this.g)e:{const W=tn(this.g),Ee=this.g.ya(),re=this.g.ca();if(!(W<3)&&(W!=3||this.g&&(this.h.h||this.g.la()||nl(this.g)))){this.K||W!=4||Ee==7||(Ee==8||re<=0?os(3):os(2)),Yo(this);var u=this.g.ca();this.X=u;var f=Rm(this);if(this.o=u==200,wm(this.i,this.v,this.B,this.l,this.S,W,u),this.o){if(this.U&&!this.L){t:{if(this.g){var p,b=this.g;if((p=b.g?b.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!v(p)){var R=p;break t}}R=null}if(o=R)ur(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Zo(this,o);else{this.o=!1,this.m=3,$e(12),Dn(this),ls(this);break e}}if(this.R){o=!0;let Ae;for(;!this.K&&this.C<f.length;)if(Ae=Pm(this,f),Ae==Xo){W==4&&(this.m=4,$e(14),o=!1),ur(this.i,this.l,null,"[Incomplete Response]");break}else if(Ae==Mu){this.m=4,$e(15),ur(this.i,this.l,f,"[Invalid Chunk]"),o=!1;break}else ur(this.i,this.l,Ae,null),Zo(this,Ae);if(xu(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),W!=4||f.length!=0||this.h.h||(this.m=1,$e(16),o=!1),this.o=this.o&&o,!o)ur(this.i,this.l,f,"[Invalid Chunked Response]"),Dn(this),ls(this);else if(f.length>0&&!this.W){this.W=!0;var O=this.j;O.g==this&&O.aa&&!O.P&&(O.j.info("Great, no buffering proxy detected. Bytes received: "+f.length),aa(O),O.P=!0,$e(11))}}else ur(this.i,this.l,f,null),Zo(this,f);W==4&&Dn(this),this.o&&!this.K&&(W==4?ul(this.j,this):(this.o=!1,oi(this)))}else jm(this.g),u==400&&f.indexOf("Unknown SID")>0?(this.m=3,$e(12)):(this.m=0,$e(13)),Dn(this),ls(this)}}}catch{}finally{}};function Rm(o){if(!xu(o))return o.g.la();const u=nl(o.g);if(u==="")return"";let f="";const p=u.length,b=tn(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return Dn(o),ls(o),"";o.h.i=new a.TextDecoder}for(let R=0;R<p;R++)o.h.h=!0,f+=o.h.i.decode(u[R],{stream:!(b&&R==p-1)});return u.length=0,o.h.g+=f,o.C=0,o.h.g}function xu(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function Pm(o,u){var f=o.C,p=u.indexOf(`
`,f);return p==-1?Xo:(f=Number(u.substring(f,p)),isNaN(f)?Mu:(p+=1,p+f>u.length?Xo:(u=u.slice(p,p+f),o.C=p+f,u)))}Yt.prototype.cancel=function(){this.K=!0,Dn(this)};function oi(o){o.T=Date.now()+o.H,Fu(o,o.H)}function Fu(o,u){if(o.D!=null)throw Error("WatchDog timer not null");o.D=as(h(o.aa,o),u)}function Yo(o){o.D&&(a.clearTimeout(o.D),o.D=null)}Yt.prototype.aa=function(){this.D=null;const o=Date.now();o-this.T>=0?(Am(this.i,this.B),this.M!=2&&(os(),$e(17)),Dn(this),this.m=2,ls(this)):Fu(this,this.T-o)};function ls(o){o.j.I==0||o.K||ul(o.j,o)}function Dn(o){Yo(o);var u=o.O;u&&typeof u.dispose=="function"&&u.dispose(),o.O=null,bu(o.V),o.g&&(u=o.g,o.g=null,u.abort(),u.dispose())}function Zo(o,u){try{var f=o.j;if(f.I!=0&&(f.g==o||ea(f.h,o))){if(!o.L&&ea(f.h,o)&&f.I==3){try{var p=f.Ba.g.parse(u)}catch{p=null}if(Array.isArray(p)&&p.length==3){var b=p;if(b[0]==0){e:if(!f.v){if(f.g)if(f.g.F+3e3<o.F)fi(f),li(f);else break e;oa(f),$e(18)}}else f.xa=b[1],0<f.xa-f.K&&b[2]<37500&&f.F&&f.A==0&&!f.C&&(f.C=as(h(f.Va,f),6e3));$u(f.h)<=1&&f.ta&&(f.ta=void 0)}else On(f,11)}else if((o.L||f.g==o)&&fi(f),!v(u))for(b=f.Ba.g.parse(u),u=0;u<b.length;u++){let re=b[u];const Ae=re[0];if(!(Ae<=f.K))if(f.K=Ae,re=re[1],f.I==2)if(re[0]=="c"){f.M=re[1],f.ba=re[2];const gt=re[3];gt!=null&&(f.ka=gt,f.j.info("VER="+f.ka));const Mn=re[4];Mn!=null&&(f.za=Mn,f.j.info("SVER="+f.za));const nn=re[5];nn!=null&&typeof nn=="number"&&nn>0&&(p=1.5*nn,f.O=p,f.j.info("backChannelRequestTimeoutMs_="+p)),p=f;const rn=o.g;if(rn){const pi=rn.g?rn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(pi){var R=p.h;R.g||pi.indexOf("spdy")==-1&&pi.indexOf("quic")==-1&&pi.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(ta(R,R.h),R.h=null))}if(p.G){const ca=rn.g?rn.g.getResponseHeader("X-HTTP-Session-Id"):null;ca&&(p.wa=ca,oe(p.J,p.G,ca))}}f.I=3,f.l&&f.l.ra(),f.aa&&(f.T=Date.now()-o.F,f.j.info("Handshake RTT: "+f.T+"ms")),p=f;var O=o;if(p.na=fl(p,p.L?p.ba:null,p.W),O.L){ju(p.h,O);var W=O,Ee=p.O;Ee&&(W.H=Ee),W.D&&(Yo(W),oi(W)),p.g=O}else al(p);f.i.length>0&&hi(f)}else re[0]!="stop"&&re[0]!="close"||On(f,7);else f.I==3&&(re[0]=="stop"||re[0]=="close"?re[0]=="stop"?On(f,7):ia(f):re[0]!="noop"&&f.l&&f.l.qa(re),f.A=0)}}os(4)}catch{}}var Cm=class{constructor(o,u){this.g=o,this.map=u}};function Uu(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Bu(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function $u(o){return o.h?1:o.g?o.g.size:0}function ea(o,u){return o.h?o.h==u:o.g?o.g.has(u):!1}function ta(o,u){o.g?o.g.add(u):o.h=u}function ju(o,u){o.h&&o.h==u?o.h=null:o.g&&o.g.has(u)&&o.g.delete(u)}Uu.prototype.cancel=function(){if(this.i=qu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function qu(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let u=o.i;for(const f of o.g.values())u=u.concat(f.G);return u}return E(o.i)}var zu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function km(o,u){if(o){o=o.split("&");for(let f=0;f<o.length;f++){const p=o[f].indexOf("=");let b,R=null;p>=0?(b=o[f].substring(0,p),R=o[f].substring(p+1)):b=o[f],u(b,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function Zt(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let u;o instanceof Zt?(this.l=o.l,hs(this,o.j),this.o=o.o,this.g=o.g,fs(this,o.u),this.h=o.h,na(this,Xu(o.i)),this.m=o.m):o&&(u=String(o).match(zu))?(this.l=!1,hs(this,u[1]||"",!0),this.o=ds(u[2]||""),this.g=ds(u[3]||"",!0),fs(this,u[4]),this.h=ds(u[5]||"",!0),na(this,u[6]||"",!0),this.m=ds(u[7]||"")):(this.l=!1,this.i=new ms(null,this.l))}Zt.prototype.toString=function(){const o=[];var u=this.j;u&&o.push(ps(u,Hu,!0),":");var f=this.g;return(f||u=="file")&&(o.push("//"),(u=this.o)&&o.push(ps(u,Hu,!0),"@"),o.push(us(f).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.u,f!=null&&o.push(":",String(f))),(f=this.h)&&(this.g&&f.charAt(0)!="/"&&o.push("/"),o.push(ps(f,f.charAt(0)=="/"?Vm:Dm,!0))),(f=this.i.toString())&&o.push("?",f),(f=this.m)&&o.push("#",ps(f,Mm)),o.join("")},Zt.prototype.resolve=function(o){const u=mt(this);let f=!!o.j;f?hs(u,o.j):f=!!o.o,f?u.o=o.o:f=!!o.g,f?u.g=o.g:f=o.u!=null;var p=o.h;if(f)fs(u,o.u);else if(f=!!o.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var b=u.h.lastIndexOf("/");b!=-1&&(p=u.h.slice(0,b+1)+p)}if(b=p,b==".."||b==".")p="";else if(b.indexOf("./")!=-1||b.indexOf("/.")!=-1){p=b.lastIndexOf("/",0)==0,b=b.split("/");const R=[];for(let O=0;O<b.length;){const W=b[O++];W=="."?p&&O==b.length&&R.push(""):W==".."?((R.length>1||R.length==1&&R[0]!="")&&R.pop(),p&&O==b.length&&R.push("")):(R.push(W),p=!0)}p=R.join("/")}else p=b}return f?u.h=p:f=o.i.toString()!=="",f?na(u,Xu(o.i)):f=!!o.m,f&&(u.m=o.m),u};function mt(o){return new Zt(o)}function hs(o,u,f){o.j=f?ds(u,!0):u,o.j&&(o.j=o.j.replace(/:$/,""))}function fs(o,u){if(u){if(u=Number(u),isNaN(u)||u<0)throw Error("Bad port number "+u);o.u=u}else o.u=null}function na(o,u,f){u instanceof ms?(o.i=u,Lm(o.i,o.l)):(f||(u=ps(u,Om)),o.i=new ms(u,o.l))}function oe(o,u,f){o.i.set(u,f)}function ai(o){return oe(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function ds(o,u){return o?u?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function ps(o,u,f){return typeof o=="string"?(o=encodeURI(o).replace(u,Nm),f&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Nm(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Hu=/[#\/\?@]/g,Dm=/[#\?:]/g,Vm=/[#\?]/g,Om=/[#\?@]/g,Mm=/#/g;function ms(o,u){this.h=this.g=null,this.i=o||null,this.j=!!u}function Vn(o){o.g||(o.g=new Map,o.h=0,o.i&&km(o.i,function(u,f){o.add(decodeURIComponent(u.replace(/\+/g," ")),f)}))}n=ms.prototype,n.add=function(o,u){Vn(this),this.i=null,o=lr(this,o);let f=this.g.get(o);return f||this.g.set(o,f=[]),f.push(u),this.h+=1,this};function Wu(o,u){Vn(o),u=lr(o,u),o.g.has(u)&&(o.i=null,o.h-=o.g.get(u).length,o.g.delete(u))}function Gu(o,u){return Vn(o),u=lr(o,u),o.g.has(u)}n.forEach=function(o,u){Vn(this),this.g.forEach(function(f,p){f.forEach(function(b){o.call(u,b,p,this)},this)},this)};function Ku(o,u){Vn(o);let f=[];if(typeof u=="string")Gu(o,u)&&(f=f.concat(o.g.get(lr(o,u))));else for(o=Array.from(o.g.values()),u=0;u<o.length;u++)f=f.concat(o[u]);return f}n.set=function(o,u){return Vn(this),this.i=null,o=lr(this,o),Gu(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[u]),this.h+=1,this},n.get=function(o,u){return o?(o=Ku(this,o),o.length>0?String(o[0]):u):u};function Qu(o,u,f){Wu(o,u),f.length>0&&(o.i=null,o.g.set(lr(o,u),E(f)),o.h+=f.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],u=Array.from(this.g.keys());for(let p=0;p<u.length;p++){var f=u[p];const b=us(f);f=Ku(this,f);for(let R=0;R<f.length;R++){let O=b;f[R]!==""&&(O+="="+us(f[R])),o.push(O)}}return this.i=o.join("&")};function Xu(o){const u=new ms;return u.i=o.i,o.g&&(u.g=new Map(o.g),u.h=o.h),u}function lr(o,u){return u=String(u),o.j&&(u=u.toLowerCase()),u}function Lm(o,u){u&&!o.j&&(Vn(o),o.i=null,o.g.forEach(function(f,p){const b=p.toLowerCase();p!=b&&(Wu(this,p),Qu(this,b,f))},o)),o.j=u}function xm(o,u){const f=new cs;if(a.Image){const p=new Image;p.onload=d(en,f,"TestLoadImage: loaded",!0,u,p),p.onerror=d(en,f,"TestLoadImage: error",!1,u,p),p.onabort=d(en,f,"TestLoadImage: abort",!1,u,p),p.ontimeout=d(en,f,"TestLoadImage: timeout",!1,u,p),a.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=o}else u(!1)}function Fm(o,u){const f=new cs,p=new AbortController,b=setTimeout(()=>{p.abort(),en(f,"TestPingServer: timeout",!1,u)},1e4);fetch(o,{signal:p.signal}).then(R=>{clearTimeout(b),R.ok?en(f,"TestPingServer: ok",!0,u):en(f,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(b),en(f,"TestPingServer: error",!1,u)})}function en(o,u,f,p,b){try{b&&(b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null),p(f)}catch{}}function Um(){this.g=new Tm}function ra(o){this.i=o.Sb||null,this.h=o.ab||!1}g(ra,Su),ra.prototype.g=function(){return new ci(this.i,this.h)};function ci(o,u){Ne.call(this),this.H=o,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(ci,Ne),n=ci.prototype,n.open=function(o,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=u,this.readyState=1,_s(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const u={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(u.body=o),(this.H||a).fetch(new Request(this.D,u)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,gs(this)),this.readyState=0},n.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,_s(this)),this.g&&(this.readyState=3,_s(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ju(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function Ju(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}n.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var u=o.value?o.value:new Uint8Array(0);(u=this.B.decode(u,{stream:!o.done}))&&(this.response=this.responseText+=u)}o.done?gs(this):_s(this),this.readyState==3&&Ju(this)}},n.Oa=function(o){this.g&&(this.response=this.responseText=o,gs(this))},n.Na=function(o){this.g&&(this.response=o,gs(this))},n.ga=function(){this.g&&gs(this)};function gs(o){o.readyState=4,o.l=null,o.j=null,o.B=null,_s(o)}n.setRequestHeader=function(o,u){this.A.append(o,u)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],u=this.h.entries();for(var f=u.next();!f.done;)f=f.value,o.push(f[0]+": "+f[1]),f=u.next();return o.join(`\r
`)};function _s(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(ci.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function Yu(o){let u="";return xt(o,function(f,p){u+=p,u+=":",u+=f,u+=`\r
`}),u}function sa(o,u,f){e:{for(p in f){var p=!1;break e}p=!0}p||(f=Yu(f),typeof o=="string"?f!=null&&us(f):oe(o,u,f))}function de(o){Ne.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(de,Ne);var Bm=/^https?$/i,$m=["POST","PUT"];n=de.prototype,n.Fa=function(o){this.H=o},n.ea=function(o,u,f,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);u=u?u.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Vu.g(),this.g.onreadystatechange=m(h(this.Ca,this));try{this.B=!0,this.g.open(u,String(o),!0),this.B=!1}catch(R){Zu(this,R);return}if(o=f||"",f=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var b in p)f.set(b,p[b]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const R of p.keys())f.set(R,p.get(R));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(f.keys()).find(R=>R.toLowerCase()=="content-type"),b=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call($m,u,void 0)>=0)||p||b||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[R,O]of f)this.g.setRequestHeader(R,O);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(R){Zu(this,R)}};function Zu(o,u){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=u,o.o=5,el(o),ui(o)}function el(o){o.A||(o.A=!0,Be(o,"complete"),Be(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,Be(this,"complete"),Be(this,"abort"),ui(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ui(this,!0)),de.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?tl(this):this.Xa())},n.Xa=function(){tl(this)};function tl(o){if(o.h&&typeof i<"u"){if(o.v&&tn(o)==4)setTimeout(o.Ca.bind(o),0);else if(Be(o,"readystatechange"),tn(o)==4){o.h=!1;try{const R=o.ca();e:switch(R){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var f;if(!(f=u)){var p;if(p=R===0){let O=String(o.D).match(zu)[1]||null;!O&&a.self&&a.self.location&&(O=a.self.location.protocol.slice(0,-1)),p=!Bm.test(O?O.toLowerCase():"")}f=p}if(f)Be(o,"complete"),Be(o,"success");else{o.o=6;try{var b=tn(o)>2?o.g.statusText:""}catch{b=""}o.l=b+" ["+o.ca()+"]",el(o)}}finally{ui(o)}}}}function ui(o,u){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);const f=o.g;o.g=null,u||Be(o,"ready");try{f.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function tn(o){return o.g?o.g.readyState:0}n.ca=function(){try{return tn(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(o){if(this.g){var u=this.g.responseText;return o&&u.indexOf(o)==0&&(u=u.substring(o.length)),Em(u)}};function nl(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function jm(o){const u={};o=(o.g&&tn(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<o.length;p++){if(v(o[p]))continue;var f=Sm(o[p]);const b=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();const R=u[b]||[];u[b]=R,R.push(f)}rt(u,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function ys(o,u,f){return f&&f.internalChannelParams&&f.internalChannelParams[o]||u}function rl(o){this.za=0,this.i=[],this.j=new cs,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=ys("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=ys("baseRetryDelayMs",5e3,o),this.Za=ys("retryDelaySeedMs",1e4,o),this.Ta=ys("forwardChannelMaxRetries",2,o),this.va=ys("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new Uu(o&&o.concurrentRequestLimit),this.Ba=new Um,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=rl.prototype,n.ka=8,n.I=1,n.connect=function(o,u,f,p){$e(0),this.W=o,this.H=u||{},f&&p!==void 0&&(this.H.OSID=f,this.H.OAID=p),this.F=this.X,this.J=fl(this,null,this.W),hi(this)};function ia(o){if(sl(o),o.I==3){var u=o.V++,f=mt(o.J);if(oe(f,"SID",o.M),oe(f,"RID",u),oe(f,"TYPE","terminate"),vs(o,f),u=new Yt(o,o.j,u),u.M=2,u.A=ai(mt(f)),f=!1,a.navigator&&a.navigator.sendBeacon)try{f=a.navigator.sendBeacon(u.A.toString(),"")}catch{}!f&&a.Image&&(new Image().src=u.A,f=!0),f||(u.g=dl(u.j,null),u.g.ea(u.A)),u.F=Date.now(),oi(u)}hl(o)}function li(o){o.g&&(aa(o),o.g.cancel(),o.g=null)}function sl(o){li(o),o.v&&(a.clearTimeout(o.v),o.v=null),fi(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function hi(o){if(!Bu(o.h)&&!o.m){o.m=!0;var u=o.Ea;G||_(),J||(G(),J=!0),I.add(u,o),o.D=0}}function qm(o,u){return $u(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=u.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=as(h(o.Ea,o,u),ll(o,o.D)),o.D++,!0)}n.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;const b=new Yt(this,this.j,o);let R=this.o;if(this.U&&(R?(R=Ft(R),cr(R,this.U)):R=this.U),this.u!==null||this.R||(b.J=R,R=null),this.S)e:{for(var u=0,f=0;f<this.i.length;f++){t:{var p=this.i[f];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(u+=p,u>4096){u=f;break e}if(u===4096||f===this.i.length-1){u=f+1;break e}}u=1e3}else u=1e3;u=ol(this,b,u),f=mt(this.J),oe(f,"RID",o),oe(f,"CVER",22),this.G&&oe(f,"X-HTTP-Session-Id",this.G),vs(this,f),R&&(this.R?u="headers="+us(Yu(R))+"&"+u:this.u&&sa(f,this.u,R)),ta(this.h,b),this.Ra&&oe(f,"TYPE","init"),this.S?(oe(f,"$req",u),oe(f,"SID","null"),b.U=!0,Jo(b,f,null)):Jo(b,f,u),this.I=2}}else this.I==3&&(o?il(this,o):this.i.length==0||Bu(this.h)||il(this))};function il(o,u){var f;u?f=u.l:f=o.V++;const p=mt(o.J);oe(p,"SID",o.M),oe(p,"RID",f),oe(p,"AID",o.K),vs(o,p),o.u&&o.o&&sa(p,o.u,o.o),f=new Yt(o,o.j,f,o.D+1),o.u===null&&(f.J=o.o),u&&(o.i=u.G.concat(o.i)),u=ol(o,f,1e3),f.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),ta(o.h,f),Jo(f,p,u)}function vs(o,u){o.H&&xt(o.H,function(f,p){oe(u,p,f)}),o.l&&xt({},function(f,p){oe(u,p,f)})}function ol(o,u,f){f=Math.min(o.i.length,f);const p=o.l?h(o.l.Ka,o.l,o):null;e:{var b=o.i;let W=-1;for(;;){const Ee=["count="+f];W==-1?f>0?(W=b[0].g,Ee.push("ofs="+W)):W=0:Ee.push("ofs="+W);let re=!0;for(let Ae=0;Ae<f;Ae++){var R=b[Ae].g;const gt=b[Ae].map;if(R-=W,R<0)W=Math.max(0,b[Ae].g-100),re=!1;else try{R="req"+R+"_"||"";try{var O=gt instanceof Map?gt:Object.entries(gt);for(const[Mn,nn]of O){let rn=nn;c(nn)&&(rn=Wo(nn)),Ee.push(R+Mn+"="+encodeURIComponent(rn))}}catch(Mn){throw Ee.push(R+"type="+encodeURIComponent("_badmap")),Mn}}catch{p&&p(gt)}}if(re){O=Ee.join("&");break e}}O=void 0}return o=o.i.splice(0,f),u.G=o,O}function al(o){if(!o.g&&!o.v){o.Y=1;var u=o.Da;G||_(),J||(G(),J=!0),I.add(u,o),o.A=0}}function oa(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=as(h(o.Da,o),ll(o,o.A)),o.A++,!0)}n.Da=function(){if(this.v=null,cl(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=as(h(this.Wa,this),o)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,$e(10),li(this),cl(this))};function aa(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function cl(o){o.g=new Yt(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var u=mt(o.na);oe(u,"RID","rpc"),oe(u,"SID",o.M),oe(u,"AID",o.K),oe(u,"CI",o.F?"0":"1"),!o.F&&o.ia&&oe(u,"TO",o.ia),oe(u,"TYPE","xmlhttp"),vs(o,u),o.u&&o.o&&sa(u,o.u,o.o),o.O&&(o.g.H=o.O);var f=o.g;o=o.ba,f.M=1,f.A=ai(mt(u)),f.u=null,f.R=!0,Lu(f,o)}n.Va=function(){this.C!=null&&(this.C=null,li(this),oa(this),$e(19))};function fi(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function ul(o,u){var f=null;if(o.g==u){fi(o),aa(o),o.g=null;var p=2}else if(ea(o.h,u))f=u.G,ju(o.h,u),p=1;else return;if(o.I!=0){if(u.o)if(p==1){f=u.u?u.u.length:0,u=Date.now()-u.F;var b=o.D;p=si(),Be(p,new Nu(p,f)),hi(o)}else al(o);else if(b=u.m,b==3||b==0&&u.X>0||!(p==1&&qm(o,u)||p==2&&oa(o)))switch(f&&f.length>0&&(u=o.h,u.i=u.i.concat(f)),b){case 1:On(o,5);break;case 4:On(o,10);break;case 3:On(o,6);break;default:On(o,2)}}}function ll(o,u){let f=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(f*=2),f*u}function On(o,u){if(o.j.info("Error code "+u),u==2){var f=h(o.bb,o),p=o.Ua;const b=!p;p=new Zt(p||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||hs(p,"https"),ai(p),b?xm(p.toString(),f):Fm(p.toString(),f)}else $e(2);o.I=0,o.l&&o.l.pa(u),hl(o),sl(o)}n.bb=function(o){o?(this.j.info("Successfully pinged google.com"),$e(2)):(this.j.info("Failed to ping google.com"),$e(1))};function hl(o){if(o.I=0,o.ja=[],o.l){const u=qu(o.h);(u.length!=0||o.i.length!=0)&&(S(o.ja,u),S(o.ja,o.i),o.h.i.length=0,E(o.i),o.i.length=0),o.l.oa()}}function fl(o,u,f){var p=f instanceof Zt?mt(f):new Zt(f);if(p.g!="")u&&(p.g=u+"."+p.g),fs(p,p.u);else{var b=a.location;p=b.protocol,u=u?u+"."+b.hostname:b.hostname,b=+b.port;const R=new Zt(null);p&&hs(R,p),u&&(R.g=u),b&&fs(R,b),f&&(R.h=f),p=R}return f=o.G,u=o.wa,f&&u&&oe(p,f,u),oe(p,"VER",o.ka),vs(o,p),p}function dl(o,u,f){if(u&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return u=o.Aa&&!o.ma?new de(new ra({ab:f})):new de(o.ma),u.Fa(o.L),u}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function pl(){}n=pl.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function di(){}di.prototype.g=function(o,u){return new Qe(o,u)};function Qe(o,u){Ne.call(this),this.g=new rl(u),this.l=o,this.h=u&&u.messageUrlParams||null,o=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(o?o["X-WebChannel-Content-Type"]=u.messageContentType:o={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.sa&&(o?o["X-WebChannel-Client-Profile"]=u.sa:o={"X-WebChannel-Client-Profile":u.sa}),this.g.U=o,(o=u&&u.Qb)&&!v(o)&&(this.g.u=o),this.A=u&&u.supportsCrossDomainXhr||!1,this.v=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!v(u)&&(this.g.G=u,o=this.h,o!==null&&u in o&&(o=this.h,u in o&&delete o[u])),this.j=new hr(this)}g(Qe,Ne),Qe.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Qe.prototype.close=function(){ia(this.g)},Qe.prototype.o=function(o){var u=this.g;if(typeof o=="string"){var f={};f.__data__=o,o=f}else this.v&&(f={},f.__data__=Wo(o),o=f);u.i.push(new Cm(u.Ya++,o)),u.I==3&&hi(u)},Qe.prototype.N=function(){this.g.l=null,delete this.j,ia(this.g),delete this.g,Qe.Z.N.call(this)};function ml(o){Go.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var u=o.__sm__;if(u){e:{for(const f in u){o=f;break e}o=void 0}(this.i=o)&&(o=this.i,u=u!==null&&o in u?u[o]:void 0),this.data=u}else this.data=o}g(ml,Go);function gl(){Ko.call(this),this.status=1}g(gl,Ko);function hr(o){this.g=o}g(hr,pl),hr.prototype.ra=function(){Be(this.g,"a")},hr.prototype.qa=function(o){Be(this.g,new ml(o))},hr.prototype.pa=function(o){Be(this.g,new gl)},hr.prototype.oa=function(){Be(this.g,"b")},di.prototype.createWebChannel=di.prototype.g,Qe.prototype.send=Qe.prototype.o,Qe.prototype.open=Qe.prototype.m,Qe.prototype.close=Qe.prototype.close,hd=function(){return new di},ld=function(){return si()},ud=Nn,Ua={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ii.NO_ERROR=0,ii.TIMEOUT=8,ii.HTTP_ERROR=6,Ai=ii,Du.COMPLETE="complete",cd=Du,Ru.EventType=is,is.OPEN="a",is.CLOSE="b",is.ERROR="c",is.MESSAGE="d",Ne.prototype.listen=Ne.prototype.J,Ts=Ru,de.prototype.listenOnce=de.prototype.K,de.prototype.getLastError=de.prototype.Ha,de.prototype.getLastErrorCode=de.prototype.ya,de.prototype.getStatus=de.prototype.ca,de.prototype.getResponseJson=de.prototype.La,de.prototype.getResponseText=de.prototype.la,de.prototype.send=de.prototype.ea,de.prototype.setWithCredentials=de.prototype.Fa,ad=de}).apply(typeof _i<"u"?_i:typeof self<"u"?self:typeof window<"u"?window:{});const $l="@firebase/firestore",jl="4.9.2";class Oe{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Oe.UNAUTHENTICATED=new Oe(null),Oe.GOOGLE_CREDENTIALS=new Oe("google-credentials-uid"),Oe.FIRST_PARTY=new Oe("first-party-uid"),Oe.MOCK_USER=new Oe("mock-user");let Jr="12.3.0";const Yn=new wc("@firebase/firestore");function pr(){return Yn.logLevel}function L(n,...e){if(Yn.logLevel<=K.DEBUG){const t=e.map(Sc);Yn.debug(`Firestore (${Jr}): ${n}`,...t)}}function Wt(n,...e){if(Yn.logLevel<=K.ERROR){const t=e.map(Sc);Yn.error(`Firestore (${Jr}): ${n}`,...t)}}function xr(n,...e){if(Yn.logLevel<=K.WARN){const t=e.map(Sc);Yn.warn(`Firestore (${Jr}): ${n}`,...t)}}function Sc(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function $(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,fd(n,r,t)}function fd(n,e,t){let r=`FIRESTORE (${Jr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Wt(r),new Error(r)}function te(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||fd(e,s,r)}function H(n,e){return n}const D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class U extends Lt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class qn{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class dd{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class sv{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Oe.UNAUTHENTICATED)))}shutdown(){}}class iv{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class ov{constructor(e){this.t=e,this.currentUser=Oe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){te(this.o===void 0,42304);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new qn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new qn,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const l=i;e.enqueueRetryable((async()=>{await l.promise,await s(this.currentUser)}))},c=l=>{L("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((l=>c(l))),setTimeout((()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?c(l):(L("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new qn)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(L("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(te(typeof r.accessToken=="string",31837,{l:r}),new dd(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return te(e===null||typeof e=="string",2055,{h:e}),new Oe(e)}}class av{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Oe.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class cv{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new av(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Oe.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ql{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class uv{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,it(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){te(this.o===void 0,3512);const r=i=>{i.error!=null&&L("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,L("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>r(i)))};const s=i=>{L("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>s(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):L("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new ql(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(te(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new ql(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function lv(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Rc{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=lv(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function Q(n,e){return n<e?-1:n>e?1:0}function Ba(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return _a(s)===_a(i)?Q(s,i):_a(s)?1:-1}return Q(n.length,e.length)}const hv=55296,fv=57343;function _a(n){const e=n.charCodeAt(0);return e>=hv&&e<=fv}function Fr(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const zl="__name__";class yt{constructor(e,t,r){t===void 0?t=0:t>e.length&&$(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&$(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return yt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof yt?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=yt.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return Q(e.length,t.length)}static compareSegments(e,t){const r=yt.isNumericId(e),s=yt.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?yt.extractNumericId(e).compare(yt.extractNumericId(t)):Ba(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return gn.fromString(e.substring(4,e.length-2))}}class ce extends yt{construct(e,t,r){return new ce(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new U(D.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new ce(t)}static emptyPath(){return new ce([])}}const dv=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Re extends yt{construct(e,t,r){return new Re(e,t,r)}static isValidIdentifier(e){return dv.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Re.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===zl}static keyField(){return new Re([zl])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new U(D.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const c=e[s];if(c==="\\"){if(s+1===e.length)throw new U(D.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new U(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else c==="`"?(a=!a,s++):c!=="."||a?(r+=c,s++):(i(),s++)}if(i(),a)throw new U(D.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Re(t)}static emptyPath(){return new Re([])}}class B{constructor(e){this.path=e}static fromPath(e){return new B(ce.fromString(e))}static fromName(e){return new B(ce.fromString(e).popFirst(5))}static empty(){return new B(ce.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ce.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ce.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new B(new ce(e.slice()))}}function pd(n,e,t){if(!t)throw new U(D.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function pv(n,e,t,r){if(e===!0&&r===!0)throw new U(D.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Hl(n){if(!B.isDocumentKey(n))throw new U(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Wl(n){if(B.isDocumentKey(n))throw new U(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function md(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Pc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":$(12329,{type:typeof n})}function _n(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new U(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Pc(n);throw new U(D.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ye(n,e){const t={typeString:n};return e&&(t.value=e),t}function Qs(n,e){if(!md(n))throw new U(D.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new U(D.INVALID_ARGUMENT,t);return!0}const Gl=-62135596800,Kl=1e6;class ue{static now(){return ue.fromMillis(Date.now())}static fromDate(e){return ue.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Kl);return new ue(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new U(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new U(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Gl)throw new U(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new U(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Kl}_compareTo(e){return this.seconds===e.seconds?Q(this.nanoseconds,e.nanoseconds):Q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ue._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Qs(e,ue._jsonSchema))return new ue(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Gl;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ue._jsonSchemaVersion="firestore/timestamp/1.0",ue._jsonSchema={type:ye("string",ue._jsonSchemaVersion),seconds:ye("number"),nanoseconds:ye("number")};class q{static fromTimestamp(e){return new q(e)}static min(){return new q(new ue(0,0))}static max(){return new q(new ue(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const xs=-1;function mv(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=q.fromTimestamp(r===1e9?new ue(t+1,0):new ue(t,r));return new Tn(s,B.empty(),e)}function gv(n){return new Tn(n.readTime,n.key,xs)}class Tn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Tn(q.min(),B.empty(),xs)}static max(){return new Tn(q.max(),B.empty(),xs)}}function _v(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=B.comparator(n.documentKey,e.documentKey),t!==0?t:Q(n.largestBatchId,e.largestBatchId))}const yv="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class vv{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Yr(n){if(n.code!==D.FAILED_PRECONDITION||n.message!==yv)throw n;L("LocalStore","Unexpectedly lost primary lease")}class N{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&$(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new N(((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof N?t:N.resolve(t)}catch(t){return N.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):N.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):N.reject(t)}static resolve(e){return new N(((t,r)=>{t(e)}))}static reject(e){return new N(((t,r)=>{r(e)}))}static waitFor(e){return new N(((t,r)=>{let s=0,i=0,a=!1;e.forEach((c=>{++s,c.next((()=>{++i,a&&i===s&&t()}),(l=>r(l)))})),a=!0,i===s&&t()}))}static or(e){let t=N.resolve(!1);for(const r of e)t=t.next((s=>s?N.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,i)=>{r.push(t.call(this,s,i))})),this.waitFor(r)}static mapArray(e,t){return new N(((r,s)=>{const i=e.length,a=new Array(i);let c=0;for(let l=0;l<i;l++){const h=l;t(e[h]).next((d=>{a[h]=d,++c,c===i&&r(a)}),(d=>s(d)))}}))}static doWhile(e,t){return new N(((r,s)=>{const i=()=>{e()===!0?t().next((()=>{i()}),s):r()};i()}))}}function Ev(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Zr(n){return n.name==="IndexedDbTransactionError"}class Eo{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Eo.ce=-1;const Cc=-1;function To(n){return n==null}function Ui(n){return n===0&&1/n==-1/0}function Tv(n){return typeof n=="number"&&Number.isInteger(n)&&!Ui(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const gd="";function Iv(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Ql(e)),e=wv(n.get(t),e);return Ql(e)}function wv(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case gd:t+="";break;default:t+=i}}return t}function Ql(n){return n+gd+""}function Xl(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Pn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function _d(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class fe{constructor(e,t){this.comparator=e,this.root=t||Se.EMPTY}insert(e,t){return new fe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Se.BLACK,null,null))}remove(e){return new fe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Se.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new yi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new yi(this.root,e,this.comparator,!1)}getReverseIterator(){return new yi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new yi(this.root,e,this.comparator,!0)}}class yi{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Se{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Se.RED,this.left=s??Se.EMPTY,this.right=i??Se.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Se(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Se.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Se.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Se.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Se.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw $(43730,{key:this.key,value:this.value});if(this.right.isRed())throw $(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw $(27949);return e+(this.isRed()?0:1)}}Se.EMPTY=null,Se.RED=!0,Se.BLACK=!1;Se.EMPTY=new class{constructor(){this.size=0}get key(){throw $(57766)}get value(){throw $(16141)}get color(){throw $(16727)}get left(){throw $(29726)}get right(){throw $(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new Se(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class we{constructor(e){this.comparator=e,this.data=new fe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Jl(this.data.getIterator())}getIteratorFrom(e){return new Jl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof we)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new we(this.comparator);return t.data=e,t}}class Jl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ye{constructor(e){this.fields=e,e.sort(Re.comparator)}static empty(){return new Ye([])}unionWith(e){let t=new we(Re.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ye(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Fr(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class yd extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ke{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new yd("Invalid base64 string: "+i):i}})(e);return new ke(t)}static fromUint8Array(e){const t=(function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i})(e);return new ke(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ke.EMPTY_BYTE_STRING=new ke("");const Av=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function In(n){if(te(!!n,39018),typeof n=="string"){let e=0;const t=Av.exec(n);if(te(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:me(n.seconds),nanos:me(n.nanos)}}function me(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function wn(n){return typeof n=="string"?ke.fromBase64String(n):ke.fromUint8Array(n)}const vd="server_timestamp",Ed="__type__",Td="__previous_value__",Id="__local_write_time__";function kc(n){return(n?.mapValue?.fields||{})[Ed]?.stringValue===vd}function Io(n){const e=n.mapValue.fields[Td];return kc(e)?Io(e):e}function Fs(n){const e=In(n.mapValue.fields[Id].timestampValue);return new ue(e.seconds,e.nanos)}class bv{constructor(e,t,r,s,i,a,c,l,h,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=l,this.useFetchStreams=h,this.isUsingEmulator=d}}const Bi="(default)";class Us{constructor(e,t){this.projectId=e,this.database=t||Bi}static empty(){return new Us("","")}get isDefaultDatabase(){return this.database===Bi}isEqual(e){return e instanceof Us&&e.projectId===this.projectId&&e.database===this.database}}const wd="__type__",Sv="__max__",vi={mapValue:{}},Ad="__vector__",$i="value";function An(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?kc(n)?4:Pv(n)?9007199254740991:Rv(n)?10:11:$(28295,{value:n})}function Dt(n,e){if(n===e)return!0;const t=An(n);if(t!==An(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Fs(n).isEqual(Fs(e));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=In(s.timestampValue),c=In(i.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,i){return wn(s.bytesValue).isEqual(wn(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,i){return me(s.geoPointValue.latitude)===me(i.geoPointValue.latitude)&&me(s.geoPointValue.longitude)===me(i.geoPointValue.longitude)})(n,e);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return me(s.integerValue)===me(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=me(s.doubleValue),c=me(i.doubleValue);return a===c?Ui(a)===Ui(c):isNaN(a)&&isNaN(c)}return!1})(n,e);case 9:return Fr(n.arrayValue.values||[],e.arrayValue.values||[],Dt);case 10:case 11:return(function(s,i){const a=s.mapValue.fields||{},c=i.mapValue.fields||{};if(Xl(a)!==Xl(c))return!1;for(const l in a)if(a.hasOwnProperty(l)&&(c[l]===void 0||!Dt(a[l],c[l])))return!1;return!0})(n,e);default:return $(52216,{left:n})}}function Bs(n,e){return(n.values||[]).find((t=>Dt(t,e)))!==void 0}function Ur(n,e){if(n===e)return 0;const t=An(n),r=An(e);if(t!==r)return Q(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Q(n.booleanValue,e.booleanValue);case 2:return(function(i,a){const c=me(i.integerValue||i.doubleValue),l=me(a.integerValue||a.doubleValue);return c<l?-1:c>l?1:c===l?0:isNaN(c)?isNaN(l)?0:-1:1})(n,e);case 3:return Yl(n.timestampValue,e.timestampValue);case 4:return Yl(Fs(n),Fs(e));case 5:return Ba(n.stringValue,e.stringValue);case 6:return(function(i,a){const c=wn(i),l=wn(a);return c.compareTo(l)})(n.bytesValue,e.bytesValue);case 7:return(function(i,a){const c=i.split("/"),l=a.split("/");for(let h=0;h<c.length&&h<l.length;h++){const d=Q(c[h],l[h]);if(d!==0)return d}return Q(c.length,l.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,a){const c=Q(me(i.latitude),me(a.latitude));return c!==0?c:Q(me(i.longitude),me(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Zl(n.arrayValue,e.arrayValue);case 10:return(function(i,a){const c=i.fields||{},l=a.fields||{},h=c[$i]?.arrayValue,d=l[$i]?.arrayValue,g=Q(h?.values?.length||0,d?.values?.length||0);return g!==0?g:Zl(h,d)})(n.mapValue,e.mapValue);case 11:return(function(i,a){if(i===vi.mapValue&&a===vi.mapValue)return 0;if(i===vi.mapValue)return 1;if(a===vi.mapValue)return-1;const c=i.fields||{},l=Object.keys(c),h=a.fields||{},d=Object.keys(h);l.sort(),d.sort();for(let g=0;g<l.length&&g<d.length;++g){const m=Ba(l[g],d[g]);if(m!==0)return m;const E=Ur(c[l[g]],h[d[g]]);if(E!==0)return E}return Q(l.length,d.length)})(n.mapValue,e.mapValue);default:throw $(23264,{he:t})}}function Yl(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Q(n,e);const t=In(n),r=In(e),s=Q(t.seconds,r.seconds);return s!==0?s:Q(t.nanos,r.nanos)}function Zl(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Ur(t[s],r[s]);if(i)return i}return Q(t.length,r.length)}function Br(n){return $a(n)}function $a(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=In(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return wn(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return B.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=$a(i);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${$a(t.fields[a])}`;return s+"}"})(n.mapValue):$(61005,{value:n})}function bi(n){switch(An(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Io(n);return e?16+bi(e):16;case 5:return 2*n.stringValue.length;case 6:return wn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,i)=>s+bi(i)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return Pn(r.fields,((i,a)=>{s+=i.length+bi(a)})),s})(n.mapValue);default:throw $(13486,{value:n})}}function ja(n){return!!n&&"integerValue"in n}function Nc(n){return!!n&&"arrayValue"in n}function eh(n){return!!n&&"nullValue"in n}function th(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Si(n){return!!n&&"mapValue"in n}function Rv(n){return(n?.mapValue?.fields||{})[wd]?.stringValue===Ad}function Ps(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Pn(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=Ps(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ps(n.arrayValue.values[t]);return e}return{...n}}function Pv(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Sv}class He{constructor(e){this.value=e}static empty(){return new He({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Si(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ps(t)}setAll(e){let t=Re.emptyPath(),r={},s=[];e.forEach(((a,c)=>{if(!t.isImmediateParentOf(c)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=c.popLast()}a?r[c.lastSegment()]=Ps(a):s.push(c.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Si(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Dt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Si(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Pn(t,((s,i)=>e[s]=i));for(const s of r)delete e[s]}clone(){return new He(Ps(this.value))}}function bd(n){const e=[];return Pn(n.fields,((t,r)=>{const s=new Re([t]);if(Si(r)){const i=bd(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)})),new Ye(e)}class xe{constructor(e,t,r,s,i,a,c){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=c}static newInvalidDocument(e){return new xe(e,0,q.min(),q.min(),q.min(),He.empty(),0)}static newFoundDocument(e,t,r,s){return new xe(e,1,t,q.min(),r,s,0)}static newNoDocument(e,t){return new xe(e,2,t,q.min(),q.min(),He.empty(),0)}static newUnknownDocument(e,t){return new xe(e,3,t,q.min(),q.min(),He.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(q.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=He.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=He.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof xe&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new xe(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ji{constructor(e,t){this.position=e,this.inclusive=t}}function nh(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],a=n.position[s];if(i.field.isKeyField()?r=B.comparator(B.fromName(a.referenceValue),t.key):r=Ur(a,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function rh(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Dt(n.position[t],e.position[t]))return!1;return!0}class qi{constructor(e,t="asc"){this.field=e,this.dir=t}}function Cv(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Sd{}class Te extends Sd{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Nv(e,t,r):t==="array-contains"?new Ov(e,r):t==="in"?new Mv(e,r):t==="not-in"?new Lv(e,r):t==="array-contains-any"?new xv(e,r):new Te(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Dv(e,r):new Vv(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Ur(t,this.value)):t!==null&&An(this.value)===An(t)&&this.matchesComparison(Ur(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return $(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Vt extends Sd{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Vt(e,t)}matches(e){return Rd(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Rd(n){return n.op==="and"}function Pd(n){return kv(n)&&Rd(n)}function kv(n){for(const e of n.filters)if(e instanceof Vt)return!1;return!0}function qa(n){if(n instanceof Te)return n.field.canonicalString()+n.op.toString()+Br(n.value);if(Pd(n))return n.filters.map((e=>qa(e))).join(",");{const e=n.filters.map((t=>qa(t))).join(",");return`${n.op}(${e})`}}function Cd(n,e){return n instanceof Te?(function(r,s){return s instanceof Te&&r.op===s.op&&r.field.isEqual(s.field)&&Dt(r.value,s.value)})(n,e):n instanceof Vt?(function(r,s){return s instanceof Vt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((i,a,c)=>i&&Cd(a,s.filters[c])),!0):!1})(n,e):void $(19439)}function kd(n){return n instanceof Te?(function(t){return`${t.field.canonicalString()} ${t.op} ${Br(t.value)}`})(n):n instanceof Vt?(function(t){return t.op.toString()+" {"+t.getFilters().map(kd).join(" ,")+"}"})(n):"Filter"}class Nv extends Te{constructor(e,t,r){super(e,t,r),this.key=B.fromName(r.referenceValue)}matches(e){const t=B.comparator(e.key,this.key);return this.matchesComparison(t)}}class Dv extends Te{constructor(e,t){super(e,"in",t),this.keys=Nd("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Vv extends Te{constructor(e,t){super(e,"not-in",t),this.keys=Nd("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Nd(n,e){return(e.arrayValue?.values||[]).map((t=>B.fromName(t.referenceValue)))}class Ov extends Te{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Nc(t)&&Bs(t.arrayValue,this.value)}}class Mv extends Te{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Bs(this.value.arrayValue,t)}}class Lv extends Te{constructor(e,t){super(e,"not-in",t)}matches(e){if(Bs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Bs(this.value.arrayValue,t)}}class xv extends Te{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Nc(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Bs(this.value.arrayValue,r)))}}class Fv{constructor(e,t=null,r=[],s=[],i=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=c,this.Te=null}}function sh(n,e=null,t=[],r=[],s=null,i=null,a=null){return new Fv(n,e,t,r,s,i,a)}function Dc(n){const e=H(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>qa(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(i){return i.field.canonicalString()+i.dir})(r))).join(","),To(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Br(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Br(r))).join(",")),e.Te=t}return e.Te}function Vc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Cv(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Cd(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!rh(n.startAt,e.startAt)&&rh(n.endAt,e.endAt)}function za(n){return B.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class wo{constructor(e,t=null,r=[],s=[],i=null,a="F",c=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=c,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Uv(n,e,t,r,s,i,a,c){return new wo(n,e,t,r,s,i,a,c)}function Oc(n){return new wo(n)}function ih(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Bv(n){return n.collectionGroup!==null}function Cs(n){const e=H(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new we(Re.comparator);return a.filters.forEach((l=>{l.getFlattenedFilters().forEach((h=>{h.isInequality()&&(c=c.add(h.field))}))})),c})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new qi(i,r))})),t.has(Re.keyField().canonicalString())||e.Ie.push(new qi(Re.keyField(),r))}return e.Ie}function At(n){const e=H(n);return e.Ee||(e.Ee=$v(e,Cs(n))),e.Ee}function $v(n,e){if(n.limitType==="F")return sh(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const i=s.dir==="desc"?"asc":"desc";return new qi(s.field,i)}));const t=n.endAt?new ji(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ji(n.startAt.position,n.startAt.inclusive):null;return sh(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Ha(n,e,t){return new wo(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ao(n,e){return Vc(At(n),At(e))&&n.limitType===e.limitType}function Dd(n){return`${Dc(At(n))}|lt:${n.limitType}`}function mr(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>kd(s))).join(", ")}]`),To(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>Br(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>Br(s))).join(",")),`Target(${r})`})(At(n))}; limitType=${n.limitType})`}function bo(n,e){return e.isFoundDocument()&&(function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):B.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)})(n,e)&&(function(r,s){for(const i of Cs(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,c,l){const h=nh(a,c,l);return a.inclusive?h<=0:h<0})(r.startAt,Cs(r),s)||r.endAt&&!(function(a,c,l){const h=nh(a,c,l);return a.inclusive?h>=0:h>0})(r.endAt,Cs(r),s))})(n,e)}function jv(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Vd(n){return(e,t)=>{let r=!1;for(const s of Cs(n)){const i=qv(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function qv(n,e,t){const r=n.field.isKeyField()?B.comparator(e.key,t.key):(function(i,a,c){const l=a.data.field(i),h=c.data.field(i);return l!==null&&h!==null?Ur(l,h):$(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return $(19790,{direction:n.dir})}}class sr{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Pn(this.inner,((t,r)=>{for(const[s,i]of r)e(s,i)}))}isEmpty(){return _d(this.inner)}size(){return this.innerSize}}const zv=new fe(B.comparator);function Gt(){return zv}const Od=new fe(B.comparator);function Is(...n){let e=Od;for(const t of n)e=e.insert(t.key,t);return e}function Md(n){let e=Od;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function Fn(){return ks()}function Ld(){return ks()}function ks(){return new sr((n=>n.toString()),((n,e)=>n.isEqual(e)))}const Hv=new fe(B.comparator),Wv=new we(B.comparator);function X(...n){let e=Wv;for(const t of n)e=e.add(t);return e}const Gv=new we(Q);function Kv(){return Gv}function Mc(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ui(e)?"-0":e}}function xd(n){return{integerValue:""+n}}function Qv(n,e){return Tv(e)?xd(e):Mc(n,e)}class So{constructor(){this._=void 0}}function Xv(n,e,t){return n instanceof zi?(function(s,i){const a={fields:{[Ed]:{stringValue:vd},[Id]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&kc(i)&&(i=Io(i)),i&&(a.fields[Td]=i),{mapValue:a}})(t,e):n instanceof $s?Ud(n,e):n instanceof js?Bd(n,e):(function(s,i){const a=Fd(s,i),c=oh(a)+oh(s.Ae);return ja(a)&&ja(s.Ae)?xd(c):Mc(s.serializer,c)})(n,e)}function Jv(n,e,t){return n instanceof $s?Ud(n,e):n instanceof js?Bd(n,e):t}function Fd(n,e){return n instanceof Hi?(function(r){return ja(r)||(function(i){return!!i&&"doubleValue"in i})(r)})(e)?e:{integerValue:0}:null}class zi extends So{}class $s extends So{constructor(e){super(),this.elements=e}}function Ud(n,e){const t=$d(e);for(const r of n.elements)t.some((s=>Dt(s,r)))||t.push(r);return{arrayValue:{values:t}}}class js extends So{constructor(e){super(),this.elements=e}}function Bd(n,e){let t=$d(e);for(const r of n.elements)t=t.filter((s=>!Dt(s,r)));return{arrayValue:{values:t}}}class Hi extends So{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function oh(n){return me(n.integerValue||n.doubleValue)}function $d(n){return Nc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Yv(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof $s&&s instanceof $s||r instanceof js&&s instanceof js?Fr(r.elements,s.elements,Dt):r instanceof Hi&&s instanceof Hi?Dt(r.Ae,s.Ae):r instanceof zi&&s instanceof zi})(n.transform,e.transform)}class Zv{constructor(e,t){this.version=e,this.transformResults=t}}class ht{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ht}static exists(e){return new ht(void 0,e)}static updateTime(e){return new ht(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ri(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Ro{}function jd(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Lc(n.key,ht.none()):new Xs(n.key,n.data,ht.none());{const t=n.data,r=He.empty();let s=new we(Re.comparator);for(let i of e.fields)if(!s.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Cn(n.key,r,new Ye(s.toArray()),ht.none())}}function eE(n,e,t){n instanceof Xs?(function(s,i,a){const c=s.value.clone(),l=ch(s.fieldTransforms,i,a.transformResults);c.setAll(l),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()})(n,e,t):n instanceof Cn?(function(s,i,a){if(!Ri(s.precondition,i))return void i.convertToUnknownDocument(a.version);const c=ch(s.fieldTransforms,i,a.transformResults),l=i.data;l.setAll(qd(s)),l.setAll(c),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):(function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function Ns(n,e,t,r){return n instanceof Xs?(function(i,a,c,l){if(!Ri(i.precondition,a))return c;const h=i.value.clone(),d=uh(i.fieldTransforms,l,a);return h.setAll(d),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null})(n,e,t,r):n instanceof Cn?(function(i,a,c,l){if(!Ri(i.precondition,a))return c;const h=uh(i.fieldTransforms,l,a),d=a.data;return d.setAll(qd(i)),d.setAll(h),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((g=>g.field)))})(n,e,t,r):(function(i,a,c){return Ri(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c})(n,e,t)}function tE(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Fd(r.transform,s||null);i!=null&&(t===null&&(t=He.empty()),t.set(r.field,i))}return t||null}function ah(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Fr(r,s,((i,a)=>Yv(i,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Xs extends Ro{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Cn extends Ro{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function qd(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function ch(n,e,t){const r=new Map;te(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],a=i.transform,c=e.data.field(i.field);r.set(i.field,Jv(a,c,t[s]))}return r}function uh(n,e,t){const r=new Map;for(const s of n){const i=s.transform,a=t.data.field(s.field);r.set(s.field,Xv(i,a,e))}return r}class Lc extends Ro{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class nE extends Ro{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class rE{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&eE(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ns(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Ns(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Ld();return this.mutations.forEach((s=>{const i=e.get(s.key),a=i.overlayedDocument;let c=this.applyToLocalView(a,i.mutatedFields);c=t.has(s.key)?null:c;const l=jd(a,c);l!==null&&r.set(s.key,l),a.isValidDocument()||a.convertToNoDocument(q.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),X())}isEqual(e){return this.batchId===e.batchId&&Fr(this.mutations,e.mutations,((t,r)=>ah(t,r)))&&Fr(this.baseMutations,e.baseMutations,((t,r)=>ah(t,r)))}}class xc{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){te(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return Hv})();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new xc(e,t,r,s)}}class sE{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class iE{constructor(e,t){this.count=e,this.unchangedNames=t}}var _e,Y;function oE(n){switch(n){case D.OK:return $(64938);case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0;default:return $(15467,{code:n})}}function zd(n){if(n===void 0)return Wt("GRPC error has no .code"),D.UNKNOWN;switch(n){case _e.OK:return D.OK;case _e.CANCELLED:return D.CANCELLED;case _e.UNKNOWN:return D.UNKNOWN;case _e.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case _e.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case _e.INTERNAL:return D.INTERNAL;case _e.UNAVAILABLE:return D.UNAVAILABLE;case _e.UNAUTHENTICATED:return D.UNAUTHENTICATED;case _e.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case _e.NOT_FOUND:return D.NOT_FOUND;case _e.ALREADY_EXISTS:return D.ALREADY_EXISTS;case _e.PERMISSION_DENIED:return D.PERMISSION_DENIED;case _e.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case _e.ABORTED:return D.ABORTED;case _e.OUT_OF_RANGE:return D.OUT_OF_RANGE;case _e.UNIMPLEMENTED:return D.UNIMPLEMENTED;case _e.DATA_LOSS:return D.DATA_LOSS;default:return $(39323,{code:n})}}(Y=_e||(_e={}))[Y.OK=0]="OK",Y[Y.CANCELLED=1]="CANCELLED",Y[Y.UNKNOWN=2]="UNKNOWN",Y[Y.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Y[Y.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Y[Y.NOT_FOUND=5]="NOT_FOUND",Y[Y.ALREADY_EXISTS=6]="ALREADY_EXISTS",Y[Y.PERMISSION_DENIED=7]="PERMISSION_DENIED",Y[Y.UNAUTHENTICATED=16]="UNAUTHENTICATED",Y[Y.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Y[Y.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Y[Y.ABORTED=10]="ABORTED",Y[Y.OUT_OF_RANGE=11]="OUT_OF_RANGE",Y[Y.UNIMPLEMENTED=12]="UNIMPLEMENTED",Y[Y.INTERNAL=13]="INTERNAL",Y[Y.UNAVAILABLE=14]="UNAVAILABLE",Y[Y.DATA_LOSS=15]="DATA_LOSS";function aE(){return new TextEncoder}const cE=new gn([4294967295,4294967295],0);function lh(n){const e=aE().encode(n),t=new od;return t.update(e),new Uint8Array(t.digest())}function hh(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new gn([t,r],0),new gn([s,i],0)]}class Fc{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ws(`Invalid padding: ${t}`);if(r<0)throw new ws(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ws(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ws(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=gn.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(gn.fromNumber(r)));return s.compare(cE)===1&&(s=new gn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=lh(e),[r,s]=hh(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new Fc(i,s,t);return r.forEach((c=>a.insert(c))),a}insert(e){if(this.ge===0)return;const t=lh(e),[r,s]=hh(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);this.Se(a)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class ws extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Po{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Js.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Po(q.min(),s,new fe(Q),Gt(),X())}}class Js{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Js(r,t,X(),X(),X())}}class Pi{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class Hd{constructor(e,t){this.targetId=e,this.Ce=t}}class Wd{constructor(e,t,r=ke.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class fh{constructor(){this.ve=0,this.Fe=dh(),this.Me=ke.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=X(),t=X(),r=X();return this.Fe.forEach(((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:$(38017,{changeType:i})}})),new Js(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=dh()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,te(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class uE{constructor(e){this.Ge=e,this.ze=new Map,this.je=Gt(),this.Je=Ei(),this.He=Ei(),this.Ye=new fe(Q)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:$(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(za(i))if(r===0){const a=new B(i.path);this.et(t,a,xe.newNoDocument(a,q.min()))}else te(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const c=this.ut(e),l=c?this.ct(c,e,a):1;if(l!==0){this.it(t);const h=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,h)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let a,c;try{a=wn(r).toUint8Array()}catch(l){if(l instanceof yd)return xr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{c=new Fc(a,s,i)}catch(l){return xr(l instanceof ws?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return c.ge===0?null:c}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((i=>{const a=this.Ge.ht(),c=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.et(t,i,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((i,a)=>{const c=this.ot(a);if(c){if(i.current&&za(c.target)){const l=new B(c.target.path);this.It(l).has(a)||this.Et(a,l)||this.et(a,l,xe.newNoDocument(l,e))}i.Be&&(t.set(a,i.ke()),i.qe())}}));let r=X();this.He.forEach(((i,a)=>{let c=!0;a.forEachWhile((l=>{const h=this.ot(l);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)})),c&&(r=r.add(i))})),this.je.forEach(((i,a)=>a.setReadTime(e)));const s=new Po(e,t,this.Ye,this.je,r);return this.je=Gt(),this.Je=Ei(),this.He=Ei(),this.Ye=new fe(Q),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new fh,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new we(Q),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new we(Q),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||L("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new fh),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Ei(){return new fe(B.comparator)}function dh(){return new fe(B.comparator)}const lE={asc:"ASCENDING",desc:"DESCENDING"},hE={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},fE={and:"AND",or:"OR"};class dE{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Wa(n,e){return n.useProto3Json||To(e)?e:{value:e}}function Wi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Gd(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function pE(n,e){return Wi(n,e.toTimestamp())}function bt(n){return te(!!n,49232),q.fromTimestamp((function(t){const r=In(t);return new ue(r.seconds,r.nanos)})(n))}function Uc(n,e){return Ga(n,e).canonicalString()}function Ga(n,e){const t=(function(s){return new ce(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Kd(n){const e=ce.fromString(n);return te(Zd(e),10190,{key:e.toString()}),e}function Ka(n,e){return Uc(n.databaseId,e.path)}function ya(n,e){const t=Kd(e);if(t.get(1)!==n.databaseId.projectId)throw new U(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new U(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new B(Xd(t))}function Qd(n,e){return Uc(n.databaseId,e)}function mE(n){const e=Kd(n);return e.length===4?ce.emptyPath():Xd(e)}function Qa(n){return new ce(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Xd(n){return te(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function ph(n,e,t){return{name:Ka(n,e),fields:t.value.mapValue.fields}}function gE(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:$(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=(function(h,d){return h.useProto3Json?(te(d===void 0||typeof d=="string",58123),ke.fromBase64String(d||"")):(te(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),ke.fromUint8Array(d||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&(function(h){const d=h.code===void 0?D.UNKNOWN:zd(h.code);return new U(d,h.message||"")})(a);t=new Wd(r,s,i,c||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=ya(n,r.document.name),i=bt(r.document.updateTime),a=r.document.createTime?bt(r.document.createTime):q.min(),c=new He({mapValue:{fields:r.document.fields}}),l=xe.newFoundDocument(s,i,a,c),h=r.targetIds||[],d=r.removedTargetIds||[];t=new Pi(h,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=ya(n,r.document),i=r.readTime?bt(r.readTime):q.min(),a=xe.newNoDocument(s,i),c=r.removedTargetIds||[];t=new Pi([],c,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=ya(n,r.document),i=r.removedTargetIds||[];t=new Pi([],i,s,null)}else{if(!("filter"in e))return $(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new iE(s,i),c=r.targetId;t=new Hd(c,a)}}return t}function _E(n,e){let t;if(e instanceof Xs)t={update:ph(n,e.key,e.value)};else if(e instanceof Lc)t={delete:Ka(n,e.key)};else if(e instanceof Cn)t={update:ph(n,e.key,e.data),updateMask:SE(e.fieldMask)};else{if(!(e instanceof nE))return $(16599,{Vt:e.type});t={verify:Ka(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(i,a){const c=a.transform;if(c instanceof zi)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof $s)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof js)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Hi)return{fieldPath:a.field.canonicalString(),increment:c.Ae};throw $(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,i){return i.updateTime!==void 0?{updateTime:pE(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:$(27497)})(n,e.precondition)),t}function yE(n,e){return n&&n.length>0?(te(e!==void 0,14353),n.map((t=>(function(s,i){let a=s.updateTime?bt(s.updateTime):bt(i);return a.isEqual(q.min())&&(a=bt(i)),new Zv(a,s.transformResults||[])})(t,e)))):[]}function vE(n,e){return{documents:[Qd(n,e.path)]}}function EE(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Qd(n,s);const i=(function(h){if(h.length!==0)return Yd(Vt.create(h,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const a=(function(h){if(h.length!==0)return h.map((d=>(function(m){return{field:gr(m.field),direction:wE(m.dir)}})(d)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const c=Wa(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:s}}function TE(n){let e=mE(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){te(r===1,65062);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=(function(g){const m=Jd(g);return m instanceof Vt&&Pd(m)?m.getFilters():[m]})(t.where));let a=[];t.orderBy&&(a=(function(g){return g.map((m=>(function(S){return new qi(_r(S.field),(function(P){switch(P){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(S.direction))})(m)))})(t.orderBy));let c=null;t.limit&&(c=(function(g){let m;return m=typeof g=="object"?g.value:g,To(m)?null:m})(t.limit));let l=null;t.startAt&&(l=(function(g){const m=!!g.before,E=g.values||[];return new ji(E,m)})(t.startAt));let h=null;return t.endAt&&(h=(function(g){const m=!g.before,E=g.values||[];return new ji(E,m)})(t.endAt)),Uv(e,s,a,i,c,"F",l,h)}function IE(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Jd(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=_r(t.unaryFilter.field);return Te.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=_r(t.unaryFilter.field);return Te.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=_r(t.unaryFilter.field);return Te.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=_r(t.unaryFilter.field);return Te.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return $(61313);default:return $(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Te.create(_r(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return $(58110);default:return $(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Vt.create(t.compositeFilter.filters.map((r=>Jd(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return $(1026)}})(t.compositeFilter.op))})(n):$(30097,{filter:n})}function wE(n){return lE[n]}function AE(n){return hE[n]}function bE(n){return fE[n]}function gr(n){return{fieldPath:n.canonicalString()}}function _r(n){return Re.fromServerFormat(n.fieldPath)}function Yd(n){return n instanceof Te?(function(t){if(t.op==="=="){if(th(t.value))return{unaryFilter:{field:gr(t.field),op:"IS_NAN"}};if(eh(t.value))return{unaryFilter:{field:gr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(th(t.value))return{unaryFilter:{field:gr(t.field),op:"IS_NOT_NAN"}};if(eh(t.value))return{unaryFilter:{field:gr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:gr(t.field),op:AE(t.op),value:t.value}}})(n):n instanceof Vt?(function(t){const r=t.getFilters().map((s=>Yd(s)));return r.length===1?r[0]:{compositeFilter:{op:bE(t.op),filters:r}}})(n):$(54877,{filter:n})}function SE(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Zd(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class ln{constructor(e,t,r,s,i=q.min(),a=q.min(),c=ke.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=l}withSequenceNumber(e){return new ln(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ln(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ln(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ln(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class RE{constructor(e){this.yt=e}}function PE(n){const e=TE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ha(e,e.limit,"L"):e}class CE{constructor(){this.Cn=new kE}addToCollectionParentIndex(e,t){return this.Cn.add(t),N.resolve()}getCollectionParents(e,t){return N.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return N.resolve()}deleteFieldIndex(e,t){return N.resolve()}deleteAllFieldIndexes(e){return N.resolve()}createTargetIndexes(e,t){return N.resolve()}getDocumentsMatchingTarget(e,t){return N.resolve(null)}getIndexType(e,t){return N.resolve(0)}getFieldIndexes(e,t){return N.resolve([])}getNextCollectionGroupToUpdate(e){return N.resolve(null)}getMinOffset(e,t){return N.resolve(Tn.min())}getMinOffsetFromCollectionGroup(e,t){return N.resolve(Tn.min())}updateCollectionGroup(e,t,r){return N.resolve()}updateIndexEntries(e,t){return N.resolve()}}class kE{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new we(ce.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new we(ce.comparator)).toArray()}}const mh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ep=41943040;class ze{static withCacheSize(e){return new ze(e,ze.DEFAULT_COLLECTION_PERCENTILE,ze.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}ze.DEFAULT_COLLECTION_PERCENTILE=10,ze.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ze.DEFAULT=new ze(ep,ze.DEFAULT_COLLECTION_PERCENTILE,ze.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ze.DISABLED=new ze(-1,0,0);class $r{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new $r(0)}static cr(){return new $r(-1)}}const gh="LruGarbageCollector",NE=1048576;function _h([n,e],[t,r]){const s=Q(n,t);return s===0?Q(e,r):s}class DE{constructor(e){this.Ir=e,this.buffer=new we(_h),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();_h(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class VE{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){L(gh,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Zr(t)?L(gh,"Ignoring IndexedDB error during garbage collection: ",t):await Yr(t)}await this.Vr(3e5)}))}}class OE{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return N.resolve(Eo.ce);const r=new DE(t);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(L("LruGarbageCollector","Garbage collection skipped; disabled"),N.resolve(mh)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(L("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),mh):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,a,c,l,h;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(L("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),s=this.params.maximumSequenceNumbersToCollect):s=g,a=Date.now(),this.nthSequenceNumber(e,s)))).next((g=>(r=g,c=Date.now(),this.removeTargets(e,r,t)))).next((g=>(i=g,l=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(h=Date.now(),pr()<=K.DEBUG&&L("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-d}ms
	Determined least recently used ${s} in `+(c-a)+`ms
	Removed ${i} targets in `+(l-c)+`ms
	Removed ${g} documents in `+(h-l)+`ms
Total Duration: ${h-d}ms`),N.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:g}))))}}function ME(n,e){return new OE(n,e)}class LE{constructor(){this.changes=new sr((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,xe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?N.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class xE{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class FE{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&Ns(r.mutation,s,Ye.empty(),ue.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,X()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=X()){const s=Fn();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((i=>{let a=Is();return i.forEach(((c,l)=>{a=a.insert(c,l.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=Fn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,X())))}populateOverlays(e,t,r){const s=[];return r.forEach((i=>{t.has(i)||s.push(i)})),this.documentOverlayCache.getOverlays(e,s).next((i=>{i.forEach(((a,c)=>{t.set(a,c)}))}))}computeViews(e,t,r,s){let i=Gt();const a=ks(),c=(function(){return ks()})();return t.forEach(((l,h)=>{const d=r.get(h.key);s.has(h.key)&&(d===void 0||d.mutation instanceof Cn)?i=i.insert(h.key,h):d!==void 0?(a.set(h.key,d.mutation.getFieldMask()),Ns(d.mutation,h,d.mutation.getFieldMask(),ue.now())):a.set(h.key,Ye.empty())})),this.recalculateAndSaveOverlays(e,i).next((l=>(l.forEach(((h,d)=>a.set(h,d))),t.forEach(((h,d)=>c.set(h,new xE(d,a.get(h)??null)))),c)))}recalculateAndSaveOverlays(e,t){const r=ks();let s=new fe(((a,c)=>a-c)),i=X();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const c of a)c.keys().forEach((l=>{const h=t.get(l);if(h===null)return;let d=r.get(l)||Ye.empty();d=c.applyToLocalView(h,d),r.set(l,d);const g=(s.get(c.batchId)||X()).add(l);s=s.insert(c.batchId,g)}))})).next((()=>{const a=[],c=s.getReverseIterator();for(;c.hasNext();){const l=c.getNext(),h=l.key,d=l.value,g=Ld();d.forEach((m=>{if(!i.has(m)){const E=jd(t.get(m),r.get(m));E!==null&&g.set(m,E),i=i.add(m)}})),a.push(this.documentOverlayCache.saveOverlays(e,h,g))}return N.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return(function(a){return B.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Bv(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):N.resolve(Fn());let c=xs,l=i;return a.next((h=>N.forEach(h,((d,g)=>(c<g.largestBatchId&&(c=g.largestBatchId),i.get(d)?N.resolve():this.remoteDocumentCache.getEntry(e,d).next((m=>{l=l.insert(d,m)}))))).next((()=>this.populateOverlays(e,h,i))).next((()=>this.computeViews(e,l,h,X()))).next((d=>({batchId:c,changes:Md(d)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new B(t)).next((r=>{let s=Is();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let a=Is();return this.indexManager.getCollectionParents(e,i).next((c=>N.forEach(c,(l=>{const h=(function(g,m){return new wo(m,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,h,r,s).next((d=>{d.forEach(((g,m)=>{a=a.insert(g,m)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s)))).next((a=>{i.forEach(((l,h)=>{const d=h.getKey();a.get(d)===null&&(a=a.insert(d,xe.newInvalidDocument(d)))}));let c=Is();return a.forEach(((l,h)=>{const d=i.get(l);d!==void 0&&Ns(d.mutation,h,Ye.empty(),ue.now()),bo(t,h)&&(c=c.insert(l,h))})),c}))}}class UE{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return N.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:bt(s.createTime)}})(t)),N.resolve()}getNamedQuery(e,t){return N.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:PE(s.bundledQuery),readTime:bt(s.readTime)}})(t)),N.resolve()}}class BE{constructor(){this.overlays=new fe(B.comparator),this.qr=new Map}getOverlay(e,t){return N.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Fn();return N.forEach(t,(s=>this.getOverlay(e,s).next((i=>{i!==null&&r.set(s,i)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,i)=>{this.St(e,t,i)})),N.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((i=>this.overlays=this.overlays.remove(i))),this.qr.delete(r)),N.resolve()}getOverlaysForCollection(e,t,r){const s=Fn(),i=t.length+1,a=new B(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){const l=c.getNext().value,h=l.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return N.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new fe(((h,d)=>h-d));const a=this.overlays.getIterator();for(;a.hasNext();){const h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let d=i.get(h.largestBatchId);d===null&&(d=Fn(),i=i.insert(h.largestBatchId,d)),d.set(h.getKey(),h)}}const c=Fn(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((h,d)=>c.set(h,d))),!(c.size()>=s)););return N.resolve(c)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new sE(t,r));let i=this.qr.get(t);i===void 0&&(i=X(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}class $E{constructor(){this.sessionToken=ke.EMPTY_BYTE_STRING}getSessionToken(e){return N.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,N.resolve()}}class Bc{constructor(){this.Qr=new we(be.$r),this.Ur=new we(be.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new be(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new be(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new B(new ce([])),r=new be(t,e),s=new be(t,e+1),i=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),i.push(a.key)})),i}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new B(new ce([])),r=new be(t,e),s=new be(t,e+1);let i=X();return this.Ur.forEachInRange([r,s],(a=>{i=i.add(a.key)})),i}containsKey(e){const t=new be(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class be{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return B.comparator(e.key,t.key)||Q(e.Yr,t.Yr)}static Kr(e,t){return Q(e.Yr,t.Yr)||B.comparator(e.key,t.key)}}class jE{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new we(be.$r)}checkEmpty(e){return N.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new rE(i,t,r,s);this.mutationQueue.push(a);for(const c of s)this.Zr=this.Zr.add(new be(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return N.resolve(a)}lookupMutationBatch(e,t){return N.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return N.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return N.resolve(this.mutationQueue.length===0?Cc:this.tr-1)}getAllMutationBatches(e){return N.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new be(t,0),s=new be(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],(a=>{const c=this.Xr(a.Yr);i.push(c)})),N.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new we(Q);return t.forEach((s=>{const i=new be(s,0),a=new be(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,a],(c=>{r=r.add(c.Yr)}))})),N.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;B.isDocumentKey(i)||(i=i.child(""));const a=new be(new B(i),0);let c=new we(Q);return this.Zr.forEachWhile((l=>{const h=l.key.path;return!!r.isPrefixOf(h)&&(h.length===s&&(c=c.add(l.Yr)),!0)}),a),N.resolve(this.ti(c))}ti(e){const t=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){te(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return N.forEach(t.mutations,(s=>{const i=new be(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new be(t,0),s=this.Zr.firstAfterOrEqual(r);return N.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,N.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class qE{constructor(e){this.ri=e,this.docs=(function(){return new fe(B.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return N.resolve(r?r.document.mutableCopy():xe.newInvalidDocument(t))}getEntries(e,t){let r=Gt();return t.forEach((s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():xe.newInvalidDocument(s))})),N.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Gt();const a=t.path,c=new B(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(c);for(;l.hasNext();){const{key:h,value:{document:d}}=l.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||_v(gv(d),r)<=0||(s.has(d.key)||bo(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return N.resolve(i)}getAllFromCollectionGroup(e,t,r,s){$(9500)}ii(e,t){return N.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new zE(this)}getSize(e){return N.resolve(this.size)}}class zE extends LE{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),N.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class HE{constructor(e){this.persistence=e,this.si=new sr((t=>Dc(t)),Vc),this.lastRemoteSnapshotVersion=q.min(),this.highestTargetId=0,this.oi=0,this._i=new Bc,this.targetCount=0,this.ai=$r.ur()}forEachTarget(e,t){return this.si.forEach(((r,s)=>t(s))),N.resolve()}getLastRemoteSnapshotVersion(e){return N.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return N.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),N.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),N.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new $r(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,N.resolve()}updateTargetData(e,t){return this.Pr(t),N.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,N.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach(((a,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),s++)})),N.waitFor(i).next((()=>s))}getTargetCount(e){return N.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return N.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),N.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach((a=>{i.push(s.markPotentiallyOrphaned(e,a))})),N.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),N.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return N.resolve(r)}containsKey(e,t){return N.resolve(this._i.containsKey(t))}}class tp{constructor(e,t){this.ui={},this.overlays={},this.ci=new Eo(0),this.li=!1,this.li=!0,this.hi=new $E,this.referenceDelegate=e(this),this.Pi=new HE(this),this.indexManager=new CE,this.remoteDocumentCache=(function(s){return new qE(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new RE(t),this.Ii=new UE(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new BE,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new jE(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){L("MemoryPersistence","Starting transaction:",e);const s=new WE(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((i=>this.referenceDelegate.di(s).next((()=>i)))).toPromise().then((i=>(s.raiseOnCommittedEvent(),i)))}Ai(e,t){return N.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class WE extends vv{constructor(e){super(),this.currentSequenceNumber=e}}class $c{constructor(e){this.persistence=e,this.Ri=new Bc,this.Vi=null}static mi(e){return new $c(e)}get fi(){if(this.Vi)return this.Vi;throw $(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),N.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),N.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),N.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((i=>this.fi.add(i.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return N.forEach(this.fi,(r=>{const s=B.fromPath(r);return this.gi(e,s).next((i=>{i||t.removeEntry(s,q.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return N.or([()=>N.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Gi{constructor(e,t){this.persistence=e,this.pi=new sr((r=>Iv(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=ME(this,t)}static mi(e,t){return new Gi(e,t)}Ei(){}di(e){return N.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return N.forEach(this.pi,((r,s)=>this.br(e,r,s).next((i=>i?N.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,(a=>this.br(e,a,t).next((c=>{c||(r++,i.removeEntry(a,q.min()))})))).next((()=>i.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),N.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),N.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),N.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),N.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=bi(e.data.value)),t}br(e,t,r){return N.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return N.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class jc{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=X(),s=X();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new jc(e,t.fromCache,r,s)}}class GE{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class KE{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return F_()?8:Ev(Ue())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next((a=>{i.result=a})).next((()=>{if(!i.result)return this.ws(e,t,s,r).next((a=>{i.result=a}))})).next((()=>{if(i.result)return;const a=new GE;return this.Ss(e,t,a).next((c=>{if(i.result=c,this.Vs)return this.bs(e,t,a,c.size)}))})).next((()=>i.result))}bs(e,t,r,s){return r.documentReadCount<this.fs?(pr()<=K.DEBUG&&L("QueryEngine","SDK will not create cache indexes for query:",mr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),N.resolve()):(pr()<=K.DEBUG&&L("QueryEngine","Query:",mr(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(pr()<=K.DEBUG&&L("QueryEngine","The SDK decides to create cache indexes for query:",mr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,At(t))):N.resolve())}ys(e,t){if(ih(t))return N.resolve(null);let r=At(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=Ha(t,null,"F"),r=At(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((i=>{const a=X(...i);return this.ps.getDocuments(e,a).next((c=>this.indexManager.getMinOffset(e,r).next((l=>{const h=this.Ds(t,c);return this.Cs(t,h,a,l.readTime)?this.ys(e,Ha(t,null,"F")):this.vs(e,h,t,l)}))))})))))}ws(e,t,r,s){return ih(t)||s.isEqual(q.min())?N.resolve(null):this.ps.getDocuments(e,r).next((i=>{const a=this.Ds(t,i);return this.Cs(t,a,r,s)?N.resolve(null):(pr()<=K.DEBUG&&L("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),mr(t)),this.vs(e,a,t,mv(s,xs)).next((c=>c)))}))}Ds(e,t){let r=new we(Vd(e));return t.forEach(((s,i)=>{bo(e,i)&&(r=r.add(i))})),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return pr()<=K.DEBUG&&L("QueryEngine","Using full collection scan to execute query:",mr(t)),this.ps.getDocumentsMatchingQuery(e,t,Tn.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((i=>(t.forEach((a=>{i=i.insert(a.key,a)})),i)))}}const qc="LocalStore",QE=3e8;class XE{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new fe(Q),this.xs=new sr((i=>Dc(i)),Vc),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new FE(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function JE(n,e,t,r){return new XE(n,e,t,r)}async function np(n,e){const t=H(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((i=>{const a=[],c=[];let l=X();for(const h of s){a.push(h.batchId);for(const d of h.mutations)l=l.add(d.key)}for(const h of i){c.push(h.batchId);for(const d of h.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(r,l).next((h=>({Ls:h,removedBatchIds:a,addedBatchIds:c})))}))}))}function YE(n,e){const t=H(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(c,l,h,d){const g=h.batch,m=g.keys();let E=N.resolve();return m.forEach((S=>{E=E.next((()=>d.getEntry(l,S))).next((C=>{const P=h.docVersions.get(S);te(P!==null,48541),C.version.compareTo(P)<0&&(g.applyToRemoteDocument(C,h),C.isValidDocument()&&(C.setReadTime(h.commitVersion),d.addEntry(C)))}))})),E.next((()=>c.mutationQueue.removeMutationBatch(l,g)))})(t,r,e,i).next((()=>i.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(c){let l=X();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(l=l.add(c.batch.mutations[h].key));return l})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function rp(n){const e=H(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function ZE(n,e){const t=H(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const c=[];e.targetChanges.forEach(((d,g)=>{const m=s.get(g);if(!m)return;c.push(t.Pi.removeMatchingKeys(i,d.removedDocuments,g).next((()=>t.Pi.addMatchingKeys(i,d.addedDocuments,g))));let E=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(g)!==null?E=E.withResumeToken(ke.EMPTY_BYTE_STRING,q.min()).withLastLimboFreeSnapshotVersion(q.min()):d.resumeToken.approximateByteSize()>0&&(E=E.withResumeToken(d.resumeToken,r)),s=s.insert(g,E),(function(C,P,x){return C.resumeToken.approximateByteSize()===0||P.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=QE?!0:x.addedDocuments.size+x.modifiedDocuments.size+x.removedDocuments.size>0})(m,E,d)&&c.push(t.Pi.updateTargetData(i,E))}));let l=Gt(),h=X();if(e.documentUpdates.forEach((d=>{e.resolvedLimboDocuments.has(d)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))})),c.push(eT(i,a,e.documentUpdates).next((d=>{l=d.ks,h=d.qs}))),!r.isEqual(q.min())){const d=t.Pi.getLastRemoteSnapshotVersion(i).next((g=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r)));c.push(d)}return N.waitFor(c).next((()=>a.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,l,h))).next((()=>l))})).then((i=>(t.Ms=s,i)))}function eT(n,e,t){let r=X(),s=X();return t.forEach((i=>r=r.add(i))),e.getEntries(n,r).next((i=>{let a=Gt();return t.forEach(((c,l)=>{const h=i.get(c);l.isFoundDocument()!==h.isFoundDocument()&&(s=s.add(c)),l.isNoDocument()&&l.version.isEqual(q.min())?(e.removeEntry(c,l.readTime),a=a.insert(c,l)):!h.isValidDocument()||l.version.compareTo(h.version)>0||l.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(l),a=a.insert(c,l)):L(qc,"Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",l.version)})),{ks:a,qs:s}}))}function tT(n,e){const t=H(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Cc),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function nT(n,e){const t=H(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.Pi.getTargetData(r,e).next((i=>i?(s=i,N.resolve(s)):t.Pi.allocateTargetId(r).next((a=>(s=new ln(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function Xa(n,e,t){const r=H(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Zr(a))throw a;L(qc,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function yh(n,e,t){const r=H(n);let s=q.min(),i=X();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(l,h,d){const g=H(l),m=g.xs.get(d);return m!==void 0?N.resolve(g.Ms.get(m)):g.Pi.getTargetData(h,d)})(r,a,At(e)).next((c=>{if(c)return s=c.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,c.targetId).next((l=>{i=l}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,e,t?s:q.min(),t?i:X()))).next((c=>(rT(r,jv(e),c),{documents:c,Qs:i})))))}function rT(n,e,t){let r=n.Os.get(e)||q.min();t.forEach(((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)})),n.Os.set(e,r)}class vh{constructor(){this.activeTargetIds=Kv()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class sT{constructor(){this.Mo=new vh,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new vh,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class iT{Oo(e){}shutdown(){}}const Eh="ConnectivityMonitor";class Th{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){L(Eh,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){L(Eh,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Ti=null;function Ja(){return Ti===null?Ti=(function(){return 268435456+Math.round(2147483648*Math.random())})():Ti++,"0x"+Ti.toString(16)}const va="RestConnection",oT={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class aT{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Bi?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const a=Ja(),c=this.zo(e,t.toUriEncodedString());L(va,`Sending RPC '${e}' ${a}:`,c,r);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);const{host:h}=new URL(c),d=Rn(h);return this.Jo(e,c,l,r,d).then((g=>(L(va,`Received RPC '${e}' ${a}: `,g),g)),(g=>{throw xr(va,`RPC '${e}' ${a} failed with error: `,g,"url: ",c,"request:",r),g}))}Ho(e,t,r,s,i,a){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Jr})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,i)=>e[i]=s)),r&&r.headers.forEach(((s,i)=>e[i]=s))}zo(e,t){const r=oT[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class cT{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const De="WebChannelConnection";class uT extends aT{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const a=Ja();return new Promise(((c,l)=>{const h=new ad;h.setWithCredentials(!0),h.listenOnce(cd.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case Ai.NO_ERROR:const g=h.getResponseJson();L(De,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(g)),c(g);break;case Ai.TIMEOUT:L(De,`RPC '${e}' ${a} timed out`),l(new U(D.DEADLINE_EXCEEDED,"Request time out"));break;case Ai.HTTP_ERROR:const m=h.getStatus();if(L(De,`RPC '${e}' ${a} failed with status:`,m,"response text:",h.getResponseText()),m>0){let E=h.getResponseJson();Array.isArray(E)&&(E=E[0]);const S=E?.error;if(S&&S.status&&S.message){const C=(function(x){const V=x.toLowerCase().replace(/_/g,"-");return Object.values(D).indexOf(V)>=0?V:D.UNKNOWN})(S.status);l(new U(C,S.message))}else l(new U(D.UNKNOWN,"Server responded with status "+h.getStatus()))}else l(new U(D.UNAVAILABLE,"Connection failed."));break;default:$(9055,{l_:e,streamId:a,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{L(De,`RPC '${e}' ${a} completed.`)}}));const d=JSON.stringify(s);L(De,`RPC '${e}' ${a} sending request:`,s),h.send(t,"POST",d,r,15)}))}T_(e,t,r){const s=Ja(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=hd(),c=ld(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(l.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=i.join("");L(De,`Creating RPC '${e}' stream ${s}: ${d}`,l);const g=a.createWebChannel(d,l);this.I_(g);let m=!1,E=!1;const S=new cT({Yo:P=>{E?L(De,`Not sending because RPC '${e}' stream ${s} is closed:`,P):(m||(L(De,`Opening RPC '${e}' stream ${s} transport.`),g.open(),m=!0),L(De,`RPC '${e}' stream ${s} sending:`,P),g.send(P))},Zo:()=>g.close()}),C=(P,x,V)=>{P.listen(x,(k=>{try{V(k)}catch(F){setTimeout((()=>{throw F}),0)}}))};return C(g,Ts.EventType.OPEN,(()=>{E||(L(De,`RPC '${e}' stream ${s} transport opened.`),S.o_())})),C(g,Ts.EventType.CLOSE,(()=>{E||(E=!0,L(De,`RPC '${e}' stream ${s} transport closed`),S.a_(),this.E_(g))})),C(g,Ts.EventType.ERROR,(P=>{E||(E=!0,xr(De,`RPC '${e}' stream ${s} transport errored. Name:`,P.name,"Message:",P.message),S.a_(new U(D.UNAVAILABLE,"The operation could not be completed")))})),C(g,Ts.EventType.MESSAGE,(P=>{if(!E){const x=P.data[0];te(!!x,16349);const V=x,k=V?.error||V[0]?.error;if(k){L(De,`RPC '${e}' stream ${s} received error:`,k);const F=k.status;let G=(function(_){const y=_e[_];if(y!==void 0)return zd(y)})(F),J=k.message;G===void 0&&(G=D.INTERNAL,J="Unknown error status: "+F+" with message "+k.message),E=!0,S.a_(new U(G,J)),g.close()}else L(De,`RPC '${e}' stream ${s} received:`,x),S.u_(x)}})),C(c,ud.STAT_EVENT,(P=>{P.stat===Ua.PROXY?L(De,`RPC '${e}' stream ${s} detected buffering proxy`):P.stat===Ua.NOPROXY&&L(De,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{S.__()}),0),S}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function Ea(){return typeof document<"u"?document:null}function Co(n){return new dE(n,!0)}class sp{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&L("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Ih="PersistentStream";class ip{constructor(e,t,r,s,i,a,c,l){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new sp(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===D.RESOURCE_EXHAUSTED?(Wt(t.toString()),Wt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===D.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new U(D.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return L(Ih,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(L(Ih,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class lT extends ip{constructor(e,t,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=gE(this.serializer,e),r=(function(i){if(!("targetChange"in i))return q.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?q.min():a.readTime?bt(a.readTime):q.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=Qa(this.serializer),t.addTarget=(function(i,a){let c;const l=a.target;if(c=za(l)?{documents:vE(i,l)}:{query:EE(i,l).ft},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=Gd(i,a.resumeToken);const h=Wa(i,a.expectedCount);h!==null&&(c.expectedCount=h)}else if(a.snapshotVersion.compareTo(q.min())>0){c.readTime=Wi(i,a.snapshotVersion.toTimestamp());const h=Wa(i,a.expectedCount);h!==null&&(c.expectedCount=h)}return c})(this.serializer,e);const r=IE(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=Qa(this.serializer),t.removeTarget=e,this.q_(t)}}class hT extends ip{constructor(e,t,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return te(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,te(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){te(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=yE(e.writeResults,e.commitTime),r=bt(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=Qa(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>_E(this.serializer,r)))};this.q_(t)}}class fT{}class dT extends fT{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new U(D.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Go(e,Ga(t,r),s,i,a))).catch((i=>{throw i.name==="FirebaseError"?(i.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new U(D.UNKNOWN,i.toString())}))}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,c])=>this.connection.Ho(e,Ga(t,r),s,a,c,i))).catch((a=>{throw a.name==="FirebaseError"?(a.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new U(D.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class pT{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Wt(t),this.aa=!1):L("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Zn="RemoteStore";class mT{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{ir(this)&&(L(Zn,"Restarting streams for network reachability change."),await(async function(l){const h=H(l);h.Ea.add(4),await Ys(h),h.Ra.set("Unknown"),h.Ea.delete(4),await ko(h)})(this))}))})),this.Ra=new pT(r,s)}}async function ko(n){if(ir(n))for(const e of n.da)await e(!0)}async function Ys(n){for(const e of n.da)await e(!1)}function op(n,e){const t=H(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Gc(t)?Wc(t):es(t).O_()&&Hc(t,e))}function zc(n,e){const t=H(n),r=es(t);t.Ia.delete(e),r.O_()&&ap(t,e),t.Ia.size===0&&(r.O_()?r.L_():ir(t)&&t.Ra.set("Unknown"))}function Hc(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(q.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}es(n).Y_(e)}function ap(n,e){n.Va.Ue(e),es(n).Z_(e)}function Wc(n){n.Va=new uE({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),es(n).start(),n.Ra.ua()}function Gc(n){return ir(n)&&!es(n).x_()&&n.Ia.size>0}function ir(n){return H(n).Ea.size===0}function cp(n){n.Va=void 0}async function gT(n){n.Ra.set("Online")}async function _T(n){n.Ia.forEach(((e,t)=>{Hc(n,e)}))}async function yT(n,e){cp(n),Gc(n)?(n.Ra.ha(e),Wc(n)):n.Ra.set("Unknown")}async function vT(n,e,t){if(n.Ra.set("Online"),e instanceof Wd&&e.state===2&&e.cause)try{await(async function(s,i){const a=i.cause;for(const c of i.targetIds)s.Ia.has(c)&&(await s.remoteSyncer.rejectListen(c,a),s.Ia.delete(c),s.Va.removeTarget(c))})(n,e)}catch(r){L(Zn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Ki(n,r)}else if(e instanceof Pi?n.Va.Ze(e):e instanceof Hd?n.Va.st(e):n.Va.tt(e),!t.isEqual(q.min()))try{const r=await rp(n.localStore);t.compareTo(r)>=0&&await(function(i,a){const c=i.Va.Tt(a);return c.targetChanges.forEach(((l,h)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.Ia.get(h);d&&i.Ia.set(h,d.withResumeToken(l.resumeToken,a))}})),c.targetMismatches.forEach(((l,h)=>{const d=i.Ia.get(l);if(!d)return;i.Ia.set(l,d.withResumeToken(ke.EMPTY_BYTE_STRING,d.snapshotVersion)),ap(i,l);const g=new ln(d.target,l,h,d.sequenceNumber);Hc(i,g)})),i.remoteSyncer.applyRemoteEvent(c)})(n,t)}catch(r){L(Zn,"Failed to raise snapshot:",r),await Ki(n,r)}}async function Ki(n,e,t){if(!Zr(e))throw e;n.Ea.add(1),await Ys(n),n.Ra.set("Offline"),t||(t=()=>rp(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{L(Zn,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await ko(n)}))}function up(n,e){return e().catch((t=>Ki(n,t,e)))}async function No(n){const e=H(n),t=bn(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Cc;for(;ET(e);)try{const s=await tT(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,TT(e,s)}catch(s){await Ki(e,s)}lp(e)&&hp(e)}function ET(n){return ir(n)&&n.Ta.length<10}function TT(n,e){n.Ta.push(e);const t=bn(n);t.O_()&&t.X_&&t.ea(e.mutations)}function lp(n){return ir(n)&&!bn(n).x_()&&n.Ta.length>0}function hp(n){bn(n).start()}async function IT(n){bn(n).ra()}async function wT(n){const e=bn(n);for(const t of n.Ta)e.ea(t.mutations)}async function AT(n,e,t){const r=n.Ta.shift(),s=xc.from(r,e,t);await up(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await No(n)}async function bT(n,e){e&&bn(n).X_&&await(async function(r,s){if((function(a){return oE(a)&&a!==D.ABORTED})(s.code)){const i=r.Ta.shift();bn(r).B_(),await up(r,(()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s))),await No(r)}})(n,e),lp(n)&&hp(n)}async function wh(n,e){const t=H(n);t.asyncQueue.verifyOperationInProgress(),L(Zn,"RemoteStore received new credentials");const r=ir(t);t.Ea.add(3),await Ys(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await ko(t)}async function ST(n,e){const t=H(n);e?(t.Ea.delete(2),await ko(t)):e||(t.Ea.add(2),await Ys(t),t.Ra.set("Unknown"))}function es(n){return n.ma||(n.ma=(function(t,r,s){const i=H(t);return i.sa(),new lT(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Xo:gT.bind(null,n),t_:_T.bind(null,n),r_:yT.bind(null,n),H_:vT.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),Gc(n)?Wc(n):n.Ra.set("Unknown")):(await n.ma.stop(),cp(n))}))),n.ma}function bn(n){return n.fa||(n.fa=(function(t,r,s){const i=H(t);return i.sa(),new hT(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:IT.bind(null,n),r_:bT.bind(null,n),ta:wT.bind(null,n),na:AT.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await No(n)):(await n.fa.stop(),n.Ta.length>0&&(L(Zn,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class Kc{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new qn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const a=Date.now()+r,c=new Kc(e,t,a,s,i);return c.start(r),c}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new U(D.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Qc(n,e){if(Wt("AsyncQueue",`${e}: ${n}`),Zr(n))return new U(D.UNAVAILABLE,`${e}: ${n}`);throw n}class Sr{static emptySet(e){return new Sr(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||B.comparator(t.key,r.key):(t,r)=>B.comparator(t.key,r.key),this.keyedMap=Is(),this.sortedSet=new fe(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Sr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Sr;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Ah{constructor(){this.ga=new fe(B.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):$(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class jr{constructor(e,t,r,s,i,a,c,l,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=l,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,s,i){const a=[];return t.forEach((c=>{a.push({type:0,doc:c})})),new jr(e,t,Sr.emptySet(t),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ao(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class RT{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class PT{constructor(){this.queries=bh(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=H(t),i=s.queries;s.queries=bh(),i.forEach(((a,c)=>{for(const l of c.Sa)l.onError(r)}))})(this,new U(D.ABORTED,"Firestore shutting down"))}}function bh(){return new sr((n=>Dd(n)),Ao)}async function CT(n,e){const t=H(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new RT,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const c=Qc(a,`Initialization of query '${mr(e.query)}' failed`);return void e.onError(c)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&Xc(t)}async function kT(n,e){const t=H(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const a=i.Sa.indexOf(e);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function NT(n,e){const t=H(n);let r=!1;for(const s of e){const i=s.query,a=t.queries.get(i);if(a){for(const c of a.Sa)c.Fa(s)&&(r=!0);a.wa=s}}r&&Xc(t)}function DT(n,e,t){const r=H(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function Xc(n){n.Ca.forEach((e=>{e.next()}))}var Ya,Sh;(Sh=Ya||(Ya={})).Ma="default",Sh.Cache="cache";class VT{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new jr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=jr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ya.Cache}}class fp{constructor(e){this.key=e}}class dp{constructor(e){this.key=e}}class OT{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=X(),this.mutatedKeys=X(),this.eu=Vd(e),this.tu=new Sr(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new Ah,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,a=s,c=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,h=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((d,g)=>{const m=s.get(d),E=bo(this.query,g)?g:null,S=!!m&&this.mutatedKeys.has(m.key),C=!!E&&(E.hasLocalMutations||this.mutatedKeys.has(E.key)&&E.hasCommittedMutations);let P=!1;m&&E?m.data.isEqual(E.data)?S!==C&&(r.track({type:3,doc:E}),P=!0):this.su(m,E)||(r.track({type:2,doc:E}),P=!0,(l&&this.eu(E,l)>0||h&&this.eu(E,h)<0)&&(c=!0)):!m&&E?(r.track({type:0,doc:E}),P=!0):m&&!E&&(r.track({type:1,doc:m}),P=!0,(l||h)&&(c=!0)),P&&(E?(a=a.add(E),i=C?i.add(d):i.delete(d)):(a=a.delete(d),i=i.delete(d)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const d=this.query.limitType==="F"?a.last():a.first();a=a.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{tu:a,iu:r,Cs:c,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((d,g)=>(function(E,S){const C=P=>{switch(P){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $(20277,{Rt:P})}};return C(E)-C(S)})(d.type,g.type)||this.eu(d.doc,g.doc))),this.ou(r),s=s??!1;const c=t&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,h=l!==this.Za;return this.Za=l,a.length!==0||h?{snapshot:new jr(this.query,e.tu,i,a,e.mutatedKeys,l===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Ah,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=X(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new dp(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new fp(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=X();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return jr.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Jc="SyncEngine";class MT{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class LT{constructor(e){this.key=e,this.hu=!1}}class xT{constructor(e,t,r,s,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new sr((c=>Dd(c)),Ao),this.Iu=new Map,this.Eu=new Set,this.du=new fe(B.comparator),this.Au=new Map,this.Ru=new Bc,this.Vu={},this.mu=new Map,this.fu=$r.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function FT(n,e,t=!0){const r=vp(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await pp(r,e,t,!0),s}async function UT(n,e){const t=vp(n);await pp(t,e,!0,!1)}async function pp(n,e,t,r){const s=await nT(n.localStore,At(e)),i=s.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let c;return r&&(c=await BT(n,e,i,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&op(n.remoteStore,s),c}async function BT(n,e,t,r,s){n.pu=(g,m,E)=>(async function(C,P,x,V){let k=P.view.ru(x);k.Cs&&(k=await yh(C.localStore,P.query,!1).then((({documents:I})=>P.view.ru(I,k))));const F=V&&V.targetChanges.get(P.targetId),G=V&&V.targetMismatches.get(P.targetId)!=null,J=P.view.applyChanges(k,C.isPrimaryClient,F,G);return Ph(C,P.targetId,J.au),J.snapshot})(n,g,m,E);const i=await yh(n.localStore,e,!0),a=new OT(e,i.Qs),c=a.ru(i.documents),l=Js.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),h=a.applyChanges(c,n.isPrimaryClient,l);Ph(n,t,h.au);const d=new MT(e,t,a);return n.Tu.set(e,d),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot}async function $T(n,e,t){const r=H(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter((a=>!Ao(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Xa(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&zc(r.remoteStore,s.targetId),Za(r,s.targetId)})).catch(Yr)):(Za(r,s.targetId),await Xa(r.localStore,s.targetId,!0))}async function jT(n,e){const t=H(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),zc(t.remoteStore,r.targetId))}async function qT(n,e,t){const r=XT(n);try{const s=await(function(a,c){const l=H(a),h=ue.now(),d=c.reduce(((E,S)=>E.add(S.key)),X());let g,m;return l.persistence.runTransaction("Locally write mutations","readwrite",(E=>{let S=Gt(),C=X();return l.Ns.getEntries(E,d).next((P=>{S=P,S.forEach(((x,V)=>{V.isValidDocument()||(C=C.add(x))}))})).next((()=>l.localDocuments.getOverlayedDocuments(E,S))).next((P=>{g=P;const x=[];for(const V of c){const k=tE(V,g.get(V.key).overlayedDocument);k!=null&&x.push(new Cn(V.key,k,bd(k.value.mapValue),ht.exists(!0)))}return l.mutationQueue.addMutationBatch(E,h,x,c)})).next((P=>{m=P;const x=P.applyToLocalDocumentSet(g,C);return l.documentOverlayCache.saveOverlays(E,P.batchId,x)}))})).then((()=>({batchId:m.batchId,changes:Md(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,c,l){let h=a.Vu[a.currentUser.toKey()];h||(h=new fe(Q)),h=h.insert(c,l),a.Vu[a.currentUser.toKey()]=h})(r,s.batchId,t),await Zs(r,s.changes),await No(r.remoteStore)}catch(s){const i=Qc(s,"Failed to persist write");t.reject(i)}}async function mp(n,e){const t=H(n);try{const r=await ZE(t.localStore,e);e.targetChanges.forEach(((s,i)=>{const a=t.Au.get(i);a&&(te(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?te(a.hu,14607):s.removedDocuments.size>0&&(te(a.hu,42227),a.hu=!1))})),await Zs(t,r,e)}catch(r){await Yr(r)}}function Rh(n,e,t){const r=H(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((i,a)=>{const c=a.view.va(e);c.snapshot&&s.push(c.snapshot)})),(function(a,c){const l=H(a);l.onlineState=c;let h=!1;l.queries.forEach(((d,g)=>{for(const m of g.Sa)m.va(c)&&(h=!0)})),h&&Xc(l)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function zT(n,e,t){const r=H(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let a=new fe(B.comparator);a=a.insert(i,xe.newNoDocument(i,q.min()));const c=X().add(i),l=new Po(q.min(),new Map,new fe(Q),a,c);await mp(r,l),r.du=r.du.remove(i),r.Au.delete(e),Yc(r)}else await Xa(r.localStore,e,!1).then((()=>Za(r,e,t))).catch(Yr)}async function HT(n,e){const t=H(n),r=e.batch.batchId;try{const s=await YE(t.localStore,e);_p(t,r,null),gp(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Zs(t,s)}catch(s){await Yr(s)}}async function WT(n,e,t){const r=H(n);try{const s=await(function(a,c){const l=H(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",(h=>{let d;return l.mutationQueue.lookupMutationBatch(h,c).next((g=>(te(g!==null,37113),d=g.keys(),l.mutationQueue.removeMutationBatch(h,g)))).next((()=>l.mutationQueue.performConsistencyCheck(h))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(h,d,c))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,d))).next((()=>l.localDocuments.getDocuments(h,d)))}))})(r.localStore,e);_p(r,e,t),gp(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Zs(r,s)}catch(s){await Yr(s)}}function gp(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function _p(n,e,t){const r=H(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Za(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||yp(n,r)}))}function yp(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(zc(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Yc(n))}function Ph(n,e,t){for(const r of t)r instanceof fp?(n.Ru.addReference(r.key,e),GT(n,r)):r instanceof dp?(L(Jc,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||yp(n,r.key)):$(19791,{wu:r})}function GT(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(L(Jc,"New document in limbo: "+t),n.Eu.add(r),Yc(n))}function Yc(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new B(ce.fromString(e)),r=n.fu.next();n.Au.set(r,new LT(t)),n.du=n.du.insert(t,r),op(n.remoteStore,new ln(At(Oc(t.path)),r,"TargetPurposeLimboResolution",Eo.ce))}}async function Zs(n,e,t){const r=H(n),s=[],i=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((c,l)=>{a.push(r.pu(l,e,t).then((h=>{if((h||t)&&r.isPrimaryClient){const d=h?!h.fromCache:t?.targetChanges.get(l.targetId)?.current;r.sharedClientState.updateQueryState(l.targetId,d?"current":"not-current")}if(h){s.push(h);const d=jc.As(l.targetId,h);i.push(d)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(l,h){const d=H(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>N.forEach(h,(m=>N.forEach(m.Es,(E=>d.persistence.referenceDelegate.addReference(g,m.targetId,E))).next((()=>N.forEach(m.ds,(E=>d.persistence.referenceDelegate.removeReference(g,m.targetId,E)))))))))}catch(g){if(!Zr(g))throw g;L(qc,"Failed to update sequence numbers: "+g)}for(const g of h){const m=g.targetId;if(!g.fromCache){const E=d.Ms.get(m),S=E.snapshotVersion,C=E.withLastLimboFreeSnapshotVersion(S);d.Ms=d.Ms.insert(m,C)}}})(r.localStore,i))}async function KT(n,e){const t=H(n);if(!t.currentUser.isEqual(e)){L(Jc,"User change. New user:",e.toKey());const r=await np(t.localStore,e);t.currentUser=e,(function(i,a){i.mu.forEach((c=>{c.forEach((l=>{l.reject(new U(D.CANCELLED,a))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Zs(t,r.Ls)}}function QT(n,e){const t=H(n),r=t.Au.get(e);if(r&&r.hu)return X().add(r.key);{let s=X();const i=t.Iu.get(e);if(!i)return s;for(const a of i){const c=t.Tu.get(a);s=s.unionWith(c.view.nu)}return s}}function vp(n){const e=H(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=mp.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=QT.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=zT.bind(null,e),e.Pu.H_=NT.bind(null,e.eventManager),e.Pu.yu=DT.bind(null,e.eventManager),e}function XT(n){const e=H(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=HT.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=WT.bind(null,e),e}class Qi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Co(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return JE(this.persistence,new KE,e.initialUser,this.serializer)}Cu(e){return new tp($c.mi,this.serializer)}Du(e){return new sT}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Qi.provider={build:()=>new Qi};class JT extends Qi{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){te(this.persistence.referenceDelegate instanceof Gi,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new VE(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?ze.withCacheSize(this.cacheSizeBytes):ze.DEFAULT;return new tp((r=>Gi.mi(r,t)),this.serializer)}}class ec{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Rh(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=KT.bind(null,this.syncEngine),await ST(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new PT})()}createDatastore(e){const t=Co(e.databaseInfo.databaseId),r=(function(i){return new uT(i)})(e.databaseInfo);return(function(i,a,c,l){return new dT(i,a,c,l)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,i,a,c){return new mT(r,s,i,a,c)})(this.localStore,this.datastore,e.asyncQueue,(t=>Rh(this.syncEngine,t,0)),(function(){return Th.v()?new Th:new iT})())}createSyncEngine(e,t){return(function(s,i,a,c,l,h,d){const g=new xT(s,i,a,c,l,h);return d&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=H(t);L(Zn,"RemoteStore shutting down."),r.Ea.add(5),await Ys(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}ec.provider={build:()=>new ec};class YT{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Wt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const Sn="FirestoreClient";class ZT{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Oe.UNAUTHENTICATED,this.clientId=Rc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,(async a=>{L(Sn,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(L(Sn,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new qn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Qc(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Ta(n,e){n.asyncQueue.verifyOperationInProgress(),L(Sn,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await np(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function Ch(n,e){n.asyncQueue.verifyOperationInProgress();const t=await eI(n);L(Sn,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>wh(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>wh(e.remoteStore,s))),n._onlineComponents=e}async function eI(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){L(Sn,"Using user provided OfflineComponentProvider");try{await Ta(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===D.FAILED_PRECONDITION||s.code===D.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;xr("Error using user provided cache. Falling back to memory cache: "+t),await Ta(n,new Qi)}}else L(Sn,"Using default OfflineComponentProvider"),await Ta(n,new JT(void 0));return n._offlineComponents}async function Ep(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(L(Sn,"Using user provided OnlineComponentProvider"),await Ch(n,n._uninitializedComponentsProvider._online)):(L(Sn,"Using default OnlineComponentProvider"),await Ch(n,new ec))),n._onlineComponents}function tI(n){return Ep(n).then((e=>e.syncEngine))}async function kh(n){const e=await Ep(n),t=e.eventManager;return t.onListen=FT.bind(null,e.syncEngine),t.onUnlisten=$T.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=UT.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=jT.bind(null,e.syncEngine),t}function Tp(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const Nh=new Map;const Ip="firestore.googleapis.com",Dh=!0;class Vh{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new U(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Ip,this.ssl=Dh}else this.host=e.host,this.ssl=e.ssl??Dh;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=ep;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<NE)throw new U(D.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}pv("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Tp(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new U(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new U(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new U(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Do{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Vh({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new U(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new U(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Vh(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new sv;switch(r.type){case"firstParty":return new cv(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new U(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=Nh.get(t);r&&(L("ComponentProvider","Removing Datastore"),Nh.delete(t),r.terminate())})(this),Promise.resolve()}}function nI(n,e,t,r={}){n=_n(n,Do);const s=Rn(e),i=n._getSettings(),a={...i,emulatorOptions:n._getEmulatorOptions()},c=`${e}:${t}`;s&&(Tc(`https://${c}`),Ic("Firestore",!0)),i.host!==Ip&&i.host!==c&&xr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:c,ssl:s,emulatorOptions:r};if(!Xn(l,a)&&(n._setSettings(l),r.mockUserToken)){let h,d;if(typeof r.mockUserToken=="string")h=r.mockUserToken,d=Oe.MOCK_USER;else{h=C_(r.mockUserToken,n._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new U(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Oe(g)}n._authCredentials=new iv(new dd(h,d))}}class Vo{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Vo(this.firestore,e,this._query)}}class Ie{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ie(this.firestore,e,this._key)}toJSON(){return{type:Ie._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Qs(t,Ie._jsonSchema))return new Ie(e,r||null,new B(ce.fromString(t.referencePath)))}}Ie._jsonSchemaVersion="firestore/documentReference/1.0",Ie._jsonSchema={type:ye("string",Ie._jsonSchemaVersion),referencePath:ye("string")};class yn extends Vo{constructor(e,t,r){super(e,t,Oc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ie(this.firestore,null,new B(e))}withConverter(e){return new yn(this.firestore,e,this._path)}}function wp(n,e,...t){if(n=ve(n),pd("collection","path",e),n instanceof Do){const r=ce.fromString(e,...t);return Wl(r),new yn(n,null,r)}{if(!(n instanceof Ie||n instanceof yn))throw new U(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ce.fromString(e,...t));return Wl(r),new yn(n.firestore,null,r)}}function Zc(n,e,...t){if(n=ve(n),arguments.length===1&&(e=Rc.newId()),pd("doc","path",e),n instanceof Do){const r=ce.fromString(e,...t);return Hl(r),new Ie(n,null,new B(r))}{if(!(n instanceof Ie||n instanceof yn))throw new U(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ce.fromString(e,...t));return Hl(r),new Ie(n.firestore,n instanceof yn?n.converter:null,new B(r))}}const Oh="AsyncQueue";class Mh{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new sp(this,"async_queue_retry"),this._c=()=>{const r=Ea();r&&L(Oh,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Ea();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Ea();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new qn;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Zr(e))throw e;L(Oh,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Wt("INTERNAL UNHANDLED ERROR: ",Lh(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=Kc.createAndSchedule(this,e,t,r,(i=>this.hc(i)));return this.tc.push(s),s}uc(){this.nc&&$(47125,{Pc:Lh(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Lh(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function xh(n){return(function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1})(n,["next","error","complete"])}class qr extends Do{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Mh,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Mh(e),this._firestoreClient=void 0,await e}}}function rI(n,e){const t=typeof n=="object"?n:bc(),r=typeof n=="string"?n:Bi,s=vo(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=Yf("firestore");i&&nI(s,...i)}return s}function Ap(n){if(n._terminated)throw new U(D.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||sI(n),n._firestoreClient}function sI(n){const e=n._freezeSettings(),t=(function(s,i,a,c){return new bv(s,i,a,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,Tp(c.experimentalLongPollingOptions),c.useFetchStreams,c.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new ZT(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}})(n._componentsProvider))}class ot{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ot(ke.fromBase64String(e))}catch(t){throw new U(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ot(ke.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:ot._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Qs(e,ot._jsonSchema))return ot.fromBase64String(e.bytes)}}ot._jsonSchemaVersion="firestore/bytes/1.0",ot._jsonSchema={type:ye("string",ot._jsonSchemaVersion),bytes:ye("string")};class Oo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new U(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Re(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class eu{constructor(e){this._methodName=e}}class St{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new U(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new U(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Q(this._lat,e._lat)||Q(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:St._jsonSchemaVersion}}static fromJSON(e){if(Qs(e,St._jsonSchema))return new St(e.latitude,e.longitude)}}St._jsonSchemaVersion="firestore/geoPoint/1.0",St._jsonSchema={type:ye("string",St._jsonSchemaVersion),latitude:ye("number"),longitude:ye("number")};class Rt{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Rt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Qs(e,Rt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Rt(e.vectorValues);throw new U(D.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Rt._jsonSchemaVersion="firestore/vectorValue/1.0",Rt._jsonSchema={type:ye("string",Rt._jsonSchemaVersion),vectorValues:ye("object")};const iI=/^__.*__$/;class oI{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Cn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Xs(e,this.data,t,this.fieldTransforms)}}class bp{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Cn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Sp(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $(40011,{Ac:n})}}class tu{constructor(e,t,r,s,i,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new tu({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Xi(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(Sp(this.Ac)&&iI.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class aI{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Co(e)}Cc(e,t,r,s=!1){return new tu({Ac:e,methodName:t,Dc:r,path:Re.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Rp(n){const e=n._freezeSettings(),t=Co(n._databaseId);return new aI(n._databaseId,!!e.ignoreUndefinedProperties,t)}function cI(n,e,t,r,s,i={}){const a=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);nu("Data must be an object, but it was:",a,r);const c=Pp(r,a);let l,h;if(i.merge)l=new Ye(a.fieldMask),h=a.fieldTransforms;else if(i.mergeFields){const d=[];for(const g of i.mergeFields){const m=tc(e,g,t);if(!a.contains(m))throw new U(D.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);kp(d,m)||d.push(m)}l=new Ye(d),h=a.fieldTransforms.filter((g=>l.covers(g.field)))}else l=null,h=a.fieldTransforms;return new oI(new He(c),l,h)}class Mo extends eu{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Mo}}function uI(n,e,t,r){const s=n.Cc(1,e,t);nu("Data must be an object, but it was:",s,r);const i=[],a=He.empty();Pn(r,((l,h)=>{const d=ru(e,l,t);h=ve(h);const g=s.yc(d);if(h instanceof Mo)i.push(d);else{const m=Lo(h,g);m!=null&&(i.push(d),a.set(d,m))}}));const c=new Ye(i);return new bp(a,c,s.fieldTransforms)}function lI(n,e,t,r,s,i){const a=n.Cc(1,e,t),c=[tc(e,r,t)],l=[s];if(i.length%2!=0)throw new U(D.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)c.push(tc(e,i[m])),l.push(i[m+1]);const h=[],d=He.empty();for(let m=c.length-1;m>=0;--m)if(!kp(h,c[m])){const E=c[m];let S=l[m];S=ve(S);const C=a.yc(E);if(S instanceof Mo)h.push(E);else{const P=Lo(S,C);P!=null&&(h.push(E),d.set(E,P))}}const g=new Ye(h);return new bp(d,g,a.fieldTransforms)}function Lo(n,e){if(Cp(n=ve(n)))return nu("Unsupported field value:",e,n),Pp(n,e);if(n instanceof eu)return(function(r,s){if(!Sp(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const i=[];let a=0;for(const c of r){let l=Lo(c,s.wc(a));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),a++}return{arrayValue:{values:i}}})(n,e)}return(function(r,s){if((r=ve(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Qv(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=ue.fromDate(r);return{timestampValue:Wi(s.serializer,i)}}if(r instanceof ue){const i=new ue(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Wi(s.serializer,i)}}if(r instanceof St)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ot)return{bytesValue:Gd(s.serializer,r._byteString)};if(r instanceof Ie){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Uc(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Rt)return(function(a,c){return{mapValue:{fields:{[wd]:{stringValue:Ad},[$i]:{arrayValue:{values:a.toArray().map((h=>{if(typeof h!="number")throw c.Sc("VectorValues must only contain numeric values.");return Mc(c.serializer,h)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${Pc(r)}`)})(n,e)}function Pp(n,e){const t={};return _d(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Pn(n,((r,s)=>{const i=Lo(s,e.mc(r));i!=null&&(t[r]=i)})),{mapValue:{fields:t}}}function Cp(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ue||n instanceof St||n instanceof ot||n instanceof Ie||n instanceof eu||n instanceof Rt)}function nu(n,e,t){if(!Cp(t)||!md(t)){const r=Pc(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function tc(n,e,t){if((e=ve(e))instanceof Oo)return e._internalPath;if(typeof e=="string")return ru(n,e);throw Xi("Field path arguments must be of type string or ",n,!1,void 0,t)}const hI=new RegExp("[~\\*/\\[\\]]");function ru(n,e,t){if(e.search(hI)>=0)throw Xi(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Oo(...e.split("."))._internalPath}catch{throw Xi(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Xi(n,e,t,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${r}`),a&&(l+=` in document ${s}`),l+=")"),new U(D.INVALID_ARGUMENT,c+n+l)}function kp(n,e){return n.some((t=>t.isEqual(e)))}class Np{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ie(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new fI(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Dp("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class fI extends Np{data(){return super.data()}}function Dp(n,e){return typeof e=="string"?ru(n,e):e instanceof Oo?e._internalPath:e._delegate._internalPath}function dI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new U(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class pI{convertValue(e,t="none"){switch(An(e)){case 0:return null;case 1:return e.booleanValue;case 2:return me(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(wn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw $(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Pn(e,((s,i)=>{r[s]=this.convertValue(i,t)})),r}convertVectorValue(e){const t=e.fields?.[$i].arrayValue?.values?.map((r=>me(r.doubleValue)));return new Rt(t)}convertGeoPoint(e){return new St(me(e.latitude),me(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Io(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Fs(e));default:return null}}convertTimestamp(e){const t=In(e);return new ue(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ce.fromString(e);te(Zd(r),9688,{name:e});const s=new Us(r.get(1),r.get(3)),i=new B(r.popFirst(5));return s.isEqual(t)||Wt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function mI(n,e,t){let r;return r=n?n.toFirestore(e):e,r}class As{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class zn extends Np{constructor(e,t,r,s,i,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ci(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Dp("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new U(D.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=zn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}zn._jsonSchemaVersion="firestore/documentSnapshot/1.0",zn._jsonSchema={type:ye("string",zn._jsonSchemaVersion),bundleSource:ye("string","DocumentSnapshot"),bundleName:ye("string"),bundle:ye("string")};class Ci extends zn{data(e={}){return super.data(e)}}class Rr{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new As(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new Ci(this._firestore,this._userDataWriter,r.key,r,new As(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new U(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((c=>{const l=new Ci(s._firestore,s._userDataWriter,c.doc.key,c.doc,new As(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);return c.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((c=>i||c.type!==3)).map((c=>{const l=new Ci(s._firestore,s._userDataWriter,c.doc.key,c.doc,new As(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);let h=-1,d=-1;return c.type!==0&&(h=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),d=a.indexOf(c.doc.key)),{type:gI(c.type),doc:l,oldIndex:h,newIndex:d}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new U(D.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Rr._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Rc.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function gI(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $(61501,{type:n})}}Rr._jsonSchemaVersion="firestore/querySnapshot/1.0",Rr._jsonSchema={type:ye("string",Rr._jsonSchemaVersion),bundleSource:ye("string","QuerySnapshot"),bundleName:ye("string"),bundle:ye("string")};class Vp extends pI{constructor(e){super(),this.firestore=e}convertBytes(e){return new ot(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ie(this.firestore,null,t)}}function _I(n,e,t,...r){n=_n(n,Ie);const s=_n(n.firestore,qr),i=Rp(s);let a;return a=typeof(e=ve(e))=="string"||e instanceof Oo?lI(i,"updateDoc",n._key,e,t,r):uI(i,"updateDoc",n._key,e),su(s,[a.toMutation(n._key,ht.exists(!0))])}function yI(n){return su(_n(n.firestore,qr),[new Lc(n._key,ht.none())])}function vI(n,e){const t=_n(n.firestore,qr),r=Zc(n),s=mI(n.converter,e);return su(t,[cI(Rp(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,ht.exists(!1))]).then((()=>r))}function EI(n,...e){n=ve(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||xh(e[r])||(t=e[r++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(xh(e[r])){const l=e[r];e[r]=l.next?.bind(l),e[r+1]=l.error?.bind(l),e[r+2]=l.complete?.bind(l)}let i,a,c;if(n instanceof Ie)a=_n(n.firestore,qr),c=Oc(n._key.path),i={next:l=>{e[r]&&e[r](TI(a,n,l))},error:e[r+1],complete:e[r+2]};else{const l=_n(n,Vo);a=_n(l.firestore,qr),c=l._query;const h=new Vp(a);i={next:d=>{e[r]&&e[r](new Rr(a,h,l,d))},error:e[r+1],complete:e[r+2]},dI(n._query)}return(function(h,d,g,m){const E=new YT(m),S=new VT(d,E,g);return h.asyncQueue.enqueueAndForget((async()=>CT(await kh(h),S))),()=>{E.Nu(),h.asyncQueue.enqueueAndForget((async()=>kT(await kh(h),S)))}})(Ap(a),c,s,i)}function su(n,e){return(function(r,s){const i=new qn;return r.asyncQueue.enqueueAndForget((async()=>qT(await tI(r),s,i))),i.promise})(Ap(n),e)}function TI(n,e,t){const r=t.docs.get(e._key),s=new Vp(n);return new zn(n,s,e._key,r,new As(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(s){Jr=s})(Xr),Jn(new En("firestore",((r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),c=new qr(new ov(r.getProvider("auth-internal")),new uv(a,r.getProvider("app-check-internal")),(function(h,d){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new U(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Us(h.options.projectId,d)})(a,s),a);return i={useFetchStreams:t,...i},c._setSettings(i),c}),"PUBLIC").setMultipleInstances(!0)),wt($l,jl,e),wt($l,jl,"esm2020")})();function Op(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const II=Op,Mp=new Gs("auth","Firebase",Op());const Ji=new wc("@firebase/auth");function wI(n,...e){Ji.logLevel<=K.WARN&&Ji.warn(`Auth (${Xr}): ${n}`,...e)}function ki(n,...e){Ji.logLevel<=K.ERROR&&Ji.error(`Auth (${Xr}): ${n}`,...e)}function Ot(n,...e){throw ou(n,...e)}function ft(n,...e){return ou(n,...e)}function iu(n,e,t){const r={...II(),[e]:t};return new Gs("auth","Firebase",r).create(e,{appName:n.name})}function Hn(n){return iu(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function AI(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Ot(n,"argument-error"),iu(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ou(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Mp.create(n,...e)}function j(n,e,...t){if(!n)throw ou(e,...t)}function jt(n){const e="INTERNAL ASSERTION FAILED: "+n;throw ki(e),new Error(e)}function Kt(n,e){n||jt(e)}function nc(){return typeof self<"u"&&self.location?.href||""}function bI(){return Fh()==="http:"||Fh()==="https:"}function Fh(){return typeof self<"u"&&self.location?.protocol||null}function SI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(bI()||M_()||"connection"in navigator)?navigator.onLine:!0}function RI(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class ei{constructor(e,t){this.shortDelay=e,this.longDelay=t,Kt(t>e,"Short delay should be less than long delay!"),this.isMobile=D_()||L_()}get(){return SI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function au(n,e){Kt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Lp{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;jt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;jt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;jt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const PI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const CI=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],kI=new ei(3e4,6e4);function cu(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function ts(n,e,t,r,s={}){return xp(n,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const c=Ks({key:n.config.apiKey,...a}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const h={method:e,headers:l,...i};return O_()||(h.referrerPolicy="no-referrer"),n.emulatorConfig&&Rn(n.emulatorConfig.host)&&(h.credentials="include"),Lp.fetch()(await Fp(n,n.config.apiHost,t,c),h)})}async function xp(n,e,t){n._canInitEmulator=!1;const r={...PI,...e};try{const s=new DI(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Ii(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const c=i.ok?a.errorMessage:a.error.message,[l,h]=c.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ii(n,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw Ii(n,"email-already-in-use",a);if(l==="USER_DISABLED")throw Ii(n,"user-disabled",a);const d=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw iu(n,d,h);Ot(n,d)}}catch(s){if(s instanceof Lt)throw s;Ot(n,"network-request-failed",{message:String(s)})}}async function NI(n,e,t,r,s={}){const i=await ts(n,e,t,r,s);return"mfaPendingCredential"in i&&Ot(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function Fp(n,e,t,r){const s=`${e}${t}?${r}`,i=n,a=i.config.emulator?au(n.config,s):`${n.config.apiScheme}://${s}`;return CI.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(a).toString():a}class DI{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(ft(this.auth,"network-request-failed")),kI.get())})}}function Ii(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=ft(n,e,r);return s.customData._tokenResponse=t,s}async function VI(n,e){return ts(n,"POST","/v1/accounts:delete",e)}async function Yi(n,e){return ts(n,"POST","/v1/accounts:lookup",e)}function Ds(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function OI(n,e=!1){const t=ve(n),r=await t.getIdToken(e),s=uu(r);j(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i?.sign_in_provider;return{claims:s,token:r,authTime:Ds(Ia(s.auth_time)),issuedAtTime:Ds(Ia(s.iat)),expirationTime:Ds(Ia(s.exp)),signInProvider:a||null,signInSecondFactor:i?.sign_in_second_factor||null}}function Ia(n){return Number(n)*1e3}function uu(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return ki("JWT malformed, contained fewer than 3 sections"),null;try{const s=Xf(t);return s?JSON.parse(s):(ki("Failed to decode base64 JWT payload"),null)}catch(s){return ki("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Uh(n){const e=uu(n);return j(e,"internal-error"),j(typeof e.exp<"u","internal-error"),j(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function qs(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Lt&&MI(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function MI({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class LI{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class rc{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ds(this.lastLoginAt),this.creationTime=Ds(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Zi(n){const e=n.auth,t=await n.getIdToken(),r=await qs(n,Yi(e,{idToken:t}));j(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=s.providerUserInfo?.length?Up(s.providerUserInfo):[],a=FI(n.providerData,i),c=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!a?.length,h=c?l:!1,d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new rc(s.createdAt,s.lastLoginAt),isAnonymous:h};Object.assign(n,d)}async function xI(n){const e=ve(n);await Zi(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function FI(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Up(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function UI(n,e){const t=await xp(n,{},async()=>{const r=Ks({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,a=await Fp(n,s,"/v1/token",`key=${i}`),c=await n._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:c,body:r};return n.emulatorConfig&&Rn(n.emulatorConfig.host)&&(l.credentials="include"),Lp.fetch()(a,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function BI(n,e){return ts(n,"POST","/v2/accounts:revokeToken",cu(n,e))}class Pr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){j(e.idToken,"internal-error"),j(typeof e.idToken<"u","internal-error"),j(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Uh(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){j(e.length!==0,"internal-error");const t=Uh(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(j(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await UI(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,a=new Pr;return r&&(j(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(j(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(j(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Pr,this.toJSON())}_performRefresh(){return jt("not implemented")}}function on(n,e){j(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ut{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new LI(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new rc(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await qs(this,this.stsTokenManager.getToken(this.auth,e));return j(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return OI(this,e)}reload(){return xI(this)}_assign(e){this!==e&&(j(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ut({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){j(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Zi(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(it(this.auth.app))return Promise.reject(Hn(this.auth));const e=await this.getIdToken();return await qs(this,VI(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,a=t.photoURL??void 0,c=t.tenantId??void 0,l=t._redirectEventId??void 0,h=t.createdAt??void 0,d=t.lastLoginAt??void 0,{uid:g,emailVerified:m,isAnonymous:E,providerData:S,stsTokenManager:C}=t;j(g&&C,e,"internal-error");const P=Pr.fromJSON(this.name,C);j(typeof g=="string",e,"internal-error"),on(r,e.name),on(s,e.name),j(typeof m=="boolean",e,"internal-error"),j(typeof E=="boolean",e,"internal-error"),on(i,e.name),on(a,e.name),on(c,e.name),on(l,e.name),on(h,e.name),on(d,e.name);const x=new ut({uid:g,auth:e,email:s,emailVerified:m,displayName:r,isAnonymous:E,photoURL:a,phoneNumber:i,tenantId:c,stsTokenManager:P,createdAt:h,lastLoginAt:d});return S&&Array.isArray(S)&&(x.providerData=S.map(V=>({...V}))),l&&(x._redirectEventId=l),x}static async _fromIdTokenResponse(e,t,r=!1){const s=new Pr;s.updateFromServerResponse(t);const i=new ut({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Zi(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];j(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?Up(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!i?.length,c=new Pr;c.updateFromIdToken(r);const l=new ut({uid:s.localId,auth:e,stsTokenManager:c,isAnonymous:a}),h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new rc(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!i?.length};return Object.assign(l,h),l}}const Bh=new Map;function qt(n){Kt(n instanceof Function,"Expected a class definition");let e=Bh.get(n);return e?(Kt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Bh.set(n,e),e)}class Bp{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Bp.type="NONE";const $h=Bp;function Ni(n,e,t){return`firebase:${n}:${e}:${t}`}class Cr{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Ni(this.userKey,s.apiKey,i),this.fullPersistenceKey=Ni("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Yi(this.auth,{idToken:e}).catch(()=>{});return t?ut._fromGetAccountInfoResponse(this.auth,t,e):null}return ut._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Cr(qt($h),e,r);const s=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let i=s[0]||qt($h);const a=Ni(r,e.config.apiKey,e.name);let c=null;for(const h of t)try{const d=await h._get(a);if(d){let g;if(typeof d=="string"){const m=await Yi(e,{idToken:d}).catch(()=>{});if(!m)break;g=await ut._fromGetAccountInfoResponse(e,m,d)}else g=ut._fromJSON(e,d);h!==i&&(c=g),i=h;break}}catch{}const l=s.filter(h=>h._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Cr(i,e,r):(i=l[0],c&&await i._set(a,c.toJSON()),await Promise.all(t.map(async h=>{if(h!==i)try{await h._remove(a)}catch{}})),new Cr(i,e,r))}}function jh(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(zp(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if($p(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Wp(e))return"Blackberry";if(Gp(e))return"Webos";if(jp(e))return"Safari";if((e.includes("chrome/")||qp(e))&&!e.includes("edge/"))return"Chrome";if(Hp(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function $p(n=Ue()){return/firefox\//i.test(n)}function jp(n=Ue()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function qp(n=Ue()){return/crios\//i.test(n)}function zp(n=Ue()){return/iemobile/i.test(n)}function Hp(n=Ue()){return/android/i.test(n)}function Wp(n=Ue()){return/blackberry/i.test(n)}function Gp(n=Ue()){return/webos/i.test(n)}function lu(n=Ue()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function $I(n=Ue()){return lu(n)&&!!window.navigator?.standalone}function jI(){return x_()&&document.documentMode===10}function Kp(n=Ue()){return lu(n)||Hp(n)||Gp(n)||Wp(n)||/windows phone/i.test(n)||zp(n)}function Qp(n,e=[]){let t;switch(n){case"Browser":t=jh(Ue());break;case"Worker":t=`${jh(Ue())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Xr}/${r}`}class qI{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((a,c)=>{try{const l=e(i);a(l)}catch(l){c(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function zI(n,e={}){return ts(n,"GET","/v2/passwordPolicy",cu(n,e))}const HI=6;class WI{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??HI,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class GI{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new qh(this),this.idTokenSubscription=new qh(this),this.beforeStateQueue=new qI(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Mp,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=qt(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Cr.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Yi(this,{idToken:e}),r=await ut._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(it(this.app)){const i=this.app.settings.authIdToken;return i?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(i).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=this.redirectUser?._redirectEventId,a=r?._redirectEventId,c=await this.tryRedirectSignIn(e);(!i||i===a)&&c?.user&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(i){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return j(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Zi(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=RI()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(it(this.app))return Promise.reject(Hn(this));const t=e?ve(e):null;return t&&j(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&j(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return it(this.app)?Promise.reject(Hn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return it(this.app)?Promise.reject(Hn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(qt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await zI(this),t=new WI(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Gs("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await BI(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&qt(e)||this._popupRedirectResolver;j(t,this,"argument-error"),this.redirectPersistenceManager=await Cr.create(this,[qt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(j(c,this,"internal-error"),c.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{a=!0,l()}}else{const l=e.addObserver(t);return()=>{a=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return j(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Qp(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(it(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&wI(`Error while retrieving App Check token: ${e.error}`),e?.token}}function xo(n){return ve(n)}class qh{constructor(e){this.auth=e,this.observer=null,this.addObserver=H_(t=>this.observer=t)}get next(){return j(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let hu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function KI(n){hu=n}function QI(n){return hu.loadJS(n)}function XI(){return hu.gapiScript}function JI(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function YI(n,e){const t=vo(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Xn(i,e??{}))return s;Ot(s,"already-initialized")}return t.initialize({options:e})}function ZI(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(qt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function ew(n,e,t){const r=xo(n);j(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=Xp(e),{host:a,port:c}=tw(e),l=c===null?"":`:${c}`,h={url:`${i}//${a}${l}/`},d=Object.freeze({host:a,port:c,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){j(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),j(Xn(h,r.config.emulator)&&Xn(d,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=h,r.emulatorConfig=d,r.settings.appVerificationDisabledForTesting=!0,Rn(a)?(Tc(`${i}//${a}${l}`),Ic("Auth",!0)):nw()}function Xp(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function tw(n){const e=Xp(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:zh(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:zh(a)}}}function zh(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function nw(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Jp{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return jt("not implemented")}_getIdTokenResponse(e){return jt("not implemented")}_linkToIdToken(e,t){return jt("not implemented")}_getReauthenticationResolver(e){return jt("not implemented")}}async function kr(n,e){return NI(n,"POST","/v1/accounts:signInWithIdp",cu(n,e))}const rw="http://localhost";class er extends Jp{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new er(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ot("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const a=new er(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return kr(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,kr(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,kr(e,t)}buildRequest(){const e={requestUri:rw,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ks(t)}return e}}class fu{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ti extends fu{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class an extends ti{constructor(){super("facebook.com")}static credential(e){return er._fromParams({providerId:an.PROVIDER_ID,signInMethod:an.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return an.credentialFromTaggedObject(e)}static credentialFromError(e){return an.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return an.credential(e.oauthAccessToken)}catch{return null}}}an.FACEBOOK_SIGN_IN_METHOD="facebook.com";an.PROVIDER_ID="facebook.com";class $t extends ti{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return er._fromParams({providerId:$t.PROVIDER_ID,signInMethod:$t.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return $t.credentialFromTaggedObject(e)}static credentialFromError(e){return $t.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return $t.credential(t,r)}catch{return null}}}$t.GOOGLE_SIGN_IN_METHOD="google.com";$t.PROVIDER_ID="google.com";class cn extends ti{constructor(){super("github.com")}static credential(e){return er._fromParams({providerId:cn.PROVIDER_ID,signInMethod:cn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return cn.credentialFromTaggedObject(e)}static credentialFromError(e){return cn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return cn.credential(e.oauthAccessToken)}catch{return null}}}cn.GITHUB_SIGN_IN_METHOD="github.com";cn.PROVIDER_ID="github.com";class un extends ti{constructor(){super("twitter.com")}static credential(e,t){return er._fromParams({providerId:un.PROVIDER_ID,signInMethod:un.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return un.credentialFromTaggedObject(e)}static credentialFromError(e){return un.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return un.credential(t,r)}catch{return null}}}un.TWITTER_SIGN_IN_METHOD="twitter.com";un.PROVIDER_ID="twitter.com";class zr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await ut._fromIdTokenResponse(e,r,s),a=Hh(r);return new zr({user:i,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Hh(r);return new zr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Hh(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class eo extends Lt{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,eo.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new eo(e,t,r,s)}}function Yp(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?eo._fromErrorAndOperation(n,i,e,r):i})}async function sw(n,e,t=!1){const r=await qs(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return zr._forOperation(n,"link",r)}async function iw(n,e,t=!1){const{auth:r}=n;if(it(r.app))return Promise.reject(Hn(r));const s="reauthenticate";try{const i=await qs(n,Yp(r,s,e,n),t);j(i.idToken,r,"internal-error");const a=uu(i.idToken);j(a,r,"internal-error");const{sub:c}=a;return j(n.uid===c,r,"user-mismatch"),zr._forOperation(n,s,i)}catch(i){throw i?.code==="auth/user-not-found"&&Ot(r,"user-mismatch"),i}}async function ow(n,e,t=!1){if(it(n.app))return Promise.reject(Hn(n));const r="signIn",s=await Yp(n,r,e),i=await zr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}function aw(n,e,t,r){return ve(n).onIdTokenChanged(e,t,r)}function cw(n,e,t){return ve(n).beforeAuthStateChanged(e,t)}function uw(n,e,t,r){return ve(n).onAuthStateChanged(e,t,r)}function lw(n){return ve(n).signOut()}const to="__sak";class Zp{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(to,"1"),this.storage.removeItem(to),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const hw=1e3,fw=10;class em extends Zp{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Kp(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,c,l)=>{this.notifyListeners(a,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);jI()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,fw):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},hw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}em.type="LOCAL";const dw=em;class tm extends Zp{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}tm.type="SESSION";const nm=tm;function pw(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Fo{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Fo(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const c=Array.from(a).map(async h=>h(t.origin,i)),l=await pw(c);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Fo.receivers=[];function du(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class mw{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((c,l)=>{const h=du("",20);s.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(g){const m=g;if(m.data.eventId===h)switch(m.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),c(m.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function Pt(){return window}function gw(n){Pt().location.href=n}function rm(){return typeof Pt().WorkerGlobalScope<"u"&&typeof Pt().importScripts=="function"}async function _w(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function yw(){return navigator?.serviceWorker?.controller||null}function vw(){return rm()?self:null}const sm="firebaseLocalStorageDb",Ew=1,no="firebaseLocalStorage",im="fbase_key";class ni{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Uo(n,e){return n.transaction([no],e?"readwrite":"readonly").objectStore(no)}function Tw(){const n=indexedDB.deleteDatabase(sm);return new ni(n).toPromise()}function sc(){const n=indexedDB.open(sm,Ew);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(no,{keyPath:im})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(no)?e(r):(r.close(),await Tw(),e(await sc()))})})}async function Wh(n,e,t){const r=Uo(n,!0).put({[im]:e,value:t});return new ni(r).toPromise()}async function Iw(n,e){const t=Uo(n,!1).get(e),r=await new ni(t).toPromise();return r===void 0?null:r.value}function Gh(n,e){const t=Uo(n,!0).delete(e);return new ni(t).toPromise()}const ww=800,Aw=3;class om{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await sc(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>Aw)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return rm()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Fo._getInstance(vw()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await _w(),!this.activeServiceWorker)return;this.sender=new mw(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||yw()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await sc();return await Wh(e,to,"1"),await Gh(e,to),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Wh(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Iw(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Gh(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Uo(s,!1).getAll();return new ni(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),ww)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}om.type="LOCAL";const bw=om;new ei(3e4,6e4);function am(n,e){return e?qt(e):(j(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class pu extends Jp{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return kr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return kr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return kr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Sw(n){return ow(n.auth,new pu(n),n.bypassAuthState)}function Rw(n){const{auth:e,user:t}=n;return j(t,e,"internal-error"),iw(t,new pu(n),n.bypassAuthState)}async function Pw(n){const{auth:e,user:t}=n;return j(t,e,"internal-error"),sw(t,new pu(n),n.bypassAuthState)}class cm{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:a,type:c}=e;if(a){this.reject(a);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(l))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Sw;case"linkViaPopup":case"linkViaRedirect":return Pw;case"reauthViaPopup":case"reauthViaRedirect":return Rw;default:Ot(this.auth,"internal-error")}}resolve(e){Kt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Kt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Cw=new ei(2e3,1e4);async function kw(n,e,t){if(it(n.app))return Promise.reject(ft(n,"operation-not-supported-in-this-environment"));const r=xo(n);AI(n,e,fu);const s=am(r,t);return new Un(r,"signInViaPopup",e,s).executeNotNull()}class Un extends cm{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Un.currentPopupAction&&Un.currentPopupAction.cancel(),Un.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return j(e,this.auth,"internal-error"),e}async onExecution(){Kt(this.filter.length===1,"Popup operations only handle one event");const e=du();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(ft(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(ft(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Un.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ft(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Cw.get())};e()}}Un.currentPopupAction=null;const Nw="pendingRedirect",Di=new Map;class Dw extends cm{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Di.get(this.auth._key());if(!e){try{const r=await Vw(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Di.set(this.auth._key(),e)}return this.bypassAuthState||Di.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Vw(n,e){const t=Lw(e),r=Mw(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function Ow(n,e){Di.set(n._key(),e)}function Mw(n){return qt(n._redirectPersistence)}function Lw(n){return Ni(Nw,n.config.apiKey,n.name)}async function xw(n,e,t=!1){if(it(n.app))return Promise.reject(Hn(n));const r=xo(n),s=am(r,e),a=await new Dw(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const Fw=600*1e3;class Uw{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Bw(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!um(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(ft(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Fw&&this.cachedEventUids.clear(),this.cachedEventUids.has(Kh(e))}saveEventToCache(e){this.cachedEventUids.add(Kh(e)),this.lastProcessedEventTime=Date.now()}}function Kh(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function um({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function Bw(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return um(n);default:return!1}}async function $w(n,e={}){return ts(n,"GET","/v1/projects",e)}const jw=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,qw=/^https?/;async function zw(n){if(n.config.emulator)return;const{authorizedDomains:e}=await $w(n);for(const t of e)try{if(Hw(t))return}catch{}Ot(n,"unauthorized-domain")}function Hw(n){const e=nc(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!qw.test(t))return!1;if(jw.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const Ww=new ei(3e4,6e4);function Qh(){const n=Pt().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Gw(n){return new Promise((e,t)=>{function r(){Qh(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Qh(),t(ft(n,"network-request-failed"))},timeout:Ww.get()})}if(Pt().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Pt().gapi?.load)r();else{const s=JI("iframefcb");return Pt()[s]=()=>{gapi.load?r():t(ft(n,"network-request-failed"))},QI(`${XI()}?onload=${s}`).catch(i=>t(i))}}).catch(e=>{throw Vi=null,e})}let Vi=null;function Kw(n){return Vi=Vi||Gw(n),Vi}const Qw=new ei(5e3,15e3),Xw="__/auth/iframe",Jw="emulator/auth/iframe",Yw={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Zw=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function eA(n){const e=n.config;j(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?au(e,Jw):`https://${n.config.authDomain}/${Xw}`,r={apiKey:e.apiKey,appName:n.name,v:Xr},s=Zw.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Ks(r).slice(1)}`}async function tA(n){const e=await Kw(n),t=Pt().gapi;return j(t,n,"internal-error"),e.open({where:document.body,url:eA(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Yw,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=ft(n,"network-request-failed"),c=Pt().setTimeout(()=>{i(a)},Qw.get());function l(){Pt().clearTimeout(c),s(r)}r.ping(l).then(l,()=>{i(a)})}))}const nA={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},rA=500,sA=600,iA="_blank",oA="http://localhost";class Xh{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function aA(n,e,t,r=rA,s=sA){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const l={...nA,width:r.toString(),height:s.toString(),top:i,left:a},h=Ue().toLowerCase();t&&(c=qp(h)?iA:t),$p(h)&&(e=e||oA,l.scrollbars="yes");const d=Object.entries(l).reduce((m,[E,S])=>`${m}${E}=${S},`,"");if($I(h)&&c!=="_self")return cA(e||"",c),new Xh(null);const g=window.open(e||"",c,d);j(g,n,"popup-blocked");try{g.focus()}catch{}return new Xh(g)}function cA(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const uA="__/auth/handler",lA="emulator/auth/handler",hA=encodeURIComponent("fac");async function Jh(n,e,t,r,s,i){j(n.config.authDomain,n,"auth-domain-config-required"),j(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Xr,eventId:s};if(e instanceof fu){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",z_(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,g]of Object.entries({}))a[d]=g}if(e instanceof ti){const d=e.getScopes().filter(g=>g!=="");d.length>0&&(a.scopes=d.join(","))}n.tenantId&&(a.tid=n.tenantId);const c=a;for(const d of Object.keys(c))c[d]===void 0&&delete c[d];const l=await n._getAppCheckToken(),h=l?`#${hA}=${encodeURIComponent(l)}`:"";return`${fA(n)}?${Ks(c).slice(1)}${h}`}function fA({config:n}){return n.emulator?au(n,lA):`https://${n.authDomain}/${uA}`}const wa="webStorageSupport";class dA{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=nm,this._completeRedirectFn=xw,this._overrideRedirectResult=Ow}async _openPopup(e,t,r,s){Kt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const i=await Jh(e,t,r,nc(),s);return aA(e,i,du())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Jh(e,t,r,nc(),s);return gw(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Kt(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await tA(e),r=new Uw(e);return t.register("authEvent",s=>(j(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(wa,{type:wa},s=>{const i=s?.[0]?.[wa];i!==void 0&&t(!!i),Ot(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=zw(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Kp()||jp()||lu()}}const pA=dA;var Yh="@firebase/auth",Zh="1.11.1";class mA{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){j(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function gA(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function _A(n){Jn(new En("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=r.options;j(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:a,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Qp(n)},h=new GI(r,s,i,l);return ZI(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Jn(new En("auth-internal",e=>{const t=xo(e.getProvider("auth").getImmediate());return(r=>new mA(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),wt(Yh,Zh,gA(n)),wt(Yh,Zh,"esm2020")}const yA=300,vA=ed("authIdTokenMaxAge")||yA;let ef=null;const EA=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>vA)return;const s=t?.token;ef!==s&&(ef=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function TA(n=bc()){const e=vo(n,"auth");if(e.isInitialized())return e.getImmediate();const t=YI(n,{popupRedirectResolver:pA,persistence:[bw,dw,nm]}),r=ed("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=EA(i.toString());cw(t,a,()=>a(t.currentUser)),aw(t,c=>a(c))}}const s=Jf("auth");return s&&ew(t,`http://${s}`),t}function IA(){return document.getElementsByTagName("head")?.[0]??document}KI({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=ft("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",IA().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});_A("Browser");const wA={apiKey:"AIzaSyBC5VHNEcVL9KP8M0d64ZajF6P4Hzqzafc",authDomain:"bbnme-58716.firebaseapp.com",projectId:"bbnme-58716",storageBucket:"bbnme-58716.appspot.com",messagingSenderId:"155088179379",appId:"1:155088179379:web:5d98445c178b7513f520c6"},mu=rd(wA),ro=rI(mu),gu=TA(mu),AA=new $t,Bo=_o(null),lm=_o(!0);uw(gu,n=>{Bo.set(n),lm.set(!1)});var bA=he('<button class="svelte-18sv61c"> </button>');function _u(n,e){let t=Le(e,"label",8,"Button"),r=Le(e,"onClick",8,()=>{});var s=bA(),i=ne(s);Ct(()=>go(i,t())),Nt("click",s,function(...a){r()?.apply(this,a)}),se(n,s)}var SA=he('<div class="login-container svelte-8ukb9p"><h2 class="svelte-8ukb9p">Please sign in to continue</h2> <!></div>');function RA(n,e){et(e,!1),at();var t=SA(),r=le(ne(t),2);_u(r,{label:"Sign in with Google",onClick:()=>kw(gu,AA)}),se(n,t),tt()}var PA=he('<button class="hamburger-button svelte-p9dp8"><div class="bar svelte-p9dp8"></div> <div class="bar svelte-p9dp8"></div> <div class="bar svelte-p9dp8"></div></button>');function CA(n,e){et(e,!1);const t=Ws();function r(){t("toggle")}at();var s=PA();Nt("click",s,r),se(n,s),tt()}var kA=he('<span class="not-authorized-message svelte-rfuq4y">Unauthorized user</span>'),NA=he(`<nav class="svelte-rfuq4y"><!> <div class="navbar-title svelte-rfuq4y"><h1 class="svelte-rfuq4y">bb'n'me</h1></div> <div class="user-status svelte-rfuq4y"><!></div></nav>`);function DA(n,e){et(e,!1);const t=()=>It(l,"$isAuthorizedToWriteStore",s),r=()=>It(Bo,"$user",s),[s,i]=Qr(),a=pe(),c=Ws(),l=Or("isAuthorizedToWrite");function h(){c("toggle")}vn(()=>t(),()=>{z(a,t())}),nr(),at();var d=NA(),g=ne(d);CA(g,{$$events:{toggle:h}});var m=le(g,4),E=ne(m);{var S=C=>{var P=kA();se(C,P)};lt(E,C=>{r()&&!M(a)&&C(S)})}se(n,d),tt(),i()}var VA=he('<span class="not-authorized-message svelte-12buoxc">Unauthorized user</span>'),OA=he('<div class="user-profile svelte-12buoxc"><img alt="Profile" class="svelte-12buoxc"/> <span class="svelte-12buoxc"> </span> <!></div> <div class="nav-links-wrapper svelte-12buoxc"><div class="nav-links svelte-12buoxc"><a href="/" class="svelte-12buoxc">Home</a></div></div> <div class="sidenav-footer svelte-12buoxc"><!></div>',1),MA=he('<div><button class="close-button svelte-12buoxc">&times;</button> <!></div>');function LA(n,e){et(e,!1);const t=()=>It(h,"$isAuthorizedToWriteStore",s),r=()=>It(Bo,"$user",s),[s,i]=Qr(),a=pe();let c=Le(e,"isOpen",8,!1);const l=Ws(),h=Or("isAuthorizedToWrite");function d(){l("close")}vn(()=>t(),()=>{z(a,t())}),nr(),at();var g=MA();let m;var E=ne(g),S=le(E,2);{var C=P=>{var x=OA(),V=Bn(x),k=ne(V),F=le(k,2),G=ne(F),J=le(F,2);{var I=w=>{var T=VA();se(w,T)};lt(J,w=>{M(a)||w(I)})}var _=le(V,4),y=ne(_);_u(y,{label:"Sign out",onClick:()=>lw(gu)}),Ct(()=>{Ar(k,"src",(r(),Me(()=>r().photoURL))),go(G,(r(),Me(()=>r().displayName)))}),se(P,x)};lt(S,P=>{r()&&P(C)})}Ct(()=>m=Qn(g,1,"sidenav svelte-12buoxc",null,m,{open:c()})),Nt("click",E,d),se(n,g),tt(),i()}var xA=he('<form class="svelte-7mtrh0"><h2 class="svelte-7mtrh0">Add a new place</h2> <input type="text" placeholder="Place name" required class="svelte-7mtrh0"/> <input type="url" placeholder="Website" class="svelte-7mtrh0"/> <input type="url" placeholder="Image URL" class="svelte-7mtrh0"/> <!></form>');function FA(n,e){et(e,!1);let t=pe(""),r=pe(""),s=pe("");async function i(){try{const g=await vI(wp(ro,"places"),{name:M(t),website:M(r),image:M(s)});console.log("Document written with ID: ",g.id),z(t,""),z(r,""),z(s,"")}catch(g){console.error("Error adding document: ",g)}}at();var a=xA(),c=le(ne(a),2),l=le(c,2),h=le(l,2),d=le(h,2);_u(d,{label:"Add Place",type:"submit"}),br(c,()=>M(t),g=>z(t,g)),br(l,()=>M(r),g=>z(r,g)),br(h,()=>M(s),g=>z(s,g)),Nt("submit",a,d_(i)),se(n,a),tt()}var UA=he('<div class="card svelte-1udyrqm"><!></div>');function hm(n,e){var t=UA(),r=ne(t);Ec(r,e,"default",{}),se(n,t)}var BA=he("<button><img/></button>");function Nr(n,e){et(e,!1),Ws();let t=Le(e,"iconSrc",8),r=Le(e,"altText",8,"Icon Button"),s=Le(e,"onClick",8,()=>{}),i=Le(e,"size",8,"md"),a=Le(e,"isSpinning",8,!1),c=Le(e,"isInteractive",8,!0),l=pe();function h(S){c()&&(S.stopPropagation(),s()(S))}vn(()=>yc(i()),()=>{switch(i()){case"sm":z(l,"var(--spacing-lg)");break;case"md":z(l,"33px");break;case"lg":z(l,"var(--spacing-xl)");break;case"xl":z(l,"60px");break;default:z(l,"33px");break}}),nr(),at();var d=BA();let g;var m=ne(d);let E;Ct(()=>{g=Qn(d,1,"icon-button svelte-11linj7",null,g,{interactive:c()}),Ar(m,"src",t()),Ar(m,"alt",r()),c_(m,`width: ${M(l)??""}; height: ${M(l)??""};`),E=Qn(m,1,"svelte-11linj7",null,E,{spinning:a()})}),Nt("click",d,h),se(n,d),tt()}var $A=he("<div><!> <!></div>"),jA=he("<div><!> <!></div>");function qA(n,e){et(e,!1);const t=()=>It(d,"$isAuthorizedToWriteStore",r),[r,s]=Qr(),i=pe();let a=Le(e,"place",8),c=Le(e,"isHovered",8,!1);const l=Ws();let h=pe(!1);const d=Or("isAuthorizedToWrite");function g(F){F.preventDefault(),F.stopPropagation(),z(h,!M(h))}function m(F){F.preventDefault(),l("edit",a()),z(h,!1)}function E(F){F.preventDefault(),l("delete",a().id),z(h,!1)}function S(F){M(h)&&!F.target.closest(".see-more-menu")&&z(h,!1)}vn(()=>t(),()=>{z(i,t())}),vn(()=>(yc(c()),M(h)),()=>{!c()&&M(h)&&z(h,!1)}),nr(),at();var C=jA();Nt("click",Ca,S);let P;var x=ne(C);Nr(x,{iconSrc:"./assets/see_more.png",altText:"See More Options",onClick:g,size:"md",class:"see-more-icon-button"});var V=le(x,2);{var k=F=>{var G=$A();let J;var I=ne(G);Nr(I,{iconSrc:"./assets/edit.png",altText:"Edit",onClick:m,size:"sm"});var _=le(I,2);Nr(_,{iconSrc:"./assets/delete.png",altText:"Delete",onClick:E,size:"sm"}),Ct(()=>J=Qn(G,1,"floating-actions svelte-1222uzl",null,J,{open:M(h)})),se(F,G)};lt(V,F=>{M(i)&&F(k)})}Ct(()=>P=Qn(C,1,"see-more-menu svelte-1222uzl",null,P,{visible:c()})),se(n,C),tt(),s()}var zA=he('<form class="svelte-136zmjt"><div class="header-with-actions svelte-136zmjt"><h2 class="svelte-136zmjt">Edit Place</h2> <div class="actions svelte-136zmjt"><!> <!></div></div> <input type="text" placeholder="Place name" required class="svelte-136zmjt"/> <input type="url" placeholder="Website" class="svelte-136zmjt"/> <input type="url" placeholder="Image URL" class="svelte-136zmjt"/></form>');function HA(n,e){et(e,!1);let t=Le(e,"place",8),r=Le(e,"onSave",8,()=>{}),s=Le(e,"onCancel",8,()=>{}),i=pe(t().name),a=pe(t().website),c=pe(t().image);async function l(V){V.preventDefault();try{const k=Zc(ro,"places",t().id);await _I(k,{name:M(i),website:M(a),image:M(c)}),console.log("Document successfully updated!"),r()()}catch(k){console.error("Error updating document: ",k)}}function h(){s()()}at();var d=zA(),g=ne(d),m=le(ne(g),2),E=ne(m);Nr(E,{iconSrc:"./assets/save.png",altText:"Save",onClick:l,size:"sm"});var S=le(E,2);Nr(S,{iconSrc:"./assets/cancel.png",altText:"Cancel",onClick:h,size:"sm"});var C=le(g,2),P=le(C,2),x=le(P,2);br(C,()=>M(i),V=>z(i,V)),br(P,()=>M(a),V=>z(a,V)),br(x,()=>M(c),V=>z(c,V)),Nt("submit",d,l),se(n,d),tt()}var WA=he('<div class="image-container svelte-13geuu4"><a target="_blank" rel="noreferrer" class="image-wrapper svelte-13geuu4"><img class="svelte-13geuu4"/> <!></a></div>'),GA=he('<div class="place-header svelte-13geuu4"><h3 class="svelte-13geuu4"><b> </b></h3></div> <!>',1),KA=he('<div class="places-list-container svelte-13geuu4"><h2 class="svelte-13geuu4">Travel Wishlist</h2> <div class="places-grid svelte-13geuu4"></div></div>');function QA(n,e){et(e,!1);const t=()=>It(a,"$isAuthorizedToWriteStore",r),[r,s]=Qr(),i=pe(),a=Or("isAuthorizedToWrite");let c=pe([]),l=pe(null),h=pe(null);g_(()=>{const V=EI(wp(ro,"places"),k=>{z(c,k.docs.map(F=>({id:F.id,...F.data()})))});return()=>V()});async function d(V){try{await yI(Zc(ro,"places",V)),console.log("Document successfully deleted!")}catch(k){console.error("Error removing document: ",k)}}function g(V){z(l,V)}function m(){z(l,null)}function E(){z(l,null)}function S(V){z(h,V)}function C(){z(h,null)}vn(()=>t(),()=>{z(i,t())}),nr(),at();var P=KA(),x=le(ne(P),2);zf(x,5,()=>M(c),qf,(V,k)=>{hm(V,{children:(F,G)=>{var J=vc(),I=Bn(J);{var _=w=>{HA(w,{get place(){return M(l)},onSave:m,onCancel:E})},y=w=>{var T=GA(),A=Bn(T),v=ne(A),ge=ne(v),nt=ne(ge),or=le(A,2);{var ar=pt=>{var xt=WA(),rt=ne(xt),Ft=ne(rt),ns=le(Ft,2);{var cr=Ut=>{{let rs=ho(()=>(M(h),M(k),Me(()=>M(h)===M(k).id)));qA(Ut,{get place(){return M(k)},get isHovered(){return M(rs)},$$events:{edit:kn=>g(kn.detail),delete:kn=>d(kn.detail)}})}};lt(ns,Ut=>{M(i)&&Ut(cr)})}Ct(()=>{Ar(rt,"href",(M(k),Me(()=>M(k).website))),Ar(Ft,"src",(M(k),Me(()=>M(k).image))),Ar(Ft,"alt",(M(k),Me(()=>M(k).name)))}),Nt("mouseenter",rt,()=>S(M(k).id)),Nt("mouseleave",rt,C),se(pt,xt)};lt(or,pt=>{M(k),Me(()=>M(k).image)&&pt(ar)})}Ct(()=>go(nt,(M(k),Me(()=>M(k).name)))),se(w,T)};lt(I,w=>{M(l),M(k),Me(()=>M(l)&&M(l).id===M(k).id)?w(_):w(y,!1)})}se(F,J)},$$slots:{default:!0}})}),se(n,P),tt(),s()}var XA=he("<button> </button>"),JA=he('<div class="tabs-container svelte-126ak3w"><div class="tab-headers svelte-126ak3w"></div> <div class="tab-content svelte-126ak3w"><!></div></div>');function YA(n,e){et(e,!1);let t=Le(e,"activeTab",12,1);const r=_o(t());Sa("activeTab",r);let s=[],i=pe([]);function a(m){return s=[...s,m],z(i,[...M(i),m]),s.length-1}Sa("registerTab",a);function c(m){t(m),r.set(t())}at();var l=JA(),h=ne(l);zf(h,5,()=>M(i),qf,(m,E,S)=>{var C=XA();let P;var x=ne(C);Ct(()=>{P=Qn(C,1,"tab-header svelte-126ak3w",null,P,{active:t()===S}),go(x,M(E))}),Nt("click",C,()=>c(S)),se(m,C)});var d=le(h,2),g=ne(d);Ec(g,e,"default",{}),se(n,l),tt()}var ZA=he('<div class="tab-panel svelte-1vjnlah"><!></div>');function tf(n,e){et(e,!1);const t=()=>It(c,"$activeTabStore",r),[r,s]=Qr(),i=pe();let a=Le(e,"title",8);const c=Or("activeTab"),l=Or("registerTab");let h=pe();z(h,l(a())),vn(()=>(t(),M(h)),()=>{z(i,t()===M(h))}),nr(),at();var d=vc(),g=Bn(d);{var m=E=>{var S=ZA(),C=ne(S);Ec(C,e,"default",{}),se(E,S)};lt(g,E=>{M(i)&&E(m)})}se(n,d),tt(),s()}const eb="type.googleapis.com/google.protobuf.Int64Value",tb="type.googleapis.com/google.protobuf.UInt64Value";function fm(n,e){const t={};for(const r in n)n.hasOwnProperty(r)&&(t[r]=e(n[r]));return t}function so(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>so(e));if(typeof n=="function"||typeof n=="object")return fm(n,e=>so(e));throw new Error("Data cannot be encoded in JSON: "+n)}function Hr(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case eb:case tb:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>Hr(e)):typeof n=="function"||typeof n=="object"?fm(n,e=>Hr(e)):n}const yu="functions";const nf={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ge extends Lt{constructor(e,t,r){super(`${yu}/${e}`,t||""),this.details=r,Object.setPrototypeOf(this,Ge.prototype)}}function nb(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function io(n,e){let t=nb(n),r=t,s;try{const i=e&&e.error;if(i){const a=i.status;if(typeof a=="string"){if(!nf[a])return new Ge("internal","internal");t=nf[a],r=a}const c=i.message;typeof c=="string"&&(r=c),s=i.details,s!==void 0&&(s=Hr(s))}}catch{}return t==="ok"?null:new Ge(t,r,s)}class rb{constructor(e,t,r,s){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,it(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||t.get().then(i=>this.auth=i,()=>{}),this.messaging||r.get().then(i=>this.messaging=i,()=>{}),this.appCheck||s?.get().then(i=>this.appCheck=i,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),r=await this.getMessagingToken(),s=await this.getAppCheckToken(e);return{authToken:t,messagingToken:r,appCheckToken:s}}}const ic="us-central1",sb=/^data: (.*?)(?:\n|$)/;function ib(n){let e=null;return{promise:new Promise((t,r)=>{e=setTimeout(()=>{r(new Ge("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class ob{constructor(e,t,r,s,i=ic,a=(...c)=>fetch(...c)){this.app=e,this.fetchImpl=a,this.emulatorOrigin=null,this.contextProvider=new rb(e,t,r,s),this.cancelAllRequests=new Promise(c=>{this.deleteService=()=>Promise.resolve(c())});try{const c=new URL(i);this.customDomain=c.origin+(c.pathname==="/"?"":c.pathname),this.region=ic}catch{this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function ab(n,e,t){const r=Rn(e);n.emulatorOrigin=`http${r?"s":""}://${e}:${t}`,r&&(Tc(n.emulatorOrigin+"/backends"),Ic("Functions",!0))}function cb(n,e,t){const r=s=>lb(n,e,s,{});return r.stream=(s,i)=>fb(n,e,s,i),r}function dm(n){return n.emulatorOrigin&&Rn(n.emulatorOrigin)?"include":void 0}async function ub(n,e,t,r,s){t["Content-Type"]="application/json";let i;try{i=await r(n,{method:"POST",body:JSON.stringify(e),headers:t,credentials:dm(s)})}catch{return{status:0,json:null}}let a=null;try{a=await i.json()}catch{}return{status:i.status,json:a}}async function pm(n,e){const t={},r=await n.contextProvider.getContext(e.limitedUseAppCheckTokens);return r.authToken&&(t.Authorization="Bearer "+r.authToken),r.messagingToken&&(t["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(t["X-Firebase-AppCheck"]=r.appCheckToken),t}function lb(n,e,t,r){const s=n._url(e);return hb(n,s,t,r)}async function hb(n,e,t,r){t=so(t);const s={data:t},i=await pm(n,r),a=r.timeout||7e4,c=ib(a),l=await Promise.race([ub(e,s,i,n.fetchImpl,n),c.promise,n.cancelAllRequests]);if(c.cancel(),!l)throw new Ge("cancelled","Firebase Functions instance was deleted.");const h=io(l.status,l.json);if(h)throw h;if(!l.json)throw new Ge("internal","Response is not valid JSON object.");let d=l.json.data;if(typeof d>"u"&&(d=l.json.result),typeof d>"u")throw new Ge("internal","Response is missing data field.");return{data:Hr(d)}}function fb(n,e,t,r){const s=n._url(e);return db(n,s,t,r||{})}async function db(n,e,t,r){t=so(t);const s={data:t},i=await pm(n,r);i["Content-Type"]="application/json",i.Accept="text/event-stream";let a;try{a=await n.fetchImpl(e,{method:"POST",body:JSON.stringify(s),headers:i,signal:r?.signal,credentials:dm(n)})}catch(m){if(m instanceof Error&&m.name==="AbortError"){const S=new Ge("cancelled","Request was cancelled.");return{data:Promise.reject(S),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(S)}}}}}}const E=io(0,null);return{data:Promise.reject(E),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(E)}}}}}}let c,l;const h=new Promise((m,E)=>{c=m,l=E});r?.signal?.addEventListener("abort",()=>{const m=new Ge("cancelled","Request was cancelled.");l(m)});const d=a.body.getReader(),g=pb(d,c,l,r?.signal);return{stream:{[Symbol.asyncIterator](){const m=g.getReader();return{async next(){const{value:E,done:S}=await m.read();return{value:E,done:S}},async return(){return await m.cancel(),{done:!0,value:void 0}}}}},data:h}}function pb(n,e,t,r){const s=(a,c)=>{const l=a.match(sb);if(!l)return;const h=l[1];try{const d=JSON.parse(h);if("result"in d){e(Hr(d.result));return}if("message"in d){c.enqueue(Hr(d.message));return}if("error"in d){const g=io(0,d);c.error(g),t(g);return}}catch(d){if(d instanceof Ge){c.error(d),t(d);return}}},i=new TextDecoder;return new ReadableStream({start(a){let c="";return l();async function l(){if(r?.aborted){const h=new Ge("cancelled","Request was cancelled");return a.error(h),t(h),Promise.resolve()}try{const{value:h,done:d}=await n.read();if(d){c.trim()&&s(c.trim(),a),a.close();return}if(r?.aborted){const m=new Ge("cancelled","Request was cancelled");a.error(m),t(m),await n.cancel();return}c+=i.decode(h,{stream:!0});const g=c.split(`
`);c=g.pop()||"";for(const m of g)m.trim()&&s(m.trim(),a);return l()}catch(h){const d=h instanceof Ge?h:io(0,null);a.error(d),t(d)}}},cancel(){return n.cancel()}})}const rf="@firebase/functions",sf="0.13.1";const mb="auth-internal",gb="app-check-internal",_b="messaging-internal";function yb(n){const e=(t,{instanceIdentifier:r})=>{const s=t.getProvider("app").getImmediate(),i=t.getProvider(mb),a=t.getProvider(_b),c=t.getProvider(gb);return new ob(s,i,a,c,r)};Jn(new En(yu,e,"PUBLIC").setMultipleInstances(!0)),wt(rf,sf,n),wt(rf,sf,"esm2020")}function vb(n=bc(),e=ic){const r=vo(ve(n),yu).getImmediate({identifier:e}),s=Yf("functions");return s&&Eb(r,...s),r}function Eb(n,e,t){ab(ve(n),e,t)}function Tb(n,e,t){return cb(ve(n),e)}yb();var Ib=he('<div class="loading-screen svelte-1n46o8q"><!></div>'),wb=he("<!> <!>",1),Ab=he('<!> <!> <div class="container svelte-1n46o8q"><!></div>',1),bb=he("<main><!></main>");function Sb(n,e){et(e,!1);const t=()=>It(lm,"$authLoading",i),r=()=>It(Bo,"$user",i),s=()=>It(h,"$isAuthorizedToWriteStore",i),[i,a]=Qr(),c=vb(mu),l=Tb(c,"checkAuthorization"),h=_o(!1);let d=pe(!1),g=pe(!1);Sa("isAuthorizedToWrite",h);async function m(){try{const k=await l();h.set(k.data.status==="authorized")}catch(k){console.error("Error checking authorization:",k),h.set(!1)}finally{z(d,!0)}}function E(){z(g,!M(g))}vn(()=>(t(),r()),()=>{!t()&&r()?m():!t()&&!r()?(h.set(!1),z(d,!0)):(h.set(!1),z(d,!1))}),nr(),at();var S=bb();let C;var P=ne(S);{var x=k=>{var F=Ib(),G=ne(F);Nr(G,{iconSrc:"./assets/spinner.png",altText:"Loading Spinner",size:"xl",isSpinning:!0,isInteractive:!1}),se(k,F)},V=k=>{var F=vc(),G=Bn(F);{var J=_=>{var y=Ab(),w=Bn(y);DA(w,{$$events:{toggle:E}});var T=le(w,2);LA(T,{get isOpen(){return M(g)},$$events:{close:E}});var A=le(T,2),v=ne(A);YA(v,{children:(ge,nt)=>{var or=wb(),ar=Bn(or);{var pt=rt=>{tf(rt,{title:"Add Place",children:(Ft,ns)=>{hm(Ft,{children:(cr,Ut)=>{FA(cr,{})},$$slots:{default:!0}})},$$slots:{default:!0}})};lt(ar,rt=>{M(d)&&s()&&rt(pt)})}var xt=le(ar,2);tf(xt,{title:"Travel Wishlist",children:(rt,Ft)=>{QA(rt,{})},$$slots:{default:!0}}),se(ge,or)},$$slots:{default:!0}}),se(_,y)},I=_=>{RA(_,{})};lt(G,_=>{r()?_(J):_(I,!1)},!0)}se(k,F)};lt(P,k=>{t()||!M(d)?k(x):k(V,!1)})}Ct(()=>C=Qn(S,1,"svelte-1n46o8q",null,C,{"fullscreen-main":t()||!M(d)})),se(n,S),tt(),a()}e_(Sb,{target:document.getElementById("app")});
