(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const nf=!1;var oc=Array.isArray,Hm=Array.prototype.indexOf,ac=Array.from,rf=Object.defineProperty,gr=Object.getOwnPropertyDescriptor,sf=Object.getOwnPropertyDescriptors,Wm=Object.prototype,Gm=Array.prototype,cc=Object.getPrototypeOf,pl=Object.isExtensible;const _r=()=>{};function Km(n){return n()}function Aa(n){for(var e=0;e<n.length;e++)n[e]()}function of(){var n,e,t=new Promise((r,s)=>{n=r,e=s});return{promise:t,resolve:n,reject:e}}const xe=2,uc=4,ro=8,Wt=16,Gt=32,Yn=64,so=128,dt=512,Pe=1024,Xe=2048,Mt=4096,tt=8192,ln=16384,lc=32768,Rr=65536,ml=1<<17,af=1<<18,Br=1<<19,cf=1<<20,Rs=32768,ba=1<<21,hc=1<<22,hn=1<<23,yr=Symbol("$state"),Qm=Symbol("legacy props"),Xm=Symbol(""),pr=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function fc(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Jm(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Ym(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Zm(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function eg(n){throw new Error("https://svelte.dev/e/effect_orphan")}function tg(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function ng(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function rg(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function sg(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function ig(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function og(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const ag=1,cg=2,ug=16,lg=1,hg=2,fg=4,dg=8,pg=16,mg=1,gg=2,Ve=Symbol(),_g="http://www.w3.org/1999/xhtml";function yg(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let vg=!1;function uf(n){return n===this.v}function lf(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function hf(n){return!lf(n,this.v)}let $r=!1,Eg=!1;function Tg(){$r=!0}let ie=null;function Pr(n){ie=n}function Cr(n){return ff().get(n)}function Sa(n,e){return ff().set(n,e),e}function nt(n,e=!1,t){ie={p:ie,i:!1,c:null,e:null,s:n,x:null,l:$r&&!e?{s:null,u:null,$:[]}:null}}function rt(n){var e=ie,t=e.e;if(t!==null){e.e=null;for(var r of t)Rf(r)}return e.i=!0,ie=e.p,{}}function $s(){return!$r||ie!==null&&ie.l===null}function ff(n){return ie===null&&fc(),ie.c??=new Map(Ig(ie)||void 0)}function Ig(n){let e=n.p;for(;e!==null;){const t=e.c;if(t!==null)return t;e=e.p}return null}let On=[];function df(){var n=On;On=[],Aa(n)}function io(n){if(On.length===0&&!vs){var e=On;queueMicrotask(()=>{e===On&&df()})}On.push(n)}function wg(){for(;On.length>0;)df()}function pf(n){var e=ee;if(e===null)return Z.f|=hn,n;if((e.f&lc)===0){if((e.f&so)===0)throw n;e.b.error(n)}else kr(n,e)}function kr(n,e){for(;e!==null;){if((e.f&so)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n}const di=new Set;let ae=null,Ti=null,Ze=null,yt=[],oo=null,Ra=!1,vs=!1;class vt{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#n=0;#r=0;#c=null;#o=[];#a=[];skipped_effects=new Set;is_fork=!1;process(e){yt=[],Ti=null,this.apply();var t={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const r of e)this.#s(r,t);this.is_fork||this.#u(),this.#r>0||this.is_fork?(this.#i(t.effects),this.#i(t.render_effects),this.#i(t.block_effects)):(Ti=this,ae=null,gl(t.render_effects),gl(t.effects),Ti=null,this.#c?.resolve()),Ze=null}#s(e,t){e.f^=Pe;for(var r=e.first;r!==null;){var s=r.f,i=(s&(Gt|Yn))!==0,a=i&&(s&Pe)!==0,c=a||(s&tt)!==0||this.skipped_effects.has(r);if((r.f&so)!==0&&r.b?.is_pending()&&(t={parent:t,effect:r,effects:[],render_effects:[],block_effects:[]}),!c&&r.fn!==null){i?r.f^=Pe:(s&uc)!==0?t.effects.push(r):jr(r)&&((r.f&Wt)!==0&&t.block_effects.push(r),Nr(r));var l=r.first;if(l!==null){r=l;continue}}var h=r.parent;for(r=r.next;r===null&&h!==null;)h===t.effect&&(this.#i(t.effects),this.#i(t.render_effects),this.#i(t.block_effects),t=t.parent),r=h.next,h=h.parent}}#i(e){for(const t of e)((t.f&Xe)!==0?this.#o:this.#a).push(t),Ce(t,Pe)}capture(e,t){this.previous.has(e)||this.previous.set(e,t),(e.f&hn)===0&&(this.current.set(e,e.v),Ze?.set(e,e.v))}activate(){ae=this,this.apply()}deactivate(){ae=null,Ze=null}flush(){if(this.activate(),yt.length>0){if(mf(),ae!==null&&ae!==this)return}else this.#n===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#u(){if(this.#r===0){for(const e of this.#e)e();this.#e.clear()}this.#n===0&&this.#l()}#l(){if(di.size>1){this.previous.clear();var e=Ze,t=!0,r={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const s of di){if(s===this){t=!1;continue}const i=[];for(const[c,l]of this.current){if(s.current.has(c))if(t&&l!==s.current.get(c))s.current.set(c,l);else continue;i.push(c)}if(i.length===0)continue;const a=[...s.current.keys()].filter(c=>!this.current.has(c));if(a.length>0){const c=new Set,l=new Map;for(const h of i)gf(h,a,c,l);if(yt.length>0){ae=s,s.apply();for(const h of yt)s.#s(h,r);yt=[],s.deactivate()}}}ae=null,Ze=e}this.committed=!0,di.delete(this)}increment(e){this.#n+=1,e&&(this.#r+=1)}decrement(e){this.#n-=1,e&&(this.#r-=1),this.revive()}revive(){for(const e of this.#o)Ce(e,Xe),zn(e);for(const e of this.#a)Ce(e,Mt),zn(e);this.#o=[],this.#a=[],this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#c??=of()).promise}static ensure(){if(ae===null){const e=ae=new vt;di.add(ae),vs||vt.enqueue(()=>{ae===e&&e.flush()})}return ae}static enqueue(e){io(e)}apply(){}}function Ag(n){var e=vs;vs=!0;try{for(var t;;){if(wg(),yt.length===0&&(ae?.flush(),yt.length===0))return oo=null,t;mf()}}finally{vs=e}}function mf(){var n=Fn;Ra=!0;try{var e=0;for(yl(!0);yt.length>0;){var t=vt.ensure();if(e++>1e3){var r,s;bg()}t.process(yt),fn.clear()}}finally{Ra=!1,yl(n),oo=null}}function bg(){try{tg()}catch(n){kr(n,oo)}}let xt=null;function gl(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var r=n[t++];if((r.f&(ln|tt))===0&&jr(r)&&(xt=new Set,Nr(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?kf(r):r.fn=null),xt?.size>0)){fn.clear();for(const s of xt){if((s.f&(ln|tt))!==0)continue;const i=[s];let a=s.parent;for(;a!==null;)xt.has(a)&&(xt.delete(a),i.push(a)),a=a.parent;for(let c=i.length-1;c>=0;c--){const l=i[c];(l.f&(ln|tt))===0&&Nr(l)}}xt.clear()}}xt=null}}function gf(n,e,t,r){if(!t.has(n)&&(t.add(n),n.reactions!==null))for(const s of n.reactions){const i=s.f;(i&xe)!==0?gf(s,e,t,r):(i&(hc|Wt))!==0&&(i&Xe)===0&&_f(s,e,r)&&(Ce(s,Xe),zn(s))}}function _f(n,e,t){const r=t.get(n);if(r!==void 0)return r;if(n.deps!==null)for(const s of n.deps){if(e.includes(s))return!0;if((s.f&xe)!==0&&_f(s,e,t))return t.set(s,!0),!0}return t.set(n,!1),!1}function zn(n){for(var e=oo=n;e.parent!==null;){e=e.parent;var t=e.f;if(Ra&&e===ee&&(t&Wt)!==0&&(t&af)===0)return;if((t&(Yn|Gt))!==0){if((t&Pe)===0)return;e.f^=Pe}}yt.push(e)}function Sg(n){let e=0,t=Hn(0),r;return()=>{lo()&&(L(t),ho(()=>(e===0&&(r=Me(()=>n(()=>Es(t)))),e+=1,()=>{io(()=>{e-=1,e===0&&(r?.(),r=void 0,Es(t))})})))}}var Rg=Rr|Br|so;function Pg(n,e,t){new Cg(n,e,t)}class Cg{parent;#e=!1;#t;#n=null;#r;#c;#o;#a=null;#s=null;#i=null;#u=null;#l=null;#d=0;#h=0;#p=!1;#f=null;#v=Sg(()=>(this.#f=Hn(this.#d),()=>{this.#f=null}));constructor(e,t,r){this.#t=e,this.#r=t,this.#c=r,this.parent=ee.b,this.#e=!!this.#r.pending,this.#o=mc(()=>{ee.b=this;{var s=this.#_();try{this.#a=ut(()=>r(s))}catch(i){this.error(i)}this.#h>0?this.#g():this.#e=!1}return()=>{this.#l?.remove()}},Rg)}#E(){try{this.#a=ut(()=>this.#c(this.#t))}catch(e){this.error(e)}this.#e=!1}#T(){const e=this.#r.pending;e&&(this.#s=ut(()=>e(this.#t)),vt.enqueue(()=>{var t=this.#_();this.#a=this.#m(()=>(vt.ensure(),ut(()=>this.#c(t)))),this.#h>0?this.#g():(vr(this.#s,()=>{this.#s=null}),this.#e=!1)}))}#_(){var e=this.#t;return this.#e&&(this.#l=Wn(),this.#t.before(this.#l),e=this.#l),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#r.pending}#m(e){var t=ee,r=Z,s=ie;kt(this.#o),Ge(this.#o),Pr(this.#o.ctx);try{return e()}catch(i){return pf(i),null}finally{kt(t),Ge(r),Pr(s)}}#g(){const e=this.#r.pending;this.#a!==null&&(this.#u=document.createDocumentFragment(),this.#u.append(this.#l),Vf(this.#a,this.#u)),this.#s===null&&(this.#s=ut(()=>e(this.#t)))}#y(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#y(e);return}this.#h+=e,this.#h===0&&(this.#e=!1,this.#s&&vr(this.#s,()=>{this.#s=null}),this.#u&&(this.#t.before(this.#u),this.#u=null))}update_pending_count(e){this.#y(e),this.#d+=e,this.#f&&Ps(this.#f,this.#d)}get_effect_pending(){return this.#v(),L(this.#f)}error(e){var t=this.#r.onerror;let r=this.#r.failed;if(this.#p||!t&&!r)throw e;this.#a&&(je(this.#a),this.#a=null),this.#s&&(je(this.#s),this.#s=null),this.#i&&(je(this.#i),this.#i=null);var s=!1,i=!1;const a=()=>{if(s){yg();return}s=!0,i&&og(),vt.ensure(),this.#d=0,this.#i!==null&&vr(this.#i,()=>{this.#i=null}),this.#e=this.has_pending_snippet(),this.#a=this.#m(()=>(this.#p=!1,ut(()=>this.#c(this.#t)))),this.#h>0?this.#g():this.#e=!1};var c=Z;try{Ge(null),i=!0,t?.(e,a),i=!1}catch(l){kr(l,this.#o&&this.#o.parent)}finally{Ge(c)}r&&io(()=>{this.#i=this.#m(()=>{vt.ensure(),this.#p=!0;try{return ut(()=>{r(this.#t,()=>e,()=>a)})}catch(l){return kr(l,this.#o.parent),null}finally{this.#p=!1}})})}}function kg(n,e,t,r){const s=$s()?ao:co;if(t.length===0&&n.length===0){r(e.map(s));return}var i=ae,a=ee,c=Ng();function l(){Promise.all(t.map(h=>Dg(h))).then(h=>{c();try{r([...e.map(s),...h])}catch(d){(a.f&ln)===0&&kr(d,a)}i?.deactivate(),Di()}).catch(h=>{kr(h,a)})}n.length>0?Promise.all(n).then(()=>{c();try{return l()}finally{i?.deactivate(),Di()}}):l()}function Ng(){var n=ee,e=Z,t=ie,r=ae;return function(i=!0){kt(n),Ge(e),Pr(t),i&&r?.activate()}}function Di(){kt(null),Ge(null),Pr(null)}function ao(n){var e=xe|Xe,t=Z!==null&&(Z.f&xe)!==0?Z:null;return ee!==null&&(ee.f|=Br),{ctx:ie,deps:null,effects:null,equals:uf,f:e,fn:n,reactions:null,rv:0,v:Ve,wv:0,parent:t??ee,ac:null}}function Dg(n,e){let t=ee;t===null&&Jm();var r=t.b,s=void 0,i=Hn(Ve),a=!Z,c=new Map;return jg(()=>{var l=of();s=l.promise;try{Promise.resolve(n()).then(l.resolve,l.reject).then(()=>{h===ae&&h.committed&&h.deactivate(),Di()})}catch(m){l.reject(m),Di()}var h=ae;if(a){var d=!r.is_pending();r.update_pending_count(1),h.increment(d),c.get(h)?.reject(pr),c.delete(h),c.set(h,l)}const g=(m,I=void 0)=>{if(h.activate(),I)I!==pr&&(i.f|=hn,Ps(i,I));else{(i.f&hn)!==0&&(i.f^=hn),Ps(i,m);for(const[S,C]of c){if(c.delete(S),S===h)break;C.reject(pr)}}a&&(r.update_pending_count(-1),h.decrement(d))};l.promise.then(g,m=>g(null,m||"unknown"))}),pc(()=>{for(const l of c.values())l.reject(pr)}),new Promise(l=>{function h(d){function g(){d===s?l(i):h(s)}d.then(g,g)}h(s)})}function co(n){const e=ao(n);return e.equals=hf,e}function yf(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)je(e[t])}}function Vg(n){for(var e=n.parent;e!==null;){if((e.f&xe)===0)return e;e=e.parent}return null}function dc(n){var e,t=ee;kt(Vg(n));try{n.f&=~Rs,yf(n),e=xf(n)}finally{kt(t)}return e}function vf(n){var e=dc(n);if(n.equals(e)||(n.v=e,n.wv=Mf()),!er)if(Ze!==null)lo()&&Ze.set(n,n.v);else{var t=(n.f&dt)===0?Mt:Pe;Ce(n,t)}}let Pa=new Set;const fn=new Map;let Ef=!1;function Hn(n,e){var t={f:0,v:n,reactions:null,equals:uf,rv:0,wv:0};return t}function rn(n,e){const t=Hn(n);return Hg(t),t}function pe(n,e=!1,t=!0){const r=Hn(n);return e||(r.equals=hf),$r&&t&&ie!==null&&ie.l!==null&&(ie.l.s??=[]).push(r),r}function H(n,e,t=!1){Z!==null&&(!Et||(Z.f&ml)!==0)&&$s()&&(Z.f&(xe|Wt|hc|ml))!==0&&!$t?.includes(n)&&ig();let r=t?mr(e):e;return Ps(n,r)}function Ps(n,e){if(!n.equals(e)){var t=n.v;er?fn.set(n,e):fn.set(n,t),n.v=e;var r=vt.ensure();r.capture(n,t),(n.f&xe)!==0&&((n.f&Xe)!==0&&dc(n),Ce(n,(n.f&dt)!==0?Pe:Mt)),n.wv=Mf(),Tf(n,Xe),$s()&&ee!==null&&(ee.f&Pe)!==0&&(ee.f&(Gt|Yn))===0&&(st===null?Wg([n]):st.push(n)),!r.is_fork&&Pa.size>0&&!Ef&&Og()}return e}function Og(){Ef=!1;const n=Array.from(Pa);for(const e of n)(e.f&Pe)!==0&&Ce(e,Mt),jr(e)&&Nr(e);Pa.clear()}function Es(n){H(n,n.v+1)}function Tf(n,e){var t=n.reactions;if(t!==null)for(var r=$s(),s=t.length,i=0;i<s;i++){var a=t[i],c=a.f;if(!(!r&&a===ee)){var l=(c&Xe)===0;if(l&&Ce(a,e),(c&xe)!==0){var h=a;Ze?.delete(h),(c&Rs)===0&&(c&dt&&(a.f|=Rs),Tf(h,Mt))}else l&&((c&Wt)!==0&&xt!==null&&xt.add(a),zn(a))}}}function mr(n){if(typeof n!="object"||n===null||yr in n)return n;const e=cc(n);if(e!==Wm&&e!==Gm)return n;var t=new Map,r=oc(n),s=rn(0),i=Un,a=c=>{if(Un===i)return c();var l=Z,h=Un;Ge(null),El(i);var d=c();return Ge(l),El(h),d};return r&&t.set("length",rn(n.length)),new Proxy(n,{defineProperty(c,l,h){(!("value"in h)||h.configurable===!1||h.enumerable===!1||h.writable===!1)&&rg();var d=t.get(l);return d===void 0?d=a(()=>{var g=rn(h.value);return t.set(l,g),g}):H(d,h.value,!0),!0},deleteProperty(c,l){var h=t.get(l);if(h===void 0){if(l in c){const d=a(()=>rn(Ve));t.set(l,d),Es(s)}}else H(h,Ve),Es(s);return!0},get(c,l,h){if(l===yr)return n;var d=t.get(l),g=l in c;if(d===void 0&&(!g||gr(c,l)?.writable)&&(d=a(()=>{var I=mr(g?c[l]:Ve),S=rn(I);return S}),t.set(l,d)),d!==void 0){var m=L(d);return m===Ve?void 0:m}return Reflect.get(c,l,h)},getOwnPropertyDescriptor(c,l){var h=Reflect.getOwnPropertyDescriptor(c,l);if(h&&"value"in h){var d=t.get(l);d&&(h.value=L(d))}else if(h===void 0){var g=t.get(l),m=g?.v;if(g!==void 0&&m!==Ve)return{enumerable:!0,configurable:!0,value:m,writable:!0}}return h},has(c,l){if(l===yr)return!0;var h=t.get(l),d=h!==void 0&&h.v!==Ve||Reflect.has(c,l);if(h!==void 0||ee!==null&&(!d||gr(c,l)?.writable)){h===void 0&&(h=a(()=>{var m=d?mr(c[l]):Ve,I=rn(m);return I}),t.set(l,h));var g=L(h);if(g===Ve)return!1}return d},set(c,l,h,d){var g=t.get(l),m=l in c;if(r&&l==="length")for(var I=h;I<g.v;I+=1){var S=t.get(I+"");S!==void 0?H(S,Ve):I in c&&(S=a(()=>rn(Ve)),t.set(I+"",S))}if(g===void 0)(!m||gr(c,l)?.writable)&&(g=a(()=>rn(void 0)),H(g,mr(h)),t.set(l,g));else{m=g.v!==Ve;var C=a(()=>mr(h));H(g,C)}var P=Reflect.getOwnPropertyDescriptor(c,l);if(P?.set&&P.set.call(d,h),!m){if(r&&typeof l=="string"){var D=t.get("length"),M=Number(l);Number.isInteger(M)&&M>=D.v&&H(D,M+1)}Es(s)}return!0},ownKeys(c){L(s);var l=Reflect.ownKeys(c).filter(g=>{var m=t.get(g);return m===void 0||m.v!==Ve});for(var[h,d]of t)d.v!==Ve&&!(h in c)&&l.push(h);return l},setPrototypeOf(){sg()}})}var Ca,If,wf,Af;function Mg(){if(Ca===void 0){Ca=window,If=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;wf=gr(e,"firstChild").get,Af=gr(e,"nextSibling").get,pl(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),pl(t)&&(t.__t=void 0)}}function Wn(n=""){return document.createTextNode(n)}function Vi(n){return wf.call(n)}function js(n){return Af.call(n)}function re(n,e){return Vi(n)}function xn(n,e=!1){{var t=Vi(n);return t instanceof Comment&&t.data===""?js(t):t}}function le(n,e=1,t=!1){let r=n;for(;e--;)r=js(r);return r}function Lg(n){n.textContent=""}function bf(){return!1}let _l=!1;function xg(){_l||(_l=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const e of n.target.elements)e.__on_r?.()})},{capture:!0}))}function uo(n){var e=Z,t=ee;Ge(null),kt(null);try{return n()}finally{Ge(e),kt(t)}}function Fg(n,e,t,r=t){n.addEventListener(e,()=>uo(t));const s=n.__on_r;s?n.__on_r=()=>{s(),r(!0)}:n.__on_r=()=>r(!0),xg()}function Sf(n){ee===null&&(Z===null&&eg(),Zm()),er&&Ym()}function Ug(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function Kt(n,e,t,r=!0){var s=ee;s!==null&&(s.f&tt)!==0&&(n|=tt);var i={ctx:ie,deps:null,nodes_start:null,nodes_end:null,f:n|Xe|dt,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{Nr(i),i.f|=lc}catch(l){throw je(i),l}else e!==null&&zn(i);if(r){var a=i;if(t&&a.deps===null&&a.teardown===null&&a.nodes_start===null&&a.first===a.last&&(a.f&Br)===0&&(a=a.first,(n&Wt)!==0&&(n&Rr)!==0&&a!==null&&(a.f|=Rr)),a!==null&&(a.parent=s,s!==null&&Ug(a,s),Z!==null&&(Z.f&xe)!==0&&(n&Yn)===0)){var c=Z;(c.effects??=[]).push(a)}}return i}function lo(){return Z!==null&&!Et}function pc(n){const e=Kt(ro,null,!1);return Ce(e,Pe),e.teardown=n,e}function ka(n){Sf();var e=ee.f,t=!Z&&(e&Gt)!==0&&(e&lc)===0;if(t){var r=ie;(r.e??=[]).push(n)}else return Rf(n)}function Rf(n){return Kt(uc|cf,n,!1)}function Bg(n){return Sf(),Kt(ro|cf,n,!0)}function $g(n){vt.ensure();const e=Kt(Yn|Br,n,!0);return(t={})=>new Promise(r=>{t.outro?vr(e,()=>{je(e),r(void 0)}):(je(e),r(void 0))})}function _n(n,e){var t=ie,r={effect:null,ran:!1,deps:n};t.l.$.push(r),r.effect=ho(()=>{n(),!r.ran&&(r.ran=!0,Me(e))})}function Zn(){var n=ie;ho(()=>{for(var e of n.l.$){e.deps();var t=e.effect;(t.f&Pe)!==0&&Ce(t,Mt),jr(t)&&Nr(t),e.ran=!1}})}function jg(n){return Kt(hc|Br,n,!0)}function ho(n,e=0){return Kt(ro|e,n,!0)}function Ct(n,e=[],t=[],r=[],s=!1){kg(r,e,t,i=>{Kt(s?uc:ro,()=>n(...i.map(L)),!0)})}function mc(n,e=0){var t=Kt(Wt|e,n,!0);return t}function ut(n,e=!0){return Kt(Gt|Br,n,!0,e)}function Pf(n){var e=n.teardown;if(e!==null){const t=er,r=Z;vl(!0),Ge(null);try{e.call(null)}finally{vl(t),Ge(r)}}}function Cf(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const s=t.ac;s!==null&&uo(()=>{s.abort(pr)});var r=t.next;(t.f&Yn)!==0?t.parent=null:je(t,e),t=r}}function qg(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Gt)===0&&je(e),e=t}}function je(n,e=!0){var t=!1;(e||(n.f&af)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(zg(n.nodes_start,n.nodes_end),t=!0),Cf(n,e&&!t),Oi(n,0),Ce(n,ln);var r=n.transitions;if(r!==null)for(const i of r)i.stop();Pf(n);var s=n.parent;s!==null&&s.first!==null&&kf(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function zg(n,e){for(;n!==null;){var t=n===e?null:js(n);n.remove(),n=t}}function kf(n){var e=n.parent,t=n.prev,r=n.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===n&&(e.first=r),e.last===n&&(e.last=t))}function vr(n,e,t=!0){var r=[];gc(n,r,!0),Nf(r,()=>{t&&je(n),e&&e()})}function Nf(n,e){var t=n.length;if(t>0){var r=()=>--t||e();for(var s of n)s.out(r)}else e()}function gc(n,e,t){if((n.f&tt)===0){if(n.f^=tt,n.transitions!==null)for(const a of n.transitions)(a.is_global||t)&&e.push(a);for(var r=n.first;r!==null;){var s=r.next,i=(r.f&Rr)!==0||(r.f&Gt)!==0&&(n.f&Wt)!==0;gc(r,e,i?t:!1),r=s}}}function _c(n){Df(n,!0)}function Df(n,e){if((n.f&tt)!==0){n.f^=tt,(n.f&Pe)===0&&(Ce(n,Xe),zn(n));for(var t=n.first;t!==null;){var r=t.next,s=(t.f&Rr)!==0||(t.f&Gt)!==0;Df(t,s?e:!1),t=r}if(n.transitions!==null)for(const i of n.transitions)(i.is_global||e)&&i.in()}}function Vf(n,e){for(var t=n.nodes_start,r=n.nodes_end;t!==null;){var s=t===r?null:js(t);e.append(t),t=s}}let Fn=!1;function yl(n){Fn=n}let er=!1;function vl(n){er=n}let Z=null,Et=!1;function Ge(n){Z=n}let ee=null;function kt(n){ee=n}let $t=null;function Hg(n){Z!==null&&($t===null?$t=[n]:$t.push(n))}let $e=null,Ye=0,st=null;function Wg(n){st=n}let Of=1,Cs=0,Un=Cs;function El(n){Un=n}function Mf(){return++Of}function jr(n){var e=n.f;if((e&Xe)!==0)return!0;if(e&xe&&(n.f&=~Rs),(e&Mt)!==0){var t=n.deps;if(t!==null)for(var r=t.length,s=0;s<r;s++){var i=t[s];if(jr(i)&&vf(i),i.wv>n.wv)return!0}(e&dt)!==0&&Ze===null&&Ce(n,Pe)}return!1}function Lf(n,e,t=!0){var r=n.reactions;if(r!==null&&!$t?.includes(n))for(var s=0;s<r.length;s++){var i=r[s];(i.f&xe)!==0?Lf(i,e,!1):e===i&&(t?Ce(i,Xe):(i.f&Pe)!==0&&Ce(i,Mt),zn(i))}}function xf(n){var e=$e,t=Ye,r=st,s=Z,i=$t,a=ie,c=Et,l=Un,h=n.f;$e=null,Ye=0,st=null,Z=(h&(Gt|Yn))===0?n:null,$t=null,Pr(n.ctx),Et=!1,Un=++Cs,n.ac!==null&&(uo(()=>{n.ac.abort(pr)}),n.ac=null);try{n.f|=ba;var d=n.fn,g=d(),m=n.deps;if($e!==null){var I;if(Oi(n,Ye),m!==null&&Ye>0)for(m.length=Ye+$e.length,I=0;I<$e.length;I++)m[Ye+I]=$e[I];else n.deps=m=$e;if(Fn&&lo()&&(n.f&dt)!==0)for(I=Ye;I<m.length;I++)(m[I].reactions??=[]).push(n)}else m!==null&&Ye<m.length&&(Oi(n,Ye),m.length=Ye);if($s()&&st!==null&&!Et&&m!==null&&(n.f&(xe|Mt|Xe))===0)for(I=0;I<st.length;I++)Lf(st[I],n);return s!==null&&s!==n&&(Cs++,st!==null&&(r===null?r=st:r.push(...st))),(n.f&hn)!==0&&(n.f^=hn),g}catch(S){return pf(S)}finally{n.f^=ba,$e=e,Ye=t,st=r,Z=s,$t=i,Pr(a),Et=c,Un=l}}function Gg(n,e){let t=e.reactions;if(t!==null){var r=Hm.call(t,n);if(r!==-1){var s=t.length-1;s===0?t=e.reactions=null:(t[r]=t[s],t.pop())}}t===null&&(e.f&xe)!==0&&($e===null||!$e.includes(e))&&(Ce(e,Mt),(e.f&dt)!==0&&(e.f^=dt,e.f&=~Rs),yf(e),Oi(e,0))}function Oi(n,e){var t=n.deps;if(t!==null)for(var r=e;r<t.length;r++)Gg(n,t[r])}function Nr(n){var e=n.f;if((e&ln)===0){Ce(n,Pe);var t=ee,r=Fn;ee=n,Fn=!0;try{(e&Wt)!==0?qg(n):Cf(n),Pf(n);var s=xf(n);n.teardown=typeof s=="function"?s:null,n.wv=Of;var i;nf&&Eg&&(n.f&Xe)!==0&&n.deps}finally{Fn=r,ee=t}}}async function Kg(){await Promise.resolve(),Ag()}function L(n){var e=n.f,t=(e&xe)!==0;if(Z!==null&&!Et){var r=ee!==null&&(ee.f&ln)!==0;if(!r&&!$t?.includes(n)){var s=Z.deps;if((Z.f&ba)!==0)n.rv<Cs&&(n.rv=Cs,$e===null&&s!==null&&s[Ye]===n?Ye++:$e===null?$e=[n]:$e.includes(n)||$e.push(n));else{(Z.deps??=[]).push(n);var i=n.reactions;i===null?n.reactions=[Z]:i.includes(Z)||i.push(Z)}}}if(er){if(fn.has(n))return fn.get(n);if(t){var a=n,c=a.v;return((a.f&Pe)===0&&a.reactions!==null||Uf(a))&&(c=dc(a)),fn.set(a,c),c}}else if(t){if(a=n,Ze?.has(a))return Ze.get(a);jr(a)&&vf(a),Fn&&lo()&&(a.f&dt)===0&&Ff(a)}else if(Ze?.has(n))return Ze.get(n);if((n.f&hn)!==0)throw n.v;return n.v}function Ff(n){if(n.deps!==null){n.f^=dt;for(const e of n.deps)(e.reactions??=[]).push(n),(e.f&xe)!==0&&(e.f&dt)===0&&Ff(e)}}function Uf(n){if(n.v===Ve)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(fn.has(e)||(e.f&xe)!==0&&Uf(e))return!0;return!1}function Me(n){var e=Et;try{return Et=!0,n()}finally{Et=e}}const Qg=-7169;function Ce(n,e){n.f=n.f&Qg|e}function yc(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(yr in n)Na(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&yr in t&&Na(t)}}}function Na(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let r in n)try{Na(n[r],e)}catch{}const t=cc(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const r=sf(t);for(let s in r){const i=r[s].get;if(i)try{i.call(n)}catch{}}}}}const Xg=["touchstart","touchmove"];function Jg(n){return Xg.includes(n)}const Yg=new Set,Tl=new Set;function Zg(n,e,t,r={}){function s(i){if(r.capture||ps.call(e,i),!i.cancelBubble)return uo(()=>t?.call(this,i))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?io(()=>{e.addEventListener(n,s,r)}):e.addEventListener(n,s,r),s}function Nt(n,e,t,r,s){var i={capture:r,passive:s},a=Zg(n,e,t,i);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&pc(()=>{e.removeEventListener(n,a,i)})}let Il=null;function ps(n){var e=this,t=e.ownerDocument,r=n.type,s=n.composedPath?.()||[],i=s[0]||n.target;Il=n;var a=0,c=Il===n&&n.__root;if(c){var l=s.indexOf(c);if(l!==-1&&(e===document||e===window)){n.__root=e;return}var h=s.indexOf(e);if(h===-1)return;l<=h&&(a=l)}if(i=s[a]||n.target,i!==e){rf(n,"currentTarget",{configurable:!0,get(){return i||t}});var d=Z,g=ee;Ge(null),kt(null);try{for(var m,I=[];i!==null;){var S=i.assignedSlot||i.parentNode||i.host||null;try{var C=i["__"+r];C!=null&&(!i.disabled||n.target===i)&&C.call(i,n)}catch(P){m?I.push(P):m=P}if(n.cancelBubble||S===e||S===null)break;i=S}if(m){for(let P of I)queueMicrotask(()=>{throw P});throw m}}finally{n.__root=e,delete n.currentTarget,Ge(d),kt(g)}}}function e_(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function Da(n,e){var t=ee;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function he(n,e){var t=(e&mg)!==0,r=(e&gg)!==0,s,i=!n.startsWith("<!>");return()=>{s===void 0&&(s=e_(i?n:"<!>"+n),t||(s=Vi(s)));var a=r||If?document.importNode(s,!0):s.cloneNode(!0);if(t){var c=Vi(a),l=a.lastChild;Da(c,l)}else Da(a,a);return a}}function vc(){var n=document.createDocumentFragment(),e=document.createComment(""),t=Wn();return n.append(e,t),Da(e,t),n}function se(n,e){n!==null&&n.before(e)}function fo(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function t_(n,e){return n_(n,e)}const cr=new Map;function n_(n,{target:e,anchor:t,props:r={},events:s,context:i,intro:a=!0}){Mg();var c=new Set,l=g=>{for(var m=0;m<g.length;m++){var I=g[m];if(!c.has(I)){c.add(I);var S=Jg(I);e.addEventListener(I,ps,{passive:S});var C=cr.get(I);C===void 0?(document.addEventListener(I,ps,{passive:S}),cr.set(I,1)):cr.set(I,C+1)}}};l(ac(Yg)),Tl.add(l);var h=void 0,d=$g(()=>{var g=t??e.appendChild(Wn());return Pg(g,{pending:()=>{}},m=>{if(i){nt({});var I=ie;I.c=i}s&&(r.$$events=s),h=n(m,r)||{},i&&rt()}),()=>{for(var m of c){e.removeEventListener(m,ps);var I=cr.get(m);--I===0?(document.removeEventListener(m,ps),cr.delete(m)):cr.set(m,I)}Tl.delete(l),g!==t&&g.parentNode?.removeChild(g)}});return r_.set(h,d),h}let r_=new WeakMap;class s_{anchor;#e=new Map;#t=new Map;#n=new Map;#r=!0;constructor(e,t=!0){this.anchor=e,this.#r=t}#c=()=>{var e=ae;if(this.#e.has(e)){var t=this.#e.get(e),r=this.#t.get(t);if(r)_c(r);else{var s=this.#n.get(t);s&&(this.#t.set(t,s.effect),this.#n.delete(t),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),r=s.effect)}for(const[i,a]of this.#e){if(this.#e.delete(i),i===e)break;const c=this.#n.get(a);c&&(je(c.effect),this.#n.delete(a))}for(const[i,a]of this.#t){if(i===t)continue;const c=()=>{if(Array.from(this.#e.values()).includes(i)){var h=document.createDocumentFragment();Vf(a,h),h.append(Wn()),this.#n.set(i,{effect:a,fragment:h})}else je(a);this.#t.delete(i)};this.#r||!r?vr(a,c,!1):c()}}};#o=e=>{this.#e.delete(e);const t=Array.from(this.#e.values());for(const[r,s]of this.#n)t.includes(r)||(je(s.effect),this.#n.delete(r))};ensure(e,t){var r=ae,s=bf();if(t&&!this.#t.has(e)&&!this.#n.has(e))if(s){var i=document.createDocumentFragment(),a=Wn();i.append(a),this.#n.set(e,{effect:ut(()=>t(a)),fragment:i})}else this.#t.set(e,ut(()=>t(this.anchor)));if(this.#e.set(r,e),s){for(const[c,l]of this.#t)c===e?r.skipped_effects.delete(l):r.skipped_effects.add(l);for(const[c,l]of this.#n)c===e?r.skipped_effects.delete(l.effect):r.skipped_effects.add(l.effect);r.oncommit(this.#c),r.ondiscard(this.#o)}else this.#c()}}function ht(n,e,t=!1){var r=new s_(n),s=t?Rr:0;function i(a,c){r.ensure(a,c)}mc(()=>{var a=!1;e((c,l=!0)=>{a=!0,i(l,c)}),a||i(!1,null)},s)}function Bf(n,e){return e}function i_(n,e,t){for(var r=n.items,s=[],i=e.length,a=0;a<i;a++)gc(e[a].e,s,!0);var c=i>0&&s.length===0&&t!==null;if(c){var l=t.parentNode;Lg(l),l.append(t),r.clear(),gt(n,e[0].prev,e[i-1].next)}Nf(s,()=>{for(var h=0;h<i;h++){var d=e[h];c||(r.delete(d.k),gt(n,d.prev,d.next)),je(d.e,!c)}})}function $f(n,e,t,r,s,i=null){var a=n,c={flags:e,items:new Map,first:null};{var l=n;a=l.appendChild(Wn())}var h=null,d=!1,g=new Map,m=co(()=>{var P=t();return oc(P)?P:P==null?[]:ac(P)}),I,S;function C(){o_(S,I,c,g,a,s,e,r,t),i!==null&&(I.length===0?h?_c(h):h=ut(()=>i(a)):h!==null&&vr(h,()=>{h=null}))}mc(()=>{S??=ee,I=L(m);var P=I.length;if(!(d&&P===0)){d=P===0;var D,M,V,U;if(bf()){var G=new Set,Y=ae;for(M=0;M<P;M+=1){V=I[M],U=r(V,M);var E=c.items.get(U)??g.get(U);E?jf(E,V,M):(D=qf(null,c,null,null,V,U,M,s,e,t,!0),g.set(U,D)),G.add(U)}for(const[_,y]of c.items)G.has(_)||Y.skipped_effects.add(y.e);Y.oncommit(C)}else C();L(m)}})}function o_(n,e,t,r,s,i,a,c,l){var h=e.length,d=t.items,g=t.first,m=g,I,S=null,C=[],P=[],D,M,V,U;for(U=0;U<h;U+=1){if(D=e[U],M=c(D,U),V=d.get(M),V===void 0){var G=r.get(M);if(G!==void 0){r.delete(M),d.set(M,G);var Y=S?S.next:m;gt(t,S,G),gt(t,G,Y),ca(G,Y,s),S=G}else{var E=m?m.e.nodes_start:s;S=qf(E,t,S,S===null?t.first:S.next,D,M,U,i,a,l)}d.set(M,S),C=[],P=[],m=S.next;continue}if(jf(V,D,U),(V.e.f&tt)!==0&&_c(V.e),V!==m){if(I!==void 0&&I.has(V)){if(C.length<P.length){var _=P[0],y;S=_.prev;var w=C[0],T=C[C.length-1];for(y=0;y<C.length;y+=1)ca(C[y],_,s);for(y=0;y<P.length;y+=1)I.delete(P[y]);gt(t,w.prev,T.next),gt(t,S,w),gt(t,T,_),m=_,S=T,U-=1,C=[],P=[]}else I.delete(V),ca(V,m,s),gt(t,V.prev,V.next),gt(t,V,S===null?t.first:S.next),gt(t,S,V),S=V;continue}for(C=[],P=[];m!==null&&m.k!==M;)(m.e.f&tt)===0&&(I??=new Set).add(m),P.push(m),m=m.next;if(m===null)continue;V=m}C.push(V),S=V,m=V.next}if(m!==null||I!==void 0){for(var A=I===void 0?[]:ac(I);m!==null;)(m.e.f&tt)===0&&A.push(m),m=m.next;var v=A.length;if(v>0){var ve=h===0?s:null;i_(t,A,ve)}}n.first=t.first&&t.first.e,n.last=S&&S.e;for(var qe of r.values())je(qe.e);r.clear()}function jf(n,e,t,r){Ps(n.v,e),n.i=t}function qf(n,e,t,r,s,i,a,c,l,h,d){var g=(l&ag)!==0,m=(l&ug)===0,I=g?m?pe(s,!1,!1):Hn(s):s,S=(l&cg)===0?a:Hn(a),C={i:S,v:I,k:i,a:null,e:null,prev:t,next:r};try{if(n===null){var P=document.createDocumentFragment();P.append(n=Wn())}return C.e=ut(()=>c(n,I,S,h),vg),C.e.prev=t&&t.e,C.e.next=r&&r.e,t===null?d||(e.first=C):(t.next=C,t.e.next=C.e),r!==null&&(r.prev=C,r.e.prev=C.e),C}finally{}}function ca(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,i=n.e.nodes_start;i!==null&&i!==r;){var a=js(i);s.before(i),i=a}}function gt(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Ec(n,e,t,r,s){var i=e.$$slots?.[t],a=!1;i===!0&&(i=e.children,a=!0),i===void 0||i(n,a?()=>r:r)}const wl=[...` 	
\r\fÂ \v\uFEFF`];function a_(n,e,t){var r=n==null?"":""+n;if(t){for(var s in t)if(t[s])r=r?r+" "+s:s;else if(r.length)for(var i=s.length,a=0;(a=r.indexOf(s,a))>=0;){var c=a+i;(a===0||wl.includes(r[a-1]))&&(c===r.length||wl.includes(r[c]))?r=(a===0?"":r.substring(0,a))+r.substring(c+1):a=c}}return r===""?null:r}function c_(n,e){return n==null?null:String(n)}function ks(n,e,t,r,s,i){var a=n.__className;if(a!==t||a===void 0){var c=a_(t,r,i);c==null?n.removeAttribute("class"):n.className=c,n.__className=t}else if(i&&s!==i)for(var l in i){var h=!!i[l];(s==null||h!==!!s[l])&&n.classList.toggle(l,h)}return i}function u_(n,e,t,r){var s=n.__style;if(s!==e){var i=c_(e);i==null?n.removeAttribute("style"):n.style.cssText=i,n.__style=e}return r}const l_=Symbol("is custom element"),h_=Symbol("is html");function Er(n,e,t,r){var s=f_(n);s[e]!==(s[e]=t)&&(e==="loading"&&(n[Xm]=t),t==null?n.removeAttribute(e):typeof t!="string"&&d_(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function f_(n){return n.__attributes??={[l_]:n.nodeName.includes("-"),[h_]:n.namespaceURI===_g}}var Al=new Map;function d_(n){var e=n.getAttribute("is")||n.nodeName,t=Al.get(e);if(t)return t;Al.set(e,t=[]);for(var r,s=n,i=Element.prototype;i!==s;){r=sf(s);for(var a in r)r[a].set&&t.push(a);s=cc(s)}return t}function Tr(n,e,t=e){var r=new WeakSet;Fg(n,"input",async s=>{var i=s?n.defaultValue:n.value;if(i=ua(n)?la(i):i,t(i),ae!==null&&r.add(ae),await Kg(),i!==(i=e())){var a=n.selectionStart,c=n.selectionEnd,l=n.value.length;if(n.value=i??"",c!==null){var h=n.value.length;a===c&&c===l&&h>l?(n.selectionStart=h,n.selectionEnd=h):(n.selectionStart=a,n.selectionEnd=Math.min(c,h))}}}),Me(e)==null&&n.value&&(t(ua(n)?la(n.value):n.value),ae!==null&&r.add(ae)),ho(()=>{var s=e();if(n===document.activeElement){var i=Ti??ae;if(r.has(i))return}ua(n)&&s===la(n.value)||n.type==="date"&&!s&&!n.value||s!==n.value&&(n.value=s??"")})}function ua(n){var e=n.type;return e==="number"||e==="range"}function la(n){return n===""?null:+n}function zf(n){return function(...e){var t=e[0];return t.preventDefault(),n?.apply(this,e)}}function at(n=!1){const e=ie,t=e.l.u;if(!t)return;let r=()=>yc(e.s);if(n){let s=0,i={};const a=ao(()=>{let c=!1;const l=e.s;for(const h in l)l[h]!==i[h]&&(i[h]=l[h],c=!0);return c&&s++,s});r=()=>L(a)}t.b.length&&Bg(()=>{bl(e,r),Aa(t.b)}),ka(()=>{const s=Me(()=>t.m.map(Km));return()=>{for(const i of s)typeof i=="function"&&i()}}),t.a.length&&ka(()=>{bl(e,r),Aa(t.a)})}function bl(n,e){if(n.l.s)for(const t of n.l.s)L(t);e()}function Hf(n,e,t){if(n==null)return e(void 0),_r;const r=Me(()=>n.subscribe(e,t));return r.unsubscribe?()=>r.unsubscribe():r}const ur=[];function po(n,e=_r){let t=null;const r=new Set;function s(c){if(lf(n,c)&&(n=c,t)){const l=!ur.length;for(const h of r)h[1](),ur.push(h,n);if(l){for(let h=0;h<ur.length;h+=2)ur[h][0](ur[h+1]);ur.length=0}}}function i(c){s(c(n))}function a(c,l=_r){const h=[c,l];return r.add(h),r.size===1&&(t=e(s,i)||_r),c(n),()=>{r.delete(h),r.size===0&&t&&(t(),t=null)}}return{set:s,update:i,subscribe:a}}function p_(n){let e;return Hf(n,t=>e=t)(),e}let pi=!1,Va=Symbol();function Tt(n,e,t){const r=t[e]??={store:null,source:pe(void 0),unsubscribe:_r};if(r.store!==n&&!(Va in t))if(r.unsubscribe(),r.store=n??null,n==null)r.source.v=void 0,r.unsubscribe=_r;else{var s=!0;r.unsubscribe=Hf(n,i=>{s?r.source.v=i:H(r.source,i)}),s=!1}return n&&Va in t?p_(n):L(r.source)}function qr(){const n={};function e(){pc(()=>{for(var t in n)n[t].unsubscribe();rf(n,Va,{enumerable:!1,value:!0})})}return[n,e]}function m_(n){var e=pi;try{return pi=!1,[n(),pi]}finally{pi=e}}function Ke(n,e,t,r){var s=!$r||(t&hg)!==0,i=(t&dg)!==0,a=(t&pg)!==0,c=r,l=!0,h=()=>(l&&(l=!1,c=a?Me(r):r),c),d;if(i){var g=yr in n||Qm in n;d=gr(n,e)?.set??(g&&e in n?V=>n[e]=V:void 0)}var m,I=!1;i?[m,I]=m_(()=>n[e]):m=n[e],m===void 0&&r!==void 0&&(m=h(),d&&(s&&ng(),d(m)));var S;if(s?S=()=>{var V=n[e];return V===void 0?h():(l=!0,V)}:S=()=>{var V=n[e];return V!==void 0&&(c=void 0),V===void 0?c:V},s&&(t&fg)===0)return S;if(d){var C=n.$$legacy;return(function(V,U){return arguments.length>0?((!s||!U||C||I)&&d(U?S():V),V):S()})}var P=!1,D=((t&lg)!==0?ao:co)(()=>(P=!1,S()));i&&L(D);var M=ee;return(function(V,U){if(arguments.length>0){const G=U?L(D):s&&i?mr(V):V;return H(D,G),P=!0,c!==void 0&&(c=G),V}return er&&P||(M.f&ln)!==0?D.v:L(D)})}function g_(n){ie===null&&fc(),$r&&ie.l!==null?y_(ie).m.push(n):ka(()=>{const e=Me(n);if(typeof e=="function")return e})}function __(n,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:r})}function qs(){const n=ie;return n===null&&fc(),(e,t,r)=>{const s=n.s.$$events?.[e];if(s){const i=oc(s)?s.slice():[s],a=__(e,t,r);for(const c of i)c.call(n.x,a);return!a.defaultPrevented}return!0}}function y_(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}const v_="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(v_);Tg();const E_=()=>{};var Sl={};const Wf=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},T_=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],a=n[t++],c=n[t++],l=((s&7)<<18|(i&63)<<12|(a&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},Gf={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],a=s+1<n.length,c=a?n[s+1]:0,l=s+2<n.length,h=l?n[s+2]:0,d=i>>2,g=(i&3)<<4|c>>4;let m=(c&15)<<2|h>>6,I=h&63;l||(I=64,a||(m=64)),r.push(t[d],t[g],t[m],t[I])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Wf(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):T_(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],c=s<n.length?t[n.charAt(s)]:0;++s;const h=s<n.length?t[n.charAt(s)]:64;++s;const g=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||c==null||h==null||g==null)throw new I_;const m=i<<2|c>>4;if(r.push(m),h!==64){const I=c<<4&240|h>>2;if(r.push(I),g!==64){const S=h<<6&192|g;r.push(S)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class I_ extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const w_=function(n){const e=Wf(n);return Gf.encodeByteArray(e,!0)},Mi=function(n){return w_(n).replace(/\./g,"")},Kf=function(n){try{return Gf.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function A_(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const b_=()=>A_().__FIREBASE_DEFAULTS__,S_=()=>{if(typeof process>"u"||typeof Sl>"u")return;const n=Sl.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},R_=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Kf(n[1]);return e&&JSON.parse(e)},mo=()=>{try{return E_()||b_()||S_()||R_()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Qf=n=>mo()?.emulatorHosts?.[n],Xf=n=>{const e=Qf(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Jf=()=>mo()?.config,Yf=n=>mo()?.[`_${n}`];class P_{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function bn(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Tc(n){return(await fetch(n,{credentials:"include"})).ok}function C_(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Mi(JSON.stringify(t)),Mi(JSON.stringify(a)),""].join(".")}const Ts={};function k_(){const n={prod:[],emulator:[]};for(const e of Object.keys(Ts))Ts[e]?n.emulator.push(e):n.prod.push(e);return n}function N_(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Rl=!1;function Ic(n,e){if(typeof window>"u"||typeof document>"u"||!bn(window.location.host)||Ts[n]===e||Ts[n]||Rl)return;Ts[n]=e;function t(m){return`__firebase__banner__${m}`}const r="__firebase__banner",i=k_().prod.length>0;function a(){const m=document.getElementById(r);m&&m.remove()}function c(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function l(m,I){m.setAttribute("width","24"),m.setAttribute("id",I),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function h(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{Rl=!0,a()},m}function d(m,I){m.setAttribute("id",I),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function g(){const m=N_(r),I=t("text"),S=document.getElementById(I)||document.createElement("span"),C=t("learnmore"),P=document.getElementById(C)||document.createElement("a"),D=t("preprendIcon"),M=document.getElementById(D)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const V=m.element;c(V),d(P,C);const U=h();l(M,D),V.append(M,S,P,U),document.body.appendChild(V)}i?(S.innerText="Preview backend disconnected.",M.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(M.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,S.innerText="Preview backend running in this workspace."),S.setAttribute("id",I)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function Fe(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function D_(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Fe())}function V_(){const n=mo()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function O_(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function M_(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function L_(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function x_(){const n=Fe();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function F_(){return!V_()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function U_(){try{return typeof indexedDB=="object"}catch{return!1}}function B_(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const $_="FirebaseError";class Lt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=$_,Object.setPrototypeOf(this,Lt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,zs.prototype.create)}}class zs{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?j_(i,r):"Error",c=`${this.serviceName}: ${a} (${s}).`;return new Lt(s,c,r)}}function j_(n,e){return n.replace(q_,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const q_=/\{\$([^}]+)}/g;function z_(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Gn(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],a=e[s];if(Pl(i)&&Pl(a)){if(!Gn(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Pl(n){return n!==null&&typeof n=="object"}function Hs(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function H_(n,e){const t=new W_(n,e);return t.subscribe.bind(t)}class W_{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");G_(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=ha),s.error===void 0&&(s.error=ha),s.complete===void 0&&(s.complete=ha);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function G_(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function ha(){}function ye(n){return n&&n._delegate?n._delegate:n}class yn{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Vn="[DEFAULT]";class K_{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new P_;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(X_(e))try{this.getOrInitializeService({instanceIdentifier:Vn})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Vn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Vn){return this.instances.has(e)}getOptions(e=Vn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);r===c&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Q_(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Vn){return this.component?this.component.multipleInstances?e:Vn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Q_(n){return n===Vn?void 0:n}function X_(n){return n.instantiationMode==="EAGER"}class J_{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new K_(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var K;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(K||(K={}));const Y_={debug:K.DEBUG,verbose:K.VERBOSE,info:K.INFO,warn:K.WARN,error:K.ERROR,silent:K.SILENT},Z_=K.INFO,ey={[K.DEBUG]:"log",[K.VERBOSE]:"log",[K.INFO]:"info",[K.WARN]:"warn",[K.ERROR]:"error"},ty=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=ey[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class wc{constructor(e){this.name=e,this._logLevel=Z_,this._logHandler=ty,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in K))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Y_[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,K.DEBUG,...e),this._logHandler(this,K.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,K.VERBOSE,...e),this._logHandler(this,K.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,K.INFO,...e),this._logHandler(this,K.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,K.WARN,...e),this._logHandler(this,K.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,K.ERROR,...e),this._logHandler(this,K.ERROR,...e)}}const ny=(n,e)=>e.some(t=>n instanceof t);let Cl,kl;function ry(){return Cl||(Cl=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function sy(){return kl||(kl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Zf=new WeakMap,Oa=new WeakMap,ed=new WeakMap,fa=new WeakMap,Ac=new WeakMap;function iy(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(dn(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Zf.set(t,n)}).catch(()=>{}),Ac.set(e,n),e}function oy(n){if(Oa.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});Oa.set(n,e)}let Ma={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Oa.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ed.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return dn(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function ay(n){Ma=n(Ma)}function cy(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(da(this),e,...t);return ed.set(r,e.sort?e.sort():[e]),dn(r)}:sy().includes(n)?function(...e){return n.apply(da(this),e),dn(Zf.get(this))}:function(...e){return dn(n.apply(da(this),e))}}function uy(n){return typeof n=="function"?cy(n):(n instanceof IDBTransaction&&oy(n),ny(n,ry())?new Proxy(n,Ma):n)}function dn(n){if(n instanceof IDBRequest)return iy(n);if(fa.has(n))return fa.get(n);const e=uy(n);return e!==n&&(fa.set(n,e),Ac.set(e,n)),e}const da=n=>Ac.get(n);function ly(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(n,e),c=dn(a);return r&&a.addEventListener("upgradeneeded",l=>{r(dn(a.result),l.oldVersion,l.newVersion,dn(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),c.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",h=>s(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}const hy=["get","getKey","getAll","getAllKeys","count"],fy=["put","add","delete","clear"],pa=new Map;function Nl(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(pa.get(e))return pa.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=fy.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||hy.includes(t)))return;const i=async function(a,...c){const l=this.transaction(a,s?"readwrite":"readonly");let h=l.store;return r&&(h=h.index(c.shift())),(await Promise.all([h[t](...c),s&&l.done]))[0]};return pa.set(e,i),i}ay(n=>({...n,get:(e,t,r)=>Nl(e,t)||n.get(e,t,r),has:(e,t)=>!!Nl(e,t)||n.has(e,t)}));class dy{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(py(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function py(n){return n.getComponent()?.type==="VERSION"}const La="@firebase/app",Dl="0.14.5";const jt=new wc("@firebase/app"),my="@firebase/app-compat",gy="@firebase/analytics-compat",_y="@firebase/analytics",yy="@firebase/app-check-compat",vy="@firebase/app-check",Ey="@firebase/auth",Ty="@firebase/auth-compat",Iy="@firebase/database",wy="@firebase/data-connect",Ay="@firebase/database-compat",by="@firebase/functions",Sy="@firebase/functions-compat",Ry="@firebase/installations",Py="@firebase/installations-compat",Cy="@firebase/messaging",ky="@firebase/messaging-compat",Ny="@firebase/performance",Dy="@firebase/performance-compat",Vy="@firebase/remote-config",Oy="@firebase/remote-config-compat",My="@firebase/storage",Ly="@firebase/storage-compat",xy="@firebase/firestore",Fy="@firebase/ai",Uy="@firebase/firestore-compat",By="firebase",$y="12.5.0";const xa="[DEFAULT]",jy={[La]:"fire-core",[my]:"fire-core-compat",[_y]:"fire-analytics",[gy]:"fire-analytics-compat",[vy]:"fire-app-check",[yy]:"fire-app-check-compat",[Ey]:"fire-auth",[Ty]:"fire-auth-compat",[Iy]:"fire-rtdb",[wy]:"fire-data-connect",[Ay]:"fire-rtdb-compat",[by]:"fire-fn",[Sy]:"fire-fn-compat",[Ry]:"fire-iid",[Py]:"fire-iid-compat",[Cy]:"fire-fcm",[ky]:"fire-fcm-compat",[Ny]:"fire-perf",[Dy]:"fire-perf-compat",[Vy]:"fire-rc",[Oy]:"fire-rc-compat",[My]:"fire-gcs",[Ly]:"fire-gcs-compat",[xy]:"fire-fst",[Uy]:"fire-fst-compat",[Fy]:"fire-vertex","fire-js":"fire-js",[By]:"fire-js-all"};const Li=new Map,qy=new Map,Fa=new Map;function Vl(n,e){try{n.container.addComponent(e)}catch(t){jt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Kn(n){const e=n.name;if(Fa.has(e))return jt.debug(`There were multiple attempts to register component ${e}.`),!1;Fa.set(e,n);for(const t of Li.values())Vl(t,n);for(const t of qy.values())Vl(t,n);return!0}function go(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function it(n){return n==null?!1:n.settings!==void 0}const zy={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},pn=new zs("app","Firebase",zy);class Hy{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new yn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw pn.create("app-deleted",{appName:this._name})}}const zr=$y;function td(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:xa,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw pn.create("bad-app-name",{appName:String(s)});if(t||(t=Jf()),!t)throw pn.create("no-options");const i=Li.get(s);if(i){if(Gn(t,i.options)&&Gn(r,i.config))return i;throw pn.create("duplicate-app",{appName:s})}const a=new J_(s);for(const l of Fa.values())a.addComponent(l);const c=new Hy(t,r,a);return Li.set(s,c),c}function bc(n=xa){const e=Li.get(n);if(!e&&n===xa&&Jf())return td();if(!e)throw pn.create("no-app",{appName:n});return e}function It(n,e,t){let r=jy[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),jt.warn(a.join(" "));return}Kn(new yn(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const Wy="firebase-heartbeat-database",Gy=1,Ns="firebase-heartbeat-store";let ma=null;function nd(){return ma||(ma=ly(Wy,Gy,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ns)}catch(t){console.warn(t)}}}}).catch(n=>{throw pn.create("idb-open",{originalErrorMessage:n.message})})),ma}async function Ky(n){try{const t=(await nd()).transaction(Ns),r=await t.objectStore(Ns).get(rd(n));return await t.done,r}catch(e){if(e instanceof Lt)jt.warn(e.message);else{const t=pn.create("idb-get",{originalErrorMessage:e?.message});jt.warn(t.message)}}}async function Ol(n,e){try{const r=(await nd()).transaction(Ns,"readwrite");await r.objectStore(Ns).put(e,rd(n)),await r.done}catch(t){if(t instanceof Lt)jt.warn(t.message);else{const r=pn.create("idb-set",{originalErrorMessage:t?.message});jt.warn(r.message)}}}function rd(n){return`${n.name}!${n.options.appId}`}const Qy=1024,Xy=30;class Jy{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Zy(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Ml();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>Xy){const s=ev(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){jt.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Ml(),{heartbeatsToSend:t,unsentEntries:r}=Yy(this._heartbeatsCache.heartbeats),s=Mi(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return jt.warn(e),""}}}function Ml(){return new Date().toISOString().substring(0,10)}function Yy(n,e=Qy){const t=[];let r=n.slice();for(const s of n){const i=t.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),Ll(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Ll(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Zy{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return U_()?B_().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Ky(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Ol(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Ol(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Ll(n){return Mi(JSON.stringify({version:2,heartbeats:n})).length}function ev(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function tv(n){Kn(new yn("platform-logger",e=>new dy(e),"PRIVATE")),Kn(new yn("heartbeat",e=>new Jy(e),"PRIVATE")),It(La,Dl,n),It(La,Dl,"esm2020"),It("fire-js","")}tv("");var nv="firebase",rv="12.5.0";It(nv,rv,"app");var xl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var mn,sd;(function(){var n;function e(E,_){function y(){}y.prototype=_.prototype,E.F=_.prototype,E.prototype=new y,E.prototype.constructor=E,E.D=function(w,T,A){for(var v=Array(arguments.length-2),ve=2;ve<arguments.length;ve++)v[ve-2]=arguments[ve];return _.prototype[T].apply(w,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,_,y){y||(y=0);const w=Array(16);if(typeof _=="string")for(var T=0;T<16;++T)w[T]=_.charCodeAt(y++)|_.charCodeAt(y++)<<8|_.charCodeAt(y++)<<16|_.charCodeAt(y++)<<24;else for(T=0;T<16;++T)w[T]=_[y++]|_[y++]<<8|_[y++]<<16|_[y++]<<24;_=E.g[0],y=E.g[1],T=E.g[2];let A=E.g[3],v;v=_+(A^y&(T^A))+w[0]+3614090360&4294967295,_=y+(v<<7&4294967295|v>>>25),v=A+(T^_&(y^T))+w[1]+3905402710&4294967295,A=_+(v<<12&4294967295|v>>>20),v=T+(y^A&(_^y))+w[2]+606105819&4294967295,T=A+(v<<17&4294967295|v>>>15),v=y+(_^T&(A^_))+w[3]+3250441966&4294967295,y=T+(v<<22&4294967295|v>>>10),v=_+(A^y&(T^A))+w[4]+4118548399&4294967295,_=y+(v<<7&4294967295|v>>>25),v=A+(T^_&(y^T))+w[5]+1200080426&4294967295,A=_+(v<<12&4294967295|v>>>20),v=T+(y^A&(_^y))+w[6]+2821735955&4294967295,T=A+(v<<17&4294967295|v>>>15),v=y+(_^T&(A^_))+w[7]+4249261313&4294967295,y=T+(v<<22&4294967295|v>>>10),v=_+(A^y&(T^A))+w[8]+1770035416&4294967295,_=y+(v<<7&4294967295|v>>>25),v=A+(T^_&(y^T))+w[9]+2336552879&4294967295,A=_+(v<<12&4294967295|v>>>20),v=T+(y^A&(_^y))+w[10]+4294925233&4294967295,T=A+(v<<17&4294967295|v>>>15),v=y+(_^T&(A^_))+w[11]+2304563134&4294967295,y=T+(v<<22&4294967295|v>>>10),v=_+(A^y&(T^A))+w[12]+1804603682&4294967295,_=y+(v<<7&4294967295|v>>>25),v=A+(T^_&(y^T))+w[13]+4254626195&4294967295,A=_+(v<<12&4294967295|v>>>20),v=T+(y^A&(_^y))+w[14]+2792965006&4294967295,T=A+(v<<17&4294967295|v>>>15),v=y+(_^T&(A^_))+w[15]+1236535329&4294967295,y=T+(v<<22&4294967295|v>>>10),v=_+(T^A&(y^T))+w[1]+4129170786&4294967295,_=y+(v<<5&4294967295|v>>>27),v=A+(y^T&(_^y))+w[6]+3225465664&4294967295,A=_+(v<<9&4294967295|v>>>23),v=T+(_^y&(A^_))+w[11]+643717713&4294967295,T=A+(v<<14&4294967295|v>>>18),v=y+(A^_&(T^A))+w[0]+3921069994&4294967295,y=T+(v<<20&4294967295|v>>>12),v=_+(T^A&(y^T))+w[5]+3593408605&4294967295,_=y+(v<<5&4294967295|v>>>27),v=A+(y^T&(_^y))+w[10]+38016083&4294967295,A=_+(v<<9&4294967295|v>>>23),v=T+(_^y&(A^_))+w[15]+3634488961&4294967295,T=A+(v<<14&4294967295|v>>>18),v=y+(A^_&(T^A))+w[4]+3889429448&4294967295,y=T+(v<<20&4294967295|v>>>12),v=_+(T^A&(y^T))+w[9]+568446438&4294967295,_=y+(v<<5&4294967295|v>>>27),v=A+(y^T&(_^y))+w[14]+3275163606&4294967295,A=_+(v<<9&4294967295|v>>>23),v=T+(_^y&(A^_))+w[3]+4107603335&4294967295,T=A+(v<<14&4294967295|v>>>18),v=y+(A^_&(T^A))+w[8]+1163531501&4294967295,y=T+(v<<20&4294967295|v>>>12),v=_+(T^A&(y^T))+w[13]+2850285829&4294967295,_=y+(v<<5&4294967295|v>>>27),v=A+(y^T&(_^y))+w[2]+4243563512&4294967295,A=_+(v<<9&4294967295|v>>>23),v=T+(_^y&(A^_))+w[7]+1735328473&4294967295,T=A+(v<<14&4294967295|v>>>18),v=y+(A^_&(T^A))+w[12]+2368359562&4294967295,y=T+(v<<20&4294967295|v>>>12),v=_+(y^T^A)+w[5]+4294588738&4294967295,_=y+(v<<4&4294967295|v>>>28),v=A+(_^y^T)+w[8]+2272392833&4294967295,A=_+(v<<11&4294967295|v>>>21),v=T+(A^_^y)+w[11]+1839030562&4294967295,T=A+(v<<16&4294967295|v>>>16),v=y+(T^A^_)+w[14]+4259657740&4294967295,y=T+(v<<23&4294967295|v>>>9),v=_+(y^T^A)+w[1]+2763975236&4294967295,_=y+(v<<4&4294967295|v>>>28),v=A+(_^y^T)+w[4]+1272893353&4294967295,A=_+(v<<11&4294967295|v>>>21),v=T+(A^_^y)+w[7]+4139469664&4294967295,T=A+(v<<16&4294967295|v>>>16),v=y+(T^A^_)+w[10]+3200236656&4294967295,y=T+(v<<23&4294967295|v>>>9),v=_+(y^T^A)+w[13]+681279174&4294967295,_=y+(v<<4&4294967295|v>>>28),v=A+(_^y^T)+w[0]+3936430074&4294967295,A=_+(v<<11&4294967295|v>>>21),v=T+(A^_^y)+w[3]+3572445317&4294967295,T=A+(v<<16&4294967295|v>>>16),v=y+(T^A^_)+w[6]+76029189&4294967295,y=T+(v<<23&4294967295|v>>>9),v=_+(y^T^A)+w[9]+3654602809&4294967295,_=y+(v<<4&4294967295|v>>>28),v=A+(_^y^T)+w[12]+3873151461&4294967295,A=_+(v<<11&4294967295|v>>>21),v=T+(A^_^y)+w[15]+530742520&4294967295,T=A+(v<<16&4294967295|v>>>16),v=y+(T^A^_)+w[2]+3299628645&4294967295,y=T+(v<<23&4294967295|v>>>9),v=_+(T^(y|~A))+w[0]+4096336452&4294967295,_=y+(v<<6&4294967295|v>>>26),v=A+(y^(_|~T))+w[7]+1126891415&4294967295,A=_+(v<<10&4294967295|v>>>22),v=T+(_^(A|~y))+w[14]+2878612391&4294967295,T=A+(v<<15&4294967295|v>>>17),v=y+(A^(T|~_))+w[5]+4237533241&4294967295,y=T+(v<<21&4294967295|v>>>11),v=_+(T^(y|~A))+w[12]+1700485571&4294967295,_=y+(v<<6&4294967295|v>>>26),v=A+(y^(_|~T))+w[3]+2399980690&4294967295,A=_+(v<<10&4294967295|v>>>22),v=T+(_^(A|~y))+w[10]+4293915773&4294967295,T=A+(v<<15&4294967295|v>>>17),v=y+(A^(T|~_))+w[1]+2240044497&4294967295,y=T+(v<<21&4294967295|v>>>11),v=_+(T^(y|~A))+w[8]+1873313359&4294967295,_=y+(v<<6&4294967295|v>>>26),v=A+(y^(_|~T))+w[15]+4264355552&4294967295,A=_+(v<<10&4294967295|v>>>22),v=T+(_^(A|~y))+w[6]+2734768916&4294967295,T=A+(v<<15&4294967295|v>>>17),v=y+(A^(T|~_))+w[13]+1309151649&4294967295,y=T+(v<<21&4294967295|v>>>11),v=_+(T^(y|~A))+w[4]+4149444226&4294967295,_=y+(v<<6&4294967295|v>>>26),v=A+(y^(_|~T))+w[11]+3174756917&4294967295,A=_+(v<<10&4294967295|v>>>22),v=T+(_^(A|~y))+w[2]+718787259&4294967295,T=A+(v<<15&4294967295|v>>>17),v=y+(A^(T|~_))+w[9]+3951481745&4294967295,E.g[0]=E.g[0]+_&4294967295,E.g[1]=E.g[1]+(T+(v<<21&4294967295|v>>>11))&4294967295,E.g[2]=E.g[2]+T&4294967295,E.g[3]=E.g[3]+A&4294967295}r.prototype.v=function(E,_){_===void 0&&(_=E.length);const y=_-this.blockSize,w=this.C;let T=this.h,A=0;for(;A<_;){if(T==0)for(;A<=y;)s(this,E,A),A+=this.blockSize;if(typeof E=="string"){for(;A<_;)if(w[T++]=E.charCodeAt(A++),T==this.blockSize){s(this,w),T=0;break}}else for(;A<_;)if(w[T++]=E[A++],T==this.blockSize){s(this,w),T=0;break}}this.h=T,this.o+=_},r.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var _=1;_<E.length-8;++_)E[_]=0;_=this.o*8;for(var y=E.length-8;y<E.length;++y)E[y]=_&255,_/=256;for(this.v(E),E=Array(16),_=0,y=0;y<4;++y)for(let w=0;w<32;w+=8)E[_++]=this.g[y]>>>w&255;return E};function i(E,_){var y=c;return Object.prototype.hasOwnProperty.call(y,E)?y[E]:y[E]=_(E)}function a(E,_){this.h=_;const y=[];let w=!0;for(let T=E.length-1;T>=0;T--){const A=E[T]|0;w&&A==_||(y[T]=A,w=!1)}this.g=y}var c={};function l(E){return-128<=E&&E<128?i(E,function(_){return new a([_|0],_<0?-1:0)}):new a([E|0],E<0?-1:0)}function h(E){if(isNaN(E)||!isFinite(E))return g;if(E<0)return P(h(-E));const _=[];let y=1;for(let w=0;E>=y;w++)_[w]=E/y|0,y*=4294967296;return new a(_,0)}function d(E,_){if(E.length==0)throw Error("number format error: empty string");if(_=_||10,_<2||36<_)throw Error("radix out of range: "+_);if(E.charAt(0)=="-")return P(d(E.substring(1),_));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const y=h(Math.pow(_,8));let w=g;for(let A=0;A<E.length;A+=8){var T=Math.min(8,E.length-A);const v=parseInt(E.substring(A,A+T),_);T<8?(T=h(Math.pow(_,T)),w=w.j(T).add(h(v))):(w=w.j(y),w=w.add(h(v)))}return w}var g=l(0),m=l(1),I=l(16777216);n=a.prototype,n.m=function(){if(C(this))return-P(this).m();let E=0,_=1;for(let y=0;y<this.g.length;y++){const w=this.i(y);E+=(w>=0?w:4294967296+w)*_,_*=4294967296}return E},n.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(S(this))return"0";if(C(this))return"-"+P(this).toString(E);const _=h(Math.pow(E,6));var y=this;let w="";for(;;){const T=U(y,_).g;y=D(y,T.j(_));let A=((y.g.length>0?y.g[0]:y.h)>>>0).toString(E);if(y=T,S(y))return A+w;for(;A.length<6;)A="0"+A;w=A+w}},n.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function S(E){if(E.h!=0)return!1;for(let _=0;_<E.g.length;_++)if(E.g[_]!=0)return!1;return!0}function C(E){return E.h==-1}n.l=function(E){return E=D(this,E),C(E)?-1:S(E)?0:1};function P(E){const _=E.g.length,y=[];for(let w=0;w<_;w++)y[w]=~E.g[w];return new a(y,~E.h).add(m)}n.abs=function(){return C(this)?P(this):this},n.add=function(E){const _=Math.max(this.g.length,E.g.length),y=[];let w=0;for(let T=0;T<=_;T++){let A=w+(this.i(T)&65535)+(E.i(T)&65535),v=(A>>>16)+(this.i(T)>>>16)+(E.i(T)>>>16);w=v>>>16,A&=65535,v&=65535,y[T]=v<<16|A}return new a(y,y[y.length-1]&-2147483648?-1:0)};function D(E,_){return E.add(P(_))}n.j=function(E){if(S(this)||S(E))return g;if(C(this))return C(E)?P(this).j(P(E)):P(P(this).j(E));if(C(E))return P(this.j(P(E)));if(this.l(I)<0&&E.l(I)<0)return h(this.m()*E.m());const _=this.g.length+E.g.length,y=[];for(var w=0;w<2*_;w++)y[w]=0;for(w=0;w<this.g.length;w++)for(let T=0;T<E.g.length;T++){const A=this.i(w)>>>16,v=this.i(w)&65535,ve=E.i(T)>>>16,qe=E.i(T)&65535;y[2*w+2*T]+=v*qe,M(y,2*w+2*T),y[2*w+2*T+1]+=A*qe,M(y,2*w+2*T+1),y[2*w+2*T+1]+=v*ve,M(y,2*w+2*T+1),y[2*w+2*T+2]+=A*ve,M(y,2*w+2*T+2)}for(E=0;E<_;E++)y[E]=y[2*E+1]<<16|y[2*E];for(E=_;E<2*_;E++)y[E]=0;return new a(y,0)};function M(E,_){for(;(E[_]&65535)!=E[_];)E[_+1]+=E[_]>>>16,E[_]&=65535,_++}function V(E,_){this.g=E,this.h=_}function U(E,_){if(S(_))throw Error("division by zero");if(S(E))return new V(g,g);if(C(E))return _=U(P(E),_),new V(P(_.g),P(_.h));if(C(_))return _=U(E,P(_)),new V(P(_.g),_.h);if(E.g.length>30){if(C(E)||C(_))throw Error("slowDivide_ only works with positive integers.");for(var y=m,w=_;w.l(E)<=0;)y=G(y),w=G(w);var T=Y(y,1),A=Y(w,1);for(w=Y(w,2),y=Y(y,2);!S(w);){var v=A.add(w);v.l(E)<=0&&(T=T.add(y),A=v),w=Y(w,1),y=Y(y,1)}return _=D(E,T.j(_)),new V(T,_)}for(T=g;E.l(_)>=0;){for(y=Math.max(1,Math.floor(E.m()/_.m())),w=Math.ceil(Math.log(y)/Math.LN2),w=w<=48?1:Math.pow(2,w-48),A=h(y),v=A.j(_);C(v)||v.l(E)>0;)y-=w,A=h(y),v=A.j(_);S(A)&&(A=m),T=T.add(A),E=D(E,v)}return new V(T,E)}n.B=function(E){return U(this,E).h},n.and=function(E){const _=Math.max(this.g.length,E.g.length),y=[];for(let w=0;w<_;w++)y[w]=this.i(w)&E.i(w);return new a(y,this.h&E.h)},n.or=function(E){const _=Math.max(this.g.length,E.g.length),y=[];for(let w=0;w<_;w++)y[w]=this.i(w)|E.i(w);return new a(y,this.h|E.h)},n.xor=function(E){const _=Math.max(this.g.length,E.g.length),y=[];for(let w=0;w<_;w++)y[w]=this.i(w)^E.i(w);return new a(y,this.h^E.h)};function G(E){const _=E.g.length+1,y=[];for(let w=0;w<_;w++)y[w]=E.i(w)<<1|E.i(w-1)>>>31;return new a(y,E.h)}function Y(E,_){const y=_>>5;_%=32;const w=E.g.length-y,T=[];for(let A=0;A<w;A++)T[A]=_>0?E.i(A+y)>>>_|E.i(A+y+1)<<32-_:E.i(A+y);return new a(T,E.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,sd=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=d,mn=a}).apply(typeof xl<"u"?xl:typeof self<"u"?self:typeof window<"u"?window:{});var mi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var id,ms,od,Ii,Ua,ad,cd,ud;(function(){var n,e=Object.defineProperty;function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof mi=="object"&&mi];for(var u=0;u<o.length;++u){var f=o[u];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var r=t(this);function s(o,u){if(u)e:{var f=r;o=o.split(".");for(var p=0;p<o.length-1;p++){var b=o[p];if(!(b in f))break e;f=f[b]}o=o[o.length-1],p=f[o],u=u(p),u!=p&&u!=null&&e(f,o,{configurable:!0,writable:!0,value:u})}}s("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(o){return o||function(u){var f=[],p;for(p in u)Object.prototype.hasOwnProperty.call(u,p)&&f.push([p,u[p]]);return f}});var i=i||{},a=this||self;function c(o){var u=typeof o;return u=="object"&&o!=null||u=="function"}function l(o,u,f){return o.call.apply(o.bind,arguments)}function h(o,u,f){return h=l,h.apply(null,arguments)}function d(o,u){var f=Array.prototype.slice.call(arguments,1);return function(){var p=f.slice();return p.push.apply(p,arguments),o.apply(this,p)}}function g(o,u){function f(){}f.prototype=u.prototype,o.Z=u.prototype,o.prototype=new f,o.prototype.constructor=o,o.Ob=function(p,b,R){for(var O=Array(arguments.length-2),W=2;W<arguments.length;W++)O[W-2]=arguments[W];return u.prototype[b].apply(p,O)}}var m=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function I(o){const u=o.length;if(u>0){const f=Array(u);for(let p=0;p<u;p++)f[p]=o[p];return f}return[]}function S(o,u){for(let p=1;p<arguments.length;p++){const b=arguments[p];var f=typeof b;if(f=f!="object"?f:b?Array.isArray(b)?"array":f:"null",f=="array"||f=="object"&&typeof b.length=="number"){f=o.length||0;const R=b.length||0;o.length=f+R;for(let O=0;O<R;O++)o[f+O]=b[O]}else o.push(b)}}class C{constructor(u,f){this.i=u,this.j=f,this.h=0,this.g=null}get(){let u;return this.h>0?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function P(o){a.setTimeout(()=>{throw o},0)}function D(){var o=E;let u=null;return o.g&&(u=o.g,o.g=o.g.next,o.g||(o.h=null),u.next=null),u}class M{constructor(){this.h=this.g=null}add(u,f){const p=V.get();p.set(u,f),this.h?this.h.next=p:this.g=p,this.h=p}}var V=new C(()=>new U,o=>o.reset());class U{constructor(){this.next=this.g=this.h=null}set(u,f){this.h=u,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let G,Y=!1,E=new M,_=()=>{const o=Promise.resolve(void 0);G=()=>{o.then(y)}};function y(){for(var o;o=D();){try{o.h.call(o.g)}catch(f){P(f)}var u=V;u.j(o),u.h<100&&(u.h++,o.next=u.g,u.g=o)}Y=!1}function w(){this.u=this.u,this.C=this.C}w.prototype.u=!1,w.prototype.dispose=function(){this.u||(this.u=!0,this.N())},w.prototype[Symbol.dispose]=function(){this.dispose()},w.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function T(o,u){this.type=o,this.g=this.target=u,this.defaultPrevented=!1}T.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,u=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const f=()=>{};a.addEventListener("test",f,u),a.removeEventListener("test",f,u)}catch{}return o})();function v(o){return/^[\s\xa0]*$/.test(o)}function ve(o,u){T.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,u)}g(ve,T),ve.prototype.init=function(o,u){const f=this.type=o.type,p=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=u,u=o.relatedTarget,u||(f=="mouseover"?u=o.fromElement:f=="mouseout"&&(u=o.toElement)),this.relatedTarget=u,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&ve.Z.h.call(this)},ve.prototype.h=function(){ve.Z.h.call(this);const o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var qe="closure_listenable_"+(Math.random()*1e6|0),Qt=0;function rr(o,u,f,p,b){this.listener=o,this.proxy=null,this.src=u,this.type=f,this.capture=!!p,this.ha=b,this.key=++Qt,this.da=this.fa=!1}function ct(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function ze(o,u,f){for(const p in o)u.call(f,o[p],p,o)}function sr(o,u){for(const f in o)u.call(void 0,o[f],f,o)}function Xr(o){const u={};for(const f in o)u[f]=o[f];return u}const Xt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Jr(o,u){let f,p;for(let b=1;b<arguments.length;b++){p=arguments[b];for(f in p)o[f]=p[f];for(let R=0;R<Xt.length;R++)f=Xt[R],Object.prototype.hasOwnProperty.call(p,f)&&(o[f]=p[f])}}function ei(o){this.src=o,this.g={},this.h=0}ei.prototype.add=function(o,u,f,p,b){const R=o.toString();o=this.g[R],o||(o=this.g[R]=[],this.h++);const O=Uo(o,u,p,b);return O>-1?(u=o[O],f||(u.fa=!1)):(u=new rr(u,this.src,R,!!p,b),u.fa=f,o.push(u)),u};function Fo(o,u){const f=u.type;if(f in o.g){var p=o.g[f],b=Array.prototype.indexOf.call(p,u,void 0),R;(R=b>=0)&&Array.prototype.splice.call(p,b,1),R&&(ct(u),o.g[f].length==0&&(delete o.g[f],o.h--))}}function Uo(o,u,f,p){for(let b=0;b<o.length;++b){const R=o[b];if(!R.da&&R.listener==u&&R.capture==!!f&&R.ha==p)return b}return-1}var Bo="closure_lm_"+(Math.random()*1e6|0),$o={};function gu(o,u,f,p,b){if(Array.isArray(u)){for(let R=0;R<u.length;R++)gu(o,u[R],f,p,b);return null}return f=vu(f),o&&o[qe]?o.J(u,f,c(p)?!!p.capture:!1,b):gm(o,u,f,!1,p,b)}function gm(o,u,f,p,b,R){if(!u)throw Error("Invalid event type");const O=c(b)?!!b.capture:!!b;let W=qo(o);if(W||(o[Bo]=W=new ei(o)),f=W.add(u,f,p,O,R),f.proxy)return f;if(p=_m(),f.proxy=p,p.src=o,p.listener=f,o.addEventListener)A||(b=O),b===void 0&&(b=!1),o.addEventListener(u.toString(),p,b);else if(o.attachEvent)o.attachEvent(yu(u.toString()),p);else if(o.addListener&&o.removeListener)o.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return f}function _m(){function o(f){return u.call(o.src,o.listener,f)}const u=ym;return o}function _u(o,u,f,p,b){if(Array.isArray(u))for(var R=0;R<u.length;R++)_u(o,u[R],f,p,b);else p=c(p)?!!p.capture:!!p,f=vu(f),o&&o[qe]?(o=o.i,R=String(u).toString(),R in o.g&&(u=o.g[R],f=Uo(u,f,p,b),f>-1&&(ct(u[f]),Array.prototype.splice.call(u,f,1),u.length==0&&(delete o.g[R],o.h--)))):o&&(o=qo(o))&&(u=o.g[u.toString()],o=-1,u&&(o=Uo(u,f,p,b)),(f=o>-1?u[o]:null)&&jo(f))}function jo(o){if(typeof o!="number"&&o&&!o.da){var u=o.src;if(u&&u[qe])Fo(u.i,o);else{var f=o.type,p=o.proxy;u.removeEventListener?u.removeEventListener(f,p,o.capture):u.detachEvent?u.detachEvent(yu(f),p):u.addListener&&u.removeListener&&u.removeListener(p),(f=qo(u))?(Fo(f,o),f.h==0&&(f.src=null,u[Bo]=null)):ct(o)}}}function yu(o){return o in $o?$o[o]:$o[o]="on"+o}function ym(o,u){if(o.da)o=!0;else{u=new ve(u,this);const f=o.listener,p=o.ha||o.src;o.fa&&jo(o),o=f.call(p,u)}return o}function qo(o){return o=o[Bo],o instanceof ei?o:null}var zo="__closure_events_fn_"+(Math.random()*1e9>>>0);function vu(o){return typeof o=="function"?o:(o[zo]||(o[zo]=function(u){return o.handleEvent(u)}),o[zo])}function Ne(){w.call(this),this.i=new ei(this),this.M=this,this.G=null}g(Ne,w),Ne.prototype[qe]=!0,Ne.prototype.removeEventListener=function(o,u,f,p){_u(this,o,u,f,p)};function Ue(o,u){var f,p=o.G;if(p)for(f=[];p;p=p.G)f.push(p);if(o=o.M,p=u.type||u,typeof u=="string")u=new T(u,o);else if(u instanceof T)u.target=u.target||o;else{var b=u;u=new T(p,o),Jr(u,b)}b=!0;let R,O;if(f)for(O=f.length-1;O>=0;O--)R=u.g=f[O],b=ti(R,p,!0,u)&&b;if(R=u.g=o,b=ti(R,p,!0,u)&&b,b=ti(R,p,!1,u)&&b,f)for(O=0;O<f.length;O++)R=u.g=f[O],b=ti(R,p,!1,u)&&b}Ne.prototype.N=function(){if(Ne.Z.N.call(this),this.i){var o=this.i;for(const u in o.g){const f=o.g[u];for(let p=0;p<f.length;p++)ct(f[p]);delete o.g[u],o.h--}}this.G=null},Ne.prototype.J=function(o,u,f,p){return this.i.add(String(o),u,!1,f,p)},Ne.prototype.K=function(o,u,f,p){return this.i.add(String(o),u,!0,f,p)};function ti(o,u,f,p){if(u=o.i.g[String(u)],!u)return!0;u=u.concat();let b=!0;for(let R=0;R<u.length;++R){const O=u[R];if(O&&!O.da&&O.capture==f){const W=O.listener,Ee=O.ha||O.src;O.fa&&Fo(o.i,O),b=W.call(Ee,p)!==!1&&b}}return b&&!p.defaultPrevented}function vm(o,u){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=h(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(u)>2147483647?-1:a.setTimeout(o,u||0)}function Eu(o){o.g=vm(()=>{o.g=null,o.i&&(o.i=!1,Eu(o))},o.l);const u=o.h;o.h=null,o.m.apply(null,u)}class Em extends w{constructor(u,f){super(),this.m=u,this.l=f,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:Eu(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Yr(o){w.call(this),this.h=o,this.g={}}g(Yr,w);var Tu=[];function Iu(o){ze(o.g,function(u,f){this.g.hasOwnProperty(f)&&jo(u)},o),o.g={}}Yr.prototype.N=function(){Yr.Z.N.call(this),Iu(this)},Yr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ho=a.JSON.stringify,Tm=a.JSON.parse,Im=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function wu(){}function Au(){}var Zr={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Wo(){T.call(this,"d")}g(Wo,T);function Go(){T.call(this,"c")}g(Go,T);var Pn={},bu=null;function ni(){return bu=bu||new Ne}Pn.Ia="serverreachability";function Su(o){T.call(this,Pn.Ia,o)}g(Su,T);function es(o){const u=ni();Ue(u,new Su(u))}Pn.STAT_EVENT="statevent";function Ru(o,u){T.call(this,Pn.STAT_EVENT,o),this.stat=u}g(Ru,T);function Be(o){const u=ni();Ue(u,new Ru(u,o))}Pn.Ja="timingevent";function Pu(o,u){T.call(this,Pn.Ja,o),this.size=u}g(Pu,T);function ts(o,u){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},u)}function ns(){this.g=!0}ns.prototype.ua=function(){this.g=!1};function wm(o,u,f,p,b,R){o.info(function(){if(o.g)if(R){var O="",W=R.split("&");for(let ne=0;ne<W.length;ne++){var Ee=W[ne].split("=");if(Ee.length>1){const Ae=Ee[0];Ee=Ee[1];const mt=Ae.split("_");O=mt.length>=2&&mt[1]=="type"?O+(Ae+"="+Ee+"&"):O+(Ae+"=redacted&")}}}else O=null;else O=R;return"XMLHTTP REQ ("+p+") [attempt "+b+"]: "+u+`
`+f+`
`+O})}function Am(o,u,f,p,b,R,O){o.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+b+"]: "+u+`
`+f+`
`+R+" "+O})}function ir(o,u,f,p){o.info(function(){return"XMLHTTP TEXT ("+u+"): "+Sm(o,f)+(p?" "+p:"")})}function bm(o,u){o.info(function(){return"TIMEOUT: "+u})}ns.prototype.info=function(){};function Sm(o,u){if(!o.g)return u;if(!u)return null;try{const R=JSON.parse(u);if(R){for(o=0;o<R.length;o++)if(Array.isArray(R[o])){var f=R[o];if(!(f.length<2)){var p=f[1];if(Array.isArray(p)&&!(p.length<1)){var b=p[0];if(b!="noop"&&b!="stop"&&b!="close")for(let O=1;O<p.length;O++)p[O]=""}}}}return Ho(R)}catch{return u}}var ri={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Cu={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},ku;function Ko(){}g(Ko,wu),Ko.prototype.g=function(){return new XMLHttpRequest},ku=new Ko;function rs(o){return encodeURIComponent(String(o))}function Rm(o){var u=1;o=o.split(":");const f=[];for(;u>0&&o.length;)f.push(o.shift()),u--;return o.length&&f.push(o.join(":")),f}function Jt(o,u,f,p){this.j=o,this.i=u,this.l=f,this.S=p||1,this.V=new Yr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Nu}function Nu(){this.i=null,this.g="",this.h=!1}var Du={},Qo={};function Xo(o,u,f){o.M=1,o.A=ii(pt(u)),o.u=f,o.R=!0,Vu(o,null)}function Vu(o,u){o.F=Date.now(),si(o),o.B=pt(o.A);var f=o.B,p=o.S;Array.isArray(p)||(p=[String(p)]),Wu(f.i,"t",p),o.C=0,f=o.j.L,o.h=new Nu,o.g=ll(o.j,f?u:null,!o.u),o.P>0&&(o.O=new Em(h(o.Y,o,o.g),o.P)),u=o.V,f=o.g,p=o.ba;var b="readystatechange";Array.isArray(b)||(b&&(Tu[0]=b.toString()),b=Tu);for(let R=0;R<b.length;R++){const O=gu(f,b[R],p||u.handleEvent,!1,u.h||u);if(!O)break;u.g[O.key]=O}u=o.J?Xr(o.J):{},o.u?(o.v||(o.v="POST"),u["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,u)):(o.v="GET",o.g.ea(o.B,o.v,null,u)),es(),wm(o.i,o.v,o.B,o.l,o.S,o.u)}Jt.prototype.ba=function(o){o=o.target;const u=this.O;u&&en(o)==3?u.j():this.Y(o)},Jt.prototype.Y=function(o){try{if(o==this.g)e:{const W=en(this.g),Ee=this.g.ya(),ne=this.g.ca();if(!(W<3)&&(W!=3||this.g&&(this.h.h||this.g.la()||Zu(this.g)))){this.K||W!=4||Ee==7||(Ee==8||ne<=0?es(3):es(2)),Jo(this);var u=this.g.ca();this.X=u;var f=Pm(this);if(this.o=u==200,Am(this.i,this.v,this.B,this.l,this.S,W,u),this.o){if(this.U&&!this.L){t:{if(this.g){var p,b=this.g;if((p=b.g?b.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!v(p)){var R=p;break t}}R=null}if(o=R)ir(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Yo(this,o);else{this.o=!1,this.m=3,Be(12),Cn(this),ss(this);break e}}if(this.R){o=!0;let Ae;for(;!this.K&&this.C<f.length;)if(Ae=Cm(this,f),Ae==Qo){W==4&&(this.m=4,Be(14),o=!1),ir(this.i,this.l,null,"[Incomplete Response]");break}else if(Ae==Du){this.m=4,Be(15),ir(this.i,this.l,f,"[Invalid Chunk]"),o=!1;break}else ir(this.i,this.l,Ae,null),Yo(this,Ae);if(Ou(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),W!=4||f.length!=0||this.h.h||(this.m=1,Be(16),o=!1),this.o=this.o&&o,!o)ir(this.i,this.l,f,"[Invalid Chunked Response]"),Cn(this),ss(this);else if(f.length>0&&!this.W){this.W=!0;var O=this.j;O.g==this&&O.aa&&!O.P&&(O.j.info("Great, no buffering proxy detected. Bytes received: "+f.length),oa(O),O.P=!0,Be(11))}}else ir(this.i,this.l,f,null),Yo(this,f);W==4&&Cn(this),this.o&&!this.K&&(W==4?ol(this.j,this):(this.o=!1,si(this)))}else qm(this.g),u==400&&f.indexOf("Unknown SID")>0?(this.m=3,Be(12)):(this.m=0,Be(13)),Cn(this),ss(this)}}}catch{}finally{}};function Pm(o){if(!Ou(o))return o.g.la();const u=Zu(o.g);if(u==="")return"";let f="";const p=u.length,b=en(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return Cn(o),ss(o),"";o.h.i=new a.TextDecoder}for(let R=0;R<p;R++)o.h.h=!0,f+=o.h.i.decode(u[R],{stream:!(b&&R==p-1)});return u.length=0,o.h.g+=f,o.C=0,o.h.g}function Ou(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function Cm(o,u){var f=o.C,p=u.indexOf(`
`,f);return p==-1?Qo:(f=Number(u.substring(f,p)),isNaN(f)?Du:(p+=1,p+f>u.length?Qo:(u=u.slice(p,p+f),o.C=p+f,u)))}Jt.prototype.cancel=function(){this.K=!0,Cn(this)};function si(o){o.T=Date.now()+o.H,Mu(o,o.H)}function Mu(o,u){if(o.D!=null)throw Error("WatchDog timer not null");o.D=ts(h(o.aa,o),u)}function Jo(o){o.D&&(a.clearTimeout(o.D),o.D=null)}Jt.prototype.aa=function(){this.D=null;const o=Date.now();o-this.T>=0?(bm(this.i,this.B),this.M!=2&&(es(),Be(17)),Cn(this),this.m=2,ss(this)):Mu(this,this.T-o)};function ss(o){o.j.I==0||o.K||ol(o.j,o)}function Cn(o){Jo(o);var u=o.O;u&&typeof u.dispose=="function"&&u.dispose(),o.O=null,Iu(o.V),o.g&&(u=o.g,o.g=null,u.abort(),u.dispose())}function Yo(o,u){try{var f=o.j;if(f.I!=0&&(f.g==o||Zo(f.h,o))){if(!o.L&&Zo(f.h,o)&&f.I==3){try{var p=f.Ba.g.parse(u)}catch{p=null}if(Array.isArray(p)&&p.length==3){var b=p;if(b[0]==0){e:if(!f.v){if(f.g)if(f.g.F+3e3<o.F)li(f),ci(f);else break e;ia(f),Be(18)}}else f.xa=b[1],0<f.xa-f.K&&b[2]<37500&&f.F&&f.A==0&&!f.C&&(f.C=ts(h(f.Va,f),6e3));Fu(f.h)<=1&&f.ta&&(f.ta=void 0)}else Nn(f,11)}else if((o.L||f.g==o)&&li(f),!v(u))for(b=f.Ba.g.parse(u),u=0;u<b.length;u++){let ne=b[u];const Ae=ne[0];if(!(Ae<=f.K))if(f.K=Ae,ne=ne[1],f.I==2)if(ne[0]=="c"){f.M=ne[1],f.ba=ne[2];const mt=ne[3];mt!=null&&(f.ka=mt,f.j.info("VER="+f.ka));const Dn=ne[4];Dn!=null&&(f.za=Dn,f.j.info("SVER="+f.za));const tn=ne[5];tn!=null&&typeof tn=="number"&&tn>0&&(p=1.5*tn,f.O=p,f.j.info("backChannelRequestTimeoutMs_="+p)),p=f;const nn=o.g;if(nn){const fi=nn.g?nn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(fi){var R=p.h;R.g||fi.indexOf("spdy")==-1&&fi.indexOf("quic")==-1&&fi.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(ea(R,R.h),R.h=null))}if(p.G){const aa=nn.g?nn.g.getResponseHeader("X-HTTP-Session-Id"):null;aa&&(p.wa=aa,oe(p.J,p.G,aa))}}f.I=3,f.l&&f.l.ra(),f.aa&&(f.T=Date.now()-o.F,f.j.info("Handshake RTT: "+f.T+"ms")),p=f;var O=o;if(p.na=ul(p,p.L?p.ba:null,p.W),O.L){Uu(p.h,O);var W=O,Ee=p.O;Ee&&(W.H=Ee),W.D&&(Jo(W),si(W)),p.g=O}else sl(p);f.i.length>0&&ui(f)}else ne[0]!="stop"&&ne[0]!="close"||Nn(f,7);else f.I==3&&(ne[0]=="stop"||ne[0]=="close"?ne[0]=="stop"?Nn(f,7):sa(f):ne[0]!="noop"&&f.l&&f.l.qa(ne),f.A=0)}}es(4)}catch{}}var km=class{constructor(o,u){this.g=o,this.map=u}};function Lu(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function xu(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Fu(o){return o.h?1:o.g?o.g.size:0}function Zo(o,u){return o.h?o.h==u:o.g?o.g.has(u):!1}function ea(o,u){o.g?o.g.add(u):o.h=u}function Uu(o,u){o.h&&o.h==u?o.h=null:o.g&&o.g.has(u)&&o.g.delete(u)}Lu.prototype.cancel=function(){if(this.i=Bu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function Bu(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let u=o.i;for(const f of o.g.values())u=u.concat(f.G);return u}return I(o.i)}var $u=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Nm(o,u){if(o){o=o.split("&");for(let f=0;f<o.length;f++){const p=o[f].indexOf("=");let b,R=null;p>=0?(b=o[f].substring(0,p),R=o[f].substring(p+1)):b=o[f],u(b,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function Yt(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let u;o instanceof Yt?(this.l=o.l,is(this,o.j),this.o=o.o,this.g=o.g,os(this,o.u),this.h=o.h,ta(this,Gu(o.i)),this.m=o.m):o&&(u=String(o).match($u))?(this.l=!1,is(this,u[1]||"",!0),this.o=as(u[2]||""),this.g=as(u[3]||"",!0),os(this,u[4]),this.h=as(u[5]||"",!0),ta(this,u[6]||"",!0),this.m=as(u[7]||"")):(this.l=!1,this.i=new us(null,this.l))}Yt.prototype.toString=function(){const o=[];var u=this.j;u&&o.push(cs(u,ju,!0),":");var f=this.g;return(f||u=="file")&&(o.push("//"),(u=this.o)&&o.push(cs(u,ju,!0),"@"),o.push(rs(f).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.u,f!=null&&o.push(":",String(f))),(f=this.h)&&(this.g&&f.charAt(0)!="/"&&o.push("/"),o.push(cs(f,f.charAt(0)=="/"?Om:Vm,!0))),(f=this.i.toString())&&o.push("?",f),(f=this.m)&&o.push("#",cs(f,Lm)),o.join("")},Yt.prototype.resolve=function(o){const u=pt(this);let f=!!o.j;f?is(u,o.j):f=!!o.o,f?u.o=o.o:f=!!o.g,f?u.g=o.g:f=o.u!=null;var p=o.h;if(f)os(u,o.u);else if(f=!!o.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var b=u.h.lastIndexOf("/");b!=-1&&(p=u.h.slice(0,b+1)+p)}if(b=p,b==".."||b==".")p="";else if(b.indexOf("./")!=-1||b.indexOf("/.")!=-1){p=b.lastIndexOf("/",0)==0,b=b.split("/");const R=[];for(let O=0;O<b.length;){const W=b[O++];W=="."?p&&O==b.length&&R.push(""):W==".."?((R.length>1||R.length==1&&R[0]!="")&&R.pop(),p&&O==b.length&&R.push("")):(R.push(W),p=!0)}p=R.join("/")}else p=b}return f?u.h=p:f=o.i.toString()!=="",f?ta(u,Gu(o.i)):f=!!o.m,f&&(u.m=o.m),u};function pt(o){return new Yt(o)}function is(o,u,f){o.j=f?as(u,!0):u,o.j&&(o.j=o.j.replace(/:$/,""))}function os(o,u){if(u){if(u=Number(u),isNaN(u)||u<0)throw Error("Bad port number "+u);o.u=u}else o.u=null}function ta(o,u,f){u instanceof us?(o.i=u,xm(o.i,o.l)):(f||(u=cs(u,Mm)),o.i=new us(u,o.l))}function oe(o,u,f){o.i.set(u,f)}function ii(o){return oe(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function as(o,u){return o?u?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function cs(o,u,f){return typeof o=="string"?(o=encodeURI(o).replace(u,Dm),f&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Dm(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var ju=/[#\/\?@]/g,Vm=/[#\?:]/g,Om=/[#\?]/g,Mm=/[#\?@]/g,Lm=/#/g;function us(o,u){this.h=this.g=null,this.i=o||null,this.j=!!u}function kn(o){o.g||(o.g=new Map,o.h=0,o.i&&Nm(o.i,function(u,f){o.add(decodeURIComponent(u.replace(/\+/g," ")),f)}))}n=us.prototype,n.add=function(o,u){kn(this),this.i=null,o=or(this,o);let f=this.g.get(o);return f||this.g.set(o,f=[]),f.push(u),this.h+=1,this};function qu(o,u){kn(o),u=or(o,u),o.g.has(u)&&(o.i=null,o.h-=o.g.get(u).length,o.g.delete(u))}function zu(o,u){return kn(o),u=or(o,u),o.g.has(u)}n.forEach=function(o,u){kn(this),this.g.forEach(function(f,p){f.forEach(function(b){o.call(u,b,p,this)},this)},this)};function Hu(o,u){kn(o);let f=[];if(typeof u=="string")zu(o,u)&&(f=f.concat(o.g.get(or(o,u))));else for(o=Array.from(o.g.values()),u=0;u<o.length;u++)f=f.concat(o[u]);return f}n.set=function(o,u){return kn(this),this.i=null,o=or(this,o),zu(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[u]),this.h+=1,this},n.get=function(o,u){return o?(o=Hu(this,o),o.length>0?String(o[0]):u):u};function Wu(o,u,f){qu(o,u),f.length>0&&(o.i=null,o.g.set(or(o,u),I(f)),o.h+=f.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],u=Array.from(this.g.keys());for(let p=0;p<u.length;p++){var f=u[p];const b=rs(f);f=Hu(this,f);for(let R=0;R<f.length;R++){let O=b;f[R]!==""&&(O+="="+rs(f[R])),o.push(O)}}return this.i=o.join("&")};function Gu(o){const u=new us;return u.i=o.i,o.g&&(u.g=new Map(o.g),u.h=o.h),u}function or(o,u){return u=String(u),o.j&&(u=u.toLowerCase()),u}function xm(o,u){u&&!o.j&&(kn(o),o.i=null,o.g.forEach(function(f,p){const b=p.toLowerCase();p!=b&&(qu(this,p),Wu(this,b,f))},o)),o.j=u}function Fm(o,u){const f=new ns;if(a.Image){const p=new Image;p.onload=d(Zt,f,"TestLoadImage: loaded",!0,u,p),p.onerror=d(Zt,f,"TestLoadImage: error",!1,u,p),p.onabort=d(Zt,f,"TestLoadImage: abort",!1,u,p),p.ontimeout=d(Zt,f,"TestLoadImage: timeout",!1,u,p),a.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=o}else u(!1)}function Um(o,u){const f=new ns,p=new AbortController,b=setTimeout(()=>{p.abort(),Zt(f,"TestPingServer: timeout",!1,u)},1e4);fetch(o,{signal:p.signal}).then(R=>{clearTimeout(b),R.ok?Zt(f,"TestPingServer: ok",!0,u):Zt(f,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(b),Zt(f,"TestPingServer: error",!1,u)})}function Zt(o,u,f,p,b){try{b&&(b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null),p(f)}catch{}}function Bm(){this.g=new Im}function na(o){this.i=o.Sb||null,this.h=o.ab||!1}g(na,wu),na.prototype.g=function(){return new oi(this.i,this.h)};function oi(o,u){Ne.call(this),this.H=o,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(oi,Ne),n=oi.prototype,n.open=function(o,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=u,this.readyState=1,hs(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const u={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(u.body=o),(this.H||a).fetch(new Request(this.D,u)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,ls(this)),this.readyState=0},n.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,hs(this)),this.g&&(this.readyState=3,hs(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ku(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function Ku(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}n.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var u=o.value?o.value:new Uint8Array(0);(u=this.B.decode(u,{stream:!o.done}))&&(this.response=this.responseText+=u)}o.done?ls(this):hs(this),this.readyState==3&&Ku(this)}},n.Oa=function(o){this.g&&(this.response=this.responseText=o,ls(this))},n.Na=function(o){this.g&&(this.response=o,ls(this))},n.ga=function(){this.g&&ls(this)};function ls(o){o.readyState=4,o.l=null,o.j=null,o.B=null,hs(o)}n.setRequestHeader=function(o,u){this.A.append(o,u)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],u=this.h.entries();for(var f=u.next();!f.done;)f=f.value,o.push(f[0]+": "+f[1]),f=u.next();return o.join(`\r
`)};function hs(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(oi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function Qu(o){let u="";return ze(o,function(f,p){u+=p,u+=":",u+=f,u+=`\r
`}),u}function ra(o,u,f){e:{for(p in f){var p=!1;break e}p=!0}p||(f=Qu(f),typeof o=="string"?f!=null&&rs(f):oe(o,u,f))}function de(o){Ne.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(de,Ne);var $m=/^https?$/i,jm=["POST","PUT"];n=de.prototype,n.Fa=function(o){this.H=o},n.ea=function(o,u,f,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);u=u?u.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():ku.g(),this.g.onreadystatechange=m(h(this.Ca,this));try{this.B=!0,this.g.open(u,String(o),!0),this.B=!1}catch(R){Xu(this,R);return}if(o=f||"",f=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var b in p)f.set(b,p[b]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const R of p.keys())f.set(R,p.get(R));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(f.keys()).find(R=>R.toLowerCase()=="content-type"),b=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(jm,u,void 0)>=0)||p||b||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[R,O]of f)this.g.setRequestHeader(R,O);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(R){Xu(this,R)}};function Xu(o,u){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=u,o.o=5,Ju(o),ai(o)}function Ju(o){o.A||(o.A=!0,Ue(o,"complete"),Ue(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,Ue(this,"complete"),Ue(this,"abort"),ai(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ai(this,!0)),de.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Yu(this):this.Xa())},n.Xa=function(){Yu(this)};function Yu(o){if(o.h&&typeof i<"u"){if(o.v&&en(o)==4)setTimeout(o.Ca.bind(o),0);else if(Ue(o,"readystatechange"),en(o)==4){o.h=!1;try{const R=o.ca();e:switch(R){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var f;if(!(f=u)){var p;if(p=R===0){let O=String(o.D).match($u)[1]||null;!O&&a.self&&a.self.location&&(O=a.self.location.protocol.slice(0,-1)),p=!$m.test(O?O.toLowerCase():"")}f=p}if(f)Ue(o,"complete"),Ue(o,"success");else{o.o=6;try{var b=en(o)>2?o.g.statusText:""}catch{b=""}o.l=b+" ["+o.ca()+"]",Ju(o)}}finally{ai(o)}}}}function ai(o,u){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);const f=o.g;o.g=null,u||Ue(o,"ready");try{f.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function en(o){return o.g?o.g.readyState:0}n.ca=function(){try{return en(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(o){if(this.g){var u=this.g.responseText;return o&&u.indexOf(o)==0&&(u=u.substring(o.length)),Tm(u)}};function Zu(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function qm(o){const u={};o=(o.g&&en(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<o.length;p++){if(v(o[p]))continue;var f=Rm(o[p]);const b=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();const R=u[b]||[];u[b]=R,R.push(f)}sr(u,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function fs(o,u,f){return f&&f.internalChannelParams&&f.internalChannelParams[o]||u}function el(o){this.za=0,this.i=[],this.j=new ns,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=fs("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=fs("baseRetryDelayMs",5e3,o),this.Za=fs("retryDelaySeedMs",1e4,o),this.Ta=fs("forwardChannelMaxRetries",2,o),this.va=fs("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new Lu(o&&o.concurrentRequestLimit),this.Ba=new Bm,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=el.prototype,n.ka=8,n.I=1,n.connect=function(o,u,f,p){Be(0),this.W=o,this.H=u||{},f&&p!==void 0&&(this.H.OSID=f,this.H.OAID=p),this.F=this.X,this.J=ul(this,null,this.W),ui(this)};function sa(o){if(tl(o),o.I==3){var u=o.V++,f=pt(o.J);if(oe(f,"SID",o.M),oe(f,"RID",u),oe(f,"TYPE","terminate"),ds(o,f),u=new Jt(o,o.j,u),u.M=2,u.A=ii(pt(f)),f=!1,a.navigator&&a.navigator.sendBeacon)try{f=a.navigator.sendBeacon(u.A.toString(),"")}catch{}!f&&a.Image&&(new Image().src=u.A,f=!0),f||(u.g=ll(u.j,null),u.g.ea(u.A)),u.F=Date.now(),si(u)}cl(o)}function ci(o){o.g&&(oa(o),o.g.cancel(),o.g=null)}function tl(o){ci(o),o.v&&(a.clearTimeout(o.v),o.v=null),li(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function ui(o){if(!xu(o.h)&&!o.m){o.m=!0;var u=o.Ea;G||_(),Y||(G(),Y=!0),E.add(u,o),o.D=0}}function zm(o,u){return Fu(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=u.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=ts(h(o.Ea,o,u),al(o,o.D)),o.D++,!0)}n.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;const b=new Jt(this,this.j,o);let R=this.o;if(this.U&&(R?(R=Xr(R),Jr(R,this.U)):R=this.U),this.u!==null||this.R||(b.J=R,R=null),this.S)e:{for(var u=0,f=0;f<this.i.length;f++){t:{var p=this.i[f];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(u+=p,u>4096){u=f;break e}if(u===4096||f===this.i.length-1){u=f+1;break e}}u=1e3}else u=1e3;u=rl(this,b,u),f=pt(this.J),oe(f,"RID",o),oe(f,"CVER",22),this.G&&oe(f,"X-HTTP-Session-Id",this.G),ds(this,f),R&&(this.R?u="headers="+rs(Qu(R))+"&"+u:this.u&&ra(f,this.u,R)),ea(this.h,b),this.Ra&&oe(f,"TYPE","init"),this.S?(oe(f,"$req",u),oe(f,"SID","null"),b.U=!0,Xo(b,f,null)):Xo(b,f,u),this.I=2}}else this.I==3&&(o?nl(this,o):this.i.length==0||xu(this.h)||nl(this))};function nl(o,u){var f;u?f=u.l:f=o.V++;const p=pt(o.J);oe(p,"SID",o.M),oe(p,"RID",f),oe(p,"AID",o.K),ds(o,p),o.u&&o.o&&ra(p,o.u,o.o),f=new Jt(o,o.j,f,o.D+1),o.u===null&&(f.J=o.o),u&&(o.i=u.G.concat(o.i)),u=rl(o,f,1e3),f.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),ea(o.h,f),Xo(f,p,u)}function ds(o,u){o.H&&ze(o.H,function(f,p){oe(u,p,f)}),o.l&&ze({},function(f,p){oe(u,p,f)})}function rl(o,u,f){f=Math.min(o.i.length,f);const p=o.l?h(o.l.Ka,o.l,o):null;e:{var b=o.i;let W=-1;for(;;){const Ee=["count="+f];W==-1?f>0?(W=b[0].g,Ee.push("ofs="+W)):W=0:Ee.push("ofs="+W);let ne=!0;for(let Ae=0;Ae<f;Ae++){var R=b[Ae].g;const mt=b[Ae].map;if(R-=W,R<0)W=Math.max(0,b[Ae].g-100),ne=!1;else try{R="req"+R+"_"||"";try{var O=mt instanceof Map?mt:Object.entries(mt);for(const[Dn,tn]of O){let nn=tn;c(tn)&&(nn=Ho(tn)),Ee.push(R+Dn+"="+encodeURIComponent(nn))}}catch(Dn){throw Ee.push(R+"type="+encodeURIComponent("_badmap")),Dn}}catch{p&&p(mt)}}if(ne){O=Ee.join("&");break e}}O=void 0}return o=o.i.splice(0,f),u.G=o,O}function sl(o){if(!o.g&&!o.v){o.Y=1;var u=o.Da;G||_(),Y||(G(),Y=!0),E.add(u,o),o.A=0}}function ia(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=ts(h(o.Da,o),al(o,o.A)),o.A++,!0)}n.Da=function(){if(this.v=null,il(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=ts(h(this.Wa,this),o)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Be(10),ci(this),il(this))};function oa(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function il(o){o.g=new Jt(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var u=pt(o.na);oe(u,"RID","rpc"),oe(u,"SID",o.M),oe(u,"AID",o.K),oe(u,"CI",o.F?"0":"1"),!o.F&&o.ia&&oe(u,"TO",o.ia),oe(u,"TYPE","xmlhttp"),ds(o,u),o.u&&o.o&&ra(u,o.u,o.o),o.O&&(o.g.H=o.O);var f=o.g;o=o.ba,f.M=1,f.A=ii(pt(u)),f.u=null,f.R=!0,Vu(f,o)}n.Va=function(){this.C!=null&&(this.C=null,ci(this),ia(this),Be(19))};function li(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function ol(o,u){var f=null;if(o.g==u){li(o),oa(o),o.g=null;var p=2}else if(Zo(o.h,u))f=u.G,Uu(o.h,u),p=1;else return;if(o.I!=0){if(u.o)if(p==1){f=u.u?u.u.length:0,u=Date.now()-u.F;var b=o.D;p=ni(),Ue(p,new Pu(p,f)),ui(o)}else sl(o);else if(b=u.m,b==3||b==0&&u.X>0||!(p==1&&zm(o,u)||p==2&&ia(o)))switch(f&&f.length>0&&(u=o.h,u.i=u.i.concat(f)),b){case 1:Nn(o,5);break;case 4:Nn(o,10);break;case 3:Nn(o,6);break;default:Nn(o,2)}}}function al(o,u){let f=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(f*=2),f*u}function Nn(o,u){if(o.j.info("Error code "+u),u==2){var f=h(o.bb,o),p=o.Ua;const b=!p;p=new Yt(p||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||is(p,"https"),ii(p),b?Fm(p.toString(),f):Um(p.toString(),f)}else Be(2);o.I=0,o.l&&o.l.pa(u),cl(o),tl(o)}n.bb=function(o){o?(this.j.info("Successfully pinged google.com"),Be(2)):(this.j.info("Failed to ping google.com"),Be(1))};function cl(o){if(o.I=0,o.ja=[],o.l){const u=Bu(o.h);(u.length!=0||o.i.length!=0)&&(S(o.ja,u),S(o.ja,o.i),o.h.i.length=0,I(o.i),o.i.length=0),o.l.oa()}}function ul(o,u,f){var p=f instanceof Yt?pt(f):new Yt(f);if(p.g!="")u&&(p.g=u+"."+p.g),os(p,p.u);else{var b=a.location;p=b.protocol,u=u?u+"."+b.hostname:b.hostname,b=+b.port;const R=new Yt(null);p&&is(R,p),u&&(R.g=u),b&&os(R,b),f&&(R.h=f),p=R}return f=o.G,u=o.wa,f&&u&&oe(p,f,u),oe(p,"VER",o.ka),ds(o,p),p}function ll(o,u,f){if(u&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return u=o.Aa&&!o.ma?new de(new na({ab:f})):new de(o.ma),u.Fa(o.L),u}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function hl(){}n=hl.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function hi(){}hi.prototype.g=function(o,u){return new Je(o,u)};function Je(o,u){Ne.call(this),this.g=new el(u),this.l=o,this.h=u&&u.messageUrlParams||null,o=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(o?o["X-WebChannel-Content-Type"]=u.messageContentType:o={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.sa&&(o?o["X-WebChannel-Client-Profile"]=u.sa:o={"X-WebChannel-Client-Profile":u.sa}),this.g.U=o,(o=u&&u.Qb)&&!v(o)&&(this.g.u=o),this.A=u&&u.supportsCrossDomainXhr||!1,this.v=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!v(u)&&(this.g.G=u,o=this.h,o!==null&&u in o&&(o=this.h,u in o&&delete o[u])),this.j=new ar(this)}g(Je,Ne),Je.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Je.prototype.close=function(){sa(this.g)},Je.prototype.o=function(o){var u=this.g;if(typeof o=="string"){var f={};f.__data__=o,o=f}else this.v&&(f={},f.__data__=Ho(o),o=f);u.i.push(new km(u.Ya++,o)),u.I==3&&ui(u)},Je.prototype.N=function(){this.g.l=null,delete this.j,sa(this.g),delete this.g,Je.Z.N.call(this)};function fl(o){Wo.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var u=o.__sm__;if(u){e:{for(const f in u){o=f;break e}o=void 0}(this.i=o)&&(o=this.i,u=u!==null&&o in u?u[o]:void 0),this.data=u}else this.data=o}g(fl,Wo);function dl(){Go.call(this),this.status=1}g(dl,Go);function ar(o){this.g=o}g(ar,hl),ar.prototype.ra=function(){Ue(this.g,"a")},ar.prototype.qa=function(o){Ue(this.g,new fl(o))},ar.prototype.pa=function(o){Ue(this.g,new dl)},ar.prototype.oa=function(){Ue(this.g,"b")},hi.prototype.createWebChannel=hi.prototype.g,Je.prototype.send=Je.prototype.o,Je.prototype.open=Je.prototype.m,Je.prototype.close=Je.prototype.close,ud=function(){return new hi},cd=function(){return ni()},ad=Pn,Ua={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ri.NO_ERROR=0,ri.TIMEOUT=8,ri.HTTP_ERROR=6,Ii=ri,Cu.COMPLETE="complete",od=Cu,Au.EventType=Zr,Zr.OPEN="a",Zr.CLOSE="b",Zr.ERROR="c",Zr.MESSAGE="d",Ne.prototype.listen=Ne.prototype.J,ms=Au,de.prototype.listenOnce=de.prototype.K,de.prototype.getLastError=de.prototype.Ha,de.prototype.getLastErrorCode=de.prototype.ya,de.prototype.getStatus=de.prototype.ca,de.prototype.getResponseJson=de.prototype.La,de.prototype.getResponseText=de.prototype.la,de.prototype.send=de.prototype.ea,de.prototype.setWithCredentials=de.prototype.Fa,id=de}).apply(typeof mi<"u"?mi:typeof self<"u"?self:typeof window<"u"?window:{});const Fl="@firebase/firestore",Ul="4.9.2";class Oe{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Oe.UNAUTHENTICATED=new Oe(null),Oe.GOOGLE_CREDENTIALS=new Oe("google-credentials-uid"),Oe.FIRST_PARTY=new Oe("first-party-uid"),Oe.MOCK_USER=new Oe("mock-user");let Hr="12.3.0";const Qn=new wc("@firebase/firestore");function lr(){return Qn.logLevel}function x(n,...e){if(Qn.logLevel<=K.DEBUG){const t=e.map(Sc);Qn.debug(`Firestore (${Hr}): ${n}`,...t)}}function qt(n,...e){if(Qn.logLevel<=K.ERROR){const t=e.map(Sc);Qn.error(`Firestore (${Hr}): ${n}`,...t)}}function Dr(n,...e){if(Qn.logLevel<=K.WARN){const t=e.map(Sc);Qn.warn(`Firestore (${Hr}): ${n}`,...t)}}function Sc(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function $(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,ld(n,r,t)}function ld(n,e,t){let r=`FIRESTORE (${Hr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw qt(r),new Error(r)}function te(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||ld(e,s,r)}function z(n,e){return n}const N={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class F extends Lt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Bn{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class hd{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class sv{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Oe.UNAUTHENTICATED)))}shutdown(){}}class iv{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class ov{constructor(e){this.t=e,this.currentUser=Oe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){te(this.o===void 0,42304);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new Bn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Bn,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const l=i;e.enqueueRetryable((async()=>{await l.promise,await s(this.currentUser)}))},c=l=>{x("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((l=>c(l))),setTimeout((()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?c(l):(x("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Bn)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(x("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(te(typeof r.accessToken=="string",31837,{l:r}),new hd(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return te(e===null||typeof e=="string",2055,{h:e}),new Oe(e)}}class av{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Oe.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class cv{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new av(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Oe.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Bl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class uv{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,it(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){te(this.o===void 0,3512);const r=i=>{i.error!=null&&x("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,x("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>r(i)))};const s=i=>{x("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>s(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):x("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Bl(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(te(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Bl(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function lv(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Rc{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=lv(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function Q(n,e){return n<e?-1:n>e?1:0}function Ba(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return ga(s)===ga(i)?Q(s,i):ga(s)?1:-1}return Q(n.length,e.length)}const hv=55296,fv=57343;function ga(n){const e=n.charCodeAt(0);return e>=hv&&e<=fv}function Vr(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const $l="__name__";class _t{constructor(e,t,r){t===void 0?t=0:t>e.length&&$(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&$(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return _t.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof _t?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=_t.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return Q(e.length,t.length)}static compareSegments(e,t){const r=_t.isNumericId(e),s=_t.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?_t.extractNumericId(e).compare(_t.extractNumericId(t)):Ba(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return mn.fromString(e.substring(4,e.length-2))}}class ce extends _t{construct(e,t,r){return new ce(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new F(N.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new ce(t)}static emptyPath(){return new ce([])}}const dv=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Re extends _t{construct(e,t,r){return new Re(e,t,r)}static isValidIdentifier(e){return dv.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Re.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===$l}static keyField(){return new Re([$l])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new F(N.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const c=e[s];if(c==="\\"){if(s+1===e.length)throw new F(N.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new F(N.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else c==="`"?(a=!a,s++):c!=="."||a?(r+=c,s++):(i(),s++)}if(i(),a)throw new F(N.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Re(t)}static emptyPath(){return new Re([])}}class B{constructor(e){this.path=e}static fromPath(e){return new B(ce.fromString(e))}static fromName(e){return new B(ce.fromString(e).popFirst(5))}static empty(){return new B(ce.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ce.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ce.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new B(new ce(e.slice()))}}function fd(n,e,t){if(!t)throw new F(N.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function pv(n,e,t,r){if(e===!0&&r===!0)throw new F(N.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function jl(n){if(!B.isDocumentKey(n))throw new F(N.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ql(n){if(B.isDocumentKey(n))throw new F(N.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function dd(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Pc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":$(12329,{type:typeof n})}function $n(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new F(N.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Pc(n);throw new F(N.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function _e(n,e){const t={typeString:n};return e&&(t.value=e),t}function Ws(n,e){if(!dd(n))throw new F(N.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new F(N.INVALID_ARGUMENT,t);return!0}const zl=-62135596800,Hl=1e6;class ue{static now(){return ue.fromMillis(Date.now())}static fromDate(e){return ue.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Hl);return new ue(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new F(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new F(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<zl)throw new F(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new F(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Hl}_compareTo(e){return this.seconds===e.seconds?Q(this.nanoseconds,e.nanoseconds):Q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ue._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ws(e,ue._jsonSchema))return new ue(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-zl;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ue._jsonSchemaVersion="firestore/timestamp/1.0",ue._jsonSchema={type:_e("string",ue._jsonSchemaVersion),seconds:_e("number"),nanoseconds:_e("number")};class q{static fromTimestamp(e){return new q(e)}static min(){return new q(new ue(0,0))}static max(){return new q(new ue(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Ds=-1;function mv(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=q.fromTimestamp(r===1e9?new ue(t+1,0):new ue(t,r));return new vn(s,B.empty(),e)}function gv(n){return new vn(n.readTime,n.key,Ds)}class vn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new vn(q.min(),B.empty(),Ds)}static max(){return new vn(q.max(),B.empty(),Ds)}}function _v(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=B.comparator(n.documentKey,e.documentKey),t!==0?t:Q(n.largestBatchId,e.largestBatchId))}const yv="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class vv{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Wr(n){if(n.code!==N.FAILED_PRECONDITION||n.message!==yv)throw n;x("LocalStore","Unexpectedly lost primary lease")}class k{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&$(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new k(((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof k?t:k.resolve(t)}catch(t){return k.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):k.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):k.reject(t)}static resolve(e){return new k(((t,r)=>{t(e)}))}static reject(e){return new k(((t,r)=>{r(e)}))}static waitFor(e){return new k(((t,r)=>{let s=0,i=0,a=!1;e.forEach((c=>{++s,c.next((()=>{++i,a&&i===s&&t()}),(l=>r(l)))})),a=!0,i===s&&t()}))}static or(e){let t=k.resolve(!1);for(const r of e)t=t.next((s=>s?k.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,i)=>{r.push(t.call(this,s,i))})),this.waitFor(r)}static mapArray(e,t){return new k(((r,s)=>{const i=e.length,a=new Array(i);let c=0;for(let l=0;l<i;l++){const h=l;t(e[h]).next((d=>{a[h]=d,++c,c===i&&r(a)}),(d=>s(d)))}}))}static doWhile(e,t){return new k(((r,s)=>{const i=()=>{e()===!0?t().next((()=>{i()}),s):r()};i()}))}}function Ev(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Gr(n){return n.name==="IndexedDbTransactionError"}class _o{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}_o.ce=-1;const Cc=-1;function yo(n){return n==null}function xi(n){return n===0&&1/n==-1/0}function Tv(n){return typeof n=="number"&&Number.isInteger(n)&&!xi(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const pd="";function Iv(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Wl(e)),e=wv(n.get(t),e);return Wl(e)}function wv(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case pd:t+="";break;default:t+=i}}return t}function Wl(n){return n+pd+""}function Gl(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Sn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function md(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class fe{constructor(e,t){this.comparator=e,this.root=t||Se.EMPTY}insert(e,t){return new fe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Se.BLACK,null,null))}remove(e){return new fe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Se.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new gi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new gi(this.root,e,this.comparator,!1)}getReverseIterator(){return new gi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new gi(this.root,e,this.comparator,!0)}}class gi{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Se{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Se.RED,this.left=s??Se.EMPTY,this.right=i??Se.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Se(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Se.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Se.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Se.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Se.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw $(43730,{key:this.key,value:this.value});if(this.right.isRed())throw $(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw $(27949);return e+(this.isRed()?0:1)}}Se.EMPTY=null,Se.RED=!0,Se.BLACK=!1;Se.EMPTY=new class{constructor(){this.size=0}get key(){throw $(57766)}get value(){throw $(16141)}get color(){throw $(16727)}get left(){throw $(29726)}get right(){throw $(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new Se(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class we{constructor(e){this.comparator=e,this.data=new fe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Kl(this.data.getIterator())}getIteratorFrom(e){return new Kl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof we)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new we(this.comparator);return t.data=e,t}}class Kl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class et{constructor(e){this.fields=e,e.sort(Re.comparator)}static empty(){return new et([])}unionWith(e){let t=new we(Re.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new et(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Vr(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class gd extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ke{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new gd("Invalid base64 string: "+i):i}})(e);return new ke(t)}static fromUint8Array(e){const t=(function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i})(e);return new ke(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ke.EMPTY_BYTE_STRING=new ke("");const Av=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function En(n){if(te(!!n,39018),typeof n=="string"){let e=0;const t=Av.exec(n);if(te(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:me(n.seconds),nanos:me(n.nanos)}}function me(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Tn(n){return typeof n=="string"?ke.fromBase64String(n):ke.fromUint8Array(n)}const _d="server_timestamp",yd="__type__",vd="__previous_value__",Ed="__local_write_time__";function kc(n){return(n?.mapValue?.fields||{})[yd]?.stringValue===_d}function vo(n){const e=n.mapValue.fields[vd];return kc(e)?vo(e):e}function Vs(n){const e=En(n.mapValue.fields[Ed].timestampValue);return new ue(e.seconds,e.nanos)}class bv{constructor(e,t,r,s,i,a,c,l,h,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=l,this.useFetchStreams=h,this.isUsingEmulator=d}}const Fi="(default)";class Os{constructor(e,t){this.projectId=e,this.database=t||Fi}static empty(){return new Os("","")}get isDefaultDatabase(){return this.database===Fi}isEqual(e){return e instanceof Os&&e.projectId===this.projectId&&e.database===this.database}}const Td="__type__",Sv="__max__",_i={mapValue:{}},Id="__vector__",Ui="value";function In(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?kc(n)?4:Pv(n)?9007199254740991:Rv(n)?10:11:$(28295,{value:n})}function Dt(n,e){if(n===e)return!0;const t=In(n);if(t!==In(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Vs(n).isEqual(Vs(e));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=En(s.timestampValue),c=En(i.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,i){return Tn(s.bytesValue).isEqual(Tn(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,i){return me(s.geoPointValue.latitude)===me(i.geoPointValue.latitude)&&me(s.geoPointValue.longitude)===me(i.geoPointValue.longitude)})(n,e);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return me(s.integerValue)===me(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=me(s.doubleValue),c=me(i.doubleValue);return a===c?xi(a)===xi(c):isNaN(a)&&isNaN(c)}return!1})(n,e);case 9:return Vr(n.arrayValue.values||[],e.arrayValue.values||[],Dt);case 10:case 11:return(function(s,i){const a=s.mapValue.fields||{},c=i.mapValue.fields||{};if(Gl(a)!==Gl(c))return!1;for(const l in a)if(a.hasOwnProperty(l)&&(c[l]===void 0||!Dt(a[l],c[l])))return!1;return!0})(n,e);default:return $(52216,{left:n})}}function Ms(n,e){return(n.values||[]).find((t=>Dt(t,e)))!==void 0}function Or(n,e){if(n===e)return 0;const t=In(n),r=In(e);if(t!==r)return Q(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Q(n.booleanValue,e.booleanValue);case 2:return(function(i,a){const c=me(i.integerValue||i.doubleValue),l=me(a.integerValue||a.doubleValue);return c<l?-1:c>l?1:c===l?0:isNaN(c)?isNaN(l)?0:-1:1})(n,e);case 3:return Ql(n.timestampValue,e.timestampValue);case 4:return Ql(Vs(n),Vs(e));case 5:return Ba(n.stringValue,e.stringValue);case 6:return(function(i,a){const c=Tn(i),l=Tn(a);return c.compareTo(l)})(n.bytesValue,e.bytesValue);case 7:return(function(i,a){const c=i.split("/"),l=a.split("/");for(let h=0;h<c.length&&h<l.length;h++){const d=Q(c[h],l[h]);if(d!==0)return d}return Q(c.length,l.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,a){const c=Q(me(i.latitude),me(a.latitude));return c!==0?c:Q(me(i.longitude),me(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Xl(n.arrayValue,e.arrayValue);case 10:return(function(i,a){const c=i.fields||{},l=a.fields||{},h=c[Ui]?.arrayValue,d=l[Ui]?.arrayValue,g=Q(h?.values?.length||0,d?.values?.length||0);return g!==0?g:Xl(h,d)})(n.mapValue,e.mapValue);case 11:return(function(i,a){if(i===_i.mapValue&&a===_i.mapValue)return 0;if(i===_i.mapValue)return 1;if(a===_i.mapValue)return-1;const c=i.fields||{},l=Object.keys(c),h=a.fields||{},d=Object.keys(h);l.sort(),d.sort();for(let g=0;g<l.length&&g<d.length;++g){const m=Ba(l[g],d[g]);if(m!==0)return m;const I=Or(c[l[g]],h[d[g]]);if(I!==0)return I}return Q(l.length,d.length)})(n.mapValue,e.mapValue);default:throw $(23264,{he:t})}}function Ql(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Q(n,e);const t=En(n),r=En(e),s=Q(t.seconds,r.seconds);return s!==0?s:Q(t.nanos,r.nanos)}function Xl(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Or(t[s],r[s]);if(i)return i}return Q(t.length,r.length)}function Mr(n){return $a(n)}function $a(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=En(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Tn(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return B.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=$a(i);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${$a(t.fields[a])}`;return s+"}"})(n.mapValue):$(61005,{value:n})}function wi(n){switch(In(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=vo(n);return e?16+wi(e):16;case 5:return 2*n.stringValue.length;case 6:return Tn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,i)=>s+wi(i)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return Sn(r.fields,((i,a)=>{s+=i.length+wi(a)})),s})(n.mapValue);default:throw $(13486,{value:n})}}function ja(n){return!!n&&"integerValue"in n}function Nc(n){return!!n&&"arrayValue"in n}function Jl(n){return!!n&&"nullValue"in n}function Yl(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ai(n){return!!n&&"mapValue"in n}function Rv(n){return(n?.mapValue?.fields||{})[Td]?.stringValue===Id}function Is(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Sn(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=Is(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Is(n.arrayValue.values[t]);return e}return{...n}}function Pv(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Sv}class We{constructor(e){this.value=e}static empty(){return new We({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ai(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Is(t)}setAll(e){let t=Re.emptyPath(),r={},s=[];e.forEach(((a,c)=>{if(!t.isImmediateParentOf(c)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=c.popLast()}a?r[c.lastSegment()]=Is(a):s.push(c.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Ai(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Dt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Ai(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Sn(t,((s,i)=>e[s]=i));for(const s of r)delete e[s]}clone(){return new We(Is(this.value))}}function wd(n){const e=[];return Sn(n.fields,((t,r)=>{const s=new Re([t]);if(Ai(r)){const i=wd(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)})),new et(e)}class Le{constructor(e,t,r,s,i,a,c){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=c}static newInvalidDocument(e){return new Le(e,0,q.min(),q.min(),q.min(),We.empty(),0)}static newFoundDocument(e,t,r,s){return new Le(e,1,t,q.min(),r,s,0)}static newNoDocument(e,t){return new Le(e,2,t,q.min(),q.min(),We.empty(),0)}static newUnknownDocument(e,t){return new Le(e,3,t,q.min(),q.min(),We.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(q.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=We.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=We.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Le&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Le(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Bi{constructor(e,t){this.position=e,this.inclusive=t}}function Zl(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],a=n.position[s];if(i.field.isKeyField()?r=B.comparator(B.fromName(a.referenceValue),t.key):r=Or(a,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function eh(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Dt(n.position[t],e.position[t]))return!1;return!0}class $i{constructor(e,t="asc"){this.field=e,this.dir=t}}function Cv(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Ad{}class Te extends Ad{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Nv(e,t,r):t==="array-contains"?new Ov(e,r):t==="in"?new Mv(e,r):t==="not-in"?new Lv(e,r):t==="array-contains-any"?new xv(e,r):new Te(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Dv(e,r):new Vv(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Or(t,this.value)):t!==null&&In(this.value)===In(t)&&this.matchesComparison(Or(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return $(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Vt extends Ad{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Vt(e,t)}matches(e){return bd(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function bd(n){return n.op==="and"}function Sd(n){return kv(n)&&bd(n)}function kv(n){for(const e of n.filters)if(e instanceof Vt)return!1;return!0}function qa(n){if(n instanceof Te)return n.field.canonicalString()+n.op.toString()+Mr(n.value);if(Sd(n))return n.filters.map((e=>qa(e))).join(",");{const e=n.filters.map((t=>qa(t))).join(",");return`${n.op}(${e})`}}function Rd(n,e){return n instanceof Te?(function(r,s){return s instanceof Te&&r.op===s.op&&r.field.isEqual(s.field)&&Dt(r.value,s.value)})(n,e):n instanceof Vt?(function(r,s){return s instanceof Vt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((i,a,c)=>i&&Rd(a,s.filters[c])),!0):!1})(n,e):void $(19439)}function Pd(n){return n instanceof Te?(function(t){return`${t.field.canonicalString()} ${t.op} ${Mr(t.value)}`})(n):n instanceof Vt?(function(t){return t.op.toString()+" {"+t.getFilters().map(Pd).join(" ,")+"}"})(n):"Filter"}class Nv extends Te{constructor(e,t,r){super(e,t,r),this.key=B.fromName(r.referenceValue)}matches(e){const t=B.comparator(e.key,this.key);return this.matchesComparison(t)}}class Dv extends Te{constructor(e,t){super(e,"in",t),this.keys=Cd("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Vv extends Te{constructor(e,t){super(e,"not-in",t),this.keys=Cd("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Cd(n,e){return(e.arrayValue?.values||[]).map((t=>B.fromName(t.referenceValue)))}class Ov extends Te{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Nc(t)&&Ms(t.arrayValue,this.value)}}class Mv extends Te{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ms(this.value.arrayValue,t)}}class Lv extends Te{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ms(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ms(this.value.arrayValue,t)}}class xv extends Te{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Nc(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Ms(this.value.arrayValue,r)))}}class Fv{constructor(e,t=null,r=[],s=[],i=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=c,this.Te=null}}function th(n,e=null,t=[],r=[],s=null,i=null,a=null){return new Fv(n,e,t,r,s,i,a)}function Dc(n){const e=z(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>qa(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(i){return i.field.canonicalString()+i.dir})(r))).join(","),yo(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Mr(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Mr(r))).join(",")),e.Te=t}return e.Te}function Vc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Cv(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Rd(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!eh(n.startAt,e.startAt)&&eh(n.endAt,e.endAt)}function za(n){return B.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class Eo{constructor(e,t=null,r=[],s=[],i=null,a="F",c=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=c,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Uv(n,e,t,r,s,i,a,c){return new Eo(n,e,t,r,s,i,a,c)}function Oc(n){return new Eo(n)}function nh(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Bv(n){return n.collectionGroup!==null}function ws(n){const e=z(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new we(Re.comparator);return a.filters.forEach((l=>{l.getFlattenedFilters().forEach((h=>{h.isInequality()&&(c=c.add(h.field))}))})),c})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new $i(i,r))})),t.has(Re.keyField().canonicalString())||e.Ie.push(new $i(Re.keyField(),r))}return e.Ie}function wt(n){const e=z(n);return e.Ee||(e.Ee=$v(e,ws(n))),e.Ee}function $v(n,e){if(n.limitType==="F")return th(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const i=s.dir==="desc"?"asc":"desc";return new $i(s.field,i)}));const t=n.endAt?new Bi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Bi(n.startAt.position,n.startAt.inclusive):null;return th(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Ha(n,e,t){return new Eo(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function To(n,e){return Vc(wt(n),wt(e))&&n.limitType===e.limitType}function kd(n){return`${Dc(wt(n))}|lt:${n.limitType}`}function hr(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>Pd(s))).join(", ")}]`),yo(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>Mr(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>Mr(s))).join(",")),`Target(${r})`})(wt(n))}; limitType=${n.limitType})`}function Io(n,e){return e.isFoundDocument()&&(function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):B.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)})(n,e)&&(function(r,s){for(const i of ws(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,c,l){const h=Zl(a,c,l);return a.inclusive?h<=0:h<0})(r.startAt,ws(r),s)||r.endAt&&!(function(a,c,l){const h=Zl(a,c,l);return a.inclusive?h>=0:h>0})(r.endAt,ws(r),s))})(n,e)}function jv(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Nd(n){return(e,t)=>{let r=!1;for(const s of ws(n)){const i=qv(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function qv(n,e,t){const r=n.field.isKeyField()?B.comparator(e.key,t.key):(function(i,a,c){const l=a.data.field(i),h=c.data.field(i);return l!==null&&h!==null?Or(l,h):$(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return $(19790,{direction:n.dir})}}class tr{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Sn(this.inner,((t,r)=>{for(const[s,i]of r)e(s,i)}))}isEmpty(){return md(this.inner)}size(){return this.innerSize}}const zv=new fe(B.comparator);function zt(){return zv}const Dd=new fe(B.comparator);function gs(...n){let e=Dd;for(const t of n)e=e.insert(t.key,t);return e}function Vd(n){let e=Dd;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function Mn(){return As()}function Od(){return As()}function As(){return new tr((n=>n.toString()),((n,e)=>n.isEqual(e)))}const Hv=new fe(B.comparator),Wv=new we(B.comparator);function X(...n){let e=Wv;for(const t of n)e=e.add(t);return e}const Gv=new we(Q);function Kv(){return Gv}function Mc(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xi(e)?"-0":e}}function Md(n){return{integerValue:""+n}}function Qv(n,e){return Tv(e)?Md(e):Mc(n,e)}class wo{constructor(){this._=void 0}}function Xv(n,e,t){return n instanceof ji?(function(s,i){const a={fields:{[yd]:{stringValue:_d},[Ed]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&kc(i)&&(i=vo(i)),i&&(a.fields[vd]=i),{mapValue:a}})(t,e):n instanceof Ls?xd(n,e):n instanceof xs?Fd(n,e):(function(s,i){const a=Ld(s,i),c=rh(a)+rh(s.Ae);return ja(a)&&ja(s.Ae)?Md(c):Mc(s.serializer,c)})(n,e)}function Jv(n,e,t){return n instanceof Ls?xd(n,e):n instanceof xs?Fd(n,e):t}function Ld(n,e){return n instanceof qi?(function(r){return ja(r)||(function(i){return!!i&&"doubleValue"in i})(r)})(e)?e:{integerValue:0}:null}class ji extends wo{}class Ls extends wo{constructor(e){super(),this.elements=e}}function xd(n,e){const t=Ud(e);for(const r of n.elements)t.some((s=>Dt(s,r)))||t.push(r);return{arrayValue:{values:t}}}class xs extends wo{constructor(e){super(),this.elements=e}}function Fd(n,e){let t=Ud(e);for(const r of n.elements)t=t.filter((s=>!Dt(s,r)));return{arrayValue:{values:t}}}class qi extends wo{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function rh(n){return me(n.integerValue||n.doubleValue)}function Ud(n){return Nc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Yv(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof Ls&&s instanceof Ls||r instanceof xs&&s instanceof xs?Vr(r.elements,s.elements,Dt):r instanceof qi&&s instanceof qi?Dt(r.Ae,s.Ae):r instanceof ji&&s instanceof ji})(n.transform,e.transform)}class Zv{constructor(e,t){this.version=e,this.transformResults=t}}class At{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new At}static exists(e){return new At(void 0,e)}static updateTime(e){return new At(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function bi(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Ao{}function Bd(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new jd(n.key,At.none()):new Gs(n.key,n.data,At.none());{const t=n.data,r=We.empty();let s=new we(Re.comparator);for(let i of e.fields)if(!s.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Rn(n.key,r,new et(s.toArray()),At.none())}}function eE(n,e,t){n instanceof Gs?(function(s,i,a){const c=s.value.clone(),l=ih(s.fieldTransforms,i,a.transformResults);c.setAll(l),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()})(n,e,t):n instanceof Rn?(function(s,i,a){if(!bi(s.precondition,i))return void i.convertToUnknownDocument(a.version);const c=ih(s.fieldTransforms,i,a.transformResults),l=i.data;l.setAll($d(s)),l.setAll(c),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):(function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function bs(n,e,t,r){return n instanceof Gs?(function(i,a,c,l){if(!bi(i.precondition,a))return c;const h=i.value.clone(),d=oh(i.fieldTransforms,l,a);return h.setAll(d),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null})(n,e,t,r):n instanceof Rn?(function(i,a,c,l){if(!bi(i.precondition,a))return c;const h=oh(i.fieldTransforms,l,a),d=a.data;return d.setAll($d(i)),d.setAll(h),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((g=>g.field)))})(n,e,t,r):(function(i,a,c){return bi(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c})(n,e,t)}function tE(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Ld(r.transform,s||null);i!=null&&(t===null&&(t=We.empty()),t.set(r.field,i))}return t||null}function sh(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Vr(r,s,((i,a)=>Yv(i,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Gs extends Ao{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Rn extends Ao{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function $d(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function ih(n,e,t){const r=new Map;te(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],a=i.transform,c=e.data.field(i.field);r.set(i.field,Jv(a,c,t[s]))}return r}function oh(n,e,t){const r=new Map;for(const s of n){const i=s.transform,a=t.data.field(s.field);r.set(s.field,Xv(i,a,e))}return r}class jd extends Ao{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class nE extends Ao{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class rE{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&eE(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=bs(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=bs(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Od();return this.mutations.forEach((s=>{const i=e.get(s.key),a=i.overlayedDocument;let c=this.applyToLocalView(a,i.mutatedFields);c=t.has(s.key)?null:c;const l=Bd(a,c);l!==null&&r.set(s.key,l),a.isValidDocument()||a.convertToNoDocument(q.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),X())}isEqual(e){return this.batchId===e.batchId&&Vr(this.mutations,e.mutations,((t,r)=>sh(t,r)))&&Vr(this.baseMutations,e.baseMutations,((t,r)=>sh(t,r)))}}class Lc{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){te(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return Hv})();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new Lc(e,t,r,s)}}class sE{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class iE{constructor(e,t){this.count=e,this.unchangedNames=t}}var ge,J;function oE(n){switch(n){case N.OK:return $(64938);case N.CANCELLED:case N.UNKNOWN:case N.DEADLINE_EXCEEDED:case N.RESOURCE_EXHAUSTED:case N.INTERNAL:case N.UNAVAILABLE:case N.UNAUTHENTICATED:return!1;case N.INVALID_ARGUMENT:case N.NOT_FOUND:case N.ALREADY_EXISTS:case N.PERMISSION_DENIED:case N.FAILED_PRECONDITION:case N.ABORTED:case N.OUT_OF_RANGE:case N.UNIMPLEMENTED:case N.DATA_LOSS:return!0;default:return $(15467,{code:n})}}function qd(n){if(n===void 0)return qt("GRPC error has no .code"),N.UNKNOWN;switch(n){case ge.OK:return N.OK;case ge.CANCELLED:return N.CANCELLED;case ge.UNKNOWN:return N.UNKNOWN;case ge.DEADLINE_EXCEEDED:return N.DEADLINE_EXCEEDED;case ge.RESOURCE_EXHAUSTED:return N.RESOURCE_EXHAUSTED;case ge.INTERNAL:return N.INTERNAL;case ge.UNAVAILABLE:return N.UNAVAILABLE;case ge.UNAUTHENTICATED:return N.UNAUTHENTICATED;case ge.INVALID_ARGUMENT:return N.INVALID_ARGUMENT;case ge.NOT_FOUND:return N.NOT_FOUND;case ge.ALREADY_EXISTS:return N.ALREADY_EXISTS;case ge.PERMISSION_DENIED:return N.PERMISSION_DENIED;case ge.FAILED_PRECONDITION:return N.FAILED_PRECONDITION;case ge.ABORTED:return N.ABORTED;case ge.OUT_OF_RANGE:return N.OUT_OF_RANGE;case ge.UNIMPLEMENTED:return N.UNIMPLEMENTED;case ge.DATA_LOSS:return N.DATA_LOSS;default:return $(39323,{code:n})}}(J=ge||(ge={}))[J.OK=0]="OK",J[J.CANCELLED=1]="CANCELLED",J[J.UNKNOWN=2]="UNKNOWN",J[J.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",J[J.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",J[J.NOT_FOUND=5]="NOT_FOUND",J[J.ALREADY_EXISTS=6]="ALREADY_EXISTS",J[J.PERMISSION_DENIED=7]="PERMISSION_DENIED",J[J.UNAUTHENTICATED=16]="UNAUTHENTICATED",J[J.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",J[J.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",J[J.ABORTED=10]="ABORTED",J[J.OUT_OF_RANGE=11]="OUT_OF_RANGE",J[J.UNIMPLEMENTED=12]="UNIMPLEMENTED",J[J.INTERNAL=13]="INTERNAL",J[J.UNAVAILABLE=14]="UNAVAILABLE",J[J.DATA_LOSS=15]="DATA_LOSS";function aE(){return new TextEncoder}const cE=new mn([4294967295,4294967295],0);function ah(n){const e=aE().encode(n),t=new sd;return t.update(e),new Uint8Array(t.digest())}function ch(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new mn([t,r],0),new mn([s,i],0)]}class xc{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new _s(`Invalid padding: ${t}`);if(r<0)throw new _s(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new _s(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new _s(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=mn.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(mn.fromNumber(r)));return s.compare(cE)===1&&(s=new mn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=ah(e),[r,s]=ch(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new xc(i,s,t);return r.forEach((c=>a.insert(c))),a}insert(e){if(this.ge===0)return;const t=ah(e),[r,s]=ch(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);this.Se(a)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class _s extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class bo{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Ks.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new bo(q.min(),s,new fe(Q),zt(),X())}}class Ks{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Ks(r,t,X(),X(),X())}}class Si{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class zd{constructor(e,t){this.targetId=e,this.Ce=t}}class Hd{constructor(e,t,r=ke.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class uh{constructor(){this.ve=0,this.Fe=lh(),this.Me=ke.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=X(),t=X(),r=X();return this.Fe.forEach(((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:$(38017,{changeType:i})}})),new Ks(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=lh()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,te(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class uE{constructor(e){this.Ge=e,this.ze=new Map,this.je=zt(),this.Je=yi(),this.He=yi(),this.Ye=new fe(Q)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:$(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(za(i))if(r===0){const a=new B(i.path);this.et(t,a,Le.newNoDocument(a,q.min()))}else te(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const c=this.ut(e),l=c?this.ct(c,e,a):1;if(l!==0){this.it(t);const h=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,h)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let a,c;try{a=Tn(r).toUint8Array()}catch(l){if(l instanceof gd)return Dr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{c=new xc(a,s,i)}catch(l){return Dr(l instanceof _s?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return c.ge===0?null:c}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((i=>{const a=this.Ge.ht(),c=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.et(t,i,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((i,a)=>{const c=this.ot(a);if(c){if(i.current&&za(c.target)){const l=new B(c.target.path);this.It(l).has(a)||this.Et(a,l)||this.et(a,l,Le.newNoDocument(l,e))}i.Be&&(t.set(a,i.ke()),i.qe())}}));let r=X();this.He.forEach(((i,a)=>{let c=!0;a.forEachWhile((l=>{const h=this.ot(l);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)})),c&&(r=r.add(i))})),this.je.forEach(((i,a)=>a.setReadTime(e)));const s=new bo(e,t,this.Ye,this.je,r);return this.je=zt(),this.Je=yi(),this.He=yi(),this.Ye=new fe(Q),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new uh,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new we(Q),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new we(Q),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||x("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new uh),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function yi(){return new fe(B.comparator)}function lh(){return new fe(B.comparator)}const lE={asc:"ASCENDING",desc:"DESCENDING"},hE={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},fE={and:"AND",or:"OR"};class dE{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Wa(n,e){return n.useProto3Json||yo(e)?e:{value:e}}function zi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Wd(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function pE(n,e){return zi(n,e.toTimestamp())}function bt(n){return te(!!n,49232),q.fromTimestamp((function(t){const r=En(t);return new ue(r.seconds,r.nanos)})(n))}function Fc(n,e){return Ga(n,e).canonicalString()}function Ga(n,e){const t=(function(s){return new ce(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Gd(n){const e=ce.fromString(n);return te(Yd(e),10190,{key:e.toString()}),e}function Ka(n,e){return Fc(n.databaseId,e.path)}function _a(n,e){const t=Gd(e);if(t.get(1)!==n.databaseId.projectId)throw new F(N.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new F(N.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new B(Qd(t))}function Kd(n,e){return Fc(n.databaseId,e)}function mE(n){const e=Gd(n);return e.length===4?ce.emptyPath():Qd(e)}function Qa(n){return new ce(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Qd(n){return te(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function hh(n,e,t){return{name:Ka(n,e),fields:t.value.mapValue.fields}}function gE(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:$(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=(function(h,d){return h.useProto3Json?(te(d===void 0||typeof d=="string",58123),ke.fromBase64String(d||"")):(te(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),ke.fromUint8Array(d||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&(function(h){const d=h.code===void 0?N.UNKNOWN:qd(h.code);return new F(d,h.message||"")})(a);t=new Hd(r,s,i,c||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=_a(n,r.document.name),i=bt(r.document.updateTime),a=r.document.createTime?bt(r.document.createTime):q.min(),c=new We({mapValue:{fields:r.document.fields}}),l=Le.newFoundDocument(s,i,a,c),h=r.targetIds||[],d=r.removedTargetIds||[];t=new Si(h,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=_a(n,r.document),i=r.readTime?bt(r.readTime):q.min(),a=Le.newNoDocument(s,i),c=r.removedTargetIds||[];t=new Si([],c,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=_a(n,r.document),i=r.removedTargetIds||[];t=new Si([],i,s,null)}else{if(!("filter"in e))return $(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new iE(s,i),c=r.targetId;t=new zd(c,a)}}return t}function _E(n,e){let t;if(e instanceof Gs)t={update:hh(n,e.key,e.value)};else if(e instanceof jd)t={delete:Ka(n,e.key)};else if(e instanceof Rn)t={update:hh(n,e.key,e.data),updateMask:SE(e.fieldMask)};else{if(!(e instanceof nE))return $(16599,{Vt:e.type});t={verify:Ka(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(i,a){const c=a.transform;if(c instanceof ji)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Ls)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof xs)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof qi)return{fieldPath:a.field.canonicalString(),increment:c.Ae};throw $(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,i){return i.updateTime!==void 0?{updateTime:pE(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:$(27497)})(n,e.precondition)),t}function yE(n,e){return n&&n.length>0?(te(e!==void 0,14353),n.map((t=>(function(s,i){let a=s.updateTime?bt(s.updateTime):bt(i);return a.isEqual(q.min())&&(a=bt(i)),new Zv(a,s.transformResults||[])})(t,e)))):[]}function vE(n,e){return{documents:[Kd(n,e.path)]}}function EE(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Kd(n,s);const i=(function(h){if(h.length!==0)return Jd(Vt.create(h,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const a=(function(h){if(h.length!==0)return h.map((d=>(function(m){return{field:fr(m.field),direction:wE(m.dir)}})(d)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const c=Wa(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:s}}function TE(n){let e=mE(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){te(r===1,65062);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=(function(g){const m=Xd(g);return m instanceof Vt&&Sd(m)?m.getFilters():[m]})(t.where));let a=[];t.orderBy&&(a=(function(g){return g.map((m=>(function(S){return new $i(dr(S.field),(function(P){switch(P){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(S.direction))})(m)))})(t.orderBy));let c=null;t.limit&&(c=(function(g){let m;return m=typeof g=="object"?g.value:g,yo(m)?null:m})(t.limit));let l=null;t.startAt&&(l=(function(g){const m=!!g.before,I=g.values||[];return new Bi(I,m)})(t.startAt));let h=null;return t.endAt&&(h=(function(g){const m=!g.before,I=g.values||[];return new Bi(I,m)})(t.endAt)),Uv(e,s,a,i,c,"F",l,h)}function IE(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Xd(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=dr(t.unaryFilter.field);return Te.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=dr(t.unaryFilter.field);return Te.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=dr(t.unaryFilter.field);return Te.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=dr(t.unaryFilter.field);return Te.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return $(61313);default:return $(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Te.create(dr(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return $(58110);default:return $(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Vt.create(t.compositeFilter.filters.map((r=>Xd(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return $(1026)}})(t.compositeFilter.op))})(n):$(30097,{filter:n})}function wE(n){return lE[n]}function AE(n){return hE[n]}function bE(n){return fE[n]}function fr(n){return{fieldPath:n.canonicalString()}}function dr(n){return Re.fromServerFormat(n.fieldPath)}function Jd(n){return n instanceof Te?(function(t){if(t.op==="=="){if(Yl(t.value))return{unaryFilter:{field:fr(t.field),op:"IS_NAN"}};if(Jl(t.value))return{unaryFilter:{field:fr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Yl(t.value))return{unaryFilter:{field:fr(t.field),op:"IS_NOT_NAN"}};if(Jl(t.value))return{unaryFilter:{field:fr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:fr(t.field),op:AE(t.op),value:t.value}}})(n):n instanceof Vt?(function(t){const r=t.getFilters().map((s=>Jd(s)));return r.length===1?r[0]:{compositeFilter:{op:bE(t.op),filters:r}}})(n):$(54877,{filter:n})}function SE(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Yd(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class un{constructor(e,t,r,s,i=q.min(),a=q.min(),c=ke.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=l}withSequenceNumber(e){return new un(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new un(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new un(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new un(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class RE{constructor(e){this.yt=e}}function PE(n){const e=TE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ha(e,e.limit,"L"):e}class CE{constructor(){this.Cn=new kE}addToCollectionParentIndex(e,t){return this.Cn.add(t),k.resolve()}getCollectionParents(e,t){return k.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return k.resolve()}deleteFieldIndex(e,t){return k.resolve()}deleteAllFieldIndexes(e){return k.resolve()}createTargetIndexes(e,t){return k.resolve()}getDocumentsMatchingTarget(e,t){return k.resolve(null)}getIndexType(e,t){return k.resolve(0)}getFieldIndexes(e,t){return k.resolve([])}getNextCollectionGroupToUpdate(e){return k.resolve(null)}getMinOffset(e,t){return k.resolve(vn.min())}getMinOffsetFromCollectionGroup(e,t){return k.resolve(vn.min())}updateCollectionGroup(e,t,r){return k.resolve()}updateIndexEntries(e,t){return k.resolve()}}class kE{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new we(ce.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new we(ce.comparator)).toArray()}}const fh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Zd=41943040;class He{static withCacheSize(e){return new He(e,He.DEFAULT_COLLECTION_PERCENTILE,He.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}He.DEFAULT_COLLECTION_PERCENTILE=10,He.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,He.DEFAULT=new He(Zd,He.DEFAULT_COLLECTION_PERCENTILE,He.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),He.DISABLED=new He(-1,0,0);class Lr{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Lr(0)}static cr(){return new Lr(-1)}}const dh="LruGarbageCollector",NE=1048576;function ph([n,e],[t,r]){const s=Q(n,t);return s===0?Q(e,r):s}class DE{constructor(e){this.Ir=e,this.buffer=new we(ph),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();ph(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class VE{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){x(dh,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Gr(t)?x(dh,"Ignoring IndexedDB error during garbage collection: ",t):await Wr(t)}await this.Vr(3e5)}))}}class OE{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return k.resolve(_o.ce);const r=new DE(t);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(x("LruGarbageCollector","Garbage collection skipped; disabled"),k.resolve(fh)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),fh):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,a,c,l,h;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(x("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),s=this.params.maximumSequenceNumbersToCollect):s=g,a=Date.now(),this.nthSequenceNumber(e,s)))).next((g=>(r=g,c=Date.now(),this.removeTargets(e,r,t)))).next((g=>(i=g,l=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(h=Date.now(),lr()<=K.DEBUG&&x("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-d}ms
	Determined least recently used ${s} in `+(c-a)+`ms
	Removed ${i} targets in `+(l-c)+`ms
	Removed ${g} documents in `+(h-l)+`ms
Total Duration: ${h-d}ms`),k.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:g}))))}}function ME(n,e){return new OE(n,e)}class LE{constructor(){this.changes=new tr((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Le.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?k.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class xE{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class FE{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&bs(r.mutation,s,et.empty(),ue.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,X()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=X()){const s=Mn();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((i=>{let a=gs();return i.forEach(((c,l)=>{a=a.insert(c,l.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=Mn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,X())))}populateOverlays(e,t,r){const s=[];return r.forEach((i=>{t.has(i)||s.push(i)})),this.documentOverlayCache.getOverlays(e,s).next((i=>{i.forEach(((a,c)=>{t.set(a,c)}))}))}computeViews(e,t,r,s){let i=zt();const a=As(),c=(function(){return As()})();return t.forEach(((l,h)=>{const d=r.get(h.key);s.has(h.key)&&(d===void 0||d.mutation instanceof Rn)?i=i.insert(h.key,h):d!==void 0?(a.set(h.key,d.mutation.getFieldMask()),bs(d.mutation,h,d.mutation.getFieldMask(),ue.now())):a.set(h.key,et.empty())})),this.recalculateAndSaveOverlays(e,i).next((l=>(l.forEach(((h,d)=>a.set(h,d))),t.forEach(((h,d)=>c.set(h,new xE(d,a.get(h)??null)))),c)))}recalculateAndSaveOverlays(e,t){const r=As();let s=new fe(((a,c)=>a-c)),i=X();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const c of a)c.keys().forEach((l=>{const h=t.get(l);if(h===null)return;let d=r.get(l)||et.empty();d=c.applyToLocalView(h,d),r.set(l,d);const g=(s.get(c.batchId)||X()).add(l);s=s.insert(c.batchId,g)}))})).next((()=>{const a=[],c=s.getReverseIterator();for(;c.hasNext();){const l=c.getNext(),h=l.key,d=l.value,g=Od();d.forEach((m=>{if(!i.has(m)){const I=Bd(t.get(m),r.get(m));I!==null&&g.set(m,I),i=i.add(m)}})),a.push(this.documentOverlayCache.saveOverlays(e,h,g))}return k.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return(function(a){return B.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Bv(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):k.resolve(Mn());let c=Ds,l=i;return a.next((h=>k.forEach(h,((d,g)=>(c<g.largestBatchId&&(c=g.largestBatchId),i.get(d)?k.resolve():this.remoteDocumentCache.getEntry(e,d).next((m=>{l=l.insert(d,m)}))))).next((()=>this.populateOverlays(e,h,i))).next((()=>this.computeViews(e,l,h,X()))).next((d=>({batchId:c,changes:Vd(d)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new B(t)).next((r=>{let s=gs();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let a=gs();return this.indexManager.getCollectionParents(e,i).next((c=>k.forEach(c,(l=>{const h=(function(g,m){return new Eo(m,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,h,r,s).next((d=>{d.forEach(((g,m)=>{a=a.insert(g,m)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s)))).next((a=>{i.forEach(((l,h)=>{const d=h.getKey();a.get(d)===null&&(a=a.insert(d,Le.newInvalidDocument(d)))}));let c=gs();return a.forEach(((l,h)=>{const d=i.get(l);d!==void 0&&bs(d.mutation,h,et.empty(),ue.now()),Io(t,h)&&(c=c.insert(l,h))})),c}))}}class UE{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return k.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:bt(s.createTime)}})(t)),k.resolve()}getNamedQuery(e,t){return k.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:PE(s.bundledQuery),readTime:bt(s.readTime)}})(t)),k.resolve()}}class BE{constructor(){this.overlays=new fe(B.comparator),this.qr=new Map}getOverlay(e,t){return k.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Mn();return k.forEach(t,(s=>this.getOverlay(e,s).next((i=>{i!==null&&r.set(s,i)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,i)=>{this.St(e,t,i)})),k.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((i=>this.overlays=this.overlays.remove(i))),this.qr.delete(r)),k.resolve()}getOverlaysForCollection(e,t,r){const s=Mn(),i=t.length+1,a=new B(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){const l=c.getNext().value,h=l.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return k.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new fe(((h,d)=>h-d));const a=this.overlays.getIterator();for(;a.hasNext();){const h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let d=i.get(h.largestBatchId);d===null&&(d=Mn(),i=i.insert(h.largestBatchId,d)),d.set(h.getKey(),h)}}const c=Mn(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((h,d)=>c.set(h,d))),!(c.size()>=s)););return k.resolve(c)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new sE(t,r));let i=this.qr.get(t);i===void 0&&(i=X(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}class $E{constructor(){this.sessionToken=ke.EMPTY_BYTE_STRING}getSessionToken(e){return k.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,k.resolve()}}class Uc{constructor(){this.Qr=new we(be.$r),this.Ur=new we(be.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new be(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new be(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new B(new ce([])),r=new be(t,e),s=new be(t,e+1),i=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),i.push(a.key)})),i}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new B(new ce([])),r=new be(t,e),s=new be(t,e+1);let i=X();return this.Ur.forEachInRange([r,s],(a=>{i=i.add(a.key)})),i}containsKey(e){const t=new be(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class be{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return B.comparator(e.key,t.key)||Q(e.Yr,t.Yr)}static Kr(e,t){return Q(e.Yr,t.Yr)||B.comparator(e.key,t.key)}}class jE{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new we(be.$r)}checkEmpty(e){return k.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new rE(i,t,r,s);this.mutationQueue.push(a);for(const c of s)this.Zr=this.Zr.add(new be(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return k.resolve(a)}lookupMutationBatch(e,t){return k.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return k.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return k.resolve(this.mutationQueue.length===0?Cc:this.tr-1)}getAllMutationBatches(e){return k.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new be(t,0),s=new be(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],(a=>{const c=this.Xr(a.Yr);i.push(c)})),k.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new we(Q);return t.forEach((s=>{const i=new be(s,0),a=new be(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,a],(c=>{r=r.add(c.Yr)}))})),k.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;B.isDocumentKey(i)||(i=i.child(""));const a=new be(new B(i),0);let c=new we(Q);return this.Zr.forEachWhile((l=>{const h=l.key.path;return!!r.isPrefixOf(h)&&(h.length===s&&(c=c.add(l.Yr)),!0)}),a),k.resolve(this.ti(c))}ti(e){const t=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){te(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return k.forEach(t.mutations,(s=>{const i=new be(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new be(t,0),s=this.Zr.firstAfterOrEqual(r);return k.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,k.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class qE{constructor(e){this.ri=e,this.docs=(function(){return new fe(B.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return k.resolve(r?r.document.mutableCopy():Le.newInvalidDocument(t))}getEntries(e,t){let r=zt();return t.forEach((s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Le.newInvalidDocument(s))})),k.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=zt();const a=t.path,c=new B(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(c);for(;l.hasNext();){const{key:h,value:{document:d}}=l.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||_v(gv(d),r)<=0||(s.has(d.key)||Io(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return k.resolve(i)}getAllFromCollectionGroup(e,t,r,s){$(9500)}ii(e,t){return k.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new zE(this)}getSize(e){return k.resolve(this.size)}}class zE extends LE{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),k.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class HE{constructor(e){this.persistence=e,this.si=new tr((t=>Dc(t)),Vc),this.lastRemoteSnapshotVersion=q.min(),this.highestTargetId=0,this.oi=0,this._i=new Uc,this.targetCount=0,this.ai=Lr.ur()}forEachTarget(e,t){return this.si.forEach(((r,s)=>t(s))),k.resolve()}getLastRemoteSnapshotVersion(e){return k.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return k.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),k.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),k.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Lr(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,k.resolve()}updateTargetData(e,t){return this.Pr(t),k.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,k.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach(((a,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),s++)})),k.waitFor(i).next((()=>s))}getTargetCount(e){return k.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return k.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),k.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach((a=>{i.push(s.markPotentiallyOrphaned(e,a))})),k.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),k.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return k.resolve(r)}containsKey(e,t){return k.resolve(this._i.containsKey(t))}}class ep{constructor(e,t){this.ui={},this.overlays={},this.ci=new _o(0),this.li=!1,this.li=!0,this.hi=new $E,this.referenceDelegate=e(this),this.Pi=new HE(this),this.indexManager=new CE,this.remoteDocumentCache=(function(s){return new qE(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new RE(t),this.Ii=new UE(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new BE,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new jE(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){x("MemoryPersistence","Starting transaction:",e);const s=new WE(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((i=>this.referenceDelegate.di(s).next((()=>i)))).toPromise().then((i=>(s.raiseOnCommittedEvent(),i)))}Ai(e,t){return k.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class WE extends vv{constructor(e){super(),this.currentSequenceNumber=e}}class Bc{constructor(e){this.persistence=e,this.Ri=new Uc,this.Vi=null}static mi(e){return new Bc(e)}get fi(){if(this.Vi)return this.Vi;throw $(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),k.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),k.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),k.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((i=>this.fi.add(i.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return k.forEach(this.fi,(r=>{const s=B.fromPath(r);return this.gi(e,s).next((i=>{i||t.removeEntry(s,q.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return k.or([()=>k.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Hi{constructor(e,t){this.persistence=e,this.pi=new tr((r=>Iv(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=ME(this,t)}static mi(e,t){return new Hi(e,t)}Ei(){}di(e){return k.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return k.forEach(this.pi,((r,s)=>this.br(e,r,s).next((i=>i?k.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,(a=>this.br(e,a,t).next((c=>{c||(r++,i.removeEntry(a,q.min()))})))).next((()=>i.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),k.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),k.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),k.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),k.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=wi(e.data.value)),t}br(e,t,r){return k.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return k.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class $c{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=X(),s=X();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new $c(e,t.fromCache,r,s)}}class GE{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class KE{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return F_()?8:Ev(Fe())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next((a=>{i.result=a})).next((()=>{if(!i.result)return this.ws(e,t,s,r).next((a=>{i.result=a}))})).next((()=>{if(i.result)return;const a=new GE;return this.Ss(e,t,a).next((c=>{if(i.result=c,this.Vs)return this.bs(e,t,a,c.size)}))})).next((()=>i.result))}bs(e,t,r,s){return r.documentReadCount<this.fs?(lr()<=K.DEBUG&&x("QueryEngine","SDK will not create cache indexes for query:",hr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),k.resolve()):(lr()<=K.DEBUG&&x("QueryEngine","Query:",hr(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(lr()<=K.DEBUG&&x("QueryEngine","The SDK decides to create cache indexes for query:",hr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,wt(t))):k.resolve())}ys(e,t){if(nh(t))return k.resolve(null);let r=wt(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=Ha(t,null,"F"),r=wt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((i=>{const a=X(...i);return this.ps.getDocuments(e,a).next((c=>this.indexManager.getMinOffset(e,r).next((l=>{const h=this.Ds(t,c);return this.Cs(t,h,a,l.readTime)?this.ys(e,Ha(t,null,"F")):this.vs(e,h,t,l)}))))})))))}ws(e,t,r,s){return nh(t)||s.isEqual(q.min())?k.resolve(null):this.ps.getDocuments(e,r).next((i=>{const a=this.Ds(t,i);return this.Cs(t,a,r,s)?k.resolve(null):(lr()<=K.DEBUG&&x("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),hr(t)),this.vs(e,a,t,mv(s,Ds)).next((c=>c)))}))}Ds(e,t){let r=new we(Nd(e));return t.forEach(((s,i)=>{Io(e,i)&&(r=r.add(i))})),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return lr()<=K.DEBUG&&x("QueryEngine","Using full collection scan to execute query:",hr(t)),this.ps.getDocumentsMatchingQuery(e,t,vn.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((i=>(t.forEach((a=>{i=i.insert(a.key,a)})),i)))}}const jc="LocalStore",QE=3e8;class XE{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new fe(Q),this.xs=new tr((i=>Dc(i)),Vc),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new FE(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function JE(n,e,t,r){return new XE(n,e,t,r)}async function tp(n,e){const t=z(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((i=>{const a=[],c=[];let l=X();for(const h of s){a.push(h.batchId);for(const d of h.mutations)l=l.add(d.key)}for(const h of i){c.push(h.batchId);for(const d of h.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(r,l).next((h=>({Ls:h,removedBatchIds:a,addedBatchIds:c})))}))}))}function YE(n,e){const t=z(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(c,l,h,d){const g=h.batch,m=g.keys();let I=k.resolve();return m.forEach((S=>{I=I.next((()=>d.getEntry(l,S))).next((C=>{const P=h.docVersions.get(S);te(P!==null,48541),C.version.compareTo(P)<0&&(g.applyToRemoteDocument(C,h),C.isValidDocument()&&(C.setReadTime(h.commitVersion),d.addEntry(C)))}))})),I.next((()=>c.mutationQueue.removeMutationBatch(l,g)))})(t,r,e,i).next((()=>i.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(c){let l=X();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(l=l.add(c.batch.mutations[h].key));return l})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function np(n){const e=z(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function ZE(n,e){const t=z(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const c=[];e.targetChanges.forEach(((d,g)=>{const m=s.get(g);if(!m)return;c.push(t.Pi.removeMatchingKeys(i,d.removedDocuments,g).next((()=>t.Pi.addMatchingKeys(i,d.addedDocuments,g))));let I=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(g)!==null?I=I.withResumeToken(ke.EMPTY_BYTE_STRING,q.min()).withLastLimboFreeSnapshotVersion(q.min()):d.resumeToken.approximateByteSize()>0&&(I=I.withResumeToken(d.resumeToken,r)),s=s.insert(g,I),(function(C,P,D){return C.resumeToken.approximateByteSize()===0||P.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=QE?!0:D.addedDocuments.size+D.modifiedDocuments.size+D.removedDocuments.size>0})(m,I,d)&&c.push(t.Pi.updateTargetData(i,I))}));let l=zt(),h=X();if(e.documentUpdates.forEach((d=>{e.resolvedLimboDocuments.has(d)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))})),c.push(eT(i,a,e.documentUpdates).next((d=>{l=d.ks,h=d.qs}))),!r.isEqual(q.min())){const d=t.Pi.getLastRemoteSnapshotVersion(i).next((g=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r)));c.push(d)}return k.waitFor(c).next((()=>a.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,l,h))).next((()=>l))})).then((i=>(t.Ms=s,i)))}function eT(n,e,t){let r=X(),s=X();return t.forEach((i=>r=r.add(i))),e.getEntries(n,r).next((i=>{let a=zt();return t.forEach(((c,l)=>{const h=i.get(c);l.isFoundDocument()!==h.isFoundDocument()&&(s=s.add(c)),l.isNoDocument()&&l.version.isEqual(q.min())?(e.removeEntry(c,l.readTime),a=a.insert(c,l)):!h.isValidDocument()||l.version.compareTo(h.version)>0||l.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(l),a=a.insert(c,l)):x(jc,"Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",l.version)})),{ks:a,qs:s}}))}function tT(n,e){const t=z(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Cc),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function nT(n,e){const t=z(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.Pi.getTargetData(r,e).next((i=>i?(s=i,k.resolve(s)):t.Pi.allocateTargetId(r).next((a=>(s=new un(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function Xa(n,e,t){const r=z(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Gr(a))throw a;x(jc,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function mh(n,e,t){const r=z(n);let s=q.min(),i=X();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(l,h,d){const g=z(l),m=g.xs.get(d);return m!==void 0?k.resolve(g.Ms.get(m)):g.Pi.getTargetData(h,d)})(r,a,wt(e)).next((c=>{if(c)return s=c.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,c.targetId).next((l=>{i=l}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,e,t?s:q.min(),t?i:X()))).next((c=>(rT(r,jv(e),c),{documents:c,Qs:i})))))}function rT(n,e,t){let r=n.Os.get(e)||q.min();t.forEach(((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)})),n.Os.set(e,r)}class gh{constructor(){this.activeTargetIds=Kv()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class sT{constructor(){this.Mo=new gh,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new gh,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class iT{Oo(e){}shutdown(){}}const _h="ConnectivityMonitor";class yh{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){x(_h,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){x(_h,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let vi=null;function Ja(){return vi===null?vi=(function(){return 268435456+Math.round(2147483648*Math.random())})():vi++,"0x"+vi.toString(16)}const ya="RestConnection",oT={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class aT{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Fi?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const a=Ja(),c=this.zo(e,t.toUriEncodedString());x(ya,`Sending RPC '${e}' ${a}:`,c,r);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);const{host:h}=new URL(c),d=bn(h);return this.Jo(e,c,l,r,d).then((g=>(x(ya,`Received RPC '${e}' ${a}: `,g),g)),(g=>{throw Dr(ya,`RPC '${e}' ${a} failed with error: `,g,"url: ",c,"request:",r),g}))}Ho(e,t,r,s,i,a){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Hr})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,i)=>e[i]=s)),r&&r.headers.forEach(((s,i)=>e[i]=s))}zo(e,t){const r=oT[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class cT{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const De="WebChannelConnection";class uT extends aT{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const a=Ja();return new Promise(((c,l)=>{const h=new id;h.setWithCredentials(!0),h.listenOnce(od.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case Ii.NO_ERROR:const g=h.getResponseJson();x(De,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(g)),c(g);break;case Ii.TIMEOUT:x(De,`RPC '${e}' ${a} timed out`),l(new F(N.DEADLINE_EXCEEDED,"Request time out"));break;case Ii.HTTP_ERROR:const m=h.getStatus();if(x(De,`RPC '${e}' ${a} failed with status:`,m,"response text:",h.getResponseText()),m>0){let I=h.getResponseJson();Array.isArray(I)&&(I=I[0]);const S=I?.error;if(S&&S.status&&S.message){const C=(function(D){const M=D.toLowerCase().replace(/_/g,"-");return Object.values(N).indexOf(M)>=0?M:N.UNKNOWN})(S.status);l(new F(C,S.message))}else l(new F(N.UNKNOWN,"Server responded with status "+h.getStatus()))}else l(new F(N.UNAVAILABLE,"Connection failed."));break;default:$(9055,{l_:e,streamId:a,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{x(De,`RPC '${e}' ${a} completed.`)}}));const d=JSON.stringify(s);x(De,`RPC '${e}' ${a} sending request:`,s),h.send(t,"POST",d,r,15)}))}T_(e,t,r){const s=Ja(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=ud(),c=cd(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(l.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=i.join("");x(De,`Creating RPC '${e}' stream ${s}: ${d}`,l);const g=a.createWebChannel(d,l);this.I_(g);let m=!1,I=!1;const S=new cT({Yo:P=>{I?x(De,`Not sending because RPC '${e}' stream ${s} is closed:`,P):(m||(x(De,`Opening RPC '${e}' stream ${s} transport.`),g.open(),m=!0),x(De,`RPC '${e}' stream ${s} sending:`,P),g.send(P))},Zo:()=>g.close()}),C=(P,D,M)=>{P.listen(D,(V=>{try{M(V)}catch(U){setTimeout((()=>{throw U}),0)}}))};return C(g,ms.EventType.OPEN,(()=>{I||(x(De,`RPC '${e}' stream ${s} transport opened.`),S.o_())})),C(g,ms.EventType.CLOSE,(()=>{I||(I=!0,x(De,`RPC '${e}' stream ${s} transport closed`),S.a_(),this.E_(g))})),C(g,ms.EventType.ERROR,(P=>{I||(I=!0,Dr(De,`RPC '${e}' stream ${s} transport errored. Name:`,P.name,"Message:",P.message),S.a_(new F(N.UNAVAILABLE,"The operation could not be completed")))})),C(g,ms.EventType.MESSAGE,(P=>{if(!I){const D=P.data[0];te(!!D,16349);const M=D,V=M?.error||M[0]?.error;if(V){x(De,`RPC '${e}' stream ${s} received error:`,V);const U=V.status;let G=(function(_){const y=ge[_];if(y!==void 0)return qd(y)})(U),Y=V.message;G===void 0&&(G=N.INTERNAL,Y="Unknown error status: "+U+" with message "+V.message),I=!0,S.a_(new F(G,Y)),g.close()}else x(De,`RPC '${e}' stream ${s} received:`,D),S.u_(D)}})),C(c,ad.STAT_EVENT,(P=>{P.stat===Ua.PROXY?x(De,`RPC '${e}' stream ${s} detected buffering proxy`):P.stat===Ua.NOPROXY&&x(De,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{S.__()}),0),S}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function va(){return typeof document<"u"?document:null}function So(n){return new dE(n,!0)}class rp{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&x("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const vh="PersistentStream";class sp{constructor(e,t,r,s,i,a,c,l){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new rp(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===N.RESOURCE_EXHAUSTED?(qt(t.toString()),qt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===N.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new F(N.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return x(vh,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(x(vh,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class lT extends sp{constructor(e,t,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=gE(this.serializer,e),r=(function(i){if(!("targetChange"in i))return q.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?q.min():a.readTime?bt(a.readTime):q.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=Qa(this.serializer),t.addTarget=(function(i,a){let c;const l=a.target;if(c=za(l)?{documents:vE(i,l)}:{query:EE(i,l).ft},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=Wd(i,a.resumeToken);const h=Wa(i,a.expectedCount);h!==null&&(c.expectedCount=h)}else if(a.snapshotVersion.compareTo(q.min())>0){c.readTime=zi(i,a.snapshotVersion.toTimestamp());const h=Wa(i,a.expectedCount);h!==null&&(c.expectedCount=h)}return c})(this.serializer,e);const r=IE(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=Qa(this.serializer),t.removeTarget=e,this.q_(t)}}class hT extends sp{constructor(e,t,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return te(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,te(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){te(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=yE(e.writeResults,e.commitTime),r=bt(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=Qa(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>_E(this.serializer,r)))};this.q_(t)}}class fT{}class dT extends fT{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new F(N.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Go(e,Ga(t,r),s,i,a))).catch((i=>{throw i.name==="FirebaseError"?(i.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new F(N.UNKNOWN,i.toString())}))}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,c])=>this.connection.Ho(e,Ga(t,r),s,a,c,i))).catch((a=>{throw a.name==="FirebaseError"?(a.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new F(N.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class pT{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(qt(t),this.aa=!1):x("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Xn="RemoteStore";class mT{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{nr(this)&&(x(Xn,"Restarting streams for network reachability change."),await(async function(l){const h=z(l);h.Ea.add(4),await Qs(h),h.Ra.set("Unknown"),h.Ea.delete(4),await Ro(h)})(this))}))})),this.Ra=new pT(r,s)}}async function Ro(n){if(nr(n))for(const e of n.da)await e(!0)}async function Qs(n){for(const e of n.da)await e(!1)}function ip(n,e){const t=z(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Wc(t)?Hc(t):Kr(t).O_()&&zc(t,e))}function qc(n,e){const t=z(n),r=Kr(t);t.Ia.delete(e),r.O_()&&op(t,e),t.Ia.size===0&&(r.O_()?r.L_():nr(t)&&t.Ra.set("Unknown"))}function zc(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(q.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Kr(n).Y_(e)}function op(n,e){n.Va.Ue(e),Kr(n).Z_(e)}function Hc(n){n.Va=new uE({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Kr(n).start(),n.Ra.ua()}function Wc(n){return nr(n)&&!Kr(n).x_()&&n.Ia.size>0}function nr(n){return z(n).Ea.size===0}function ap(n){n.Va=void 0}async function gT(n){n.Ra.set("Online")}async function _T(n){n.Ia.forEach(((e,t)=>{zc(n,e)}))}async function yT(n,e){ap(n),Wc(n)?(n.Ra.ha(e),Hc(n)):n.Ra.set("Unknown")}async function vT(n,e,t){if(n.Ra.set("Online"),e instanceof Hd&&e.state===2&&e.cause)try{await(async function(s,i){const a=i.cause;for(const c of i.targetIds)s.Ia.has(c)&&(await s.remoteSyncer.rejectListen(c,a),s.Ia.delete(c),s.Va.removeTarget(c))})(n,e)}catch(r){x(Xn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Wi(n,r)}else if(e instanceof Si?n.Va.Ze(e):e instanceof zd?n.Va.st(e):n.Va.tt(e),!t.isEqual(q.min()))try{const r=await np(n.localStore);t.compareTo(r)>=0&&await(function(i,a){const c=i.Va.Tt(a);return c.targetChanges.forEach(((l,h)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.Ia.get(h);d&&i.Ia.set(h,d.withResumeToken(l.resumeToken,a))}})),c.targetMismatches.forEach(((l,h)=>{const d=i.Ia.get(l);if(!d)return;i.Ia.set(l,d.withResumeToken(ke.EMPTY_BYTE_STRING,d.snapshotVersion)),op(i,l);const g=new un(d.target,l,h,d.sequenceNumber);zc(i,g)})),i.remoteSyncer.applyRemoteEvent(c)})(n,t)}catch(r){x(Xn,"Failed to raise snapshot:",r),await Wi(n,r)}}async function Wi(n,e,t){if(!Gr(e))throw e;n.Ea.add(1),await Qs(n),n.Ra.set("Offline"),t||(t=()=>np(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{x(Xn,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Ro(n)}))}function cp(n,e){return e().catch((t=>Wi(n,t,e)))}async function Po(n){const e=z(n),t=wn(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Cc;for(;ET(e);)try{const s=await tT(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,TT(e,s)}catch(s){await Wi(e,s)}up(e)&&lp(e)}function ET(n){return nr(n)&&n.Ta.length<10}function TT(n,e){n.Ta.push(e);const t=wn(n);t.O_()&&t.X_&&t.ea(e.mutations)}function up(n){return nr(n)&&!wn(n).x_()&&n.Ta.length>0}function lp(n){wn(n).start()}async function IT(n){wn(n).ra()}async function wT(n){const e=wn(n);for(const t of n.Ta)e.ea(t.mutations)}async function AT(n,e,t){const r=n.Ta.shift(),s=Lc.from(r,e,t);await cp(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await Po(n)}async function bT(n,e){e&&wn(n).X_&&await(async function(r,s){if((function(a){return oE(a)&&a!==N.ABORTED})(s.code)){const i=r.Ta.shift();wn(r).B_(),await cp(r,(()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s))),await Po(r)}})(n,e),up(n)&&lp(n)}async function Eh(n,e){const t=z(n);t.asyncQueue.verifyOperationInProgress(),x(Xn,"RemoteStore received new credentials");const r=nr(t);t.Ea.add(3),await Qs(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Ro(t)}async function ST(n,e){const t=z(n);e?(t.Ea.delete(2),await Ro(t)):e||(t.Ea.add(2),await Qs(t),t.Ra.set("Unknown"))}function Kr(n){return n.ma||(n.ma=(function(t,r,s){const i=z(t);return i.sa(),new lT(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Xo:gT.bind(null,n),t_:_T.bind(null,n),r_:yT.bind(null,n),H_:vT.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),Wc(n)?Hc(n):n.Ra.set("Unknown")):(await n.ma.stop(),ap(n))}))),n.ma}function wn(n){return n.fa||(n.fa=(function(t,r,s){const i=z(t);return i.sa(),new hT(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:IT.bind(null,n),r_:bT.bind(null,n),ta:wT.bind(null,n),na:AT.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await Po(n)):(await n.fa.stop(),n.Ta.length>0&&(x(Xn,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class Gc{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Bn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const a=Date.now()+r,c=new Gc(e,t,a,s,i);return c.start(r),c}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new F(N.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Kc(n,e){if(qt("AsyncQueue",`${e}: ${n}`),Gr(n))return new F(N.UNAVAILABLE,`${e}: ${n}`);throw n}class Ir{static emptySet(e){return new Ir(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||B.comparator(t.key,r.key):(t,r)=>B.comparator(t.key,r.key),this.keyedMap=gs(),this.sortedSet=new fe(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ir)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Ir;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Th{constructor(){this.ga=new fe(B.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):$(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class xr{constructor(e,t,r,s,i,a,c,l,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=l,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,s,i){const a=[];return t.forEach((c=>{a.push({type:0,doc:c})})),new xr(e,t,Ir.emptySet(t),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&To(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class RT{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class PT{constructor(){this.queries=Ih(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=z(t),i=s.queries;s.queries=Ih(),i.forEach(((a,c)=>{for(const l of c.Sa)l.onError(r)}))})(this,new F(N.ABORTED,"Firestore shutting down"))}}function Ih(){return new tr((n=>kd(n)),To)}async function CT(n,e){const t=z(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new RT,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const c=Kc(a,`Initialization of query '${hr(e.query)}' failed`);return void e.onError(c)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&Qc(t)}async function kT(n,e){const t=z(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const a=i.Sa.indexOf(e);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function NT(n,e){const t=z(n);let r=!1;for(const s of e){const i=s.query,a=t.queries.get(i);if(a){for(const c of a.Sa)c.Fa(s)&&(r=!0);a.wa=s}}r&&Qc(t)}function DT(n,e,t){const r=z(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function Qc(n){n.Ca.forEach((e=>{e.next()}))}var Ya,wh;(wh=Ya||(Ya={})).Ma="default",wh.Cache="cache";class VT{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new xr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=xr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ya.Cache}}class hp{constructor(e){this.key=e}}class fp{constructor(e){this.key=e}}class OT{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=X(),this.mutatedKeys=X(),this.eu=Nd(e),this.tu=new Ir(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new Th,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,a=s,c=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,h=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((d,g)=>{const m=s.get(d),I=Io(this.query,g)?g:null,S=!!m&&this.mutatedKeys.has(m.key),C=!!I&&(I.hasLocalMutations||this.mutatedKeys.has(I.key)&&I.hasCommittedMutations);let P=!1;m&&I?m.data.isEqual(I.data)?S!==C&&(r.track({type:3,doc:I}),P=!0):this.su(m,I)||(r.track({type:2,doc:I}),P=!0,(l&&this.eu(I,l)>0||h&&this.eu(I,h)<0)&&(c=!0)):!m&&I?(r.track({type:0,doc:I}),P=!0):m&&!I&&(r.track({type:1,doc:m}),P=!0,(l||h)&&(c=!0)),P&&(I?(a=a.add(I),i=C?i.add(d):i.delete(d)):(a=a.delete(d),i=i.delete(d)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const d=this.query.limitType==="F"?a.last():a.first();a=a.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{tu:a,iu:r,Cs:c,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((d,g)=>(function(I,S){const C=P=>{switch(P){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $(20277,{Rt:P})}};return C(I)-C(S)})(d.type,g.type)||this.eu(d.doc,g.doc))),this.ou(r),s=s??!1;const c=t&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,h=l!==this.Za;return this.Za=l,a.length!==0||h?{snapshot:new xr(this.query,e.tu,i,a,e.mutatedKeys,l===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Th,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=X(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new fp(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new hp(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=X();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return xr.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Xc="SyncEngine";class MT{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class LT{constructor(e){this.key=e,this.hu=!1}}class xT{constructor(e,t,r,s,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new tr((c=>kd(c)),To),this.Iu=new Map,this.Eu=new Set,this.du=new fe(B.comparator),this.Au=new Map,this.Ru=new Uc,this.Vu={},this.mu=new Map,this.fu=Lr.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function FT(n,e,t=!0){const r=yp(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await dp(r,e,t,!0),s}async function UT(n,e){const t=yp(n);await dp(t,e,!0,!1)}async function dp(n,e,t,r){const s=await nT(n.localStore,wt(e)),i=s.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let c;return r&&(c=await BT(n,e,i,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&ip(n.remoteStore,s),c}async function BT(n,e,t,r,s){n.pu=(g,m,I)=>(async function(C,P,D,M){let V=P.view.ru(D);V.Cs&&(V=await mh(C.localStore,P.query,!1).then((({documents:E})=>P.view.ru(E,V))));const U=M&&M.targetChanges.get(P.targetId),G=M&&M.targetMismatches.get(P.targetId)!=null,Y=P.view.applyChanges(V,C.isPrimaryClient,U,G);return bh(C,P.targetId,Y.au),Y.snapshot})(n,g,m,I);const i=await mh(n.localStore,e,!0),a=new OT(e,i.Qs),c=a.ru(i.documents),l=Ks.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),h=a.applyChanges(c,n.isPrimaryClient,l);bh(n,t,h.au);const d=new MT(e,t,a);return n.Tu.set(e,d),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot}async function $T(n,e,t){const r=z(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter((a=>!To(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Xa(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&qc(r.remoteStore,s.targetId),Za(r,s.targetId)})).catch(Wr)):(Za(r,s.targetId),await Xa(r.localStore,s.targetId,!0))}async function jT(n,e){const t=z(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),qc(t.remoteStore,r.targetId))}async function qT(n,e,t){const r=XT(n);try{const s=await(function(a,c){const l=z(a),h=ue.now(),d=c.reduce(((I,S)=>I.add(S.key)),X());let g,m;return l.persistence.runTransaction("Locally write mutations","readwrite",(I=>{let S=zt(),C=X();return l.Ns.getEntries(I,d).next((P=>{S=P,S.forEach(((D,M)=>{M.isValidDocument()||(C=C.add(D))}))})).next((()=>l.localDocuments.getOverlayedDocuments(I,S))).next((P=>{g=P;const D=[];for(const M of c){const V=tE(M,g.get(M.key).overlayedDocument);V!=null&&D.push(new Rn(M.key,V,wd(V.value.mapValue),At.exists(!0)))}return l.mutationQueue.addMutationBatch(I,h,D,c)})).next((P=>{m=P;const D=P.applyToLocalDocumentSet(g,C);return l.documentOverlayCache.saveOverlays(I,P.batchId,D)}))})).then((()=>({batchId:m.batchId,changes:Vd(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,c,l){let h=a.Vu[a.currentUser.toKey()];h||(h=new fe(Q)),h=h.insert(c,l),a.Vu[a.currentUser.toKey()]=h})(r,s.batchId,t),await Xs(r,s.changes),await Po(r.remoteStore)}catch(s){const i=Kc(s,"Failed to persist write");t.reject(i)}}async function pp(n,e){const t=z(n);try{const r=await ZE(t.localStore,e);e.targetChanges.forEach(((s,i)=>{const a=t.Au.get(i);a&&(te(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?te(a.hu,14607):s.removedDocuments.size>0&&(te(a.hu,42227),a.hu=!1))})),await Xs(t,r,e)}catch(r){await Wr(r)}}function Ah(n,e,t){const r=z(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((i,a)=>{const c=a.view.va(e);c.snapshot&&s.push(c.snapshot)})),(function(a,c){const l=z(a);l.onlineState=c;let h=!1;l.queries.forEach(((d,g)=>{for(const m of g.Sa)m.va(c)&&(h=!0)})),h&&Qc(l)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function zT(n,e,t){const r=z(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let a=new fe(B.comparator);a=a.insert(i,Le.newNoDocument(i,q.min()));const c=X().add(i),l=new bo(q.min(),new Map,new fe(Q),a,c);await pp(r,l),r.du=r.du.remove(i),r.Au.delete(e),Jc(r)}else await Xa(r.localStore,e,!1).then((()=>Za(r,e,t))).catch(Wr)}async function HT(n,e){const t=z(n),r=e.batch.batchId;try{const s=await YE(t.localStore,e);gp(t,r,null),mp(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Xs(t,s)}catch(s){await Wr(s)}}async function WT(n,e,t){const r=z(n);try{const s=await(function(a,c){const l=z(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",(h=>{let d;return l.mutationQueue.lookupMutationBatch(h,c).next((g=>(te(g!==null,37113),d=g.keys(),l.mutationQueue.removeMutationBatch(h,g)))).next((()=>l.mutationQueue.performConsistencyCheck(h))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(h,d,c))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,d))).next((()=>l.localDocuments.getDocuments(h,d)))}))})(r.localStore,e);gp(r,e,t),mp(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Xs(r,s)}catch(s){await Wr(s)}}function mp(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function gp(n,e,t){const r=z(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Za(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||_p(n,r)}))}function _p(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(qc(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Jc(n))}function bh(n,e,t){for(const r of t)r instanceof hp?(n.Ru.addReference(r.key,e),GT(n,r)):r instanceof fp?(x(Xc,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||_p(n,r.key)):$(19791,{wu:r})}function GT(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(x(Xc,"New document in limbo: "+t),n.Eu.add(r),Jc(n))}function Jc(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new B(ce.fromString(e)),r=n.fu.next();n.Au.set(r,new LT(t)),n.du=n.du.insert(t,r),ip(n.remoteStore,new un(wt(Oc(t.path)),r,"TargetPurposeLimboResolution",_o.ce))}}async function Xs(n,e,t){const r=z(n),s=[],i=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((c,l)=>{a.push(r.pu(l,e,t).then((h=>{if((h||t)&&r.isPrimaryClient){const d=h?!h.fromCache:t?.targetChanges.get(l.targetId)?.current;r.sharedClientState.updateQueryState(l.targetId,d?"current":"not-current")}if(h){s.push(h);const d=$c.As(l.targetId,h);i.push(d)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(l,h){const d=z(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>k.forEach(h,(m=>k.forEach(m.Es,(I=>d.persistence.referenceDelegate.addReference(g,m.targetId,I))).next((()=>k.forEach(m.ds,(I=>d.persistence.referenceDelegate.removeReference(g,m.targetId,I)))))))))}catch(g){if(!Gr(g))throw g;x(jc,"Failed to update sequence numbers: "+g)}for(const g of h){const m=g.targetId;if(!g.fromCache){const I=d.Ms.get(m),S=I.snapshotVersion,C=I.withLastLimboFreeSnapshotVersion(S);d.Ms=d.Ms.insert(m,C)}}})(r.localStore,i))}async function KT(n,e){const t=z(n);if(!t.currentUser.isEqual(e)){x(Xc,"User change. New user:",e.toKey());const r=await tp(t.localStore,e);t.currentUser=e,(function(i,a){i.mu.forEach((c=>{c.forEach((l=>{l.reject(new F(N.CANCELLED,a))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Xs(t,r.Ls)}}function QT(n,e){const t=z(n),r=t.Au.get(e);if(r&&r.hu)return X().add(r.key);{let s=X();const i=t.Iu.get(e);if(!i)return s;for(const a of i){const c=t.Tu.get(a);s=s.unionWith(c.view.nu)}return s}}function yp(n){const e=z(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=pp.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=QT.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=zT.bind(null,e),e.Pu.H_=NT.bind(null,e.eventManager),e.Pu.yu=DT.bind(null,e.eventManager),e}function XT(n){const e=z(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=HT.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=WT.bind(null,e),e}class Gi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=So(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return JE(this.persistence,new KE,e.initialUser,this.serializer)}Cu(e){return new ep(Bc.mi,this.serializer)}Du(e){return new sT}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Gi.provider={build:()=>new Gi};class JT extends Gi{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){te(this.persistence.referenceDelegate instanceof Hi,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new VE(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?He.withCacheSize(this.cacheSizeBytes):He.DEFAULT;return new ep((r=>Hi.mi(r,t)),this.serializer)}}class ec{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ah(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=KT.bind(null,this.syncEngine),await ST(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new PT})()}createDatastore(e){const t=So(e.databaseInfo.databaseId),r=(function(i){return new uT(i)})(e.databaseInfo);return(function(i,a,c,l){return new dT(i,a,c,l)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,i,a,c){return new mT(r,s,i,a,c)})(this.localStore,this.datastore,e.asyncQueue,(t=>Ah(this.syncEngine,t,0)),(function(){return yh.v()?new yh:new iT})())}createSyncEngine(e,t){return(function(s,i,a,c,l,h,d){const g=new xT(s,i,a,c,l,h);return d&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=z(t);x(Xn,"RemoteStore shutting down."),r.Ea.add(5),await Qs(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}ec.provider={build:()=>new ec};class YT{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):qt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const An="FirestoreClient";class ZT{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Oe.UNAUTHENTICATED,this.clientId=Rc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,(async a=>{x(An,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(x(An,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Bn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Kc(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Ea(n,e){n.asyncQueue.verifyOperationInProgress(),x(An,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await tp(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function Sh(n,e){n.asyncQueue.verifyOperationInProgress();const t=await eI(n);x(An,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>Eh(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>Eh(e.remoteStore,s))),n._onlineComponents=e}async function eI(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){x(An,"Using user provided OfflineComponentProvider");try{await Ea(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===N.FAILED_PRECONDITION||s.code===N.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;Dr("Error using user provided cache. Falling back to memory cache: "+t),await Ea(n,new Gi)}}else x(An,"Using default OfflineComponentProvider"),await Ea(n,new JT(void 0));return n._offlineComponents}async function vp(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(x(An,"Using user provided OnlineComponentProvider"),await Sh(n,n._uninitializedComponentsProvider._online)):(x(An,"Using default OnlineComponentProvider"),await Sh(n,new ec))),n._onlineComponents}function tI(n){return vp(n).then((e=>e.syncEngine))}async function Rh(n){const e=await vp(n),t=e.eventManager;return t.onListen=FT.bind(null,e.syncEngine),t.onUnlisten=$T.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=UT.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=jT.bind(null,e.syncEngine),t}function Ep(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const Ph=new Map;const Tp="firestore.googleapis.com",Ch=!0;class kh{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new F(N.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Tp,this.ssl=Ch}else this.host=e.host,this.ssl=e.ssl??Ch;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Zd;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<NE)throw new F(N.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}pv("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ep(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new F(N.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new F(N.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new F(N.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Co{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new kh({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new F(N.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new F(N.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new kh(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new sv;switch(r.type){case"firstParty":return new cv(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new F(N.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=Ph.get(t);r&&(x("ComponentProvider","Removing Datastore"),Ph.delete(t),r.terminate())})(this),Promise.resolve()}}function nI(n,e,t,r={}){n=$n(n,Co);const s=bn(e),i=n._getSettings(),a={...i,emulatorOptions:n._getEmulatorOptions()},c=`${e}:${t}`;s&&(Tc(`https://${c}`),Ic("Firestore",!0)),i.host!==Tp&&i.host!==c&&Dr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:c,ssl:s,emulatorOptions:r};if(!Gn(l,a)&&(n._setSettings(l),r.mockUserToken)){let h,d;if(typeof r.mockUserToken=="string")h=r.mockUserToken,d=Oe.MOCK_USER;else{h=C_(r.mockUserToken,n._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new F(N.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Oe(g)}n._authCredentials=new iv(new hd(h,d))}}class ko{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new ko(this.firestore,e,this._query)}}class Ie{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new gn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ie(this.firestore,e,this._key)}toJSON(){return{type:Ie._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Ws(t,Ie._jsonSchema))return new Ie(e,r||null,new B(ce.fromString(t.referencePath)))}}Ie._jsonSchemaVersion="firestore/documentReference/1.0",Ie._jsonSchema={type:_e("string",Ie._jsonSchemaVersion),referencePath:_e("string")};class gn extends ko{constructor(e,t,r){super(e,t,Oc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ie(this.firestore,null,new B(e))}withConverter(e){return new gn(this.firestore,e,this._path)}}function Ip(n,e,...t){if(n=ye(n),fd("collection","path",e),n instanceof Co){const r=ce.fromString(e,...t);return ql(r),new gn(n,null,r)}{if(!(n instanceof Ie||n instanceof gn))throw new F(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ce.fromString(e,...t));return ql(r),new gn(n.firestore,null,r)}}function wp(n,e,...t){if(n=ye(n),arguments.length===1&&(e=Rc.newId()),fd("doc","path",e),n instanceof Co){const r=ce.fromString(e,...t);return jl(r),new Ie(n,null,new B(r))}{if(!(n instanceof Ie||n instanceof gn))throw new F(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ce.fromString(e,...t));return jl(r),new Ie(n.firestore,n instanceof gn?n.converter:null,new B(r))}}const Nh="AsyncQueue";class Dh{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new rp(this,"async_queue_retry"),this._c=()=>{const r=va();r&&x(Nh,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=va();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=va();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Bn;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Gr(e))throw e;x(Nh,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,qt("INTERNAL UNHANDLED ERROR: ",Vh(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=Gc.createAndSchedule(this,e,t,r,(i=>this.hc(i)));return this.tc.push(s),s}uc(){this.nc&&$(47125,{Pc:Vh(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Vh(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function Oh(n){return(function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1})(n,["next","error","complete"])}class Fs extends Co{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Dh,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Dh(e),this._firestoreClient=void 0,await e}}}function rI(n,e){const t=typeof n=="object"?n:bc(),r=typeof n=="string"?n:Fi,s=go(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=Xf("firestore");i&&nI(s,...i)}return s}function Ap(n){if(n._terminated)throw new F(N.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||sI(n),n._firestoreClient}function sI(n){const e=n._freezeSettings(),t=(function(s,i,a,c){return new bv(s,i,a,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,Ep(c.experimentalLongPollingOptions),c.useFetchStreams,c.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new ZT(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}})(n._componentsProvider))}class ot{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ot(ke.fromBase64String(e))}catch(t){throw new F(N.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ot(ke.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:ot._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ws(e,ot._jsonSchema))return ot.fromBase64String(e.bytes)}}ot._jsonSchemaVersion="firestore/bytes/1.0",ot._jsonSchema={type:_e("string",ot._jsonSchemaVersion),bytes:_e("string")};class No{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new F(N.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Re(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Yc{constructor(e){this._methodName=e}}class St{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new F(N.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new F(N.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Q(this._lat,e._lat)||Q(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:St._jsonSchemaVersion}}static fromJSON(e){if(Ws(e,St._jsonSchema))return new St(e.latitude,e.longitude)}}St._jsonSchemaVersion="firestore/geoPoint/1.0",St._jsonSchema={type:_e("string",St._jsonSchemaVersion),latitude:_e("number"),longitude:_e("number")};class Rt{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Rt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ws(e,Rt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Rt(e.vectorValues);throw new F(N.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Rt._jsonSchemaVersion="firestore/vectorValue/1.0",Rt._jsonSchema={type:_e("string",Rt._jsonSchemaVersion),vectorValues:_e("object")};const iI=/^__.*__$/;class oI{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Rn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Gs(e,this.data,t,this.fieldTransforms)}}class bp{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Rn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Sp(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $(40011,{Ac:n})}}class Zc{constructor(e,t,r,s,i,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Zc({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Ki(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(Sp(this.Ac)&&iI.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class aI{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||So(e)}Cc(e,t,r,s=!1){return new Zc({Ac:e,methodName:t,Dc:r,path:Re.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Rp(n){const e=n._freezeSettings(),t=So(n._databaseId);return new aI(n._databaseId,!!e.ignoreUndefinedProperties,t)}function cI(n,e,t,r,s,i={}){const a=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);eu("Data must be an object, but it was:",a,r);const c=Pp(r,a);let l,h;if(i.merge)l=new et(a.fieldMask),h=a.fieldTransforms;else if(i.mergeFields){const d=[];for(const g of i.mergeFields){const m=tc(e,g,t);if(!a.contains(m))throw new F(N.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);kp(d,m)||d.push(m)}l=new et(d),h=a.fieldTransforms.filter((g=>l.covers(g.field)))}else l=null,h=a.fieldTransforms;return new oI(new We(c),l,h)}class Do extends Yc{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Do}}function uI(n,e,t,r){const s=n.Cc(1,e,t);eu("Data must be an object, but it was:",s,r);const i=[],a=We.empty();Sn(r,((l,h)=>{const d=tu(e,l,t);h=ye(h);const g=s.yc(d);if(h instanceof Do)i.push(d);else{const m=Vo(h,g);m!=null&&(i.push(d),a.set(d,m))}}));const c=new et(i);return new bp(a,c,s.fieldTransforms)}function lI(n,e,t,r,s,i){const a=n.Cc(1,e,t),c=[tc(e,r,t)],l=[s];if(i.length%2!=0)throw new F(N.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)c.push(tc(e,i[m])),l.push(i[m+1]);const h=[],d=We.empty();for(let m=c.length-1;m>=0;--m)if(!kp(h,c[m])){const I=c[m];let S=l[m];S=ye(S);const C=a.yc(I);if(S instanceof Do)h.push(I);else{const P=Vo(S,C);P!=null&&(h.push(I),d.set(I,P))}}const g=new et(h);return new bp(d,g,a.fieldTransforms)}function Vo(n,e){if(Cp(n=ye(n)))return eu("Unsupported field value:",e,n),Pp(n,e);if(n instanceof Yc)return(function(r,s){if(!Sp(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const i=[];let a=0;for(const c of r){let l=Vo(c,s.wc(a));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),a++}return{arrayValue:{values:i}}})(n,e)}return(function(r,s){if((r=ye(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Qv(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=ue.fromDate(r);return{timestampValue:zi(s.serializer,i)}}if(r instanceof ue){const i=new ue(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:zi(s.serializer,i)}}if(r instanceof St)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ot)return{bytesValue:Wd(s.serializer,r._byteString)};if(r instanceof Ie){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Fc(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Rt)return(function(a,c){return{mapValue:{fields:{[Td]:{stringValue:Id},[Ui]:{arrayValue:{values:a.toArray().map((h=>{if(typeof h!="number")throw c.Sc("VectorValues must only contain numeric values.");return Mc(c.serializer,h)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${Pc(r)}`)})(n,e)}function Pp(n,e){const t={};return md(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Sn(n,((r,s)=>{const i=Vo(s,e.mc(r));i!=null&&(t[r]=i)})),{mapValue:{fields:t}}}function Cp(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ue||n instanceof St||n instanceof ot||n instanceof Ie||n instanceof Yc||n instanceof Rt)}function eu(n,e,t){if(!Cp(t)||!dd(t)){const r=Pc(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function tc(n,e,t){if((e=ye(e))instanceof No)return e._internalPath;if(typeof e=="string")return tu(n,e);throw Ki("Field path arguments must be of type string or ",n,!1,void 0,t)}const hI=new RegExp("[~\\*/\\[\\]]");function tu(n,e,t){if(e.search(hI)>=0)throw Ki(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new No(...e.split("."))._internalPath}catch{throw Ki(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ki(n,e,t,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${r}`),a&&(l+=` in document ${s}`),l+=")"),new F(N.INVALID_ARGUMENT,c+n+l)}function kp(n,e){return n.some((t=>t.isEqual(e)))}class Np{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ie(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new fI(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Dp("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class fI extends Np{data(){return super.data()}}function Dp(n,e){return typeof e=="string"?tu(n,e):e instanceof No?e._internalPath:e._delegate._internalPath}function dI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new F(N.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class pI{convertValue(e,t="none"){switch(In(e)){case 0:return null;case 1:return e.booleanValue;case 2:return me(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Tn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw $(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Sn(e,((s,i)=>{r[s]=this.convertValue(i,t)})),r}convertVectorValue(e){const t=e.fields?.[Ui].arrayValue?.values?.map((r=>me(r.doubleValue)));return new Rt(t)}convertGeoPoint(e){return new St(me(e.latitude),me(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=vo(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Vs(e));default:return null}}convertTimestamp(e){const t=En(e);return new ue(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ce.fromString(e);te(Yd(r),9688,{name:e});const s=new Os(r.get(1),r.get(3)),i=new B(r.popFirst(5));return s.isEqual(t)||qt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function mI(n,e,t){let r;return r=n?n.toFirestore(e):e,r}class ys{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class jn extends Np{constructor(e,t,r,s,i,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ri(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Dp("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new F(N.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=jn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}jn._jsonSchemaVersion="firestore/documentSnapshot/1.0",jn._jsonSchema={type:_e("string",jn._jsonSchemaVersion),bundleSource:_e("string","DocumentSnapshot"),bundleName:_e("string"),bundle:_e("string")};class Ri extends jn{data(e={}){return super.data(e)}}class wr{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new ys(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new Ri(this._firestore,this._userDataWriter,r.key,r,new ys(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new F(N.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((c=>{const l=new Ri(s._firestore,s._userDataWriter,c.doc.key,c.doc,new ys(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);return c.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((c=>i||c.type!==3)).map((c=>{const l=new Ri(s._firestore,s._userDataWriter,c.doc.key,c.doc,new ys(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);let h=-1,d=-1;return c.type!==0&&(h=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),d=a.indexOf(c.doc.key)),{type:gI(c.type),doc:l,oldIndex:h,newIndex:d}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new F(N.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=wr._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Rc.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function gI(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $(61501,{type:n})}}wr._jsonSchemaVersion="firestore/querySnapshot/1.0",wr._jsonSchema={type:_e("string",wr._jsonSchemaVersion),bundleSource:_e("string","QuerySnapshot"),bundleName:_e("string"),bundle:_e("string")};class Vp extends pI{constructor(e){super(),this.firestore=e}convertBytes(e){return new ot(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ie(this.firestore,null,t)}}function _I(n,e,t,...r){n=$n(n,Ie);const s=$n(n.firestore,Fs),i=Rp(s);let a;return a=typeof(e=ye(e))=="string"||e instanceof No?lI(i,"updateDoc",n._key,e,t,r):uI(i,"updateDoc",n._key,e),Op(s,[a.toMutation(n._key,At.exists(!0))])}function yI(n,e){const t=$n(n.firestore,Fs),r=wp(n),s=mI(n.converter,e);return Op(t,[cI(Rp(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,At.exists(!1))]).then((()=>r))}function vI(n,...e){n=ye(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||Oh(e[r])||(t=e[r++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Oh(e[r])){const l=e[r];e[r]=l.next?.bind(l),e[r+1]=l.error?.bind(l),e[r+2]=l.complete?.bind(l)}let i,a,c;if(n instanceof Ie)a=$n(n.firestore,Fs),c=Oc(n._key.path),i={next:l=>{e[r]&&e[r](EI(a,n,l))},error:e[r+1],complete:e[r+2]};else{const l=$n(n,ko);a=$n(l.firestore,Fs),c=l._query;const h=new Vp(a);i={next:d=>{e[r]&&e[r](new wr(a,h,l,d))},error:e[r+1],complete:e[r+2]},dI(n._query)}return(function(h,d,g,m){const I=new YT(m),S=new VT(d,I,g);return h.asyncQueue.enqueueAndForget((async()=>CT(await Rh(h),S))),()=>{I.Nu(),h.asyncQueue.enqueueAndForget((async()=>kT(await Rh(h),S)))}})(Ap(a),c,s,i)}function Op(n,e){return(function(r,s){const i=new Bn;return r.asyncQueue.enqueueAndForget((async()=>qT(await tI(r),s,i))),i.promise})(Ap(n),e)}function EI(n,e,t){const r=t.docs.get(e._key),s=new Vp(n);return new jn(n,s,e._key,r,new ys(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(s){Hr=s})(zr),Kn(new yn("firestore",((r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),c=new Fs(new ov(r.getProvider("auth-internal")),new uv(a,r.getProvider("app-check-internal")),(function(h,d){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new F(N.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Os(h.options.projectId,d)})(a,s),a);return i={useFetchStreams:t,...i},c._setSettings(i),c}),"PUBLIC").setMultipleInstances(!0)),It(Fl,Ul,e),It(Fl,Ul,"esm2020")})();function Mp(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const TI=Mp,Lp=new zs("auth","Firebase",Mp());const Qi=new wc("@firebase/auth");function II(n,...e){Qi.logLevel<=K.WARN&&Qi.warn(`Auth (${zr}): ${n}`,...e)}function Pi(n,...e){Qi.logLevel<=K.ERROR&&Qi.error(`Auth (${zr}): ${n}`,...e)}function Ot(n,...e){throw ru(n,...e)}function ft(n,...e){return ru(n,...e)}function nu(n,e,t){const r={...TI(),[e]:t};return new zs("auth","Firebase",r).create(e,{appName:n.name})}function qn(n){return nu(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function wI(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Ot(n,"argument-error"),nu(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ru(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Lp.create(n,...e)}function j(n,e,...t){if(!n)throw ru(e,...t)}function Ut(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Pi(e),new Error(e)}function Ht(n,e){n||Ut(e)}function nc(){return typeof self<"u"&&self.location?.href||""}function AI(){return Mh()==="http:"||Mh()==="https:"}function Mh(){return typeof self<"u"&&self.location?.protocol||null}function bI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(AI()||M_()||"connection"in navigator)?navigator.onLine:!0}function SI(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class Js{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ht(t>e,"Short delay should be less than long delay!"),this.isMobile=D_()||L_()}get(){return bI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function su(n,e){Ht(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class xp{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ut("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ut("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ut("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const RI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const PI=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],CI=new Js(3e4,6e4);function iu(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Qr(n,e,t,r,s={}){return Fp(n,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const c=Hs({key:n.config.apiKey,...a}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const h={method:e,headers:l,...i};return O_()||(h.referrerPolicy="no-referrer"),n.emulatorConfig&&bn(n.emulatorConfig.host)&&(h.credentials="include"),xp.fetch()(await Up(n,n.config.apiHost,t,c),h)})}async function Fp(n,e,t){n._canInitEmulator=!1;const r={...RI,...e};try{const s=new NI(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Ei(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const c=i.ok?a.errorMessage:a.error.message,[l,h]=c.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ei(n,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw Ei(n,"email-already-in-use",a);if(l==="USER_DISABLED")throw Ei(n,"user-disabled",a);const d=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw nu(n,d,h);Ot(n,d)}}catch(s){if(s instanceof Lt)throw s;Ot(n,"network-request-failed",{message:String(s)})}}async function kI(n,e,t,r,s={}){const i=await Qr(n,e,t,r,s);return"mfaPendingCredential"in i&&Ot(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function Up(n,e,t,r){const s=`${e}${t}?${r}`,i=n,a=i.config.emulator?su(n.config,s):`${n.config.apiScheme}://${s}`;return PI.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(a).toString():a}class NI{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(ft(this.auth,"network-request-failed")),CI.get())})}}function Ei(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=ft(n,e,r);return s.customData._tokenResponse=t,s}async function DI(n,e){return Qr(n,"POST","/v1/accounts:delete",e)}async function Xi(n,e){return Qr(n,"POST","/v1/accounts:lookup",e)}function Ss(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function VI(n,e=!1){const t=ye(n),r=await t.getIdToken(e),s=ou(r);j(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i?.sign_in_provider;return{claims:s,token:r,authTime:Ss(Ta(s.auth_time)),issuedAtTime:Ss(Ta(s.iat)),expirationTime:Ss(Ta(s.exp)),signInProvider:a||null,signInSecondFactor:i?.sign_in_second_factor||null}}function Ta(n){return Number(n)*1e3}function ou(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Pi("JWT malformed, contained fewer than 3 sections"),null;try{const s=Kf(t);return s?JSON.parse(s):(Pi("Failed to decode base64 JWT payload"),null)}catch(s){return Pi("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Lh(n){const e=ou(n);return j(e,"internal-error"),j(typeof e.exp<"u","internal-error"),j(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Us(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Lt&&OI(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function OI({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class MI{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class rc{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ss(this.lastLoginAt),this.creationTime=Ss(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Ji(n){const e=n.auth,t=await n.getIdToken(),r=await Us(n,Xi(e,{idToken:t}));j(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=s.providerUserInfo?.length?Bp(s.providerUserInfo):[],a=xI(n.providerData,i),c=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!a?.length,h=c?l:!1,d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new rc(s.createdAt,s.lastLoginAt),isAnonymous:h};Object.assign(n,d)}async function LI(n){const e=ye(n);await Ji(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function xI(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Bp(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function FI(n,e){const t=await Fp(n,{},async()=>{const r=Hs({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,a=await Up(n,s,"/v1/token",`key=${i}`),c=await n._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:c,body:r};return n.emulatorConfig&&bn(n.emulatorConfig.host)&&(l.credentials="include"),xp.fetch()(a,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function UI(n,e){return Qr(n,"POST","/v2/accounts:revokeToken",iu(n,e))}class Ar{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){j(e.idToken,"internal-error"),j(typeof e.idToken<"u","internal-error"),j(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Lh(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){j(e.length!==0,"internal-error");const t=Lh(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(j(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await FI(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,a=new Ar;return r&&(j(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(j(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(j(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ar,this.toJSON())}_performRefresh(){return Ut("not implemented")}}function sn(n,e){j(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class lt{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new MI(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new rc(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Us(this,this.stsTokenManager.getToken(this.auth,e));return j(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return VI(this,e)}reload(){return LI(this)}_assign(e){this!==e&&(j(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new lt({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){j(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Ji(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(it(this.auth.app))return Promise.reject(qn(this.auth));const e=await this.getIdToken();return await Us(this,DI(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,a=t.photoURL??void 0,c=t.tenantId??void 0,l=t._redirectEventId??void 0,h=t.createdAt??void 0,d=t.lastLoginAt??void 0,{uid:g,emailVerified:m,isAnonymous:I,providerData:S,stsTokenManager:C}=t;j(g&&C,e,"internal-error");const P=Ar.fromJSON(this.name,C);j(typeof g=="string",e,"internal-error"),sn(r,e.name),sn(s,e.name),j(typeof m=="boolean",e,"internal-error"),j(typeof I=="boolean",e,"internal-error"),sn(i,e.name),sn(a,e.name),sn(c,e.name),sn(l,e.name),sn(h,e.name),sn(d,e.name);const D=new lt({uid:g,auth:e,email:s,emailVerified:m,displayName:r,isAnonymous:I,photoURL:a,phoneNumber:i,tenantId:c,stsTokenManager:P,createdAt:h,lastLoginAt:d});return S&&Array.isArray(S)&&(D.providerData=S.map(M=>({...M}))),l&&(D._redirectEventId=l),D}static async _fromIdTokenResponse(e,t,r=!1){const s=new Ar;s.updateFromServerResponse(t);const i=new lt({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Ji(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];j(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?Bp(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!i?.length,c=new Ar;c.updateFromIdToken(r);const l=new lt({uid:s.localId,auth:e,stsTokenManager:c,isAnonymous:a}),h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new rc(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!i?.length};return Object.assign(l,h),l}}const xh=new Map;function Bt(n){Ht(n instanceof Function,"Expected a class definition");let e=xh.get(n);return e?(Ht(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,xh.set(n,e),e)}class $p{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}$p.type="NONE";const Fh=$p;function Ci(n,e,t){return`firebase:${n}:${e}:${t}`}class br{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Ci(this.userKey,s.apiKey,i),this.fullPersistenceKey=Ci("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Xi(this.auth,{idToken:e}).catch(()=>{});return t?lt._fromGetAccountInfoResponse(this.auth,t,e):null}return lt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new br(Bt(Fh),e,r);const s=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let i=s[0]||Bt(Fh);const a=Ci(r,e.config.apiKey,e.name);let c=null;for(const h of t)try{const d=await h._get(a);if(d){let g;if(typeof d=="string"){const m=await Xi(e,{idToken:d}).catch(()=>{});if(!m)break;g=await lt._fromGetAccountInfoResponse(e,m,d)}else g=lt._fromJSON(e,d);h!==i&&(c=g),i=h;break}}catch{}const l=s.filter(h=>h._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new br(i,e,r):(i=l[0],c&&await i._set(a,c.toJSON()),await Promise.all(t.map(async h=>{if(h!==i)try{await h._remove(a)}catch{}})),new br(i,e,r))}}function Uh(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Hp(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(jp(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Gp(e))return"Blackberry";if(Kp(e))return"Webos";if(qp(e))return"Safari";if((e.includes("chrome/")||zp(e))&&!e.includes("edge/"))return"Chrome";if(Wp(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function jp(n=Fe()){return/firefox\//i.test(n)}function qp(n=Fe()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function zp(n=Fe()){return/crios\//i.test(n)}function Hp(n=Fe()){return/iemobile/i.test(n)}function Wp(n=Fe()){return/android/i.test(n)}function Gp(n=Fe()){return/blackberry/i.test(n)}function Kp(n=Fe()){return/webos/i.test(n)}function au(n=Fe()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function BI(n=Fe()){return au(n)&&!!window.navigator?.standalone}function $I(){return x_()&&document.documentMode===10}function Qp(n=Fe()){return au(n)||Wp(n)||Kp(n)||Gp(n)||/windows phone/i.test(n)||Hp(n)}function Xp(n,e=[]){let t;switch(n){case"Browser":t=Uh(Fe());break;case"Worker":t=`${Uh(Fe())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${zr}/${r}`}class jI{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((a,c)=>{try{const l=e(i);a(l)}catch(l){c(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function qI(n,e={}){return Qr(n,"GET","/v2/passwordPolicy",iu(n,e))}const zI=6;class HI{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??zI,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class WI{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Bh(this),this.idTokenSubscription=new Bh(this),this.beforeStateQueue=new jI(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Lp,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Bt(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await br.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Xi(this,{idToken:e}),r=await lt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(it(this.app)){const i=this.app.settings.authIdToken;return i?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(i).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=this.redirectUser?._redirectEventId,a=r?._redirectEventId,c=await this.tryRedirectSignIn(e);(!i||i===a)&&c?.user&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(i){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return j(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ji(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=SI()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(it(this.app))return Promise.reject(qn(this));const t=e?ye(e):null;return t&&j(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&j(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return it(this.app)?Promise.reject(qn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return it(this.app)?Promise.reject(qn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Bt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await qI(this),t=new HI(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new zs("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await UI(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Bt(e)||this._popupRedirectResolver;j(t,this,"argument-error"),this.redirectPersistenceManager=await br.create(this,[Bt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(j(c,this,"internal-error"),c.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{a=!0,l()}}else{const l=e.addObserver(t);return()=>{a=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return j(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Xp(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(it(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&II(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Oo(n){return ye(n)}class Bh{constructor(e){this.auth=e,this.observer=null,this.addObserver=H_(t=>this.observer=t)}get next(){return j(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let cu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function GI(n){cu=n}function KI(n){return cu.loadJS(n)}function QI(){return cu.gapiScript}function XI(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function JI(n,e){const t=go(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Gn(i,e??{}))return s;Ot(s,"already-initialized")}return t.initialize({options:e})}function YI(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(Bt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function ZI(n,e,t){const r=Oo(n);j(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=Jp(e),{host:a,port:c}=ew(e),l=c===null?"":`:${c}`,h={url:`${i}//${a}${l}/`},d=Object.freeze({host:a,port:c,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){j(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),j(Gn(h,r.config.emulator)&&Gn(d,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=h,r.emulatorConfig=d,r.settings.appVerificationDisabledForTesting=!0,bn(a)?(Tc(`${i}//${a}${l}`),Ic("Auth",!0)):tw()}function Jp(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function ew(n){const e=Jp(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:$h(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:$h(a)}}}function $h(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function tw(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Yp{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ut("not implemented")}_getIdTokenResponse(e){return Ut("not implemented")}_linkToIdToken(e,t){return Ut("not implemented")}_getReauthenticationResolver(e){return Ut("not implemented")}}async function Sr(n,e){return kI(n,"POST","/v1/accounts:signInWithIdp",iu(n,e))}const nw="http://localhost";class Jn extends Yp{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Jn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ot("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const a=new Jn(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return Sr(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Sr(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Sr(e,t)}buildRequest(){const e={requestUri:nw,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Hs(t)}return e}}class uu{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Ys extends uu{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class on extends Ys{constructor(){super("facebook.com")}static credential(e){return Jn._fromParams({providerId:on.PROVIDER_ID,signInMethod:on.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return on.credentialFromTaggedObject(e)}static credentialFromError(e){return on.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return on.credential(e.oauthAccessToken)}catch{return null}}}on.FACEBOOK_SIGN_IN_METHOD="facebook.com";on.PROVIDER_ID="facebook.com";class Ft extends Ys{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Jn._fromParams({providerId:Ft.PROVIDER_ID,signInMethod:Ft.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ft.credentialFromTaggedObject(e)}static credentialFromError(e){return Ft.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Ft.credential(t,r)}catch{return null}}}Ft.GOOGLE_SIGN_IN_METHOD="google.com";Ft.PROVIDER_ID="google.com";class an extends Ys{constructor(){super("github.com")}static credential(e){return Jn._fromParams({providerId:an.PROVIDER_ID,signInMethod:an.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return an.credentialFromTaggedObject(e)}static credentialFromError(e){return an.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return an.credential(e.oauthAccessToken)}catch{return null}}}an.GITHUB_SIGN_IN_METHOD="github.com";an.PROVIDER_ID="github.com";class cn extends Ys{constructor(){super("twitter.com")}static credential(e,t){return Jn._fromParams({providerId:cn.PROVIDER_ID,signInMethod:cn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return cn.credentialFromTaggedObject(e)}static credentialFromError(e){return cn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return cn.credential(t,r)}catch{return null}}}cn.TWITTER_SIGN_IN_METHOD="twitter.com";cn.PROVIDER_ID="twitter.com";class Fr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await lt._fromIdTokenResponse(e,r,s),a=jh(r);return new Fr({user:i,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=jh(r);return new Fr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function jh(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class Yi extends Lt{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Yi.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Yi(e,t,r,s)}}function Zp(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Yi._fromErrorAndOperation(n,i,e,r):i})}async function rw(n,e,t=!1){const r=await Us(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Fr._forOperation(n,"link",r)}async function sw(n,e,t=!1){const{auth:r}=n;if(it(r.app))return Promise.reject(qn(r));const s="reauthenticate";try{const i=await Us(n,Zp(r,s,e,n),t);j(i.idToken,r,"internal-error");const a=ou(i.idToken);j(a,r,"internal-error");const{sub:c}=a;return j(n.uid===c,r,"user-mismatch"),Fr._forOperation(n,s,i)}catch(i){throw i?.code==="auth/user-not-found"&&Ot(r,"user-mismatch"),i}}async function iw(n,e,t=!1){if(it(n.app))return Promise.reject(qn(n));const r="signIn",s=await Zp(n,r,e),i=await Fr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}function ow(n,e,t,r){return ye(n).onIdTokenChanged(e,t,r)}function aw(n,e,t){return ye(n).beforeAuthStateChanged(e,t)}function cw(n,e,t,r){return ye(n).onAuthStateChanged(e,t,r)}function uw(n){return ye(n).signOut()}const Zi="__sak";class em{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Zi,"1"),this.storage.removeItem(Zi),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const lw=1e3,hw=10;class tm extends em{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Qp(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,c,l)=>{this.notifyListeners(a,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);$I()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,hw):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},lw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}tm.type="LOCAL";const fw=tm;class nm extends em{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}nm.type="SESSION";const rm=nm;function dw(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Mo{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Mo(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const c=Array.from(a).map(async h=>h(t.origin,i)),l=await dw(c);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Mo.receivers=[];function lu(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class pw{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((c,l)=>{const h=lu("",20);s.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(g){const m=g;if(m.data.eventId===h)switch(m.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),c(m.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function Pt(){return window}function mw(n){Pt().location.href=n}function sm(){return typeof Pt().WorkerGlobalScope<"u"&&typeof Pt().importScripts=="function"}async function gw(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function _w(){return navigator?.serviceWorker?.controller||null}function yw(){return sm()?self:null}const im="firebaseLocalStorageDb",vw=1,eo="firebaseLocalStorage",om="fbase_key";class Zs{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Lo(n,e){return n.transaction([eo],e?"readwrite":"readonly").objectStore(eo)}function Ew(){const n=indexedDB.deleteDatabase(im);return new Zs(n).toPromise()}function sc(){const n=indexedDB.open(im,vw);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(eo,{keyPath:om})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(eo)?e(r):(r.close(),await Ew(),e(await sc()))})})}async function qh(n,e,t){const r=Lo(n,!0).put({[om]:e,value:t});return new Zs(r).toPromise()}async function Tw(n,e){const t=Lo(n,!1).get(e),r=await new Zs(t).toPromise();return r===void 0?null:r.value}function zh(n,e){const t=Lo(n,!0).delete(e);return new Zs(t).toPromise()}const Iw=800,ww=3;class am{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await sc(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>ww)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return sm()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Mo._getInstance(yw()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await gw(),!this.activeServiceWorker)return;this.sender=new pw(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||_w()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await sc();return await qh(e,Zi,"1"),await zh(e,Zi),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>qh(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Tw(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>zh(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Lo(s,!1).getAll();return new Zs(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Iw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}am.type="LOCAL";const Aw=am;new Js(3e4,6e4);function cm(n,e){return e?Bt(e):(j(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class hu extends Yp{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Sr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Sr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Sr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function bw(n){return iw(n.auth,new hu(n),n.bypassAuthState)}function Sw(n){const{auth:e,user:t}=n;return j(t,e,"internal-error"),sw(t,new hu(n),n.bypassAuthState)}async function Rw(n){const{auth:e,user:t}=n;return j(t,e,"internal-error"),rw(t,new hu(n),n.bypassAuthState)}class um{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:a,type:c}=e;if(a){this.reject(a);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(l))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return bw;case"linkViaPopup":case"linkViaRedirect":return Rw;case"reauthViaPopup":case"reauthViaRedirect":return Sw;default:Ot(this.auth,"internal-error")}}resolve(e){Ht(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ht(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Pw=new Js(2e3,1e4);async function Cw(n,e,t){if(it(n.app))return Promise.reject(ft(n,"operation-not-supported-in-this-environment"));const r=Oo(n);wI(n,e,uu);const s=cm(r,t);return new Ln(r,"signInViaPopup",e,s).executeNotNull()}class Ln extends um{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Ln.currentPopupAction&&Ln.currentPopupAction.cancel(),Ln.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return j(e,this.auth,"internal-error"),e}async onExecution(){Ht(this.filter.length===1,"Popup operations only handle one event");const e=lu();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(ft(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(ft(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ln.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ft(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Pw.get())};e()}}Ln.currentPopupAction=null;const kw="pendingRedirect",ki=new Map;class Nw extends um{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=ki.get(this.auth._key());if(!e){try{const r=await Dw(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}ki.set(this.auth._key(),e)}return this.bypassAuthState||ki.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Dw(n,e){const t=Mw(e),r=Ow(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function Vw(n,e){ki.set(n._key(),e)}function Ow(n){return Bt(n._redirectPersistence)}function Mw(n){return Ci(kw,n.config.apiKey,n.name)}async function Lw(n,e,t=!1){if(it(n.app))return Promise.reject(qn(n));const r=Oo(n),s=cm(r,e),a=await new Nw(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const xw=600*1e3;class Fw{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Uw(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!lm(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(ft(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=xw&&this.cachedEventUids.clear(),this.cachedEventUids.has(Hh(e))}saveEventToCache(e){this.cachedEventUids.add(Hh(e)),this.lastProcessedEventTime=Date.now()}}function Hh(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function lm({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function Uw(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return lm(n);default:return!1}}async function Bw(n,e={}){return Qr(n,"GET","/v1/projects",e)}const $w=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,jw=/^https?/;async function qw(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Bw(n);for(const t of e)try{if(zw(t))return}catch{}Ot(n,"unauthorized-domain")}function zw(n){const e=nc(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!jw.test(t))return!1;if($w.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const Hw=new Js(3e4,6e4);function Wh(){const n=Pt().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Ww(n){return new Promise((e,t)=>{function r(){Wh(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Wh(),t(ft(n,"network-request-failed"))},timeout:Hw.get()})}if(Pt().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Pt().gapi?.load)r();else{const s=XI("iframefcb");return Pt()[s]=()=>{gapi.load?r():t(ft(n,"network-request-failed"))},KI(`${QI()}?onload=${s}`).catch(i=>t(i))}}).catch(e=>{throw Ni=null,e})}let Ni=null;function Gw(n){return Ni=Ni||Ww(n),Ni}const Kw=new Js(5e3,15e3),Qw="__/auth/iframe",Xw="emulator/auth/iframe",Jw={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Yw=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Zw(n){const e=n.config;j(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?su(e,Xw):`https://${n.config.authDomain}/${Qw}`,r={apiKey:e.apiKey,appName:n.name,v:zr},s=Yw.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Hs(r).slice(1)}`}async function eA(n){const e=await Gw(n),t=Pt().gapi;return j(t,n,"internal-error"),e.open({where:document.body,url:Zw(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Jw,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=ft(n,"network-request-failed"),c=Pt().setTimeout(()=>{i(a)},Kw.get());function l(){Pt().clearTimeout(c),s(r)}r.ping(l).then(l,()=>{i(a)})}))}const tA={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},nA=500,rA=600,sA="_blank",iA="http://localhost";class Gh{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function oA(n,e,t,r=nA,s=rA){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const l={...tA,width:r.toString(),height:s.toString(),top:i,left:a},h=Fe().toLowerCase();t&&(c=zp(h)?sA:t),jp(h)&&(e=e||iA,l.scrollbars="yes");const d=Object.entries(l).reduce((m,[I,S])=>`${m}${I}=${S},`,"");if(BI(h)&&c!=="_self")return aA(e||"",c),new Gh(null);const g=window.open(e||"",c,d);j(g,n,"popup-blocked");try{g.focus()}catch{}return new Gh(g)}function aA(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const cA="__/auth/handler",uA="emulator/auth/handler",lA=encodeURIComponent("fac");async function Kh(n,e,t,r,s,i){j(n.config.authDomain,n,"auth-domain-config-required"),j(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:zr,eventId:s};if(e instanceof uu){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",z_(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,g]of Object.entries({}))a[d]=g}if(e instanceof Ys){const d=e.getScopes().filter(g=>g!=="");d.length>0&&(a.scopes=d.join(","))}n.tenantId&&(a.tid=n.tenantId);const c=a;for(const d of Object.keys(c))c[d]===void 0&&delete c[d];const l=await n._getAppCheckToken(),h=l?`#${lA}=${encodeURIComponent(l)}`:"";return`${hA(n)}?${Hs(c).slice(1)}${h}`}function hA({config:n}){return n.emulator?su(n,uA):`https://${n.authDomain}/${cA}`}const Ia="webStorageSupport";class fA{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rm,this._completeRedirectFn=Lw,this._overrideRedirectResult=Vw}async _openPopup(e,t,r,s){Ht(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const i=await Kh(e,t,r,nc(),s);return oA(e,i,lu())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Kh(e,t,r,nc(),s);return mw(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Ht(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await eA(e),r=new Fw(e);return t.register("authEvent",s=>(j(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ia,{type:Ia},s=>{const i=s?.[0]?.[Ia];i!==void 0&&t(!!i),Ot(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=qw(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Qp()||qp()||au()}}const dA=fA;var Qh="@firebase/auth",Xh="1.11.1";class pA{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){j(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function mA(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function gA(n){Kn(new yn("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=r.options;j(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:a,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Xp(n)},h=new WI(r,s,i,l);return YI(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Kn(new yn("auth-internal",e=>{const t=Oo(e.getProvider("auth").getImmediate());return(r=>new pA(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),It(Qh,Xh,mA(n)),It(Qh,Xh,"esm2020")}const _A=300,yA=Yf("authIdTokenMaxAge")||_A;let Jh=null;const vA=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>yA)return;const s=t?.token;Jh!==s&&(Jh=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function EA(n=bc()){const e=go(n,"auth");if(e.isInitialized())return e.getImmediate();const t=JI(n,{popupRedirectResolver:dA,persistence:[Aw,fw,rm]}),r=Yf("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=vA(i.toString());aw(t,a,()=>a(t.currentUser)),ow(t,c=>a(c))}}const s=Qf("auth");return s&&ZI(t,`http://${s}`),t}function TA(){return document.getElementsByTagName("head")?.[0]??document}GI({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=ft("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",TA().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});gA("Browser");const IA={apiKey:"AIzaSyBC5VHNEcVL9KP8M0d64ZajF6P4Hzqzafc",authDomain:"bbnme-58716.firebaseapp.com",projectId:"bbnme-58716",storageBucket:"bbnme-58716.appspot.com",messagingSenderId:"155088179379",appId:"1:155088179379:web:5d98445c178b7513f520c6"},fu=td(IA),du=rI(fu),pu=EA(fu),wA=new Ft,xo=po(null),hm=po(!0);cw(pu,n=>{xo.set(n),hm.set(!1)});var AA=he('<button class="svelte-18sv61c"> </button>');function Bs(n,e){let t=Ke(e,"label",8,"Button"),r=Ke(e,"onClick",8,()=>{});var s=AA(),i=re(s);Ct(()=>fo(i,t())),Nt("click",s,function(...a){r()?.apply(this,a)}),se(n,s)}var bA=he('<div class="login-container svelte-8ukb9p"><h2 class="svelte-8ukb9p">Please sign in to continue</h2> <!></div>');function SA(n,e){nt(e,!1),at();var t=bA(),r=le(re(t),2);Bs(r,{label:"Sign in with Google",onClick:()=>Cw(pu,wA)}),se(n,t),rt()}var RA=he('<button class="hamburger-button svelte-p9dp8"><div class="bar svelte-p9dp8"></div> <div class="bar svelte-p9dp8"></div> <div class="bar svelte-p9dp8"></div></button>');function PA(n,e){nt(e,!1);const t=qs();function r(){t("toggle")}at();var s=RA();Nt("click",s,r),se(n,s),rt()}var CA=he('<span class="not-authorized-message svelte-rfuq4y">Unauthorized user</span>'),kA=he(`<nav class="svelte-rfuq4y"><!> <div class="navbar-title svelte-rfuq4y"><h1 class="svelte-rfuq4y">bb'n'me</h1></div> <div class="user-status svelte-rfuq4y"><!></div></nav>`);function NA(n,e){nt(e,!1);const t=()=>Tt(l,"$isAuthorizedToWriteStore",s),r=()=>Tt(xo,"$user",s),[s,i]=qr(),a=pe(),c=qs(),l=Cr("isAuthorizedToWrite");function h(){c("toggle")}_n(()=>t(),()=>{H(a,t())}),Zn(),at();var d=kA(),g=re(d);PA(g,{$$events:{toggle:h}});var m=le(g,4),I=re(m);{var S=C=>{var P=CA();se(C,P)};ht(I,C=>{r()&&!L(a)&&C(S)})}se(n,d),rt(),i()}var DA=he('<span class="not-authorized-message svelte-12buoxc">Unauthorized user</span>'),VA=he('<div class="user-profile svelte-12buoxc"><img alt="Profile" class="svelte-12buoxc"/> <span class="svelte-12buoxc"> </span> <!></div> <div class="nav-links-wrapper svelte-12buoxc"><div class="nav-links svelte-12buoxc"><a href="/" class="svelte-12buoxc">Home</a></div></div> <div class="sidenav-footer svelte-12buoxc"><!></div>',1),OA=he('<div><button class="close-button svelte-12buoxc">&times;</button> <!></div>');function MA(n,e){nt(e,!1);const t=()=>Tt(h,"$isAuthorizedToWriteStore",s),r=()=>Tt(xo,"$user",s),[s,i]=qr(),a=pe();let c=Ke(e,"isOpen",8,!1);const l=qs(),h=Cr("isAuthorizedToWrite");function d(){l("close")}_n(()=>t(),()=>{H(a,t())}),Zn(),at();var g=OA();let m;var I=re(g),S=le(I,2);{var C=P=>{var D=VA(),M=xn(D),V=re(M),U=le(V,2),G=re(U),Y=le(U,2);{var E=w=>{var T=DA();se(w,T)};ht(Y,w=>{L(a)||w(E)})}var _=le(M,4),y=re(_);Bs(y,{label:"Sign out",onClick:()=>uw(pu)}),Ct(()=>{Er(V,"src",(r(),Me(()=>r().photoURL))),fo(G,(r(),Me(()=>r().displayName)))}),se(P,D)};ht(S,P=>{r()&&P(C)})}Ct(()=>m=ks(g,1,"sidenav svelte-12buoxc",null,m,{open:c()})),Nt("click",I,d),se(n,g),rt(),i()}var LA=he('<form class="svelte-7mtrh0"><h2 class="svelte-7mtrh0">Add a new place</h2> <input type="text" placeholder="Place name" required class="svelte-7mtrh0"/> <input type="url" placeholder="Website" class="svelte-7mtrh0"/> <input type="url" placeholder="Image URL" class="svelte-7mtrh0"/> <!></form>');function xA(n,e){nt(e,!1);let t=pe(""),r=pe(""),s=pe("");async function i(){try{const g=await yI(Ip(du,"places"),{name:L(t),website:L(r),image:L(s)});console.log("Document written with ID: ",g.id),H(t,""),H(r,""),H(s,"")}catch(g){console.error("Error adding document: ",g)}}at();var a=LA(),c=le(re(a),2),l=le(c,2),h=le(l,2),d=le(h,2);Bs(d,{label:"Add Place",type:"submit"}),Tr(c,()=>L(t),g=>H(t,g)),Tr(l,()=>L(r),g=>H(r,g)),Tr(h,()=>L(s),g=>H(s,g)),Nt("submit",a,zf(i)),se(n,a),rt()}var FA=he('<div class="card svelte-1udyrqm"><!></div>');function fm(n,e){var t=FA(),r=re(t);Ec(r,e,"default",{}),se(n,t)}var UA=he('<button class="icon-button svelte-11linj7"><img class="svelte-11linj7"/></button>');function wa(n,e){nt(e,!1),qs();let t=Ke(e,"iconSrc",8),r=Ke(e,"altText",8,"Icon Button"),s=Ke(e,"onClick",8,()=>{}),i=Ke(e,"size",8,"md"),a=pe();function c(d){d.stopPropagation(),s()(d)}_n(()=>yc(i()),()=>{switch(i()){case"sm":H(a,"var(--spacing-lg)");break;case"lg":H(a,"var(--spacing-xl)");break;case"md":default:H(a,"33px");break}}),Zn(),at();var l=UA(),h=re(l);Ct(()=>{Er(h,"src",t()),Er(h,"alt",r()),u_(h,`width: ${L(a)??""}; height: ${L(a)??""};`)}),Nt("click",l,c),se(n,l),rt()}var BA=he("<div><!> <!></div>"),$A=he("<div><!> <!></div>");function jA(n,e){nt(e,!1);const t=()=>Tt(d,"$isAuthorizedToWriteStore",r),[r,s]=qr(),i=pe();let a=Ke(e,"place",8),c=Ke(e,"isHovered",8,!1);const l=qs();let h=pe(!1);const d=Cr("isAuthorizedToWrite");function g(U){U.preventDefault(),U.stopPropagation(),H(h,!L(h))}function m(U){U.preventDefault(),l("edit",a()),H(h,!1)}function I(U){U.preventDefault(),l("delete",a().id),H(h,!1)}function S(U){L(h)&&!U.target.closest(".see-more-menu")&&H(h,!1)}_n(()=>t(),()=>{H(i,t())}),_n(()=>(yc(c()),L(h)),()=>{!c()&&L(h)&&H(h,!1)}),Zn(),at();var C=$A();Nt("click",Ca,S);let P;var D=re(C);wa(D,{iconSrc:"./assets/see_more.png",altText:"See More Options",onClick:g,size:"md",class:"see-more-icon-button"});var M=le(D,2);{var V=U=>{var G=BA();let Y;var E=re(G);wa(E,{iconSrc:"./assets/edit.png",altText:"Edit",onClick:m,size:"sm"});var _=le(E,2);wa(_,{iconSrc:"./assets/delete.png",altText:"Delete",onClick:I,size:"sm"}),Ct(()=>Y=ks(G,1,"floating-actions svelte-1222uzl",null,Y,{open:L(h)})),se(U,G)};ht(M,U=>{L(h)&&L(i)&&U(V)})}Ct(()=>P=ks(C,1,"see-more-menu svelte-1222uzl",null,P,{visible:c()})),se(n,C),rt(),s()}var qA=he('<form class="svelte-136zmjt"><h2 class="svelte-136zmjt">Edit Place</h2> <input type="text" placeholder="Place name" required class="svelte-136zmjt"/> <input type="url" placeholder="Website" class="svelte-136zmjt"/> <input type="url" placeholder="Image URL" class="svelte-136zmjt"/> <div class="actions svelte-136zmjt"><!> <!></div></form>');function zA(n,e){nt(e,!1);let t=Ke(e,"place",8),r=Ke(e,"onSave",8,()=>{}),s=Ke(e,"onCancel",8,()=>{}),i=pe(t().name),a=pe(t().website),c=pe(t().image);async function l(){try{const P=wp(du,"places",t().id);await _I(P,{name:L(i),website:L(a),image:L(c)}),console.log("Document successfully updated!"),r()()}catch(P){console.error("Error updating document: ",P)}}at();var h=qA(),d=le(re(h),2),g=le(d,2),m=le(g,2),I=le(m,2),S=re(I);Bs(S,{label:"Save",type:"submit"});var C=le(S,2);Bs(C,{label:"Cancel",get onClick(){return s()}}),Tr(d,()=>L(i),P=>H(i,P)),Tr(g,()=>L(a),P=>H(a,P)),Tr(m,()=>L(c),P=>H(c,P)),Nt("submit",h,zf(l)),se(n,h),rt()}var HA=he('<div class="image-container svelte-13geuu4"><a target="_blank" rel="noreferrer" class="image-wrapper svelte-13geuu4"><img class="svelte-13geuu4"/> <!></a></div>'),WA=he('<div class="place-header svelte-13geuu4"><h3 class="svelte-13geuu4"><b> </b></h3></div> <!>',1),GA=he('<div class="places-list-container svelte-13geuu4"><h2 class="svelte-13geuu4">Travel Wishlist</h2> <div class="places-grid svelte-13geuu4"></div></div>');function KA(n,e){nt(e,!1);const t=()=>Tt(a,"$isAuthorizedToWriteStore",r),[r,s]=qr(),i=pe(),a=Cr("isAuthorizedToWrite");let c=pe([]),l=pe(null),h=pe(null);g_(()=>{const P=vI(Ip(du,"places"),D=>{H(c,D.docs.map(M=>({id:M.id,...M.data()})))});return()=>P()});function d(){H(l,null)}function g(){H(l,null)}function m(P){H(h,P)}function I(){H(h,null)}_n(()=>t(),()=>{H(i,t())}),Zn(),at();var S=GA(),C=le(re(S),2);$f(C,5,()=>L(c),Bf,(P,D)=>{fm(P,{children:(M,V)=>{var U=vc(),G=xn(U);{var Y=_=>{zA(_,{get place(){return L(l)},onSave:d,onCancel:g})},E=_=>{var y=WA(),w=xn(y),T=re(w),A=re(T),v=re(A),ve=le(w,2);{var qe=Qt=>{var rr=HA(),ct=re(rr),ze=re(ct),sr=le(ze,2);{var Xr=Xt=>{{let Jr=co(()=>(L(h),L(D),Me(()=>L(h)===L(D).id)));jA(Xt,{get place(){return L(D)},get isHovered(){return L(Jr)}})}};ht(sr,Xt=>{L(i)&&Xt(Xr)})}Ct(()=>{Er(ct,"href",(L(D),Me(()=>L(D).website))),Er(ze,"src",(L(D),Me(()=>L(D).image))),Er(ze,"alt",(L(D),Me(()=>L(D).name)))}),Nt("mouseenter",ct,()=>m(L(D).id)),Nt("mouseleave",ct,I),se(Qt,rr)};ht(ve,Qt=>{L(D),Me(()=>L(D).image)&&Qt(qe)})}Ct(()=>fo(v,(L(D),Me(()=>L(D).name)))),se(_,y)};ht(G,_=>{L(l),L(D),Me(()=>L(l)&&L(l).id===L(D).id)?_(Y):_(E,!1)})}se(M,U)},$$slots:{default:!0}})}),se(n,S),rt(),s()}var QA=he("<button> </button>"),XA=he('<div class="tabs-container svelte-126ak3w"><div class="tab-headers svelte-126ak3w"></div> <div class="tab-content svelte-126ak3w"><!></div></div>');function JA(n,e){nt(e,!1);let t=Ke(e,"activeTab",12,1);const r=po(t());Sa("activeTab",r);let s=[],i=pe([]);function a(m){return s=[...s,m],H(i,[...L(i),m]),s.length-1}Sa("registerTab",a);function c(m){t(m),r.set(t())}at();var l=XA(),h=re(l);$f(h,5,()=>L(i),Bf,(m,I,S)=>{var C=QA();let P;var D=re(C);Ct(()=>{P=ks(C,1,"tab-header svelte-126ak3w",null,P,{active:t()===S}),fo(D,L(I))}),Nt("click",C,()=>c(S)),se(m,C)});var d=le(h,2),g=re(d);Ec(g,e,"default",{}),se(n,l),rt()}var YA=he('<div class="tab-panel svelte-1vjnlah"><!></div>');function Yh(n,e){nt(e,!1);const t=()=>Tt(c,"$activeTabStore",r),[r,s]=qr(),i=pe();let a=Ke(e,"title",8);const c=Cr("activeTab"),l=Cr("registerTab");let h=pe();H(h,l(a())),_n(()=>(t(),L(h)),()=>{H(i,t()===L(h))}),Zn(),at();var d=vc(),g=xn(d);{var m=I=>{var S=YA(),C=re(S);Ec(C,e,"default",{}),se(I,S)};ht(g,I=>{L(i)&&I(m)})}se(n,d),rt(),s()}const ZA="type.googleapis.com/google.protobuf.Int64Value",eb="type.googleapis.com/google.protobuf.UInt64Value";function dm(n,e){const t={};for(const r in n)n.hasOwnProperty(r)&&(t[r]=e(n[r]));return t}function to(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>to(e));if(typeof n=="function"||typeof n=="object")return dm(n,e=>to(e));throw new Error("Data cannot be encoded in JSON: "+n)}function Ur(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case ZA:case eb:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>Ur(e)):typeof n=="function"||typeof n=="object"?dm(n,e=>Ur(e)):n}const mu="functions";const Zh={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Qe extends Lt{constructor(e,t,r){super(`${mu}/${e}`,t||""),this.details=r,Object.setPrototypeOf(this,Qe.prototype)}}function tb(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function no(n,e){let t=tb(n),r=t,s;try{const i=e&&e.error;if(i){const a=i.status;if(typeof a=="string"){if(!Zh[a])return new Qe("internal","internal");t=Zh[a],r=a}const c=i.message;typeof c=="string"&&(r=c),s=i.details,s!==void 0&&(s=Ur(s))}}catch{}return t==="ok"?null:new Qe(t,r,s)}class nb{constructor(e,t,r,s){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,it(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||t.get().then(i=>this.auth=i,()=>{}),this.messaging||r.get().then(i=>this.messaging=i,()=>{}),this.appCheck||s?.get().then(i=>this.appCheck=i,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),r=await this.getMessagingToken(),s=await this.getAppCheckToken(e);return{authToken:t,messagingToken:r,appCheckToken:s}}}const ic="us-central1",rb=/^data: (.*?)(?:\n|$)/;function sb(n){let e=null;return{promise:new Promise((t,r)=>{e=setTimeout(()=>{r(new Qe("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class ib{constructor(e,t,r,s,i=ic,a=(...c)=>fetch(...c)){this.app=e,this.fetchImpl=a,this.emulatorOrigin=null,this.contextProvider=new nb(e,t,r,s),this.cancelAllRequests=new Promise(c=>{this.deleteService=()=>Promise.resolve(c())});try{const c=new URL(i);this.customDomain=c.origin+(c.pathname==="/"?"":c.pathname),this.region=ic}catch{this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function ob(n,e,t){const r=bn(e);n.emulatorOrigin=`http${r?"s":""}://${e}:${t}`,r&&(Tc(n.emulatorOrigin+"/backends"),Ic("Functions",!0))}function ab(n,e,t){const r=s=>ub(n,e,s,{});return r.stream=(s,i)=>hb(n,e,s,i),r}function pm(n){return n.emulatorOrigin&&bn(n.emulatorOrigin)?"include":void 0}async function cb(n,e,t,r,s){t["Content-Type"]="application/json";let i;try{i=await r(n,{method:"POST",body:JSON.stringify(e),headers:t,credentials:pm(s)})}catch{return{status:0,json:null}}let a=null;try{a=await i.json()}catch{}return{status:i.status,json:a}}async function mm(n,e){const t={},r=await n.contextProvider.getContext(e.limitedUseAppCheckTokens);return r.authToken&&(t.Authorization="Bearer "+r.authToken),r.messagingToken&&(t["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(t["X-Firebase-AppCheck"]=r.appCheckToken),t}function ub(n,e,t,r){const s=n._url(e);return lb(n,s,t,r)}async function lb(n,e,t,r){t=to(t);const s={data:t},i=await mm(n,r),a=r.timeout||7e4,c=sb(a),l=await Promise.race([cb(e,s,i,n.fetchImpl,n),c.promise,n.cancelAllRequests]);if(c.cancel(),!l)throw new Qe("cancelled","Firebase Functions instance was deleted.");const h=no(l.status,l.json);if(h)throw h;if(!l.json)throw new Qe("internal","Response is not valid JSON object.");let d=l.json.data;if(typeof d>"u"&&(d=l.json.result),typeof d>"u")throw new Qe("internal","Response is missing data field.");return{data:Ur(d)}}function hb(n,e,t,r){const s=n._url(e);return fb(n,s,t,r||{})}async function fb(n,e,t,r){t=to(t);const s={data:t},i=await mm(n,r);i["Content-Type"]="application/json",i.Accept="text/event-stream";let a;try{a=await n.fetchImpl(e,{method:"POST",body:JSON.stringify(s),headers:i,signal:r?.signal,credentials:pm(n)})}catch(m){if(m instanceof Error&&m.name==="AbortError"){const S=new Qe("cancelled","Request was cancelled.");return{data:Promise.reject(S),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(S)}}}}}}const I=no(0,null);return{data:Promise.reject(I),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(I)}}}}}}let c,l;const h=new Promise((m,I)=>{c=m,l=I});r?.signal?.addEventListener("abort",()=>{const m=new Qe("cancelled","Request was cancelled.");l(m)});const d=a.body.getReader(),g=db(d,c,l,r?.signal);return{stream:{[Symbol.asyncIterator](){const m=g.getReader();return{async next(){const{value:I,done:S}=await m.read();return{value:I,done:S}},async return(){return await m.cancel(),{done:!0,value:void 0}}}}},data:h}}function db(n,e,t,r){const s=(a,c)=>{const l=a.match(rb);if(!l)return;const h=l[1];try{const d=JSON.parse(h);if("result"in d){e(Ur(d.result));return}if("message"in d){c.enqueue(Ur(d.message));return}if("error"in d){const g=no(0,d);c.error(g),t(g);return}}catch(d){if(d instanceof Qe){c.error(d),t(d);return}}},i=new TextDecoder;return new ReadableStream({start(a){let c="";return l();async function l(){if(r?.aborted){const h=new Qe("cancelled","Request was cancelled");return a.error(h),t(h),Promise.resolve()}try{const{value:h,done:d}=await n.read();if(d){c.trim()&&s(c.trim(),a),a.close();return}if(r?.aborted){const m=new Qe("cancelled","Request was cancelled");a.error(m),t(m),await n.cancel();return}c+=i.decode(h,{stream:!0});const g=c.split(`
`);c=g.pop()||"";for(const m of g)m.trim()&&s(m.trim(),a);return l()}catch(h){const d=h instanceof Qe?h:no(0,null);a.error(d),t(d)}}},cancel(){return n.cancel()}})}const ef="@firebase/functions",tf="0.13.1";const pb="auth-internal",mb="app-check-internal",gb="messaging-internal";function _b(n){const e=(t,{instanceIdentifier:r})=>{const s=t.getProvider("app").getImmediate(),i=t.getProvider(pb),a=t.getProvider(gb),c=t.getProvider(mb);return new ib(s,i,a,c,r)};Kn(new yn(mu,e,"PUBLIC").setMultipleInstances(!0)),It(ef,tf,n),It(ef,tf,"esm2020")}function yb(n=bc(),e=ic){const r=go(ye(n),mu).getImmediate({identifier:e}),s=Xf("functions");return s&&vb(r,...s),r}function vb(n,e,t){ob(ye(n),e,t)}function Eb(n,e,t){return ab(ye(n),e)}_b();var Tb=he('<div class="loading-screen svelte-1n46o8q"><img src="./assets/loading_image.png" alt="Loading..." class="loading-image svelte-1n46o8q"/></div>'),Ib=he("<!> <!>",1),wb=he('<!> <!> <div class="container svelte-1n46o8q"><!></div>',1),Ab=he("<main><!></main>");function bb(n,e){nt(e,!1);const t=()=>Tt(hm,"$authLoading",i),r=()=>Tt(xo,"$user",i),s=()=>Tt(h,"$isAuthorizedToWriteStore",i),[i,a]=qr(),c=yb(fu),l=Eb(c,"checkAuthorization"),h=po(!1);let d=pe(!1),g=pe(!1);Sa("isAuthorizedToWrite",h);function m(){H(g,!L(g))}_n(()=>(t(),r()),()=>{!t()&&r()?l().then(M=>{h.set(M.data.status==="authorized"),H(d,!0)}).catch(M=>{console.error("Error checking authorization:",M),h.set(!1),H(d,!0)}):!t()&&!r()?(h.set(!1),H(d,!0)):(h.set(!1),H(d,!1))}),Zn(),at();var I=Ab();let S;var C=re(I);{var P=M=>{var V=Tb();se(M,V)},D=M=>{var V=vc(),U=xn(V);{var G=E=>{var _=wb(),y=xn(_);NA(y,{$$events:{toggle:m}});var w=le(y,2);MA(w,{get isOpen(){return L(g)},$$events:{close:m}});var T=le(w,2),A=re(T);JA(A,{children:(v,ve)=>{var qe=Ib(),Qt=xn(qe);{var rr=ze=>{Yh(ze,{title:"Add Place",children:(sr,Xr)=>{fm(sr,{children:(Xt,Jr)=>{xA(Xt,{})},$$slots:{default:!0}})},$$slots:{default:!0}})};ht(Qt,ze=>{L(d)&&s()&&ze(rr)})}var ct=le(Qt,2);Yh(ct,{title:"Travel Wishlist",children:(ze,sr)=>{KA(ze,{})},$$slots:{default:!0}}),se(v,qe)},$$slots:{default:!0}}),se(E,_)},Y=E=>{SA(E,{})};ht(U,E=>{r()?E(G):E(Y,!1)},!0)}se(M,V)};ht(C,M=>{t()||!L(d)?M(P):M(D,!1)})}Ct(()=>S=ks(I,1,"svelte-1n46o8q",null,S,{"fullscreen-main":t()||!L(d)})),se(n,I),rt(),a()}t_(bb,{target:document.getElementById("app")});
